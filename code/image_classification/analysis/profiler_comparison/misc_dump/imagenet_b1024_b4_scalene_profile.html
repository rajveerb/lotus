<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
.r1 {font-style: italic}
.r2 {font-weight: bold}
.r3 {color: #000080; text-decoration-color: #000080; font-weight: bold}
.r4 {color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold}
.r5 {color: #000080; text-decoration-color: #000080; font-weight: bold; font-style: italic}
.r6 {color: #7f7f7f; text-decoration-color: #7f7f7f}
.r7 {color: #000080; text-decoration-color: #000080}
.r8 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8; font-style: italic}
.r9 {background-color: #f8f8f8}
.r10 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8; font-weight: bold}
.r11 {color: #000000; text-decoration-color: #000000; background-color: #f8f8f8}
.r12 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8; font-weight: bold}
.r13 {color: #cb3f38; text-decoration-color: #cb3f38; background-color: #f8f8f8; font-weight: bold}
.r14 {color: #3d7b7b; text-decoration-color: #3d7b7b; background-color: #f8f8f8; font-style: italic}
.r15 {color: #666666; text-decoration-color: #666666; background-color: #f8f8f8}
.r16 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8}
.r17 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8}
.r18 {color: #bbbbbb; text-decoration-color: #bbbbbb; background-color: #f8f8f8}
.r19 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8; font-weight: bold}
.r20 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8}
.r21 {color: #a45a77; text-decoration-color: #a45a77; background-color: #f8f8f8; font-weight: bold}
.r22 {color: #19177c; text-decoration-color: #19177c; background-color: #f8f8f8}
.r23 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8}
.r24 {font-weight: bold; font-style: italic}
.r25 {color: #aa5d1f; text-decoration-color: #aa5d1f; background-color: #f8f8f8; font-weight: bold}
.r26 {color: #000080; text-decoration-color: #000080; text-decoration: underline}
body {
    color: #000000;
    background-color: #ffffff;
}
</style>
</head>
<body>
    <pre style="font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><code style="font-family:inherit"><span class="r1"> /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/threading.py: % of time =  69.87% (3h:34m:57.409s) out of 4h:40m:20.690s.  </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/threading.py                             </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;Thread module emulating a subset of Java&#x27;s threading model.&quot;&quot;&quot;</span><span class="r9">                              </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">os</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> </span><span class="r12">_os</span><span class="r9">                                                                               </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">sys</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> </span><span class="r12">_sys</span><span class="r9">                                                                             </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">_thread</span><span class="r9">                                                                                 </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">functools</span><span class="r9">                                                                               </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">time</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> monotonic </span><span class="r10">as</span><span class="r11"> _time</span><span class="r9">                                                            </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">_weakrefset</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> WeakSet</span><span class="r9">                                                                </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">itertools</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> islice </span><span class="r10">as</span><span class="r11"> _islice, count </span><span class="r10">as</span><span class="r11"> _count</span><span class="r9">                                       </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">_collections</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> deque </span><span class="r10">as</span><span class="r11"> _deque</span><span class="r9">                                                   </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">collections</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> deque </span><span class="r10">as</span><span class="r11"> _deque</span><span class="r9">                                                    </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Note regarding PEP 8 compliant names</span><span class="r9">                                                         </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#  This threading model was originally inspired by Java, and inherited</span><span class="r9">                         </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># the convention of camelCase function and method names from that</span><span class="r9">                              </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># language. Those original names are not in any imminent danger of</span><span class="r9">                             </span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># being deprecated (even for Py3k),so this module provides them as an</span><span class="r9">                          </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># alias for the PEP 8 compliant names</span><span class="r9">                                                          </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Note that using the new PEP 8 compliant names facilitates substitution</span><span class="r9">                       </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># with the multiprocessing module, which doesn&#x27;t provide the old</span><span class="r9">                               </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Java inspired names.</span><span class="r9">                                                                         </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">__all__ </span><span class="r15">=</span><span class="r11"> [</span><span class="r16">&#x27;get_ident&#x27;</span><span class="r11">, </span><span class="r16">&#x27;active_count&#x27;</span><span class="r11">, </span><span class="r16">&#x27;Condition&#x27;</span><span class="r11">, </span><span class="r16">&#x27;current_thread&#x27;</span><span class="r11">,</span><span class="r9">                         </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&#x27;enumerate&#x27;</span><span class="r11">, </span><span class="r16">&#x27;main_thread&#x27;</span><span class="r11">, </span><span class="r16">&#x27;TIMEOUT_MAX&#x27;</span><span class="r11">,</span><span class="r9">                                          </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&#x27;Event&#x27;</span><span class="r11">, </span><span class="r16">&#x27;Lock&#x27;</span><span class="r11">, </span><span class="r16">&#x27;RLock&#x27;</span><span class="r11">, </span><span class="r16">&#x27;Semaphore&#x27;</span><span class="r11">, </span><span class="r16">&#x27;BoundedSemaphore&#x27;</span><span class="r11">, </span><span class="r16">&#x27;Thread&#x27;</span><span class="r11">,</span><span class="r9">                </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&#x27;Barrier&#x27;</span><span class="r11">, </span><span class="r16">&#x27;BrokenBarrierError&#x27;</span><span class="r11">, </span><span class="r16">&#x27;Timer&#x27;</span><span class="r11">, </span><span class="r16">&#x27;ThreadError&#x27;</span><span class="r11">,</span><span class="r9">                            </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&#x27;setprofile&#x27;</span><span class="r11">, </span><span class="r16">&#x27;settrace&#x27;</span><span class="r11">, </span><span class="r16">&#x27;local&#x27;</span><span class="r11">, </span><span class="r16">&#x27;stack_size&#x27;</span><span class="r11">,</span><span class="r9">                                    </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&#x27;excepthook&#x27;</span><span class="r11">, </span><span class="r16">&#x27;ExceptHookArgs&#x27;</span><span class="r11">, </span><span class="r16">&#x27;gettrace&#x27;</span><span class="r11">, </span><span class="r16">&#x27;getprofile&#x27;</span><span class="r11">]</span><span class="r9">                           </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Rename some stuff so &quot;from threading import *&quot; is safe</span><span class="r9">                                       </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_start_new_thread </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">start_new_thread</span><span class="r9">                                                   </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_allocate_lock </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">allocate_lock</span><span class="r9">                                                         </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_set_sentinel </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">_set_sentinel</span><span class="r9">                                                          </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">get_ident </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">get_ident</span><span class="r9">                                                                  </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    get_native_id </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">get_native_id</span><span class="r9">                                                      </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _HAVE_THREAD_NATIVE_ID </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                              </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&#x27;get_native_id&#x27;</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _HAVE_THREAD_NATIVE_ID </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                             </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ThreadError </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">error</span><span class="r9">                                                                    </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _CRLock </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">RLock</span><span class="r9">                                                                    </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _CRLock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                             </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">TIMEOUT_MAX </span><span class="r15">=</span><span class="r11"> _thread</span><span class="r15">.</span><span class="r11">TIMEOUT_MAX</span><span class="r9">                                                              </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">del</span><span class="r11"> _thread</span><span class="r9">                                                                                    </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Support for profile and trace hooks</span><span class="r9">                                                          </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_profile_hook </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                           </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_trace_hook </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                             </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">setprofile</span><span class="r11">(func):</span><span class="r9">                                                                          </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Set a profile function for all threads started from the threading module.</span><span class="r9">               </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The func will be passed to sys.setprofile() for each thread, before its</span><span class="r9">                    </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    run() method is called.</span><span class="r9">                                                                    </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _profile_hook</span><span class="r9">                                                                       </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _profile_hook </span><span class="r15">=</span><span class="r11"> func</span><span class="r9">                                                                       </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getprofile</span><span class="r11">():</span><span class="r9">                                                                              </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Get the profiler function as set by threading.setprofile().&quot;&quot;&quot;</span><span class="r9">                          </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> _profile_hook</span><span class="r9">                                                                       </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">settrace</span><span class="r11">(func):</span><span class="r9">                                                                            </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Set a trace function for all threads started from the threading module.</span><span class="r9">                 </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The func will be passed to sys.settrace() for each thread, before its run()</span><span class="r9">                </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    method is called.</span><span class="r9">                                                                          </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _trace_hook</span><span class="r9">                                                                         </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _trace_hook </span><span class="r15">=</span><span class="r11"> func</span><span class="r9">                                                                         </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">gettrace</span><span class="r11">():</span><span class="r9">                                                                                </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Get the trace function as set by threading.settrace().&quot;&quot;&quot;</span><span class="r9">                               </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> _trace_hook</span><span class="r9">                                                                         </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Synchronization classes</span><span class="r9">                                                                      </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Lock </span><span class="r15">=</span><span class="r11"> _allocate_lock</span><span class="r9">                                                                          </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">RLock</span><span class="r11">(</span><span class="r15">*</span><span class="r11">args, </span><span class="r15">**</span><span class="r11">kwargs):</span><span class="r9">                                                                    </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Factory function that returns a new reentrant lock.</span><span class="r9">                                     </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A reentrant lock must be released by the thread that acquired it. Once a</span><span class="r9">                   </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    thread has acquired a reentrant lock, the same thread may acquire it again</span><span class="r9">                 </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    without blocking; the thread must release it once for each time it has</span><span class="r9">                     </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    acquired it.</span><span class="r9">                                                                               </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _CRLock </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _PyRLock(</span><span class="r15">*</span><span class="r11">args, </span><span class="r15">**</span><span class="r11">kwargs)</span><span class="r9">                                                       </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> _CRLock(</span><span class="r15">*</span><span class="r11">args, </span><span class="r15">**</span><span class="r11">kwargs)</span><span class="r9">                                                            </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">_RLock</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;This class implements reentrant lock objects.</span><span class="r9">                                           </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A reentrant lock must be released by the thread that acquired it. Once a</span><span class="r9">                   </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    thread has acquired a reentrant lock, the same thread may acquire it</span><span class="r9">                       </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    again without blocking; the thread must release it once for each time it</span><span class="r9">                   </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    has acquired it.</span><span class="r9">                                                                           </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block </span><span class="r15">=</span><span class="r11"> _allocate_lock()</span><span class="r9">                                                         </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                     </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__repr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        owner </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner</span><span class="r9">                                                                    </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            owner </span><span class="r15">=</span><span class="r11"> _active[owner]</span><span class="r15">.</span><span class="r11">name</span><span class="r9">                                                        </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">&quot;&lt;</span><span class="r21">%s</span><span class="r16"> </span><span class="r21">%s</span><span class="r16">.</span><span class="r21">%s</span><span class="r16"> object owner=</span><span class="r21">%r</span><span class="r16"> count=</span><span class="r21">%d</span><span class="r16"> at </span><span class="r21">%s</span><span class="r16">&gt;&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (</span><span class="r9">                                 </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;locked&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">locked() </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;unlocked&quot;</span><span class="r11">,</span><span class="r9">                                  </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__module__</span><span class="r11">,</span><span class="r9">                                                         </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__qualname__</span><span class="r11">,</span><span class="r9">                                                       </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            owner,</span><span class="r9">                                                                             </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count,</span><span class="r9">                                                                       </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">hex</span><span class="r11">(</span><span class="r20">id</span><span class="r11">(</span><span class="r20">self</span><span class="r11">))</span><span class="r9">                                                                      </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_at_fork_reinit</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">_at_fork_reinit()</span><span class="r9">                                                          </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                     </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">acquire</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, blocking</span><span class="r15">=</span><span class="r10">True</span><span class="r11">, timeout</span><span class="r15">=-1</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Acquire a lock, blocking or non-blocking.</span><span class="r9">                                           </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked without arguments: if this thread already owns the lock,</span><span class="r9">                  </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        increment the recursion level by one, and return immediately. Otherwise,</span><span class="r9">               </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        if another thread owns the lock, block until the lock is unlocked. Once</span><span class="r9">                </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the lock is unlocked (not owned by any thread), then grab ownership, set</span><span class="r9">               </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the recursion level to one, and return. If more than one thread is</span><span class="r9">                     </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        blocked waiting until the lock is unlocked, only one at a time will be</span><span class="r9">                 </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        able to grab ownership of the lock. There is no return value in this</span><span class="r9">                   </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        case.</span><span class="r9">                                                                                  </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with the blocking argument set to true, do the same thing</span><span class="r9">                 </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        as when called without arguments, and return true.</span><span class="r9">                                     </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with the blocking argument set to false, do not block. If a</span><span class="r9">               </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        call without an argument would block, return false immediately;</span><span class="r9">                        </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        otherwise, do the same thing as when called without arguments, and</span><span class="r9">                     </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        return true.</span><span class="r9">                                                                           </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with the floating-point timeout argument set to a positive</span><span class="r9">                </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        value, block for at most the number of seconds specified by timeout</span><span class="r9">                    </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and as long as the lock cannot be acquired.  Return true if the lock has</span><span class="r9">               </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        been acquired, false if the timeout has elapsed.</span><span class="r9">                                       </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        me </span><span class="r15">=</span><span class="r11"> get_ident()</span><span class="r9">                                                                       </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">==</span><span class="r11"> me:</span><span class="r9">                                                                  </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                   </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                           </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rc </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">acquire(blocking, timeout)</span><span class="r9">                                            </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> rc:</span><span class="r9">                                                                                 </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> me</span><span class="r9">                                                                   </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                    </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> rc</span><span class="r9">                                                                              </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r17">__enter__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> acquire</span><span class="r9">                                                                        </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">release</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Release a lock, decrementing the recursion level.</span><span class="r9">                                   </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If after the decrement it is zero, reset the lock to unlocked (not owned</span><span class="r9">               </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        by any thread), and if any other threads are blocked waiting for the</span><span class="r9">                   </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        lock to become unlocked, allow exactly one of them to proceed. If after</span><span class="r9">                </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the decrement the recursion level is still nonzero, the lock remains</span><span class="r9">                   </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        locked and owned by the calling thread.</span><span class="r9">                                                </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Only call this method when the calling thread owns the lock. A</span><span class="r9">                         </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        RuntimeError is raised if this method is called when the lock is</span><span class="r9">                       </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        unlocked.</span><span class="r9">                                                                              </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        There is no return value.</span><span class="r9">                                                              </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">!=</span><span class="r11"> get_ident():</span><span class="r9">                                                         </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot release un-acquired lock&quot;</span><span class="r11">)</span><span class="r9">                              </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> count </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">-</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                  </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> count:</span><span class="r9">                                                                          </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                 </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                              </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, t, v, tb):</span><span class="r9">                                                              </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                         </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Internal methods used by condition variables</span><span class="r9">                                             </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_acquire_restore</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, state):</span><span class="r9">                                                         </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                                  </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> state</span><span class="r9">                                                       </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_release_save</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot release un-acquired lock&quot;</span><span class="r11">)</span><span class="r9">                              </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        count </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count</span><span class="r9">                                                                    </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        owner </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner</span><span class="r9">                                                                    </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                     </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_block</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                  </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> (count, owner)</span><span class="r9">                                                                  </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_is_owned</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_owner </span><span class="r15">==</span><span class="r11"> get_ident()</span><span class="r9">                                                      </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_PyRLock </span><span class="r15">=</span><span class="r11"> _RLock</span><span class="r9">                                                                              </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Condition</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Class that implements a condition variable.</span><span class="r9">                                             </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A condition variable allows one or more threads to wait until they are</span><span class="r9">                     </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    notified by another thread.</span><span class="r9">                                                                </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If the lock argument is given and not None, it must be a Lock or RLock</span><span class="r9">                     </span>  
 <span class="r6">   231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    object, and it is used as the underlying lock. Otherwise, a new RLock object</span><span class="r9">               </span>  
 <span class="r6">   232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    is created and used as the underlying lock.</span><span class="r9">                                                </span>  
 <span class="r6">   233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, lock</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> lock </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lock </span><span class="r15">=</span><span class="r11"> RLock()</span><span class="r9">                                                                     </span>  
 <span class="r6">   239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock </span><span class="r15">=</span><span class="r11"> lock</span><span class="r9">                                                                      </span>  
 <span class="r6">   240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Export the lock&#x27;s acquire() and release() methods</span><span class="r9">                                    </span>  
 <span class="r6">   241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">acquire </span><span class="r15">=</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">acquire</span><span class="r9">                                                            </span>  
 <span class="r6">   242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">release </span><span class="r15">=</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">release</span><span class="r9">                                                            </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># If the lock defines _release_save() and/or _acquire_restore(),</span><span class="r9">                       </span>  
 <span class="r6">   244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># these override the default implementations (which just call</span><span class="r9">                          </span>  
 <span class="r6">   245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># release() and acquire() on the lock).  Ditto for _is_owned().</span><span class="r9">                        </span>  
 <span class="r6">   246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_release_save </span><span class="r15">=</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">_release_save</span><span class="r9">                                            </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_acquire_restore </span><span class="r15">=</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">_acquire_restore</span><span class="r9">                                      </span>  
 <span class="r6">   252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_owned </span><span class="r15">=</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">_is_owned</span><span class="r9">                                                    </span>  
 <span class="r6">   256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters </span><span class="r15">=</span><span class="r11"> _deque()</span><span class="r9">                                                               </span>  
 <span class="r6">   259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_at_fork_reinit</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">   261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r11">_at_fork_reinit()</span><span class="r9">                                                           </span>  
 <span class="r6">   262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                  </span>  
 <span class="r6">   263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__enter__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r17">__enter__</span><span class="r11">()</span><span class="r9">                                                          </span>  
 <span class="r6">   266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                                 </span>  
 <span class="r6">   268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r17">__exit__</span><span class="r11">(</span><span class="r15">*</span><span class="r11">args)</span><span class="r9">                                                      </span>  
 <span class="r6">   269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__repr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">&quot;&lt;Condition(</span><span class="r21">%s</span><span class="r16">, </span><span class="r21">%d</span><span class="r16">)&gt;&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock, </span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters))</span><span class="r9">                        </span>  
 <span class="r6">   272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_release_save</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">   274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r11">release()           </span><span class="r14"># No state to save</span><span class="r9">                                      </span>  
 <span class="r6">   275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_acquire_restore</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, x):</span><span class="r9">                                                             </span>  
 <span class="r6">   277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r11">acquire()           </span><span class="r14"># Ignore saved state</span><span class="r9">                                    </span>  
 <span class="r6">   278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_is_owned</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Return True if lock is owned by current_thread.</span><span class="r9">                                      </span>  
 <span class="r6">   281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># This method is called only if _lock doesn&#x27;t have _is_owned().</span><span class="r9">                        </span>  
 <span class="r6">   282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r11">acquire(</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_lock</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                               </span>  
 <span class="r6">   284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                       </span>  
 <span class="r6">   285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                        </span>  
 <span class="r6">   287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">wait</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">   289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wait until notified or until a timeout occurs.</span><span class="r9">                                      </span>  
 <span class="r6">   290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the calling thread has not acquired the lock when this method is</span><span class="r9">                    </span>  
 <span class="r6">   292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        called, a RuntimeError is raised.</span><span class="r9">                                                      </span>  
 <span class="r6">   293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method releases the underlying lock, and then blocks until it is</span><span class="r9">                  </span>  
 <span class="r6">   295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        awakened by a notify() or notify_all() call for the same condition</span><span class="r9">                     </span>  
 <span class="r6">   296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        variable in another thread, or until the optional timeout occurs. Once</span><span class="r9">                 </span>  
 <span class="r6">   297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        awakened or timed out, it re-acquires the lock and returns.</span><span class="r9">                            </span>  
 <span class="r6">   298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the timeout argument is present and not None, it should be a</span><span class="r9">                      </span>  
 <span class="r6">   300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        floating point number specifying a timeout for the operation in seconds</span><span class="r9">                </span>  
 <span class="r6">   301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (or fractions thereof).</span><span class="r9">                                                                </span>  
 <span class="r6">   302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the underlying lock is an RLock, it is not released using its</span><span class="r9">                     </span>  
 <span class="r6">   304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        release() method, since this may not actually unlock the lock when it</span><span class="r9">                  </span>  
 <span class="r6">   305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        was acquired multiple times recursively. Instead, an internal interface</span><span class="r9">                </span>  
 <span class="r6">   306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        of the RLock class is used, which really unlocks it even when it has</span><span class="r9">                   </span>  
 <span class="r6">   307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        been recursively acquired several times. Another internal interface is</span><span class="r9">                 </span>  
 <span class="r6">   308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        then used to restore the recursion level when the lock is reacquired.</span><span class="r9">                  </span>  
 <span class="r6">   309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_owned():</span><span class="r9">                                                               </span>  
 <span class="r6">   312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot wait on un-acquired lock&quot;</span><span class="r11">)</span><span class="r9">                              </span>  
 <span class="r6">   313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        waiter </span><span class="r15">=</span><span class="r11"> _allocate_lock()</span><span class="r9">                                                              </span>  
 <span class="r6">   314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        waiter</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                                       </span>  
 <span class="r6">   315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters</span><span class="r15">.</span><span class="r11">append(waiter)</span><span class="r9">                                                           </span>  
 <span class="r6">   316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        saved_state </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_release_save()</span><span class="r9">                                                     </span>  
 <span class="r6">   317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        gotit </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                          </span>  
 <span class="r6">   318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:    </span><span class="r14"># restore state no matter what (e.g., KeyboardInterrupt)</span><span class="r9">                       </span>  
 <span class="r6">   319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   320 </span>│<span class="r7">        </span>│<span class="r7">    5% </span>│<span class="r7">  25%  </span>│<span class="r11">                waiter</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                               </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                gotit </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                   </span>  
 <span class="r6">   322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">   3%  </span>│<span class="r11">                    gotit </span><span class="r15">=</span><span class="r11"> waiter</span><span class="r15">.</span><span class="r11">acquire(</span><span class="r10">True</span><span class="r11">, timeout)</span><span class="r9">                                      </span>  
 <span class="r6">   325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    gotit </span><span class="r15">=</span><span class="r11"> waiter</span><span class="r15">.</span><span class="r11">acquire(</span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                              </span>  
 <span class="r6">   327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> gotit</span><span class="r9">                                                                       </span>  
 <span class="r6">   328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_acquire_restore(saved_state)</span><span class="r9">                                                 </span>  
 <span class="r6">   330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> gotit:</span><span class="r9">                                                                      </span>  
 <span class="r6">   331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters</span><span class="r15">.</span><span class="r11">remove(waiter)</span><span class="r9">                                               </span>  
 <span class="r6">   333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">   334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">   335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">wait_for</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, predicate, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                               </span>  
 <span class="r6">   337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wait until a condition evaluates to True.</span><span class="r9">                                           </span>  
 <span class="r6">   338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        predicate should be a callable which result will be interpreted as a</span><span class="r9">                   </span>  
 <span class="r6">   340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        boolean value.  A timeout may be provided giving the maximum time to</span><span class="r9">                   </span>  
 <span class="r6">   341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        wait.</span><span class="r9">                                                                                  </span>  
 <span class="r6">   342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        endtime </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        waittime </span><span class="r15">=</span><span class="r11"> timeout</span><span class="r9">                                                                     </span>  
 <span class="r6">   346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        result </span><span class="r15">=</span><span class="r11"> predicate()</span><span class="r9">                                                                   </span>  
 <span class="r6">   347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> result:</span><span class="r9">                                                                      </span>  
 <span class="r6">   348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> waittime </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">   349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> endtime </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">   350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    endtime </span><span class="r15">=</span><span class="r11"> _time() </span><span class="r15">+</span><span class="r11"> waittime</span><span class="r9">                                               </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    waittime </span><span class="r15">=</span><span class="r11"> endtime </span><span class="r15">-</span><span class="r11"> _time()</span><span class="r9">                                               </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> waittime </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">   354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">break</span><span class="r9">                                                                  </span>  
 <span class="r6">   355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">wait(waittime)</span><span class="r9">                                                                </span>  
 <span class="r6">   356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            result </span><span class="r15">=</span><span class="r11"> predicate()</span><span class="r9">                                                               </span>  
 <span class="r6">   357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> result</span><span class="r9">                                                                          </span>  
 <span class="r6">   358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">notify</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, n</span><span class="r15">=1</span><span class="r11">):</span><span class="r9">                                                                     </span>  
 <span class="r6">   360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wake up one or more threads waiting on this condition, if any.</span><span class="r9">                      </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the calling thread has not acquired the lock when this method is</span><span class="r9">                    </span>  
 <span class="r6">   363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        called, a RuntimeError is raised.</span><span class="r9">                                                      </span>  
 <span class="r6">   364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method wakes up at most n of the threads waiting for the condition</span><span class="r9">                </span>  
 <span class="r6">   366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        variable; it is a no-op if no threads are waiting.</span><span class="r9">                                     </span>  
 <span class="r6">   367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_owned():</span><span class="r9">                                                               </span>  
 <span class="r6">   370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot notify on un-acquired lock&quot;</span><span class="r11">)</span><span class="r9">                            </span>  
 <span class="r6">   371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        waiters </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters</span><span class="r9">                                                                </span>  
 <span class="r6">   372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> waiters </span><span class="r19">and</span><span class="r11"> n </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            waiter </span><span class="r15">=</span><span class="r11"> waiters[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                </span>  
 <span class="r6">   374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                waiter</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                               </span>  
 <span class="r6">   376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># gh-92530: The previous call of notify() released the lock,</span><span class="r9">                   </span>  
 <span class="r6">   378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># but was interrupted before removing it from the queue.</span><span class="r9">                       </span>  
 <span class="r6">   379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># It can happen if a signal handler raises an exception,</span><span class="r9">                       </span>  
 <span class="r6">   380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># like CTRL+C which raises KeyboardInterrupt.</span><span class="r9">                                  </span>  
 <span class="r6">   381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                n </span><span class="r15">-=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                         </span>  
 <span class="r6">   384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                waiters</span><span class="r15">.</span><span class="r11">remove(waiter)</span><span class="r9">                                                         </span>  
 <span class="r6">   386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">notify_all</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">   390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wake up all threads waiting on this condition.</span><span class="r9">                                      </span>  
 <span class="r6">   391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the calling thread has not acquired the lock when this method</span><span class="r9">                       </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        is called, a RuntimeError is raised.</span><span class="r9">                                                   </span>  
 <span class="r6">   394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">notify(</span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_waiters))</span><span class="r9">                                                        </span>  
 <span class="r6">   397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">notifyAll</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wake up all threads waiting on this condition.</span><span class="r9">                                      </span>  
 <span class="r6">   400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use notify_all() instead.</span><span class="r9">                                   </span>  
 <span class="r6">   402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">   405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;notifyAll() is deprecated, use notify_all() instead&#x27;</span><span class="r11">,</span><span class="r9">                   </span>  
 <span class="r6">   406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">   407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                                      </span>  
 <span class="r6">   408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Semaphore</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;This class implements semaphore objects.</span><span class="r9">                                                </span>  
 <span class="r6">   412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Semaphores manage a counter representing the number of release() calls minus</span><span class="r9">               </span>  
 <span class="r6">   414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the number of acquire() calls, plus an initial value. The acquire() method</span><span class="r9">                 </span>  
 <span class="r6">   415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    blocks if necessary until it can return without making the counter</span><span class="r9">                         </span>  
 <span class="r6">   416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    negative. If not given, value defaults to 1.</span><span class="r9">                                               </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># After Tim Peters&#x27; semaphore class, but not quite the same (no maximum)</span><span class="r9">                   </span>  
 <span class="r6">   421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, value</span><span class="r15">=1</span><span class="r11">):</span><span class="r9">                                                               </span>  
 <span class="r6">   423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> value </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;semaphore initial value must be &gt;= 0&quot;</span><span class="r11">)</span><span class="r9">                           </span>  
 <span class="r6">   425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond </span><span class="r15">=</span><span class="r11"> Condition(Lock())</span><span class="r9">                                                         </span>  
 <span class="r6">   426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">=</span><span class="r11"> value</span><span class="r9">                                                                    </span>  
 <span class="r6">   427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">acquire</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, blocking</span><span class="r15">=</span><span class="r10">True</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                            </span>  
 <span class="r6">   429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Acquire a semaphore, decrementing the internal counter by one.</span><span class="r9">                      </span>  
 <span class="r6">   430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked without arguments: if the internal counter is larger than</span><span class="r9">                 </span>  
 <span class="r6">   432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        zero on entry, decrement it by one and return immediately. If it is zero</span><span class="r9">               </span>  
 <span class="r6">   433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        on entry, block, waiting until some other thread has called release() to</span><span class="r9">               </span>  
 <span class="r6">   434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        make it larger than zero. This is done with proper interlocking so that</span><span class="r9">                </span>  
 <span class="r6">   435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        if multiple acquire() calls are blocked, release() will wake exactly one</span><span class="r9">               </span>  
 <span class="r6">   436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        of them up. The implementation may pick one at random, so the order in</span><span class="r9">                 </span>  
 <span class="r6">   437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        which blocked threads are awakened should not be relied on. There is no</span><span class="r9">                </span>  
 <span class="r6">   438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        return value in this case.</span><span class="r9">                                                             </span>  
 <span class="r6">   439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with blocking set to true, do the same thing as when called</span><span class="r9">               </span>  
 <span class="r6">   441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        without arguments, and return true.</span><span class="r9">                                                    </span>  
 <span class="r6">   442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with blocking set to false, do not block. If a call without</span><span class="r9">               </span>  
 <span class="r6">   444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        an argument would block, return false immediately; otherwise, do the</span><span class="r9">                   </span>  
 <span class="r6">   445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        same thing as when called without arguments, and return true.</span><span class="r9">                          </span>  
 <span class="r6">   446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When invoked with a timeout other than None, it will block for at</span><span class="r9">                      </span>  
 <span class="r6">   448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        most timeout seconds.  If acquire does not complete successfully in</span><span class="r9">                    </span>  
 <span class="r6">   449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        that interval, return false.  Return true otherwise.</span><span class="r9">                                   </span>  
 <span class="r6">   450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> blocking </span><span class="r19">and</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                               </span>  
 <span class="r6">   453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;can&#x27;t specify timeout for non-blocking acquire&quot;</span><span class="r11">)</span><span class="r9">                 </span>  
 <span class="r6">   454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rc </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                             </span>  
 <span class="r6">   455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        endtime </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">while</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">   458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> blocking:</span><span class="r9">                                                               </span>  
 <span class="r6">   459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">break</span><span class="r9">                                                                      </span>  
 <span class="r6">   460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> endtime </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        endtime </span><span class="r15">=</span><span class="r11"> _time() </span><span class="r15">+</span><span class="r11"> timeout</span><span class="r9">                                            </span>  
 <span class="r6">   463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        timeout </span><span class="r15">=</span><span class="r11"> endtime </span><span class="r15">-</span><span class="r11"> _time()</span><span class="r9">                                            </span>  
 <span class="r6">   465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">   466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">break</span><span class="r9">                                                              </span>  
 <span class="r6">   467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">wait(timeout)</span><span class="r9">                                                       </span>  
 <span class="r6">   468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">-=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                               </span>  
 <span class="r6">   470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                rc </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                      </span>  
 <span class="r6">   471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> rc</span><span class="r9">                                                                              </span>  
 <span class="r6">   472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r17">__enter__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> acquire</span><span class="r9">                                                                        </span>  
 <span class="r6">   474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">release</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, n</span><span class="r15">=1</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">   476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Release a semaphore, incrementing the internal counter by one or more.</span><span class="r9">              </span>  
 <span class="r6">   477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the counter is zero on entry and another thread is waiting for it</span><span class="r9">                 </span>  
 <span class="r6">   479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        to become larger than zero again, wake up that thread.</span><span class="r9">                                 </span>  
 <span class="r6">   480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&#x27;n must be one or more&#x27;</span><span class="r11">)</span><span class="r9">                                          </span>  
 <span class="r6">   484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">+=</span><span class="r11"> n</span><span class="r9">                                                                   </span>  
 <span class="r6">   486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(n):</span><span class="r9">                                                                 </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify()</span><span class="r9">                                                            </span>  
 <span class="r6">   488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, t, v, tb):</span><span class="r9">                                                              </span>  
 <span class="r6">   490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                         </span>  
 <span class="r6">   491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">BoundedSemaphore</span><span class="r11">(Semaphore):</span><span class="r9">                                                             </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Implements a bounded semaphore.</span><span class="r9">                                                         </span>  
 <span class="r6">   495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A bounded semaphore checks to make sure its current value doesn&#x27;t exceed its</span><span class="r9">               </span>  
 <span class="r6">   497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    initial value. If it does, ValueError is raised. In most situations</span><span class="r9">                        </span>  
 <span class="r6">   498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    semaphores are used to guard resources with limited capacity.</span><span class="r9">                              </span>  
 <span class="r6">   499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If the semaphore is released too many times it&#x27;s a sign of a bug. If not</span><span class="r9">                   </span>  
 <span class="r6">   501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    given, value defaults to 1.</span><span class="r9">                                                                </span>  
 <span class="r6">   502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Like regular semaphores, bounded semaphores manage a counter representing</span><span class="r9">                  </span>  
 <span class="r6">   504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the number of release() calls minus the number of acquire() calls, plus an</span><span class="r9">                 </span>  
 <span class="r6">   505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    initial value. The acquire() method blocks if necessary until it can return</span><span class="r9">                </span>  
 <span class="r6">   506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    without making the counter negative. If not given, value defaults to 1.</span><span class="r9">                    </span>  
 <span class="r6">   507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, value</span><span class="r15">=1</span><span class="r11">):</span><span class="r9">                                                               </span>  
 <span class="r6">   511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        Semaphore</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, value)</span><span class="r9">                                                        </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initial_value </span><span class="r15">=</span><span class="r11"> value</span><span class="r9">                                                            </span>  
 <span class="r6">   513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">release</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, n</span><span class="r15">=1</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">   515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Release a semaphore, incrementing the internal counter by one or more.</span><span class="r9">              </span>  
 <span class="r6">   516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the counter is zero on entry and another thread is waiting for it</span><span class="r9">                 </span>  
 <span class="r6">   518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        to become larger than zero again, wake up that thread.</span><span class="r9">                                 </span>  
 <span class="r6">   519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the number of releases exceeds the number of acquires,</span><span class="r9">                              </span>  
 <span class="r6">   521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        raise a ValueError.</span><span class="r9">                                                                    </span>  
 <span class="r6">   522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&#x27;n must be one or more&#x27;</span><span class="r11">)</span><span class="r9">                                          </span>  
 <span class="r6">   526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">+</span><span class="r11"> n </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initial_value:</span><span class="r9">                                          </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Semaphore released too many times&quot;</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">   529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_value </span><span class="r15">+=</span><span class="r11"> n</span><span class="r9">                                                                   </span>  
 <span class="r6">   530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(n):</span><span class="r9">                                                                 </span>  
 <span class="r6">   531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify()</span><span class="r9">                                                            </span>  
 <span class="r6">   532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Event</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Class implementing event objects.</span><span class="r9">                                                       </span>  
 <span class="r6">   536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Events manage a flag that can be set to true with the set() method and reset</span><span class="r9">               </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    to false with the clear() method. The wait() method blocks until the flag is</span><span class="r9">               </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    true.  The flag is initially false.</span><span class="r9">                                                        </span>  
 <span class="r6">   540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># After Tim Peters&#x27; event class (without is_posted())</span><span class="r9">                                      </span>  
 <span class="r6">   544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond </span><span class="r15">=</span><span class="r11"> Condition(Lock())</span><span class="r9">                                                         </span>  
 <span class="r6">   547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_flag </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                     </span>  
 <span class="r6">   548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_at_fork_reinit</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">   550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Private method called by Thread._reset_internal_locks()</span><span class="r9">                              </span>  
 <span class="r6">   551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">_at_fork_reinit()</span><span class="r9">                                                           </span>  
 <span class="r6">   552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">is_set</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return true if and only if the internal flag is true.&quot;&quot;&quot;</span><span class="r9">                            </span>  
 <span class="r6">   555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_flag</span><span class="r9">                                                                      </span>  
 <span class="r6">   556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">isSet</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return true if and only if the internal flag is true.</span><span class="r9">                               </span>  
 <span class="r6">   559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use is_set() instead.</span><span class="r9">                                       </span>  
 <span class="r6">   561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">   564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;isSet() is deprecated, use is_set() instead&#x27;</span><span class="r11">,</span><span class="r9">                           </span>  
 <span class="r6">   565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">   566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">is_set()</span><span class="r9">                                                                   </span>  
 <span class="r6">   567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">set</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                             </span>  
 <span class="r6">   569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Set the internal flag to true.</span><span class="r9">                                                      </span>  
 <span class="r6">   570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        All threads waiting for it to become true are awakened. Threads</span><span class="r9">                        </span>  
 <span class="r6">   572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        that call wait() once the flag is true will not block at all.</span><span class="r9">                          </span>  
 <span class="r6">   573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_flag </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                  </span>  
 <span class="r6">   577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                            </span>  
 <span class="r6">   578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">clear</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Reset the internal flag to false.</span><span class="r9">                                                   </span>  
 <span class="r6">   581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Subsequently, threads calling wait() will block until set() is called to</span><span class="r9">               </span>  
 <span class="r6">   583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        set the internal flag to true again.</span><span class="r9">                                                   </span>  
 <span class="r6">   584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_flag </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                 </span>  
 <span class="r6">   588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">wait</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">   590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Block until the internal flag is true.</span><span class="r9">                                              </span>  
 <span class="r6">   591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the internal flag is true on entry, return immediately. Otherwise,</span><span class="r9">                  </span>  
 <span class="r6">   593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        block until another thread calls set() to set the flag to true, or until</span><span class="r9">               </span>  
 <span class="r6">   594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the optional timeout occurs.</span><span class="r9">                                                           </span>  
 <span class="r6">   595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the timeout argument is present and not None, it should be a</span><span class="r9">                      </span>  
 <span class="r6">   597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        floating point number specifying a timeout for the operation in seconds</span><span class="r9">                </span>  
 <span class="r6">   598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (or fractions thereof).</span><span class="r9">                                                                </span>  
 <span class="r6">   599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method returns the internal flag on exit, so it will always return</span><span class="r9">                </span>  
 <span class="r6">   601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        True except if a timeout is given and the operation times out.</span><span class="r9">                         </span>  
 <span class="r6">   602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            signaled </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_flag</span><span class="r9">                                                              </span>  
 <span class="r6">   606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> signaled:</span><span class="r9">                                                                   </span>  
 <span class="r6">   607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                signaled </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">wait(timeout)</span><span class="r9">                                            </span>  
 <span class="r6">   608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> signaled</span><span class="r9">                                                                    </span>  
 <span class="r6">   609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># A barrier class.  Inspired in part by the pthread_barrier_* api and</span><span class="r9">                          </span>  
 <span class="r6">   612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># the CyclicBarrier class from Java.  See</span><span class="r9">                                                      </span>  
 <span class="r6">   613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># http://sourceware.org/pthreads-win32/manual/pthread_barrier_init.html and</span><span class="r9">                    </span>  
 <span class="r6">   614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/</span><span class="r9">                                </span>  
 <span class="r6">   615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#        CyclicBarrier.html</span><span class="r9">                                                                    </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># for information.</span><span class="r9">                                                                             </span>  
 <span class="r6">   617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># We maintain two main states, &#x27;filling&#x27; and &#x27;draining&#x27; enabling the barrier</span><span class="r9">                   </span>  
 <span class="r6">   618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># to be cyclic.  Threads are not allowed into it until it has fully drained</span><span class="r9">                    </span>  
 <span class="r6">   619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># since the previous cycle.  In addition, a &#x27;resetting&#x27; state exists which is</span><span class="r9">                  </span>  
 <span class="r6">   620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># similar to &#x27;draining&#x27; except that threads leave with a BrokenBarrierError,</span><span class="r9">                   </span>  
 <span class="r6">   621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># and a &#x27;broken&#x27; state in which all threads get the exception.</span><span class="r9">                                 </span>  
 <span class="r6">   622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Barrier</span><span class="r11">:</span><span class="r9">                                                                                 </span>  
 <span class="r6">   623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Implements a Barrier.</span><span class="r9">                                                                   </span>  
 <span class="r6">   624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Useful for synchronizing a fixed number of threads at known synchronization</span><span class="r9">                </span>  
 <span class="r6">   626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    points.  Threads block on &#x27;wait()&#x27; and are simultaneously awoken once they</span><span class="r9">                 </span>  
 <span class="r6">   627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    have all made that call.</span><span class="r9">                                                                   </span>  
 <span class="r6">   628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, parties, action</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Create a barrier, initialised to &#x27;parties&#x27; threads.</span><span class="r9">                                 </span>  
 <span class="r6">   633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &#x27;action&#x27; is a callable which, when supplied, will be called by one of</span><span class="r9">                  </span>  
 <span class="r6">   635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the threads after they have all entered the barrier and just prior to</span><span class="r9">                  </span>  
 <span class="r6">   636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        releasing them all. If a &#x27;timeout&#x27; is provided, it is used as the</span><span class="r9">                      </span>  
 <span class="r6">   637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        default for all subsequent &#x27;wait()&#x27; calls.</span><span class="r9">                                             </span>  
 <span class="r6">   638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond </span><span class="r15">=</span><span class="r11"> Condition(Lock())</span><span class="r9">                                                         </span>  
 <span class="r6">   641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_action </span><span class="r15">=</span><span class="r11"> action</span><span class="r9">                                                                  </span>  
 <span class="r6">   642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_timeout </span><span class="r15">=</span><span class="r11"> timeout</span><span class="r9">                                                                </span>  
 <span class="r6">   643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_parties </span><span class="r15">=</span><span class="r11"> parties</span><span class="r9">                                                                </span>  
 <span class="r6">   644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">  </span><span class="r14"># 0 filling, 1 draining, -1 resetting, -2 broken</span><span class="r9">                      </span>  
 <span class="r6">   645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">wait</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">   648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wait for the barrier.</span><span class="r9">                                                               </span>  
 <span class="r6">   649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the specified number of threads have started waiting, they are all</span><span class="r9">                </span>  
 <span class="r6">   651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        simultaneously awoken. If an &#x27;action&#x27; was provided for the barrier, one</span><span class="r9">                </span>  
 <span class="r6">   652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        of the threads will have executed that callback prior to returning.</span><span class="r9">                    </span>  
 <span class="r6">   653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns an individual index number from 0 to &#x27;parties-1&#x27;.</span><span class="r9">                              </span>  
 <span class="r6">   654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            timeout </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_timeout</span><span class="r9">                                                            </span>  
 <span class="r6">   658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_enter() </span><span class="r14"># Block while the barrier drains.</span><span class="r9">                                    </span>  
 <span class="r6">   660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            index </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count</span><span class="r9">                                                                </span>  
 <span class="r6">   661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                   </span>  
 <span class="r6">   662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> index </span><span class="r15">+</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_parties:</span><span class="r9">                                                 </span>  
 <span class="r6">   664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># We release the barrier</span><span class="r9">                                                   </span>  
 <span class="r6">   665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_release()</span><span class="r9">                                                            </span>  
 <span class="r6">   666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># We wait until someone releases us</span><span class="r9">                                        </span>  
 <span class="r6">   668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_wait(timeout)</span><span class="r9">                                                        </span>  
 <span class="r6">   669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> index</span><span class="r9">                                                                   </span>  
 <span class="r6">   670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">-=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                               </span>  
 <span class="r6">   672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Wake up any threads waiting for barrier to drain.</span><span class="r9">                            </span>  
 <span class="r6">   673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exit()</span><span class="r9">                                                                   </span>  
 <span class="r6">   674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Block until the barrier is ready for us, or raise an exception</span><span class="r9">                           </span>  
 <span class="r6">   676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># if it is broken.</span><span class="r9">                                                                         </span>  
 <span class="r6">   677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_enter</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r19">in</span><span class="r11"> (</span><span class="r15">-1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># It is draining or resetting, wait until done</span><span class="r9">                                     </span>  
 <span class="r6">   680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">wait()</span><span class="r9">                                                                  </span>  
 <span class="r6">   681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#see if the barrier is in a broken state</span><span class="r9">                                               </span>  
 <span class="r6">   682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> BrokenBarrierError</span><span class="r9">                                                           </span>  
 <span class="r6">   684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                </span>  
 <span class="r6">   685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Optionally run the &#x27;action&#x27; and release the threads waiting</span><span class="r9">                              </span>  
 <span class="r6">   687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># in the barrier.</span><span class="r9">                                                                          </span>  
 <span class="r6">   688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_release</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_action:</span><span class="r9">                                                                   </span>  
 <span class="r6">   691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_action()</span><span class="r9">                                                                 </span>  
 <span class="r6">   692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># enter draining state</span><span class="r9">                                                             </span>  
 <span class="r6">   693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                    </span>  
 <span class="r6">   694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                            </span>  
 <span class="r6">   695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                                </span>  
 <span class="r6">   696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14">#an exception during the _action handler.  Break and reraise</span><span class="r9">                       </span>  
 <span class="r6">   697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_break()</span><span class="r9">                                                                      </span>  
 <span class="r6">   698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Wait in the barrier until we are released.  Raise an exception</span><span class="r9">                           </span>  
 <span class="r6">   701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># if the barrier is reset or broken.</span><span class="r9">                                                       </span>  
 <span class="r6">   702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_wait</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout):</span><span class="r9">                                                                  </span>  
 <span class="r6">   703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">wait_for(</span><span class="r10">lambda</span><span class="r11"> : </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">, timeout):</span><span class="r9">                        </span>  
 <span class="r6">   704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14">#timed out.  Break the barrier</span><span class="r9">                                                     </span>  
 <span class="r6">   705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_break()</span><span class="r9">                                                                      </span>  
 <span class="r6">   706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> BrokenBarrierError</span><span class="r9">                                                           </span>  
 <span class="r6">   707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> BrokenBarrierError</span><span class="r9">                                                           </span>  
 <span class="r6">   709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                </span>  
 <span class="r6">   710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># If we are the last thread to exit the barrier, signal any threads</span><span class="r9">                        </span>  
 <span class="r6">   712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># waiting for the barrier to drain.</span><span class="r9">                                                        </span>  
 <span class="r6">   713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_exit</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r19">in</span><span class="r11"> (</span><span class="r15">-1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14">#resetting or draining</span><span class="r9">                                                         </span>  
 <span class="r6">   717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                </span>  
 <span class="r6">   718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                        </span>  
 <span class="r6">   719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">reset</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Reset the barrier to the initial state.</span><span class="r9">                                             </span>  
 <span class="r6">   722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Any threads currently waiting will get the BrokenBarrier exception</span><span class="r9">                     </span>  
 <span class="r6">   724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        raised.</span><span class="r9">                                                                                </span>  
 <span class="r6">   725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">   730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14">#reset the barrier, waking up threads</span><span class="r9">                                      </span>  
 <span class="r6">   731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                           </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-2</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14">#was broken, set it to reset state</span><span class="r9">                                         </span>  
 <span class="r6">   734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14">#which clears when the last thread exits</span><span class="r9">                                   </span>  
 <span class="r6">   735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                           </span>  
 <span class="r6">   736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                </span>  
 <span class="r6">   738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                            </span>  
 <span class="r6">   739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">abort</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Place the barrier into a &#x27;broken&#x27; state.</span><span class="r9">                                            </span>  
 <span class="r6">   742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Useful in case of error.  Any currently waiting threads and threads</span><span class="r9">                    </span>  
 <span class="r6">   744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        attempting to &#x27;wait()&#x27; will have BrokenBarrierError raised.</span><span class="r9">                            </span>  
 <span class="r6">   745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond:</span><span class="r9">                                                                       </span>  
 <span class="r6">   748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_break()</span><span class="r9">                                                                      </span>  
 <span class="r6">   749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_break</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># An internal error was detected.  The barrier is set to</span><span class="r9">                               </span>  
 <span class="r6">   752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># a broken state all parties awakened.</span><span class="r9">                                                 </span>  
 <span class="r6">   753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-2</span><span class="r9">                                                                       </span>  
 <span class="r6">   754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_cond</span><span class="r15">.</span><span class="r11">notify_all()</span><span class="r9">                                                                </span>  
 <span class="r6">   755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">parties</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return the number of threads required to trip the barrier.&quot;&quot;&quot;</span><span class="r9">                       </span>  
 <span class="r6">   759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_parties</span><span class="r9">                                                                   </span>  
 <span class="r6">   760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">n_waiting</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return the number of threads currently waiting at the barrier.&quot;&quot;&quot;</span><span class="r9">                   </span>  
 <span class="r6">   764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># We don&#x27;t need synchronization here since this is an ephemeral result</span><span class="r9">                 </span>  
 <span class="r6">   765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># anyway.  It returns the correct value in the steady state.</span><span class="r9">                           </span>  
 <span class="r6">   766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_count</span><span class="r9">                                                                 </span>  
 <span class="r6">   768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                               </span>  
 <span class="r6">   769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">broken</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return True if the barrier is in a broken state.&quot;&quot;&quot;</span><span class="r9">                                 </span>  
 <span class="r6">   773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_state </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-2</span><span class="r9">                                                               </span>  
 <span class="r6">   774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># exception raised by the Barrier class</span><span class="r9">                                                        </span>  
 <span class="r6">   776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">BrokenBarrierError</span><span class="r11">(</span><span class="r13">RuntimeError</span><span class="r11">):</span><span class="r9">                                                        </span>  
 <span class="r6">   777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">pass</span><span class="r9">                                                                                       </span>  
 <span class="r6">   778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Helper to generate new thread names</span><span class="r9">                                                          </span>  
 <span class="r6">   781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_counter </span><span class="r15">=</span><span class="r11"> _count(</span><span class="r15">1</span><span class="r11">)</span><span class="r15">.</span><span class="r17">__next__</span><span class="r9">                                                                  </span>  
 <span class="r6">   782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_newname</span><span class="r11">(name_template):</span><span class="r9">                                                                   </span>  
 <span class="r6">   783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> name_template </span><span class="r15">%</span><span class="r11"> _counter()</span><span class="r9">                                                          </span>  
 <span class="r6">   784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Active thread administration.</span><span class="r9">                                                                </span>  
 <span class="r6">   786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">   787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># bpo-44422: Use a reentrant lock to allow reentrant calls to functions like</span><span class="r9">                   </span>  
 <span class="r6">   788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># threading.enumerate().</span><span class="r9">                                                                       </span>  
 <span class="r6">   789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_active_limbo_lock </span><span class="r15">=</span><span class="r11"> RLock()</span><span class="r9">                                                                   </span>  
 <span class="r6">   790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_active </span><span class="r15">=</span><span class="r11"> {}    </span><span class="r14"># maps thread id to Thread object</span><span class="r9">                                              </span>  
 <span class="r6">   791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_limbo </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                    </span>  
 <span class="r6">   792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_dangling </span><span class="r15">=</span><span class="r11"> WeakSet()</span><span class="r9">                                                                          </span>  
 <span class="r6">   793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Set of Thread._tstate_lock locks of non-daemon threads used by _shutdown()</span><span class="r9">                   </span>  
 <span class="r6">   795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># to wait until all Python thread states get deleted:</span><span class="r9">                                          </span>  
 <span class="r6">   796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># see Thread._set_tstate_lock().</span><span class="r9">                                                               </span>  
 <span class="r6">   797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_shutdown_locks_lock </span><span class="r15">=</span><span class="r11"> _allocate_lock()</span><span class="r9">                                                        </span>  
 <span class="r6">   798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_shutdown_locks </span><span class="r15">=</span><span class="r11"> </span><span class="r20">set</span><span class="r11">()</span><span class="r9">                                                                        </span>  
 <span class="r6">   799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_maintain_shutdown_locks</span><span class="r11">():</span><span class="r9">                                                                </span>  
 <span class="r6">   801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Drop any shutdown locks that don&#x27;t correspond to running threads anymore.</span><span class="r9">                  </span>  
 <span class="r6">   803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Calling this from time to time avoids an ever-growing _shutdown_locks</span><span class="r9">                      </span>  
 <span class="r6">   805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    set when Thread objects are not joined explicitly. See bpo-37788.</span><span class="r9">                          </span>  
 <span class="r6">   806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This must be called with _shutdown_locks_lock acquired.</span><span class="r9">                                    </span>  
 <span class="r6">   808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># If a lock was released, the corresponding thread has exited</span><span class="r9">                              </span>  
 <span class="r6">   810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    to_remove </span><span class="r15">=</span><span class="r11"> [lock </span><span class="r10">for</span><span class="r11"> lock </span><span class="r19">in</span><span class="r11"> _shutdown_locks </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">locked()]</span><span class="r9">                        </span>  
 <span class="r6">   811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _shutdown_locks</span><span class="r15">.</span><span class="r11">difference_update(to_remove)</span><span class="r9">                                               </span>  
 <span class="r6">   812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Main class for threads</span><span class="r9">                                                                       </span>  
 <span class="r6">   815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Thread</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;A class that represents a thread of control.</span><span class="r9">                                            </span>  
 <span class="r6">   818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This class can be safely subclassed in a limited fashion. There are two ways</span><span class="r9">               </span>  
 <span class="r6">   820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    to specify the activity: by passing a callable object to the constructor, or</span><span class="r9">               </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    by overriding the run() method in a subclass.</span><span class="r9">                                              </span>  
 <span class="r6">   822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _initialized </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                       </span>  
 <span class="r6">   826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, group</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, target</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, name</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                     </span>  
 <span class="r6">   828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                 args</span><span class="r15">=</span><span class="r11">(), kwargs</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r15">*</span><span class="r11">, daemon</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                        </span>  
 <span class="r6">   829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;This constructor should always be called with keyword arguments. Arguments are:</span><span class="r9">     </span>  
 <span class="r6">   830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *group* should be None; reserved for future extension when a ThreadGroup</span><span class="r9">               </span>  
 <span class="r6">   832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        class is implemented.</span><span class="r9">                                                                  </span>  
 <span class="r6">   833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *target* is the callable object to be invoked by the run()</span><span class="r9">                             </span>  
 <span class="r6">   835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method. Defaults to None, meaning nothing is called.</span><span class="r9">                                   </span>  
 <span class="r6">   836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *name* is the thread name. By default, a unique name is constructed of</span><span class="r9">                 </span>  
 <span class="r6">   838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the form &quot;Thread-N&quot; where N is a small decimal number.</span><span class="r9">                                 </span>  
 <span class="r6">   839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *args* is the argument tuple for the target invocation. Defaults to ().</span><span class="r9">                </span>  
 <span class="r6">   841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *kwargs* is a dictionary of keyword arguments for the target</span><span class="r9">                           </span>  
 <span class="r6">   843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        invocation. Defaults to {}.</span><span class="r9">                                                            </span>  
 <span class="r6">   844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If a subclass overrides the constructor, it must make sure to invoke</span><span class="r9">                   </span>  
 <span class="r6">   846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the base class constructor (Thread.__init__()) before doing anything</span><span class="r9">                   </span>  
 <span class="r6">   847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        else to the thread.</span><span class="r9">                                                                    </span>  
 <span class="r6">   848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> group </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">, </span><span class="r16">&quot;group argument must be None for now&quot;</span><span class="r9">                            </span>  
 <span class="r6">   851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> kwargs </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            kwargs </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                        </span>  
 <span class="r6">   853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> name:</span><span class="r9">                                                                               </span>  
 <span class="r6">   854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name </span><span class="r15">=</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(name)</span><span class="r9">                                                                   </span>  
 <span class="r6">   855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name </span><span class="r15">=</span><span class="r11"> _newname(</span><span class="r16">&quot;Thread-</span><span class="r21">%d</span><span class="r16">&quot;</span><span class="r11">)</span><span class="r9">                                                       </span>  
 <span class="r6">   857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> target </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">   858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    target_name </span><span class="r15">=</span><span class="r11"> target</span><span class="r15">.</span><span class="r22">__name__</span><span class="r9">                                              </span>  
 <span class="r6">   860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    name </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">f&quot; (</span><span class="r21">{</span><span class="r11">target_name</span><span class="r21">}</span><span class="r16">)&quot;</span><span class="r9">                                                </span>  
 <span class="r6">   861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                         </span>  
 <span class="r6">   862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">   863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_target </span><span class="r15">=</span><span class="r11"> target</span><span class="r9">                                                                  </span>  
 <span class="r6">   865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_name </span><span class="r15">=</span><span class="r11"> name</span><span class="r9">                                                                      </span>  
 <span class="r6">   866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_args </span><span class="r15">=</span><span class="r11"> args</span><span class="r9">                                                                      </span>  
 <span class="r6">   867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_kwargs </span><span class="r15">=</span><span class="r11"> kwargs</span><span class="r9">                                                                  </span>  
 <span class="r6">   868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> daemon </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic </span><span class="r15">=</span><span class="r11"> daemon</span><span class="r9">                                                            </span>  
 <span class="r6">   870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic </span><span class="r15">=</span><span class="r11"> current_thread()</span><span class="r15">.</span><span class="r11">daemon</span><span class="r9">                                           </span>  
 <span class="r6">   872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                     </span>  
 <span class="r6">   873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                             </span>  
 <span class="r6">   874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_native_id </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                             </span>  
 <span class="r6">   875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">   876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started </span><span class="r15">=</span><span class="r11"> Event()</span><span class="r9">                                                                </span>  
 <span class="r6">   877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                               </span>  
 <span class="r6">   878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                               </span>  
 <span class="r6">   879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Copy of sys.stderr used by self._invoke_excepthook()</span><span class="r9">                                 </span>  
 <span class="r6">   880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_stderr </span><span class="r15">=</span><span class="r11"> _sys</span><span class="r15">.</span><span class="r11">stderr</span><span class="r9">                                                             </span>  
 <span class="r6">   881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_invoke_excepthook </span><span class="r15">=</span><span class="r11"> _make_invoke_excepthook()</span><span class="r9">                                    </span>  
 <span class="r6">   882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># For debugging and _after_fork()</span><span class="r9">                                                      </span>  
 <span class="r6">   883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _dangling</span><span class="r15">.</span><span class="r11">add(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                    </span>  
 <span class="r6">   884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_reset_internal_locks</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, is_alive):</span><span class="r9">                                                 </span>  
 <span class="r6">   886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># private!  Called by _after_fork() to reset our internal locks as</span><span class="r9">                     </span>  
 <span class="r6">   887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># they may be in an invalid state leading to a deadlock or crash.</span><span class="r9">                      </span>  
 <span class="r6">   888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">_at_fork_reinit()</span><span class="r9">                                                        </span>  
 <span class="r6">   889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> is_alive:</span><span class="r9">                                                                           </span>  
 <span class="r6">   890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># bpo-42350: If the fork happens when the thread is already stopped</span><span class="r9">                </span>  
 <span class="r6">   891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># (ex: after threading._shutdown() has been called), _tstate_lock</span><span class="r9">                  </span>  
 <span class="r6">   892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># is None. Do nothing in this case.</span><span class="r9">                                                </span>  
 <span class="r6">   893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                  </span>  
 <span class="r6">   894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r15">.</span><span class="r11">_at_fork_reinit()</span><span class="r9">                                            </span>  
 <span class="r6">   895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                    </span>  
 <span class="r6">   896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># The thread isn&#x27;t alive after fork: it doesn&#x27;t have a tstate</span><span class="r9">                      </span>  
 <span class="r6">   898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># anymore.</span><span class="r9">                                                                         </span>  
 <span class="r6">   899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                            </span>  
 <span class="r6">   900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                           </span>  
 <span class="r6">   901 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   902 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__repr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   903 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() was not called&quot;</span><span class="r9">                           </span>  
 <span class="r6">   904 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        status </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;initial&quot;</span><span class="r9">                                                                     </span>  
 <span class="r6">   905 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                                             </span>  
 <span class="r6">   906 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            status </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;started&quot;</span><span class="r9">                                                                 </span>  
 <span class="r6">   907 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">is_alive() </span><span class="r14"># easy way to get ._is_stopped set when appropriate</span><span class="r9">                    </span>  
 <span class="r6">   908 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped:</span><span class="r9">                                                                   </span>  
 <span class="r6">   909 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            status </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;stopped&quot;</span><span class="r9">                                                                 </span>  
 <span class="r6">   910 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic:</span><span class="r9">                                                                     </span>  
 <span class="r6">   911 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            status </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot; daemon&quot;</span><span class="r9">                                                                </span>  
 <span class="r6">   912 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">   913 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            status </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot; </span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident</span><span class="r9">                                                      </span>  
 <span class="r6">   914 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">&quot;&lt;</span><span class="r21">%s</span><span class="r16">(</span><span class="r21">%s</span><span class="r16">, </span><span class="r21">%s</span><span class="r16">)&gt;&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__name__</span><span class="r11">, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_name, status)</span><span class="r9">                  </span>  
 <span class="r6">   915 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">start</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   917 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Start the thread&#x27;s activity.</span><span class="r9">                                                        </span>  
 <span class="r6">   918 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   919 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        It must be called at most once per thread object. It arranges for the</span><span class="r9">                  </span>  
 <span class="r6">   920 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        object&#x27;s run() method to be invoked in a separate thread of control.</span><span class="r9">                   </span>  
 <span class="r6">   921 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   922 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method will raise a RuntimeError if called more than once on the</span><span class="r9">                  </span>  
 <span class="r6">   923 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        same thread object.</span><span class="r9">                                                                    </span>  
 <span class="r6">   924 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   925 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   926 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized:</span><span class="r9">                                                              </span>  
 <span class="r6">   927 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;thread.__init__() not called&quot;</span><span class="r11">)</span><span class="r9">                                 </span>  
 <span class="r6">   928 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   929 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                                             </span>  
 <span class="r6">   930 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;threads can only be started once&quot;</span><span class="r11">)</span><span class="r9">                             </span>  
 <span class="r6">   931 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   932 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                               </span>  
 <span class="r6">   933 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _limbo[</span><span class="r20">self</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                                </span>  
 <span class="r6">   934 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   935 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _start_new_thread(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_bootstrap, ())</span><span class="r9">                                             </span>  
 <span class="r6">   936 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   937 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                           </span>  
 <span class="r6">   938 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">del</span><span class="r11"> _limbo[</span><span class="r20">self</span><span class="r11">]</span><span class="r9">                                                               </span>  
 <span class="r6">   939 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   940 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">wait()</span><span class="r9">                                                                   </span>  
 <span class="r6">   941 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   942 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">run</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                             </span>  
 <span class="r6">   943 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Method representing the thread&#x27;s activity.</span><span class="r9">                                          </span>  
 <span class="r6">   944 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   945 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        You may override this method in a subclass. The standard run() method</span><span class="r9">                  </span>  
 <span class="r6">   946 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        invokes the callable object passed to the object&#x27;s constructor as the</span><span class="r9">                  </span>  
 <span class="r6">   947 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        target argument, if any, with sequential and keyword arguments taken</span><span class="r9">                   </span>  
 <span class="r6">   948 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        from the args and kwargs arguments, respectively.</span><span class="r9">                                      </span>  
 <span class="r6">   949 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   950 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   951 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   952 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_target </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">   953 </span>│<span class="r7">        </span>│<span class="r7">    9% </span>│<span class="r7">  28%  </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_target(</span><span class="r15">*</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_args, </span><span class="r15">**</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_kwargs)</span><span class="r9">                                      </span>  
 <span class="r6">   954 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   955 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Avoid a refcycle if the thread is running a function with</span><span class="r9">                        </span>  
 <span class="r6">   956 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># an argument that has a member that points to the thread.</span><span class="r9">                         </span>  
 <span class="r6">   957 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_target, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_args, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_kwargs</span><span class="r9">                                         </span>  
 <span class="r6">   958 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   959 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_bootstrap</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">   960 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Wrapper around the real bootstrap code that ignores</span><span class="r9">                                  </span>  
 <span class="r6">   961 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># exceptions during interpreter cleanup.  Those typically</span><span class="r9">                              </span>  
 <span class="r6">   962 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># happen when a daemon thread wakes up at an unfortunate</span><span class="r9">                               </span>  
 <span class="r6">   963 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># moment, finds the world around it destroyed, and raises some</span><span class="r9">                         </span>  
 <span class="r6">   964 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># random exception *** while trying to report the exception in</span><span class="r9">                         </span>  
 <span class="r6">   965 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># _bootstrap_inner() below ***.  Those random exceptions</span><span class="r9">                               </span>  
 <span class="r6">   966 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># don&#x27;t help anybody, and they confuse users, so we suppress</span><span class="r9">                           </span>  
 <span class="r6">   967 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># them.  We suppress them only when it appears that the world</span><span class="r9">                          </span>  
 <span class="r6">   968 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># indeed has already been destroyed, so that exceptions in</span><span class="r9">                             </span>  
 <span class="r6">   969 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># _bootstrap_inner() during normal business hours are properly</span><span class="r9">                         </span>  
 <span class="r6">   970 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># reported.  Also, we only suppress them for daemonic threads;</span><span class="r9">                         </span>  
 <span class="r6">   971 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># if a non-daemonic encounters this, something else is wrong.</span><span class="r9">                          </span>  
 <span class="r6">   972 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   973 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_bootstrap_inner()</span><span class="r9">                                                            </span>  
 <span class="r6">   974 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                                </span>  
 <span class="r6">   975 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic </span><span class="r19">and</span><span class="r11"> _sys </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                </span>  
 <span class="r6">   976 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">   977 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   978 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   979 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_set_ident</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">   980 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident </span><span class="r15">=</span><span class="r11"> get_ident()</span><span class="r9">                                                              </span>  
 <span class="r6">   981 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   982 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                                 </span>  
 <span class="r6">   983 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_set_native_id</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">   984 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_native_id </span><span class="r15">=</span><span class="r11"> get_native_id()</span><span class="r9">                                                  </span>  
 <span class="r6">   985 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   986 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_set_tstate_lock</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">   987 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   988 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Set a lock object which will be released by the interpreter when</span><span class="r9">                       </span>  
 <span class="r6">   989 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the underlying thread state (see pystate.h) gets deleted.</span><span class="r9">                              </span>  
 <span class="r6">   990 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   991 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock </span><span class="r15">=</span><span class="r11"> _set_sentinel()</span><span class="r9">                                                    </span>  
 <span class="r6">   992 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                            </span>  
 <span class="r6">   993 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   994 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">daemon:</span><span class="r9">                                                                    </span>  
 <span class="r6">   995 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> _shutdown_locks_lock:</span><span class="r9">                                                         </span>  
 <span class="r6">   996 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _maintain_shutdown_locks()</span><span class="r9">                                                     </span>  
 <span class="r6">   997 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _shutdown_locks</span><span class="r15">.</span><span class="r11">add(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock)</span><span class="r9">                                         </span>  
 <span class="r6">   998 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   999 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_bootstrap_inner</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">  1000 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1001 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_ident()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1002 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_tstate_lock()</span><span class="r9">                                                            </span>  
 <span class="r6">  1003 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                         </span>  
 <span class="r6">  1004 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_native_id()</span><span class="r9">                                                          </span>  
 <span class="r6">  1005 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">set()</span><span class="r9">                                                                </span>  
 <span class="r6">  1006 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                           </span>  
 <span class="r6">  1007 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _active[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                    </span>  
 <span class="r6">  1008 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">del</span><span class="r11"> _limbo[</span><span class="r20">self</span><span class="r11">]</span><span class="r9">                                                               </span>  
 <span class="r6">  1009 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1010 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> _trace_hook:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1011 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _sys</span><span class="r15">.</span><span class="r11">settrace(_trace_hook)</span><span class="r9">                                                     </span>  
 <span class="r6">  1012 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> _profile_hook:</span><span class="r9">                                                                  </span>  
 <span class="r6">  1013 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _sys</span><span class="r15">.</span><span class="r11">setprofile(_profile_hook)</span><span class="r9">                                                 </span>  
 <span class="r6">  1014 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1015 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1016 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">run()</span><span class="r9">                                                                     </span>  
 <span class="r6">  1017 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">  1018 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_invoke_excepthook(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                  </span>  
 <span class="r6">  1019 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1020 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                           </span>  
 <span class="r6">  1021 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1022 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># We don&#x27;t call self._delete() because it also</span><span class="r9">                             </span>  
 <span class="r6">  1023 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># grabs _active_limbo_lock.</span><span class="r9">                                                </span>  
 <span class="r6">  1024 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">del</span><span class="r11"> _active[get_ident()]</span><span class="r9">                                                   </span>  
 <span class="r6">  1025 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1026 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">  1027 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1028 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_stop</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">  1029 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># After calling ._stop(), .is_alive() returns False and .join() returns</span><span class="r9">                </span>  
 <span class="r6">  1030 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># immediately.  ._tstate_lock must be released before calling ._stop().</span><span class="r9">                </span>  
 <span class="r6">  1031 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#</span><span class="r9">                                                                                      </span>  
 <span class="r6">  1032 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Normal case:  C code at the end of the thread&#x27;s life</span><span class="r9">                                 </span>  
 <span class="r6">  1033 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (release_sentinel in _threadmodule.c) releases ._tstate_lock, and</span><span class="r9">                    </span>  
 <span class="r6">  1034 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># that&#x27;s detected by our ._wait_for_tstate_lock(), called by .join()</span><span class="r9">                   </span>  
 <span class="r6">  1035 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># and .is_alive().  Any number of threads _may_ call ._stop()</span><span class="r9">                          </span>  
 <span class="r6">  1036 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># simultaneously (for example, if multiple threads are blocked in</span><span class="r9">                      </span>  
 <span class="r6">  1037 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># .join() calls), and they&#x27;re not serialized.  That&#x27;s harmless -</span><span class="r9">                       </span>  
 <span class="r6">  1038 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># they&#x27;ll just make redundant rebindings of ._is_stopped and</span><span class="r9">                           </span>  
 <span class="r6">  1039 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># ._tstate_lock.  Obscure:  we rebind ._tstate_lock last so that the</span><span class="r9">                   </span>  
 <span class="r6">  1040 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># &quot;assert self._is_stopped&quot; in ._wait_for_tstate_lock() always works</span><span class="r9">                   </span>  
 <span class="r6">  1041 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (the assert is executed only if ._tstate_lock is None).</span><span class="r9">                              </span>  
 <span class="r6">  1042 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#</span><span class="r9">                                                                                      </span>  
 <span class="r6">  1043 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Special case:  _main_thread releases ._tstate_lock via this</span><span class="r9">                          </span>  
 <span class="r6">  1044 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># module&#x27;s _shutdown() function.</span><span class="r9">                                                       </span>  
 <span class="r6">  1045 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        lock </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r9">                                                               </span>  
 <span class="r6">  1046 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> lock </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1047 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">assert</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">locked()</span><span class="r9">                                                           </span>  
 <span class="r6">  1048 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                </span>  
 <span class="r6">  1049 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">  1050 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">daemon:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1051 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> _shutdown_locks_lock:</span><span class="r9">                                                         </span>  
 <span class="r6">  1052 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Remove our lock and other released locks from _shutdown_locks</span><span class="r9">                </span>  
 <span class="r6">  1053 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _maintain_shutdown_locks()</span><span class="r9">                                                     </span>  
 <span class="r6">  1054 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1055 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_delete</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  1056 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&quot;Remove current thread from the dict of currently running threads.&quot;</span><span class="r9">                    </span>  
 <span class="r6">  1057 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                               </span>  
 <span class="r6">  1058 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> _active[get_ident()]</span><span class="r9">                                                           </span>  
 <span class="r6">  1059 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># There must not be any python code between the previous line</span><span class="r9">                      </span>  
 <span class="r6">  1060 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># and after the lock is released.  Otherwise a tracing function</span><span class="r9">                    </span>  
 <span class="r6">  1061 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># could try to acquire the lock again in the same thread, (in</span><span class="r9">                      </span>  
 <span class="r6">  1062 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># current_thread()), and would block.</span><span class="r9">                                              </span>  
 <span class="r6">  1063 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1064 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">join</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">  1065 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wait until the thread terminates.</span><span class="r9">                                                   </span>  
 <span class="r6">  1066 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1067 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This blocks the calling thread until the thread whose join() method is</span><span class="r9">                 </span>  
 <span class="r6">  1068 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        called terminates -- either normally or through an unhandled exception</span><span class="r9">                 </span>  
 <span class="r6">  1069 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        or until the optional timeout occurs.</span><span class="r9">                                                  </span>  
 <span class="r6">  1070 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1071 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the timeout argument is present and not None, it should be a</span><span class="r9">                      </span>  
 <span class="r6">  1072 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        floating point number specifying a timeout for the operation in seconds</span><span class="r9">                </span>  
 <span class="r6">  1073 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (or fractions thereof). As join() always returns None, you must call</span><span class="r9">                   </span>  
 <span class="r6">  1074 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        is_alive() after join() to decide whether a timeout happened -- if the</span><span class="r9">                 </span>  
 <span class="r6">  1075 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        thread is still alive, the join() call timed out.</span><span class="r9">                                      </span>  
 <span class="r6">  1076 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1077 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When the timeout argument is not present or None, the operation will</span><span class="r9">                   </span>  
 <span class="r6">  1078 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        block until the thread terminates.</span><span class="r9">                                                     </span>  
 <span class="r6">  1079 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1080 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        A thread can be join()ed many times.</span><span class="r9">                                                   </span>  
 <span class="r6">  1081 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1082 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        join() raises a RuntimeError if an attempt is made to join the current</span><span class="r9">                 </span>  
 <span class="r6">  1083 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        thread as that would cause a deadlock. It is also an error to join() a</span><span class="r9">                 </span>  
 <span class="r6">  1084 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        thread before it has been started and attempts to do so raises the same</span><span class="r9">                </span>  
 <span class="r6">  1085 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        exception.</span><span class="r9">                                                                             </span>  
 <span class="r6">  1086 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1087 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1088 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized:</span><span class="r9">                                                              </span>  
 <span class="r6">  1089 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r11">)</span><span class="r9">                                 </span>  
 <span class="r6">  1090 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                                         </span>  
 <span class="r6">  1091 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot join thread before it is started&quot;</span><span class="r11">)</span><span class="r9">                      </span>  
 <span class="r6">  1092 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r11"> </span><span class="r19">is</span><span class="r11"> current_thread():</span><span class="r9">                                                           </span>  
 <span class="r6">  1093 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot join current thread&quot;</span><span class="r11">)</span><span class="r9">                                   </span>  
 <span class="r6">  1094 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1095 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1096 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_wait_for_tstate_lock()</span><span class="r9">                                                       </span>  
 <span class="r6">  1097 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1098 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># the behavior of a negative timeout isn&#x27;t documented, but</span><span class="r9">                         </span>  
 <span class="r6">  1099 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># historically .join(timeout=x) for x&lt;0 has acted as if timeout=0</span><span class="r9">                  </span>  
 <span class="r6">  1100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_wait_for_tstate_lock(timeout</span><span class="r15">=</span><span class="r20">max</span><span class="r11">(timeout, </span><span class="r15">0</span><span class="r11">))</span><span class="r9">                                </span>  
 <span class="r6">  1101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_wait_for_tstate_lock</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, block</span><span class="r15">=</span><span class="r10">True</span><span class="r11">, timeout</span><span class="r15">=-1</span><span class="r11">):</span><span class="r9">                                   </span>  
 <span class="r6">  1103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Issue #18808: wait for the thread state to be gone.</span><span class="r9">                                  </span>  
 <span class="r6">  1104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># At the end of the thread&#x27;s life, after all knowledge of the thread</span><span class="r9">                   </span>  
 <span class="r6">  1105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># is removed from C data structures, C code releases our _tstate_lock.</span><span class="r9">                 </span>  
 <span class="r6">  1106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># This method passes its arguments to _tstate_lock.acquire().</span><span class="r9">                          </span>  
 <span class="r6">  1107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># If the lock is acquired, the C code is done, and self._stop() is</span><span class="r9">                     </span>  
 <span class="r6">  1108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># called.  That sets ._is_stopped to True, and ._tstate_lock to None.</span><span class="r9">                  </span>  
 <span class="r6">  1109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        lock </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r9">                                                               </span>  
 <span class="r6">  1110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> lock </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">  1111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># already determined that the C code is done</span><span class="r9">                                       </span>  
 <span class="r6">  1112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped</span><span class="r9">                                                            </span>  
 <span class="r6">  1113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  1114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">acquire(block, timeout):</span><span class="r9">                                                   </span>  
 <span class="r6">  1117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                lock</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_stop()</span><span class="r9">                                                                   </span>  
 <span class="r6">  1119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                                </span>  
 <span class="r6">  1120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> lock</span><span class="r15">.</span><span class="r11">locked():</span><span class="r9">                                                                  </span>  
 <span class="r6">  1121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># bpo-45274: lock.acquire() acquired the lock, but the function</span><span class="r9">                </span>  
 <span class="r6">  1122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># was interrupted with an exception before reaching the</span><span class="r9">                        </span>  
 <span class="r6">  1123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># lock.release(). It can happen if a signal handler raises an</span><span class="r9">                  </span>  
 <span class="r6">  1124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># exception, like CTRL+C which raises KeyboardInterrupt.</span><span class="r9">                       </span>  
 <span class="r6">  1125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                lock</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_stop()</span><span class="r9">                                                                   </span>  
 <span class="r6">  1127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">  1128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">name</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">  1131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;A string used for identification purposes only.</span><span class="r9">                                     </span>  
 <span class="r6">  1132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        It has no semantics. Multiple threads may be given the same name. The</span><span class="r9">                  </span>  
 <span class="r6">  1134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        initial name is set by the constructor.</span><span class="r9">                                                </span>  
 <span class="r6">  1135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                               </span>  
 <span class="r6">  1138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_name</span><span class="r9">                                                                      </span>  
 <span class="r6">  1139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@name</span><span class="r15">.</span><span class="r11">setter</span><span class="r9">                                                                               </span>  
 <span class="r6">  1141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">name</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name):</span><span class="r9">                                                                      </span>  
 <span class="r6">  1142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                               </span>  
 <span class="r6">  1143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_name </span><span class="r15">=</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(name)</span><span class="r9">                                                                 </span>  
 <span class="r6">  1144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">ident</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">  1147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Thread identifier of this thread or None if it has not been started.</span><span class="r9">                </span>  
 <span class="r6">  1148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This is a nonzero integer. See the get_ident() function. Thread</span><span class="r9">                        </span>  
 <span class="r6">  1150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        identifiers may be recycled when a thread exits and another thread is</span><span class="r9">                  </span>  
 <span class="r6">  1151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        created. The identifier is available even after the thread has exited.</span><span class="r9">                 </span>  
 <span class="r6">  1152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                               </span>  
 <span class="r6">  1155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident</span><span class="r9">                                                                     </span>  
 <span class="r6">  1156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r23">@property</span><span class="r9">                                                                              </span>  
 <span class="r6">  1159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">native_id</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">  1160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">            </span><span class="r8">&quot;&quot;&quot;Native integral thread ID of this thread, or None if it has not been started.</span><span class="r9">   </span>  
 <span class="r6">  1161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            This is a non-negative integer. See the get_native_id() function.</span><span class="r9">                  </span>  
 <span class="r6">  1163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            This represents the Thread ID as reported by the kernel.</span><span class="r9">                           </span>  
 <span class="r6">  1164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            &quot;&quot;&quot;</span><span class="r9">                                                                                </span>  
 <span class="r6">  1166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                           </span>  
 <span class="r6">  1167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_native_id</span><span class="r9">                                                             </span>  
 <span class="r6">  1168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">is_alive</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return whether the thread is alive.</span><span class="r9">                                                 </span>  
 <span class="r6">  1171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method returns True just before the run() method starts until just</span><span class="r9">                </span>  
 <span class="r6">  1173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        after the run() method terminates. See also the module function</span><span class="r9">                        </span>  
 <span class="r6">  1174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        enumerate().</span><span class="r9">                                                                           </span>  
 <span class="r6">  1175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                               </span>  
 <span class="r6">  1178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                     </span>  
 <span class="r6">  1179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                       </span>  
 <span class="r6">  1180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_wait_for_tstate_lock(</span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                                      </span>  
 <span class="r6">  1181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped</span><span class="r9">                                                            </span>  
 <span class="r6">  1182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">daemon</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">  1185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;A boolean value indicating whether this thread is a daemon thread.</span><span class="r9">                  </span>  
 <span class="r6">  1186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This must be set before start() is called, otherwise RuntimeError is</span><span class="r9">                   </span>  
 <span class="r6">  1188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        raised. Its initial value is inherited from the creating thread; the</span><span class="r9">                   </span>  
 <span class="r6">  1189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        main thread is not a daemon thread and therefore all threads created in</span><span class="r9">                </span>  
 <span class="r6">  1190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the main thread default to daemon = False.</span><span class="r9">                                             </span>  
 <span class="r6">  1191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The entire Python program exits when only daemon threads are left.</span><span class="r9">                     </span>  
 <span class="r6">  1193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized, </span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r9">                               </span>  
 <span class="r6">  1196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic</span><span class="r9">                                                                  </span>  
 <span class="r6">  1197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@daemon</span><span class="r15">.</span><span class="r11">setter</span><span class="r9">                                                                             </span>  
 <span class="r6">  1199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">daemon</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, daemonic):</span><span class="r9">                                                                </span>  
 <span class="r6">  1200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_initialized:</span><span class="r9">                                                              </span>  
 <span class="r6">  1201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;Thread.__init__() not called&quot;</span><span class="r11">)</span><span class="r9">                                 </span>  
 <span class="r6">  1202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                                             </span>  
 <span class="r6">  1203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;cannot set daemon status of active thread&quot;</span><span class="r11">)</span><span class="r9">                    </span>  
 <span class="r6">  1204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_daemonic </span><span class="r15">=</span><span class="r11"> daemonic</span><span class="r9">                                                              </span>  
 <span class="r6">  1205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">isDaemon</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return whether this thread is a daemon.</span><span class="r9">                                             </span>  
 <span class="r6">  1208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use the daemon attribute instead.</span><span class="r9">                           </span>  
 <span class="r6">  1210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">  1213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;isDaemon() is deprecated, get the daemon attribute instead&#x27;</span><span class="r11">,</span><span class="r9">            </span>  
 <span class="r6">  1214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  1215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">daemon</span><span class="r9">                                                                     </span>  
 <span class="r6">  1216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">setDaemon</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, daemonic):</span><span class="r9">                                                             </span>  
 <span class="r6">  1218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Set whether this thread is a daemon.</span><span class="r9">                                                </span>  
 <span class="r6">  1219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use the .daemon property instead.</span><span class="r9">                           </span>  
 <span class="r6">  1221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">  1224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;setDaemon() is deprecated, set the daemon attribute instead&#x27;</span><span class="r11">,</span><span class="r9">           </span>  
 <span class="r6">  1225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  1226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">daemon </span><span class="r15">=</span><span class="r11"> daemonic</span><span class="r9">                                                                 </span>  
 <span class="r6">  1227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getName</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  1229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return a string used for identification purposes only.</span><span class="r9">                              </span>  
 <span class="r6">  1230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use the name attribute instead.</span><span class="r9">                             </span>  
 <span class="r6">  1232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">  1235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;getName() is deprecated, get the name attribute instead&#x27;</span><span class="r11">,</span><span class="r9">               </span>  
 <span class="r6">  1236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  1237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">name</span><span class="r9">                                                                       </span>  
 <span class="r6">  1238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">setName</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name):</span><span class="r9">                                                                   </span>  
 <span class="r6">  1240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Set the name string for this thread.</span><span class="r9">                                                </span>  
 <span class="r6">  1241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is deprecated, use the name attribute instead.</span><span class="r9">                             </span>  
 <span class="r6">  1243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                        </span>  
 <span class="r6">  1246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;setName() is deprecated, set the name attribute instead&#x27;</span><span class="r11">,</span><span class="r9">               </span>  
 <span class="r6">  1247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  1248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">name </span><span class="r15">=</span><span class="r11"> name</span><span class="r9">                                                                       </span>  
 <span class="r6">  1249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">  1252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">_thread</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> (_excepthook </span><span class="r10">as</span><span class="r11"> excepthook,</span><span class="r9">                                            </span>  
 <span class="r6">  1253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                         _ExceptHookArgs </span><span class="r10">as</span><span class="r11"> ExceptHookArgs)</span><span class="r9">                                    </span>  
 <span class="r6">  1254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">  1255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Simple Python implementation if _thread._excepthook() is not available</span><span class="r9">                   </span>  
 <span class="r6">  1256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">traceback</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> print_exception </span><span class="r10">as</span><span class="r11"> _print_exception</span><span class="r9">                                  </span>  
 <span class="r6">  1257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">collections</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> namedtuple</span><span class="r9">                                                         </span>  
 <span class="r6">  1258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _ExceptHookArgs </span><span class="r15">=</span><span class="r11"> namedtuple(</span><span class="r9">                                                              </span>  
 <span class="r6">  1260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;ExceptHookArgs&#x27;</span><span class="r11">,</span><span class="r9">                                                                      </span>  
 <span class="r6">  1261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;exc_type exc_value exc_traceback thread&#x27;</span><span class="r11">)</span><span class="r9">                                             </span>  
 <span class="r6">  1262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">ExceptHookArgs</span><span class="r11">(args):</span><span class="r9">                                                                  </span>  
 <span class="r6">  1264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _ExceptHookArgs(</span><span class="r15">*</span><span class="r11">args)</span><span class="r9">                                                          </span>  
 <span class="r6">  1265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">excepthook</span><span class="r11">(args, </span><span class="r15">/</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">  1267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Handle uncaught Thread.run() exception.</span><span class="r9">                                                </span>  
 <span class="r6">  1269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> args</span><span class="r15">.</span><span class="r11">exc_type </span><span class="r15">==</span><span class="r11"> </span><span class="r13">SystemExit</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">  1271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># silently ignore SystemExit</span><span class="r9">                                                       </span>  
 <span class="r6">  1272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  1273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> _sys </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> _sys</span><span class="r15">.</span><span class="r11">stderr </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                       </span>  
 <span class="r6">  1275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            stderr </span><span class="r15">=</span><span class="r11"> _sys</span><span class="r15">.</span><span class="r11">stderr</span><span class="r9">                                                               </span>  
 <span class="r6">  1276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> args</span><span class="r15">.</span><span class="r11">thread </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">  1277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            stderr </span><span class="r15">=</span><span class="r11"> args</span><span class="r15">.</span><span class="r11">thread</span><span class="r15">.</span><span class="r11">_stderr</span><span class="r9">                                                       </span>  
 <span class="r6">  1278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> stderr </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># do nothing if sys.stderr is None and sys.stderr was None</span><span class="r9">                     </span>  
 <span class="r6">  1280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># when the thread was created</span><span class="r9">                                                  </span>  
 <span class="r6">  1281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">  1282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># do nothing if sys.stderr is None and args.thread is None</span><span class="r9">                         </span>  
 <span class="r6">  1284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  1285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> args</span><span class="r15">.</span><span class="r11">thread </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">  1287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name </span><span class="r15">=</span><span class="r11"> args</span><span class="r15">.</span><span class="r11">thread</span><span class="r15">.</span><span class="r11">name</span><span class="r9">                                                            </span>  
 <span class="r6">  1288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name </span><span class="r15">=</span><span class="r11"> get_ident()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">print</span><span class="r11">(</span><span class="r16">f&quot;Exception in thread </span><span class="r21">{</span><span class="r11">name</span><span class="r21">}</span><span class="r16">:&quot;</span><span class="r11">,</span><span class="r9">                                                  </span>  
 <span class="r6">  1291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">              file</span><span class="r15">=</span><span class="r11">stderr, flush</span><span class="r15">=</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">  1292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _print_exception(args</span><span class="r15">.</span><span class="r11">exc_type, args</span><span class="r15">.</span><span class="r11">exc_value, args</span><span class="r15">.</span><span class="r11">exc_traceback,</span><span class="r9">                    </span>  
 <span class="r6">  1293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                         file</span><span class="r15">=</span><span class="r11">stderr)</span><span class="r9">                                                          </span>  
 <span class="r6">  1294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        stderr</span><span class="r15">.</span><span class="r11">flush()</span><span class="r9">                                                                         </span>  
 <span class="r6">  1295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Original value of threading.excepthook</span><span class="r9">                                                       </span>  
 <span class="r6">  1298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">__excepthook__ </span><span class="r15">=</span><span class="r11"> excepthook</span><span class="r9">                                                                    </span>  
 <span class="r6">  1299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_make_invoke_excepthook</span><span class="r11">():</span><span class="r9">                                                                 </span>  
 <span class="r6">  1302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Create a local namespace to ensure that variables remain alive</span><span class="r9">                           </span>  
 <span class="r6">  1303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># when _invoke_excepthook() is called, even if it is called late during</span><span class="r9">                    </span>  
 <span class="r6">  1304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Python shutdown. It is mostly needed for daemon threads.</span><span class="r9">                                 </span>  
 <span class="r6">  1305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    old_excepthook </span><span class="r15">=</span><span class="r11"> excepthook</span><span class="r9">                                                                </span>  
 <span class="r6">  1307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    old_sys_excepthook </span><span class="r15">=</span><span class="r11"> _sys</span><span class="r15">.</span><span class="r11">excepthook</span><span class="r9">                                                       </span>  
 <span class="r6">  1308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> old_excepthook </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;threading.excepthook is None&quot;</span><span class="r11">)</span><span class="r9">                                     </span>  
 <span class="r6">  1310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> old_sys_excepthook </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  1311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;sys.excepthook is None&quot;</span><span class="r11">)</span><span class="r9">                                           </span>  
 <span class="r6">  1312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    sys_exc_info </span><span class="r15">=</span><span class="r11"> _sys</span><span class="r15">.</span><span class="r11">exc_info</span><span class="r9">                                                               </span>  
 <span class="r6">  1314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    local_print </span><span class="r15">=</span><span class="r11"> </span><span class="r20">print</span><span class="r9">                                                                        </span>  
 <span class="r6">  1315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    local_sys </span><span class="r15">=</span><span class="r11"> _sys</span><span class="r9">                                                                           </span>  
 <span class="r6">  1316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">invoke_excepthook</span><span class="r11">(thread):</span><span class="r9">                                                             </span>  
 <span class="r6">  1318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">global</span><span class="r11"> excepthook</span><span class="r9">                                                                      </span>  
 <span class="r6">  1319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            hook </span><span class="r15">=</span><span class="r11"> excepthook</span><span class="r9">                                                                  </span>  
 <span class="r6">  1321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> hook </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                hook </span><span class="r15">=</span><span class="r11"> old_excepthook</span><span class="r9">                                                          </span>  
 <span class="r6">  1323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> ExceptHookArgs([</span><span class="r15">*</span><span class="r11">sys_exc_info(), thread])</span><span class="r9">                                   </span>  
 <span class="r6">  1325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            hook(args)</span><span class="r9">                                                                         </span>  
 <span class="r6">  1327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> exc:</span><span class="r9">                                                               </span>  
 <span class="r6">  1328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            exc</span><span class="r15">.</span><span class="r11">__suppress_context__ </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                    </span>  
 <span class="r6">  1329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> exc</span><span class="r9">                                                                            </span>  
 <span class="r6">  1330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> local_sys </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> local_sys</span><span class="r15">.</span><span class="r11">stderr </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                         </span>  
 <span class="r6">  1332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                stderr </span><span class="r15">=</span><span class="r11"> local_sys</span><span class="r15">.</span><span class="r11">stderr</span><span class="r9">                                                      </span>  
 <span class="r6">  1333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                stderr </span><span class="r15">=</span><span class="r11"> thread</span><span class="r15">.</span><span class="r11">_stderr</span><span class="r9">                                                        </span>  
 <span class="r6">  1335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            local_print(</span><span class="r16">&quot;Exception in threading.excepthook:&quot;</span><span class="r11">,</span><span class="r9">                                  </span>  
 <span class="r6">  1337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        file</span><span class="r15">=</span><span class="r11">stderr, flush</span><span class="r15">=</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                                               </span>  
 <span class="r6">  1338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> local_sys </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> local_sys</span><span class="r15">.</span><span class="r11">excepthook </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                     </span>  
 <span class="r6">  1340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sys_excepthook </span><span class="r15">=</span><span class="r11"> local_sys</span><span class="r15">.</span><span class="r11">excepthook</span><span class="r9">                                          </span>  
 <span class="r6">  1341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sys_excepthook </span><span class="r15">=</span><span class="r11"> old_sys_excepthook</span><span class="r9">                                            </span>  
 <span class="r6">  1343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sys_excepthook(</span><span class="r15">*</span><span class="r11">sys_exc_info())</span><span class="r9">                                                    </span>  
 <span class="r6">  1345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Break reference cycle (exception stored in a variable)</span><span class="r9">                           </span>  
 <span class="r6">  1347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                        </span>  
 <span class="r6">  1348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> invoke_excepthook</span><span class="r9">                                                                   </span>  
 <span class="r6">  1350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># The timer class was contributed by Itamar Shtull-Trauring</span><span class="r9">                                    </span>  
 <span class="r6">  1353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Timer</span><span class="r11">(Thread):</span><span class="r9">                                                                           </span>  
 <span class="r6">  1355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Call a function after a specified number of seconds:</span><span class="r9">                                    </span>  
 <span class="r6">  1356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            t = Timer(30.0, f, args=None, kwargs=None)</span><span class="r9">                                         </span>  
 <span class="r6">  1358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            t.start()</span><span class="r9">                                                                          </span>  
 <span class="r6">  1359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            t.cancel()     # stop the timer&#x27;s action if it&#x27;s still waiting</span><span class="r9">                     </span>  
 <span class="r6">  1360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, interval, function, args</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, kwargs</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                            </span>  
 <span class="r6">  1364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        Thread</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                  </span>  
 <span class="r6">  1365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">interval </span><span class="r15">=</span><span class="r11"> interval</span><span class="r9">                                                               </span>  
 <span class="r6">  1366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">function </span><span class="r15">=</span><span class="r11"> function</span><span class="r9">                                                               </span>  
 <span class="r6">  1367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">args </span><span class="r15">=</span><span class="r11"> args </span><span class="r10">if</span><span class="r11"> args </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> []</span><span class="r9">                                           </span>  
 <span class="r6">  1368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">kwargs </span><span class="r15">=</span><span class="r11"> kwargs </span><span class="r10">if</span><span class="r11"> kwargs </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> {}</span><span class="r9">                                     </span>  
 <span class="r6">  1369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished </span><span class="r15">=</span><span class="r11"> Event()</span><span class="r9">                                                                </span>  
 <span class="r6">  1370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">cancel</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">  1372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Stop the timer if it hasn&#x27;t finished yet.&quot;&quot;&quot;</span><span class="r9">                                        </span>  
 <span class="r6">  1373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished</span><span class="r15">.</span><span class="r11">set()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">run</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                             </span>  
 <span class="r6">  1376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished</span><span class="r15">.</span><span class="r11">wait(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">interval)</span><span class="r9">                                                      </span>  
 <span class="r6">  1377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished</span><span class="r15">.</span><span class="r11">is_set():</span><span class="r9">                                                         </span>  
 <span class="r6">  1378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">function(</span><span class="r15">*</span><span class="r20">self</span><span class="r15">.</span><span class="r11">args, </span><span class="r15">**</span><span class="r20">self</span><span class="r15">.</span><span class="r11">kwargs)</span><span class="r9">                                           </span>  
 <span class="r6">  1379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished</span><span class="r15">.</span><span class="r11">set()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Special thread class to represent the main thread</span><span class="r9">                                            </span>  
 <span class="r6">  1383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">_MainThread</span><span class="r11">(Thread):</span><span class="r9">                                                                     </span>  
 <span class="r6">  1385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        Thread</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name</span><span class="r15">=</span><span class="r16">&quot;MainThread&quot;</span><span class="r11">, daemon</span><span class="r15">=</span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                 </span>  
 <span class="r6">  1388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_tstate_lock()</span><span class="r9">                                                                </span>  
 <span class="r6">  1389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">set()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_ident()</span><span class="r9">                                                                      </span>  
 <span class="r6">  1391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                             </span>  
 <span class="r6">  1392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_native_id()</span><span class="r9">                                                              </span>  
 <span class="r6">  1393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                               </span>  
 <span class="r6">  1394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _active[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                        </span>  
 <span class="r6">  1395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Dummy thread class to represent threads not started here.</span><span class="r9">                                    </span>  
 <span class="r6">  1398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># These aren&#x27;t garbage collected when they die, nor can they be waited for.</span><span class="r9">                    </span>  
 <span class="r6">  1399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># If they invoke anything in threading.py that calls current_thread(), they</span><span class="r9">                    </span>  
 <span class="r6">  1400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># leave an entry in the _active dict forever after.</span><span class="r9">                                            </span>  
 <span class="r6">  1401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Their purpose is to return *something* from current_thread().</span><span class="r9">                                </span>  
 <span class="r6">  1402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># They are marked as daemon threads so we won&#x27;t wait for them</span><span class="r9">                                  </span>  
 <span class="r6">  1403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># when we exit (conform previous semantics).</span><span class="r9">                                                   </span>  
 <span class="r6">  1404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">_DummyThread</span><span class="r11">(Thread):</span><span class="r9">                                                                    </span>  
 <span class="r6">  1406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        Thread</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name</span><span class="r15">=</span><span class="r11">_newname(</span><span class="r16">&quot;Dummy-</span><span class="r21">%d</span><span class="r16">&quot;</span><span class="r11">), daemon</span><span class="r15">=</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">  1409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">set()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_ident()</span><span class="r9">                                                                      </span>  
 <span class="r6">  1412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> _HAVE_THREAD_NATIVE_ID:</span><span class="r9">                                                             </span>  
 <span class="r6">  1413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_set_native_id()</span><span class="r9">                                                              </span>  
 <span class="r6">  1414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                               </span>  
 <span class="r6">  1415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _active[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ident] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                        </span>  
 <span class="r6">  1416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_stop</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">  1418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">is_alive</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_is_stopped </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_started</span><span class="r15">.</span><span class="r11">is_set()</span><span class="r9">                                 </span>  
 <span class="r6">  1422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                            </span>  
 <span class="r6">  1423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">join</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, timeout</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">  1425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r10">False</span><span class="r11">, </span><span class="r16">&quot;cannot join a dummy thread&quot;</span><span class="r9">                                             </span>  
 <span class="r6">  1426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Global API functions</span><span class="r9">                                                                         </span>  
 <span class="r6">  1429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">current_thread</span><span class="r11">():</span><span class="r9">                                                                          </span>  
 <span class="r6">  1431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return the current Thread object, corresponding to the caller&#x27;s thread of control.</span><span class="r9">      </span>  
 <span class="r6">  1432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If the caller&#x27;s thread of control was not created through the threading</span><span class="r9">                    </span>  
 <span class="r6">  1434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    module, a dummy thread object with limited functionality is returned.</span><span class="r9">                      </span>  
 <span class="r6">  1435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">  1438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _active[get_ident()]</span><span class="r9">                                                            </span>  
 <span class="r6">  1439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _DummyThread()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">currentThread</span><span class="r11">():</span><span class="r9">                                                                           </span>  
 <span class="r6">  1443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return the current Thread object, corresponding to the caller&#x27;s thread of control.</span><span class="r9">      </span>  
 <span class="r6">  1444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This function is deprecated, use current_thread() instead.</span><span class="r9">                                 </span>  
 <span class="r6">  1446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                            </span>  
 <span class="r6">  1449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;currentThread() is deprecated, use current_thread() instead&#x27;</span><span class="r11">,</span><span class="r9">               </span>  
 <span class="r6">  1450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                  </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  1451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> current_thread()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">active_count</span><span class="r11">():</span><span class="r9">                                                                            </span>  
 <span class="r6">  1454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return the number of Thread objects currently alive.</span><span class="r9">                                    </span>  
 <span class="r6">  1455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The returned count is equal to the length of the list returned by</span><span class="r9">                          </span>  
 <span class="r6">  1457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    enumerate().</span><span class="r9">                                                                               </span>  
 <span class="r6">  1458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(_active) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(_limbo)</span><span class="r9">                                                      </span>  
 <span class="r6">  1462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">activeCount</span><span class="r11">():</span><span class="r9">                                                                             </span>  
 <span class="r6">  1464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return the number of Thread objects currently alive.</span><span class="r9">                                    </span>  
 <span class="r6">  1465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This function is deprecated, use active_count() instead.</span><span class="r9">                                   </span>  
 <span class="r6">  1467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                            </span>  
 <span class="r6">  1470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&#x27;activeCount() is deprecated, use active_count() instead&#x27;</span><span class="r11">,</span><span class="r9">                   </span>  
 <span class="r6">  1471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                  </span><span class="r13">DeprecationWarning</span><span class="r11">, stacklevel</span><span class="r15">=2</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  1472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> active_count()</span><span class="r9">                                                                      </span>  
 <span class="r6">  1473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_enumerate</span><span class="r11">():</span><span class="r9">                                                                              </span>  
 <span class="r6">  1475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Same as enumerate(), but without the lock. Internal use only.</span><span class="r9">                            </span>  
 <span class="r6">  1476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(_active</span><span class="r15">.</span><span class="r11">values()) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(_limbo</span><span class="r15">.</span><span class="r11">values())</span><span class="r9">                                      </span>  
 <span class="r6">  1477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">enumerate</span><span class="r11">():</span><span class="r9">                                                                               </span>  
 <span class="r6">  1479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return a list of all Thread objects currently alive.</span><span class="r9">                                    </span>  
 <span class="r6">  1480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The list includes daemonic threads, dummy thread objects created by</span><span class="r9">                        </span>  
 <span class="r6">  1482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    current_thread(), and the main thread. It excludes terminated threads and</span><span class="r9">                  </span>  
 <span class="r6">  1483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    threads that have not yet been started.</span><span class="r9">                                                    </span>  
 <span class="r6">  1484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(_active</span><span class="r15">.</span><span class="r11">values()) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(_limbo</span><span class="r15">.</span><span class="r11">values())</span><span class="r9">                                  </span>  
 <span class="r6">  1488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_threading_atexits </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                        </span>  
 <span class="r6">  1491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_SHUTTING_DOWN </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                         </span>  
 <span class="r6">  1492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_register_atexit</span><span class="r11">(func, </span><span class="r15">*</span><span class="r11">arg, </span><span class="r15">**</span><span class="r11">kwargs):</span><span class="r9">                                                    </span>  
 <span class="r6">  1494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;CPython internal: register *func* to be called before joining threads.</span><span class="r9">                  </span>  
 <span class="r6">  1495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The registered *func* is called with its arguments just before all</span><span class="r9">                         </span>  
 <span class="r6">  1497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    non-daemon threads are joined in `_shutdown()`. It provides a similar</span><span class="r9">                      </span>  
 <span class="r6">  1498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    purpose to `atexit.register()`, but its functions are called prior to</span><span class="r9">                      </span>  
 <span class="r6">  1499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    threading shutdown instead of interpreter shutdown.</span><span class="r9">                                        </span>  
 <span class="r6">  1500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    For similarity to atexit, the registered functions are called in reverse.</span><span class="r9">                  </span>  
 <span class="r6">  1502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _SHUTTING_DOWN:</span><span class="r9">                                                                         </span>  
 <span class="r6">  1504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(</span><span class="r16">&quot;can&#x27;t register atexit after shutdown&quot;</span><span class="r11">)</span><span class="r9">                             </span>  
 <span class="r6">  1505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    call </span><span class="r15">=</span><span class="r11"> functools</span><span class="r15">.</span><span class="r11">partial(func, </span><span class="r15">*</span><span class="r11">arg, </span><span class="r15">**</span><span class="r11">kwargs)</span><span class="r9">                                             </span>  
 <span class="r6">  1507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _threading_atexits</span><span class="r15">.</span><span class="r11">append(call)</span><span class="r9">                                                            </span>  
 <span class="r6">  1508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">_thread</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> stack_size</span><span class="r9">                                                                 </span>  
 <span class="r6">  1511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Create the main thread object,</span><span class="r9">                                                               </span>  
 <span class="r6">  1513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># and make it available for the interpreter</span><span class="r9">                                                    </span>  
 <span class="r6">  1514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># (Py_Main) as threading._shutdown.</span><span class="r9">                                                            </span>  
 <span class="r6">  1515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_main_thread </span><span class="r15">=</span><span class="r11"> _MainThread()</span><span class="r9">                                                                   </span>  
 <span class="r6">  1517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_shutdown</span><span class="r11">():</span><span class="r9">                                                                               </span>  
 <span class="r6">  1519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Wait until the Python thread state of all non-daemon threads get deleted.</span><span class="r9">                  </span>  
 <span class="r6">  1521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Obscure:  other threads may be waiting to join _main_thread.  That&#x27;s</span><span class="r9">                     </span>  
 <span class="r6">  1523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># dubious, but some code does it.  We can&#x27;t wait for C code to release</span><span class="r9">                     </span>  
 <span class="r6">  1524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># the main thread&#x27;s tstate_lock - that won&#x27;t happen until the interpreter</span><span class="r9">                  </span>  
 <span class="r6">  1525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># is nearly dead.  So we release it here.  Note that just calling _stop()</span><span class="r9">                  </span>  
 <span class="r6">  1526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># isn&#x27;t enough:  other threads may already be waiting on _tstate_lock.</span><span class="r9">                     </span>  
 <span class="r6">  1527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _main_thread</span><span class="r15">.</span><span class="r11">_is_stopped:</span><span class="r9">                                                               </span>  
 <span class="r6">  1528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># _shutdown() was already called</span><span class="r9">                                                       </span>  
 <span class="r6">  1529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r9">                                                                                 </span>  
 <span class="r6">  1530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _SHUTTING_DOWN</span><span class="r9">                                                                      </span>  
 <span class="r6">  1532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _SHUTTING_DOWN </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                      </span>  
 <span class="r6">  1533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Call registered threading atexit functions before threads are joined.</span><span class="r9">                    </span>  
 <span class="r6">  1535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Order is reversed, similar to atexit.</span><span class="r9">                                                    </span>  
 <span class="r6">  1536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> atexit_call </span><span class="r19">in</span><span class="r11"> </span><span class="r20">reversed</span><span class="r11">(_threading_atexits):</span><span class="r9">                                           </span>  
 <span class="r6">  1537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        atexit_call()</span><span class="r9">                                                                          </span>  
 <span class="r6">  1538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Main thread</span><span class="r9">                                                                              </span>  
 <span class="r6">  1540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _main_thread</span><span class="r15">.</span><span class="r11">ident </span><span class="r15">==</span><span class="r11"> get_ident():</span><span class="r9">                                                      </span>  
 <span class="r6">  1541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        tlock </span><span class="r15">=</span><span class="r11"> _main_thread</span><span class="r15">.</span><span class="r11">_tstate_lock</span><span class="r9">                                                      </span>  
 <span class="r6">  1542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># The main thread isn&#x27;t finished yet, so its thread state lock can&#x27;t</span><span class="r9">                   </span>  
 <span class="r6">  1543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># have been released.</span><span class="r9">                                                                  </span>  
 <span class="r6">  1544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> tlock </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">  1545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> tlock</span><span class="r15">.</span><span class="r11">locked()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        tlock</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                        </span>  
 <span class="r6">  1547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _main_thread</span><span class="r15">.</span><span class="r11">_stop()</span><span class="r9">                                                                   </span>  
 <span class="r6">  1548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">  1549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># bpo-1596321: _shutdown() must be called in the main thread.</span><span class="r9">                          </span>  
 <span class="r6">  1550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># If the threading module was not imported by the main thread,</span><span class="r9">                         </span>  
 <span class="r6">  1551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># _main_thread is the thread which imported the threading module.</span><span class="r9">                      </span>  
 <span class="r6">  1552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># In this case, ignore _main_thread, similar behavior than for threads</span><span class="r9">                 </span>  
 <span class="r6">  1553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># spawned by C libraries or using _thread.start_new_thread().</span><span class="r9">                          </span>  
 <span class="r6">  1554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Join all non-deamon threads</span><span class="r9">                                                              </span>  
 <span class="r6">  1557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                                </span>  
 <span class="r6">  1558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> _shutdown_locks_lock:</span><span class="r9">                                                             </span>  
 <span class="r6">  1559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            locks </span><span class="r15">=</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(_shutdown_locks)</span><span class="r9">                                                      </span>  
 <span class="r6">  1560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _shutdown_locks</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                            </span>  
 <span class="r6">  1561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> locks:</span><span class="r9">                                                                          </span>  
 <span class="r6">  1563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">break</span><span class="r9">                                                                              </span>  
 <span class="r6">  1564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> lock </span><span class="r19">in</span><span class="r11"> locks:</span><span class="r9">                                                                     </span>  
 <span class="r6">  1566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># mimic Thread.join()</span><span class="r9">                                                              </span>  
 <span class="r6">  1567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lock</span><span class="r15">.</span><span class="r11">acquire()</span><span class="r9">                                                                     </span>  
 <span class="r6">  1568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lock</span><span class="r15">.</span><span class="r11">release()</span><span class="r9">                                                                     </span>  
 <span class="r6">  1569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># new threads can be spawned while we were waiting for the other</span><span class="r9">                       </span>  
 <span class="r6">  1571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># threads to complete</span><span class="r9">                                                                  </span>  
 <span class="r6">  1572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">main_thread</span><span class="r11">():</span><span class="r9">                                                                             </span>  
 <span class="r6">  1575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return the main thread object.</span><span class="r9">                                                          </span>  
 <span class="r6">  1576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    In normal conditions, the main thread is the thread from which the</span><span class="r9">                         </span>  
 <span class="r6">  1578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Python interpreter was started.</span><span class="r9">                                                            </span>  
 <span class="r6">  1579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> _main_thread</span><span class="r9">                                                                        </span>  
 <span class="r6">  1581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># get thread-local implementation, either from the thread</span><span class="r9">                                      </span>  
 <span class="r6">  1583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># module, or from the python fallback</span><span class="r9">                                                          </span>  
 <span class="r6">  1584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">  1586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">_thread</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> _local </span><span class="r10">as</span><span class="r11"> local</span><span class="r9">                                                        </span>  
 <span class="r6">  1587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">  1588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">_threading_local</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> local</span><span class="r9">                                                         </span>  
 <span class="r6">  1589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_after_fork</span><span class="r11">():</span><span class="r9">                                                                             </span>  
 <span class="r6">  1592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Cleanup threading module state that should not exist after a fork.</span><span class="r9">                         </span>  
 <span class="r6">  1594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  1595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Reset _active_limbo_lock, in case we forked while the lock was held</span><span class="r9">                      </span>  
 <span class="r6">  1596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># by another (non-forked) thread.  http://bugs.python.org/issue874900</span><span class="r9">                      </span>  
 <span class="r6">  1597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _active_limbo_lock, _main_thread</span><span class="r9">                                                    </span>  
 <span class="r6">  1598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _shutdown_locks_lock, _shutdown_locks</span><span class="r9">                                               </span>  
 <span class="r6">  1599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _active_limbo_lock </span><span class="r15">=</span><span class="r11"> RLock()</span><span class="r9">                                                               </span>  
 <span class="r6">  1600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># fork() only copied the current thread; clear references to others.</span><span class="r9">                       </span>  
 <span class="r6">  1602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    new_active </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                            </span>  
 <span class="r6">  1603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">  1605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        current </span><span class="r15">=</span><span class="r11"> _active[get_ident()]</span><span class="r9">                                                         </span>  
 <span class="r6">  1606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># fork() was called in a thread which was not spawned</span><span class="r9">                                  </span>  
 <span class="r6">  1608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># by threading.Thread. For example, a thread spawned</span><span class="r9">                                   </span>  
 <span class="r6">  1609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># by thread.start_new_thread().</span><span class="r9">                                                        </span>  
 <span class="r6">  1610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        current </span><span class="r15">=</span><span class="r11"> _MainThread()</span><span class="r9">                                                                </span>  
 <span class="r6">  1611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _main_thread </span><span class="r15">=</span><span class="r11"> current</span><span class="r9">                                                                     </span>  
 <span class="r6">  1613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># reset _shutdown() locks: threads re-register their _tstate_lock below</span><span class="r9">                    </span>  
 <span class="r6">  1615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _shutdown_locks_lock </span><span class="r15">=</span><span class="r11"> _allocate_lock()</span><span class="r9">                                                    </span>  
 <span class="r6">  1616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _shutdown_locks </span><span class="r15">=</span><span class="r11"> </span><span class="r20">set</span><span class="r11">()</span><span class="r9">                                                                    </span>  
 <span class="r6">  1617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">with</span><span class="r11"> _active_limbo_lock:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Dangling thread instances must still have their locks reset,</span><span class="r9">                         </span>  
 <span class="r6">  1620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># because someone may join() them.</span><span class="r9">                                                     </span>  
 <span class="r6">  1621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        threads </span><span class="r15">=</span><span class="r11"> </span><span class="r20">set</span><span class="r11">(_enumerate())</span><span class="r9">                                                            </span>  
 <span class="r6">  1622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        threads</span><span class="r15">.</span><span class="r11">update(_dangling)</span><span class="r9">                                                              </span>  
 <span class="r6">  1623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> thread </span><span class="r19">in</span><span class="r11"> threads:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Any lock/condition variable may be currently locked or in an</span><span class="r9">                     </span>  
 <span class="r6">  1625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># invalid state, so we reinitialize them.</span><span class="r9">                                          </span>  
 <span class="r6">  1626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> thread </span><span class="r19">is</span><span class="r11"> current:</span><span class="r9">                                                              </span>  
 <span class="r6">  1627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># There is only one active thread. We reset the ident to</span><span class="r9">                       </span>  
 <span class="r6">  1628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># its new value since it can have changed.</span><span class="r9">                                     </span>  
 <span class="r6">  1629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                thread</span><span class="r15">.</span><span class="r11">_reset_internal_locks(</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                                             </span>  
 <span class="r6">  1630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ident </span><span class="r15">=</span><span class="r11"> get_ident()</span><span class="r9">                                                            </span>  
 <span class="r6">  1631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                thread</span><span class="r15">.</span><span class="r11">_ident </span><span class="r15">=</span><span class="r11"> ident</span><span class="r9">                                                          </span>  
 <span class="r6">  1632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new_active[ident] </span><span class="r15">=</span><span class="r11"> thread</span><span class="r9">                                                     </span>  
 <span class="r6">  1633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># All the others are already stopped.</span><span class="r9">                                          </span>  
 <span class="r6">  1635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                thread</span><span class="r15">.</span><span class="r11">_reset_internal_locks(</span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  1636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                thread</span><span class="r15">.</span><span class="r11">_stop()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _limbo</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                         </span>  
 <span class="r6">  1639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _active</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                        </span>  
 <span class="r6">  1640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _active</span><span class="r15">.</span><span class="r11">update(new_active)</span><span class="r9">                                                             </span>  
 <span class="r6">  1641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(_active) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                               </span>  
 <span class="r6">  1642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_os, </span><span class="r16">&quot;register_at_fork&quot;</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">  1645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _os</span><span class="r15">.</span><span class="r11">register_at_fork(after_in_child</span><span class="r15">=</span><span class="r11">_after_fork)</span><span class="r9">                                           </span>  
 <span class="r6">  1646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r24">function summary for /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/threading.py       </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Process</span><span class="r15">.</span><span class="r11">RLock</span><span class="r9">                                                                                  </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r17">__init__</span><span class="r9">                                                                             </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r17">__enter__</span><span class="r9">                                                                            </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r17">__exit__</span><span class="r9">                                                                             </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r11">_acquire_restore</span><span class="r9">                                                                     </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r11">_is_owned</span><span class="r9">                                                                            </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">    4% </span>│<span class="r7">  28%  </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r11">wait</span><span class="r9">                                                                                 </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Condition</span><span class="r15">.</span><span class="r11">notify</span><span class="r9">                                                                               </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r11">_maintain_shutdown_locks</span><span class="r9">                                                                </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r17">__init__</span><span class="r9">                                                                                </span>  
 <span class="r6">   916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r11">start</span><span class="r9">                                                                                   </span>  
 <span class="r6">   942 </span>│<span class="r7">        </span>│<span class="r7">    9% </span>│<span class="r7">  28%  </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r11">run</span><span class="r9">                                                                                     </span>  
 <span class="r6">  1064 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r11">join</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Thread</span><span class="r15">.</span><span class="r11">_wait_for_tstate_lock</span><span class="r9">                                                                   </span>  
        ╵        ╵       ╵       ╵                                                                                                 
<span class="r1">    /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/socket.py: % of time =  14.88% (33m:46.880s) out of 4h:40m:20.690s.     </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/socket.py                                </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Wrapper module for _socket, providing some additional facilities</span><span class="r9">                             </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># implemented in Python.</span><span class="r9">                                                                       </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;\</span><span class="r9">                                                                                           </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">This module provides socket operations and some related functions.</span><span class="r9">                             </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">On Unix, it supports IP (Internet Protocol) and Unix domain sockets.</span><span class="r9">                           </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">On other systems, it only supports IP. Functions specific for a</span><span class="r9">                                </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">socket are available as methods of the socket object.</span><span class="r9">                                          </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">Functions:</span><span class="r9">                                                                                     </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">socket() -- create a new socket object</span><span class="r9">                                                         </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">socketpair() -- create a pair of new socket objects [*]</span><span class="r9">                                        </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">fromfd() -- create a socket object from an open file descriptor [*]</span><span class="r9">                            </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">send_fds() -- Send file descriptor to the socket.</span><span class="r9">                                              </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">recv_fds() -- Recieve file descriptors from the socket.</span><span class="r9">                                        </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">fromshare() -- create a socket object from data received from socket.share() [*]</span><span class="r9">               </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">gethostname() -- return the current hostname</span><span class="r9">                                                   </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">gethostbyname() -- map a hostname to its IP number</span><span class="r9">                                             </span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">gethostbyaddr() -- map an IP number or hostname to DNS info</span><span class="r9">                                    </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">getservbyname() -- map a service name and a protocol name to a port number</span><span class="r9">                     </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">getprotobyname() -- map a protocol name (e.g. &#x27;tcp&#x27;) to a number</span><span class="r9">                               </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">ntohs(), ntohl() -- convert 16, 32 bit int from network to host byte order</span><span class="r9">                     </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">htons(), htonl() -- convert 16, 32 bit int from host to network byte order</span><span class="r9">                     </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">inet_aton() -- convert IP addr string (123.45.67.89) to 32-bit packed format</span><span class="r9">                   </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">inet_ntoa() -- convert 32-bit packed format IP to string (123.45.67.89)</span><span class="r9">                        </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">socket.getdefaulttimeout() -- get the default timeout value</span><span class="r9">                                    </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">socket.setdefaulttimeout() -- set the default timeout value</span><span class="r9">                                    </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">create_connection() -- connects to an address, with an optional timeout and</span><span class="r9">                    </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       optional source address.</span><span class="r9">                                                </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8"> [*] not available on all platforms!</span><span class="r9">                                                           </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">Special objects:</span><span class="r9">                                                                               </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">SocketType -- type object for socket objects</span><span class="r9">                                                   </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">error -- exception raised for I/O errors</span><span class="r9">                                                       </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">has_ipv6 -- boolean value indicating if IPv6 is supported</span><span class="r9">                                      </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">IntEnum constants:</span><span class="r9">                                                                             </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">AF_INET, AF_UNIX -- socket domains (first argument to socket() call)</span><span class="r9">                           </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">SOCK_STREAM, SOCK_DGRAM, SOCK_RAW -- socket types (second argument)</span><span class="r9">                            </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">Integer constants:</span><span class="r9">                                                                             </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">Many other constants may be defined; these may be used in calls to</span><span class="r9">                             </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">the setsockopt() and getsockopt() methods.</span><span class="r9">                                                     </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">_socket</span><span class="r9">                                                                                 </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">_socket</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> </span><span class="r15">*</span><span class="r9">                                                                          </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">os</span><span class="r15">,</span><span class="r11"> </span><span class="r12">sys</span><span class="r15">,</span><span class="r11"> </span><span class="r12">io</span><span class="r15">,</span><span class="r11"> </span><span class="r12">selectors</span><span class="r9">                                                                  </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">enum</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> IntEnum, IntFlag</span><span class="r9">                                                              </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">errno</span><span class="r9">                                                                               </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errno </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                               </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">EBADF </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(errno, </span><span class="r16">&#x27;EBADF&#x27;</span><span class="r11">, </span><span class="r15">9</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">EAGAIN </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(errno, </span><span class="r16">&#x27;EAGAIN&#x27;</span><span class="r11">, </span><span class="r15">11</span><span class="r11">)</span><span class="r9">                                                          </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">EWOULDBLOCK </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(errno, </span><span class="r16">&#x27;EWOULDBLOCK&#x27;</span><span class="r11">, </span><span class="r15">11</span><span class="r11">)</span><span class="r9">                                                </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">__all__ </span><span class="r15">=</span><span class="r11"> [</span><span class="r16">&quot;fromfd&quot;</span><span class="r11">, </span><span class="r16">&quot;getfqdn&quot;</span><span class="r11">, </span><span class="r16">&quot;create_connection&quot;</span><span class="r11">, </span><span class="r16">&quot;create_server&quot;</span><span class="r11">,</span><span class="r9">                          </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">           </span><span class="r16">&quot;has_dualstack_ipv6&quot;</span><span class="r11">, </span><span class="r16">&quot;AddressFamily&quot;</span><span class="r11">, </span><span class="r16">&quot;SocketKind&quot;</span><span class="r11">]</span><span class="r9">                                </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">__all__</span><span class="r15">.</span><span class="r11">extend(os</span><span class="r15">.</span><span class="r11">_get_exports_list(_socket))</span><span class="r9">                                                  </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Set up the socket.AF_* socket.SOCK_* constants as members of IntEnums for</span><span class="r9">                    </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># nicer string representations.</span><span class="r9">                                                                </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Note that _socket only knows about the integer values. The public interface</span><span class="r9">                  </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># in this module understands the enums and translates them back from integers</span><span class="r9">                  </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># where needed (e.g. .family property of a socket object).</span><span class="r9">                                     </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">IntEnum</span><span class="r15">.</span><span class="r11">_convert_(</span><span class="r9">                                                                             </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;AddressFamily&#x27;</span><span class="r11">,</span><span class="r9">                                                                       </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">lambda</span><span class="r11"> C: C</span><span class="r15">.</span><span class="r11">isupper() </span><span class="r19">and</span><span class="r11"> C</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&#x27;AF_&#x27;</span><span class="r11">))</span><span class="r9">                                         </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">IntEnum</span><span class="r15">.</span><span class="r11">_convert_(</span><span class="r9">                                                                             </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;SocketKind&#x27;</span><span class="r11">,</span><span class="r9">                                                                          </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">lambda</span><span class="r11"> C: C</span><span class="r15">.</span><span class="r11">isupper() </span><span class="r19">and</span><span class="r11"> C</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&#x27;SOCK_&#x27;</span><span class="r11">))</span><span class="r9">                                       </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">IntFlag</span><span class="r15">.</span><span class="r11">_convert_(</span><span class="r9">                                                                             </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;MsgFlag&#x27;</span><span class="r11">,</span><span class="r9">                                                                             </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">lambda</span><span class="r11"> C: C</span><span class="r15">.</span><span class="r11">isupper() </span><span class="r19">and</span><span class="r11"> C</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&#x27;MSG_&#x27;</span><span class="r11">))</span><span class="r9">                                        </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">IntFlag</span><span class="r15">.</span><span class="r11">_convert_(</span><span class="r9">                                                                             </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&#x27;AddressInfo&#x27;</span><span class="r11">,</span><span class="r9">                                                                         </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">lambda</span><span class="r11"> C: C</span><span class="r15">.</span><span class="r11">isupper() </span><span class="r19">and</span><span class="r11"> C</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&#x27;AI_&#x27;</span><span class="r11">))</span><span class="r9">                                         </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_LOCALHOST    </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&#x27;127.0.0.1&#x27;</span><span class="r9">                                                                    </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_LOCALHOST_V6 </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&#x27;::1&#x27;</span><span class="r9">                                                                          </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_intenum_converter</span><span class="r11">(value, enum_klass):</span><span class="r9">                                                     </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Convert a numeric family value to an IntEnum member.</span><span class="r9">                                    </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If it&#x27;s not a known member, return the numeric value itself.</span><span class="r9">                               </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> enum_klass(value)</span><span class="r9">                                                               </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> value</span><span class="r9">                                                                           </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># WSA error codes</span><span class="r9">                                                                              </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">platform</span><span class="r15">.</span><span class="r11">lower()</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&quot;win&quot;</span><span class="r11">):</span><span class="r9">                                                     </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                              </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">6</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Specified event object handle is invalid.&quot;</span><span class="r9">                                  </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">8</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Insufficient memory available.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">87</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;One or more parameters are invalid.&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">995</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Overlapped operation aborted.&quot;</span><span class="r9">                                            </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">996</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Overlapped I/O event object not in signaled state.&quot;</span><span class="r9">                       </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">997</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Overlapped operation will complete later.&quot;</span><span class="r9">                                </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10004</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The operation was interrupted.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10009</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;A bad file handle was passed.&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10013</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Permission denied.&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10014</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;A fault occurred on the network??&quot;</span><span class="r11">  </span><span class="r14"># WSAEFAULT</span><span class="r9">                         </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10022</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;An invalid operation was attempted.&quot;</span><span class="r9">                                    </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10024</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Too many open files.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10035</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The socket operation would block&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10036</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;A blocking operation is already in progress.&quot;</span><span class="r9">                           </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10037</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Operation already in progress.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10038</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Socket operation on nonsocket.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10039</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Destination address required.&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10040</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Message too long.&quot;</span><span class="r9">                                                      </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10041</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Protocol wrong type for socket.&quot;</span><span class="r9">                                        </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10042</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Bad protocol option.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10043</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Protocol not supported.&quot;</span><span class="r9">                                                </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10044</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Socket type not supported.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10045</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Operation not supported.&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10046</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Protocol family not supported.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10047</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Address family not supported by protocol family.&quot;</span><span class="r9">                       </span>  
 <span class="r6">   138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10048</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The network address is in use.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10049</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot assign requested address.&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10050</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Network is down.&quot;</span><span class="r9">                                                       </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10051</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Network is unreachable.&quot;</span><span class="r9">                                                </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10052</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Network dropped connection on reset.&quot;</span><span class="r9">                                   </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10053</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Software caused connection abort.&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10054</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The connection has been reset.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10055</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;No buffer space available.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10056</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Socket is already connected.&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10057</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Socket is not connected.&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10058</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The network has been shut down.&quot;</span><span class="r9">                                        </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10059</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Too many references.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10060</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The operation timed out.&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10061</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Connection refused.&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10062</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot translate name.&quot;</span><span class="r9">                                                 </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10063</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The name is too long.&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10064</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The host is down.&quot;</span><span class="r9">                                                      </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10065</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;The host is unreachable.&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10066</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Directory not empty.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10067</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Too many processes.&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10068</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;User quota exceeded.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10069</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Disk quota exceeded.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10070</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Stale file handle reference.&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10071</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Item is remote.&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10091</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Network subsystem is unavailable.&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10092</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Winsock.dll version out of range.&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10093</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Successful WSAStartup not yet performed.&quot;</span><span class="r9">                               </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10101</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Graceful shutdown in progress.&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10102</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;No more results from WSALookupServiceNext.&quot;</span><span class="r9">                             </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10103</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Call has been canceled.&quot;</span><span class="r9">                                                </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10104</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Procedure call table is invalid.&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10105</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Service provider is invalid.&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10106</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Service provider failed to initialize.&quot;</span><span class="r9">                                 </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10107</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;System call failure.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10108</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Service not found.&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10109</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Class type not found.&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10110</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;No more results from WSALookupServiceNext.&quot;</span><span class="r9">                             </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10111</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Call was canceled.&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">10112</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Database query was refused.&quot;</span><span class="r9">                                            </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11001</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Host not found.&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11002</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Nonauthoritative host not found.&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11003</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;This is a nonrecoverable error.&quot;</span><span class="r9">                                        </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11004</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Valid name, no data record requested type.&quot;</span><span class="r9">                             </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11005</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS receivers.&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11006</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS senders.&quot;</span><span class="r9">                                                           </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11007</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;No QoS senders.&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11008</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS no receivers.&quot;</span><span class="r9">                                                      </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11009</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS request confirmed.&quot;</span><span class="r9">                                                 </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11010</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS admission error.&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11011</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS policy failure.&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11012</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS bad style.&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11013</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS bad object.&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11014</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS traffic control error.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11015</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS generic error.&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11016</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS service type error.&quot;</span><span class="r9">                                                </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11017</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;QoS flowspec error.&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11018</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS provider buffer.&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11019</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS filter style.&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11020</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS filter style.&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11021</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Incorrect QoS filter count.&quot;</span><span class="r9">                                            </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11022</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS object length.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11023</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Incorrect QoS flow count.&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11024</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Unrecognized QoS object.&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11025</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS policy object.&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11026</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS flow descriptor.&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11027</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS provider-specific flowspec.&quot;</span><span class="r9">                                </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11028</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS provider-specific filterspec.&quot;</span><span class="r9">                              </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11029</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS shape discard mode object.&quot;</span><span class="r9">                                 </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11030</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid QoS shaping rate object.&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    errorTab[</span><span class="r15">11031</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Reserved policy QoS element type.&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&quot;errorTab&quot;</span><span class="r11">)</span><span class="r9">                                                                 </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">_GiveupOnSendfile</span><span class="r11">(</span><span class="r13">Exception</span><span class="r11">): </span><span class="r10">pass</span><span class="r9">                                                       </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">socket</span><span class="r11">(_socket</span><span class="r15">.</span><span class="r11">socket):</span><span class="r9">                                                                  </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;A subclass of _socket.socket adding the makefile() method.&quot;&quot;&quot;</span><span class="r9">                           </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r22">__slots__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> [</span><span class="r16">&quot;__weakref__&quot;</span><span class="r11">, </span><span class="r16">&quot;_io_refs&quot;</span><span class="r11">, </span><span class="r16">&quot;_closed&quot;</span><span class="r11">]</span><span class="r9">                                         </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, family</span><span class="r15">=-1</span><span class="r11">, </span><span class="r20">type</span><span class="r15">=-1</span><span class="r11">, proto</span><span class="r15">=-1</span><span class="r11">, fileno</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                             </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># For user code address family and type values are IntEnum members, but</span><span class="r9">                </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># for the underlying _socket.socket they&#x27;re just integers. The</span><span class="r9">                         </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># constructor of _socket.socket converts the given argument to an</span><span class="r9">                      </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># integer automatically.</span><span class="r9">                                                               </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> fileno </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> family </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-1</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                family </span><span class="r15">=</span><span class="r11"> AF_INET</span><span class="r9">                                                               </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">type</span><span class="r11"> </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-1</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">type</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> SOCK_STREAM</span><span class="r9">                                                             </span>  
 <span class="r6">   230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> proto </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-1</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                proto </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                      </span>  
 <span class="r6">   232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _socket</span><span class="r15">.</span><span class="r11">socket</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, family, </span><span class="r20">type</span><span class="r11">, proto, fileno)</span><span class="r9">                             </span>  
 <span class="r6">   233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_io_refs </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                      </span>  
 <span class="r6">   234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_closed </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                   </span>  
 <span class="r6">   235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__enter__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                                            </span>  
 <span class="r6">   238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                                 </span>  
 <span class="r6">   240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_closed:</span><span class="r9">                                                                   </span>  
 <span class="r6">   241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                       </span>  
 <span class="r6">   242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__repr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Wrap __repr__() to reveal the real class name and socket</span><span class="r9">                            </span>  
 <span class="r6">   245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        address(es).</span><span class="r9">                                                                           </span>  
 <span class="r6">   246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        closed </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&#x27;_closed&#x27;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                               </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&lt;</span><span class="r21">%s</span><span class="r16">.</span><span class="r21">%s%s</span><span class="r16"> fd=</span><span class="r21">%i</span><span class="r16">, family=</span><span class="r21">%s</span><span class="r16">, type=</span><span class="r21">%s</span><span class="r16">, proto=</span><span class="r21">%i</span><span class="r16">&quot;</span><span class="r11"> \</span><span class="r9">                                   </span>  
 <span class="r6">   249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r15">%</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__module__</span><span class="r11">,</span><span class="r9">                                                      </span>  
 <span class="r6">   250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__qualname__</span><span class="r11">,</span><span class="r9">                                                    </span>  
 <span class="r6">   251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r16">&quot; [closed]&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> closed </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r11">,</span><span class="r9">                                                  </span>  
 <span class="r6">   252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno(),</span><span class="r9">                                                                  </span>  
 <span class="r6">   253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r20">self</span><span class="r15">.</span><span class="r11">family,</span><span class="r9">                                                                    </span>  
 <span class="r6">   254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r20">self</span><span class="r15">.</span><span class="r11">type,</span><span class="r9">                                                                      </span>  
 <span class="r6">   255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">               </span><span class="r20">self</span><span class="r15">.</span><span class="r11">proto)</span><span class="r9">                                                                     </span>  
 <span class="r6">   256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> closed:</span><span class="r9">                                                                         </span>  
 <span class="r6">   257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                laddr </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getsockname()</span><span class="r9">                                                     </span>  
 <span class="r6">   259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> laddr:</span><span class="r9">                                                                      </span>  
 <span class="r6">   260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    s </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot;, laddr=</span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(laddr)</span><span class="r9">                                             </span>  
 <span class="r6">   261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                      </span>  
 <span class="r6">   262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                raddr </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getpeername()</span><span class="r9">                                                     </span>  
 <span class="r6">   265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> raddr:</span><span class="r9">                                                                      </span>  
 <span class="r6">   266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    s </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot;, raddr=</span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(raddr)</span><span class="r9">                                             </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                      </span>  
 <span class="r6">   268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&#x27;&gt;&#x27;</span><span class="r9">                                                                               </span>  
 <span class="r6">   270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> s</span><span class="r9">                                                                               </span>  
 <span class="r6">   271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__getstate__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">   273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(</span><span class="r16">f&quot;cannot pickle </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__name__</span><span class="r21">!r}</span><span class="r16"> object&quot;</span><span class="r11">)</span><span class="r9">                   </span>  
 <span class="r6">   274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">dup</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                             </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;dup() -&gt; socket object</span><span class="r9">                                                              </span>  
 <span class="r6">   277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Duplicate the socket. Return a new socket object connected to the same</span><span class="r9">                 </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        system resource. The new socket is non-inheritable.</span><span class="r9">                                    </span>  
 <span class="r6">   280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fd </span><span class="r15">=</span><span class="r11"> dup(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno())</span><span class="r9">                                                                </span>  
 <span class="r6">   282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">family, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">type, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">proto, fileno</span><span class="r15">=</span><span class="r11">fd)</span><span class="r9">                   </span>  
 <span class="r6">   283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock</span><span class="r15">.</span><span class="r11">settimeout(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">gettimeout())</span><span class="r9">                                                     </span>  
 <span class="r6">   284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> sock</span><span class="r9">                                                                            </span>  
 <span class="r6">   285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">accept</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;accept() -&gt; (socket object, address info)</span><span class="r9">                                           </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Wait for an incoming connection.  Return a new socket</span><span class="r9">                                  </span>  
 <span class="r6">   290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        representing the connection, and the address of the client.</span><span class="r9">                            </span>  
 <span class="r6">   291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        For IP sockets, the address info is a pair (hostaddr, port).</span><span class="r9">                           </span>  
 <span class="r6">   292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   293 </span>│<span class="r7">        </span>│<span class="r7">    5% </span>│<span class="r7">  10%  </span>│<span class="r11">        fd, addr </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_accept()</span><span class="r9">                                                              </span>  
 <span class="r6">   294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock </span><span class="r15">=</span><span class="r11"> socket(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">family, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">type, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">proto, fileno</span><span class="r15">=</span><span class="r11">fd)</span><span class="r9">                           </span>  
 <span class="r6">   295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Issue #7995: if no default timeout is set and the listening</span><span class="r9">                          </span>  
 <span class="r6">   296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># socket had a (non-zero) timeout, force the new socket in blocking</span><span class="r9">                    </span>  
 <span class="r6">   297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># mode to override platform-specific socket flags inheritance.</span><span class="r9">                         </span>  
 <span class="r6">   298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> getdefaulttimeout() </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">gettimeout():</span><span class="r9">                                  </span>  
 <span class="r6">   299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">setblocking(</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">   300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> sock, addr</span><span class="r9">                                                                      </span>  
 <span class="r6">   301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">makefile</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mode</span><span class="r15">=</span><span class="r16">&quot;r&quot;</span><span class="r11">, buffering</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r15">*</span><span class="r11">,</span><span class="r9">                                            </span>  
 <span class="r6">   303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                 encoding</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, errors</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, newline</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;makefile(...) -&gt; an I/O stream connected to the socket</span><span class="r9">                              </span>  
 <span class="r6">   305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The arguments are as for io.open() after the filename, except the only</span><span class="r9">                 </span>  
 <span class="r6">   307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        supported mode values are &#x27;r&#x27; (default), &#x27;w&#x27; and &#x27;b&#x27;.</span><span class="r9">                                  </span>  
 <span class="r6">   308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># XXX refactor to share code?</span><span class="r9">                                                          </span>  
 <span class="r6">   310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">set</span><span class="r11">(mode) </span><span class="r15">&lt;=</span><span class="r11"> {</span><span class="r16">&quot;r&quot;</span><span class="r11">, </span><span class="r16">&quot;w&quot;</span><span class="r11">, </span><span class="r16">&quot;b&quot;</span><span class="r11">}:</span><span class="r9">                                                   </span>  
 <span class="r6">   311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;invalid mode </span><span class="r21">%r</span><span class="r16"> (only r, w, b allowed)&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (mode,))</span><span class="r9">               </span>  
 <span class="r6">   312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        writing </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;w&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode</span><span class="r9">                                                                  </span>  
 <span class="r6">   313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        reading </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;r&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> writing</span><span class="r9">                                                   </span>  
 <span class="r6">   314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> reading </span><span class="r19">or</span><span class="r11"> writing</span><span class="r9">                                                              </span>  
 <span class="r6">   315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        binary </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;b&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode</span><span class="r9">                                                                   </span>  
 <span class="r6">   316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rawmode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                           </span>  
 <span class="r6">   317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reading:</span><span class="r9">                                                                            </span>  
 <span class="r6">   318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rawmode </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot;r&quot;</span><span class="r9">                                                                     </span>  
 <span class="r6">   319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> writing:</span><span class="r9">                                                                            </span>  
 <span class="r6">   320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rawmode </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot;w&quot;</span><span class="r9">                                                                     </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        raw </span><span class="r15">=</span><span class="r11"> SocketIO(</span><span class="r20">self</span><span class="r11">, rawmode)</span><span class="r9">                                                          </span>  
 <span class="r6">   322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_io_refs </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                     </span>  
 <span class="r6">   323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> buffering </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            buffering </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                                     </span>  
 <span class="r6">   325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> buffering </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            buffering </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">DEFAULT_BUFFER_SIZE</span><span class="r9">                                                 </span>  
 <span class="r6">   327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> buffering </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> binary:</span><span class="r9">                                                                     </span>  
 <span class="r6">   329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;unbuffered streams must be binary&quot;</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">   330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> raw</span><span class="r9">                                                                         </span>  
 <span class="r6">   331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reading </span><span class="r19">and</span><span class="r11"> writing:</span><span class="r9">                                                                </span>  
 <span class="r6">   332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            buffer </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BufferedRWPair(raw, raw, buffering)</span><span class="r9">                                    </span>  
 <span class="r6">   333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> reading:</span><span class="r9">                                                                          </span>  
 <span class="r6">   334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            buffer </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BufferedReader(raw, buffering)</span><span class="r9">                                         </span>  
 <span class="r6">   335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">assert</span><span class="r11"> writing</span><span class="r9">                                                                     </span>  
 <span class="r6">   337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            buffer </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BufferedWriter(raw, buffering)</span><span class="r9">                                         </span>  
 <span class="r6">   338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> binary:</span><span class="r9">                                                                             </span>  
 <span class="r6">   339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> buffer</span><span class="r9">                                                                      </span>  
 <span class="r6">   340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        encoding </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">text_encoding(encoding)</span><span class="r9">                                                  </span>  
 <span class="r6">   341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        text </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">TextIOWrapper(buffer, encoding, errors, newline)</span><span class="r9">                             </span>  
 <span class="r6">   342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        text</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                       </span>  
 <span class="r6">   343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> text</span><span class="r9">                                                                            </span>  
 <span class="r6">   344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(os, </span><span class="r16">&#x27;sendfile&#x27;</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">   346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_sendfile_use_sendfile</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file, offset</span><span class="r15">=0</span><span class="r11">, count</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                          </span>  
 <span class="r6">   348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_check_sendfile_params(file, offset, count)</span><span class="r9">                                   </span>  
 <span class="r6">   349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sockno </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno()</span><span class="r9">                                                             </span>  
 <span class="r6">   350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fileno </span><span class="r15">=</span><span class="r11"> file</span><span class="r15">.</span><span class="r11">fileno()</span><span class="r9">                                                         </span>  
 <span class="r6">   352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, io</span><span class="r15">.</span><span class="r11">UnsupportedOperation) </span><span class="r10">as</span><span class="r11"> err:</span><span class="r9">                           </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> _GiveupOnSendfile(err)  </span><span class="r14"># not a regular file</span><span class="r9">                             </span>  
 <span class="r6">   354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fsize </span><span class="r15">=</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">fstat(fileno)</span><span class="r15">.</span><span class="r11">st_size</span><span class="r9">                                               </span>  
 <span class="r6">   356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> err:</span><span class="r9">                                                             </span>  
 <span class="r6">   357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> _GiveupOnSendfile(err)  </span><span class="r14"># not a regular file</span><span class="r9">                             </span>  
 <span class="r6">   358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> fsize:</span><span class="r9">                                                                      </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r15">0</span><span class="r11">  </span><span class="r14"># empty file</span><span class="r9">                                                         </span>  
 <span class="r6">   360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Truncate to 1GiB to avoid OverflowError, see bpo-38319.</span><span class="r9">                          </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            blocksize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(count </span><span class="r19">or</span><span class="r11"> fsize, </span><span class="r15">2</span><span class="r11"> </span><span class="r15">**</span><span class="r11"> </span><span class="r15">30</span><span class="r11">)</span><span class="r9">                                           </span>  
 <span class="r6">   362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            timeout </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">gettimeout()</span><span class="r9">                                                        </span>  
 <span class="r6">   363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;non-blocking sockets are not supported&quot;</span><span class="r11">)</span><span class="r9">                     </span>  
 <span class="r6">   365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># poll/select have the advantage of not requiring any</span><span class="r9">                              </span>  
 <span class="r6">   366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># extra file descriptor, contrarily to epoll/kqueue</span><span class="r9">                                </span>  
 <span class="r6">   367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># (also, they require a single syscall).</span><span class="r9">                                           </span>  
 <span class="r6">   368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(selectors, </span><span class="r16">&#x27;PollSelector&#x27;</span><span class="r11">):</span><span class="r9">                                             </span>  
 <span class="r6">   369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                selector </span><span class="r15">=</span><span class="r11"> selectors</span><span class="r15">.</span><span class="r11">PollSelector()</span><span class="r9">                                            </span>  
 <span class="r6">   370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                selector </span><span class="r15">=</span><span class="r11"> selectors</span><span class="r15">.</span><span class="r11">SelectSelector()</span><span class="r9">                                          </span>  
 <span class="r6">   372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            selector</span><span class="r15">.</span><span class="r11">register(sockno, selectors</span><span class="r15">.</span><span class="r11">EVENT_WRITE)</span><span class="r9">                                   </span>  
 <span class="r6">   373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            total_sent </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                     </span>  
 <span class="r6">   375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># localize variable access to minimize overhead</span><span class="r9">                                    </span>  
 <span class="r6">   376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            selector_select </span><span class="r15">=</span><span class="r11"> selector</span><span class="r15">.</span><span class="r11">select</span><span class="r9">                                                  </span>  
 <span class="r6">   377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            os_sendfile </span><span class="r15">=</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">sendfile</span><span class="r9">                                                          </span>  
 <span class="r6">   378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> selector_select(timeout):</span><span class="r9">                               </span>  
 <span class="r6">   381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TimeoutError</span><span class="r11">(</span><span class="r16">&#x27;timed out&#x27;</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">   382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> count:</span><span class="r9">                                                                  </span>  
 <span class="r6">   383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        blocksize </span><span class="r15">=</span><span class="r11"> count </span><span class="r15">-</span><span class="r11"> total_sent</span><span class="r9">                                         </span>  
 <span class="r6">   384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> blocksize </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                     </span>  
 <span class="r6">   385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">break</span><span class="r9">                                                              </span>  
 <span class="r6">   386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        sent </span><span class="r15">=</span><span class="r11"> os_sendfile(sockno, fileno, offset, blocksize)</span><span class="r9">                  </span>  
 <span class="r6">   388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">BlockingIOError</span><span class="r11">:</span><span class="r9">                                                    </span>  
 <span class="r6">   389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> timeout:</span><span class="r9">                                                        </span>  
 <span class="r6">   390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># Block until the socket is ready to send some</span><span class="r9">                     </span>  
 <span class="r6">   391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># data; avoids hogging CPU resources.</span><span class="r9">                              </span>  
 <span class="r6">   392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            selector_select()</span><span class="r9">                                                  </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">continue</span><span class="r9">                                                               </span>  
 <span class="r6">   394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> err:</span><span class="r9">                                                     </span>  
 <span class="r6">   395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> total_sent </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                    </span>  
 <span class="r6">   396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># We can get here for different reasons, the main</span><span class="r9">                  </span>  
 <span class="r6">   397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># one being &#x27;file&#x27; is not a regular mmap(2)-like</span><span class="r9">                   </span>  
 <span class="r6">   398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># file, in which case we&#x27;ll fall back on using</span><span class="r9">                     </span>  
 <span class="r6">   399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># plain send().</span><span class="r9">                                                    </span>  
 <span class="r6">   400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">raise</span><span class="r11"> _GiveupOnSendfile(err)</span><span class="r9">                                       </span>  
 <span class="r6">   401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">raise</span><span class="r11"> err </span><span class="r10">from</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                    </span>  
 <span class="r6">   402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> sent </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">break</span><span class="r11">  </span><span class="r14"># EOF</span><span class="r9">                                                       </span>  
 <span class="r6">   405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        offset </span><span class="r15">+=</span><span class="r11"> sent</span><span class="r9">                                                         </span>  
 <span class="r6">   406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        total_sent </span><span class="r15">+=</span><span class="r11"> sent</span><span class="r9">                                                     </span>  
 <span class="r6">   407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> total_sent</span><span class="r9">                                                              </span>  
 <span class="r6">   408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> total_sent </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(file, </span><span class="r16">&#x27;seek&#x27;</span><span class="r11">):</span><span class="r9">                                   </span>  
 <span class="r6">   410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    file</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                                          </span>  
 <span class="r6">   411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_sendfile_use_sendfile</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file, offset</span><span class="r15">=0</span><span class="r11">, count</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                          </span>  
 <span class="r6">   413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> _GiveupOnSendfile(</span><span class="r9">                                                           </span>  
 <span class="r6">   414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;os.sendfile() not available on this platform&quot;</span><span class="r11">)</span><span class="r9">                                </span>  
 <span class="r6">   415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_sendfile_use_send</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file, offset</span><span class="r15">=0</span><span class="r11">, count</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                  </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_check_sendfile_params(file, offset, count)</span><span class="r9">                                       </span>  
 <span class="r6">   418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">gettimeout() </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">   419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;non-blocking sockets are not supported&quot;</span><span class="r11">)</span><span class="r9">                         </span>  
 <span class="r6">   420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> offset:</span><span class="r9">                                                                             </span>  
 <span class="r6">   421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            file</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                                                  </span>  
 <span class="r6">   422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        blocksize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(count, </span><span class="r15">8192</span><span class="r11">) </span><span class="r10">if</span><span class="r11"> count </span><span class="r10">else</span><span class="r11"> </span><span class="r15">8192</span><span class="r9">                                        </span>  
 <span class="r6">   423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        total_sent </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                         </span>  
 <span class="r6">   424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># localize variable access to minimize overhead</span><span class="r9">                                        </span>  
 <span class="r6">   425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        file_read </span><span class="r15">=</span><span class="r11"> file</span><span class="r15">.</span><span class="r11">read</span><span class="r9">                                                                  </span>  
 <span class="r6">   426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock_send </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">send</span><span class="r9">                                                                  </span>  
 <span class="r6">   427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> count:</span><span class="r9">                                                                      </span>  
 <span class="r6">   430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    blocksize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(count </span><span class="r15">-</span><span class="r11"> total_sent, blocksize)</span><span class="r9">                             </span>  
 <span class="r6">   431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> blocksize </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                         </span>  
 <span class="r6">   432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">break</span><span class="r9">                                                                  </span>  
 <span class="r6">   433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">memoryview</span><span class="r11">(file_read(blocksize))</span><span class="r9">                                        </span>  
 <span class="r6">   434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> data:</span><span class="r9">                                                                   </span>  
 <span class="r6">   435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">break</span><span class="r11">  </span><span class="r14"># EOF</span><span class="r9">                                                               </span>  
 <span class="r6">   436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        sent </span><span class="r15">=</span><span class="r11"> sock_send(data)</span><span class="r9">                                                 </span>  
 <span class="r6">   439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">BlockingIOError</span><span class="r11">:</span><span class="r9">                                                    </span>  
 <span class="r6">   440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">continue</span><span class="r9">                                                               </span>  
 <span class="r6">   441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        total_sent </span><span class="r15">+=</span><span class="r11"> sent</span><span class="r9">                                                     </span>  
 <span class="r6">   443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> sent </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(data):</span><span class="r9">                                                   </span>  
 <span class="r6">   444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            data </span><span class="r15">=</span><span class="r11"> data[sent:]</span><span class="r9">                                                 </span>  
 <span class="r6">   445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">break</span><span class="r9">                                                              </span>  
 <span class="r6">   447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> total_sent</span><span class="r9">                                                                  </span>  
 <span class="r6">   448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> total_sent </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(file, </span><span class="r16">&#x27;seek&#x27;</span><span class="r11">):</span><span class="r9">                                       </span>  
 <span class="r6">   450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                file</span><span class="r15">.</span><span class="r11">seek(offset </span><span class="r15">+</span><span class="r11"> total_sent)</span><span class="r9">                                                 </span>  
 <span class="r6">   451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_check_sendfile_params</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file, offset, count):</span><span class="r9">                                     </span>  
 <span class="r6">   453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&#x27;b&#x27;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(file, </span><span class="r16">&#x27;mode&#x27;</span><span class="r11">, </span><span class="r16">&#x27;b&#x27;</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">   454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;file should be opened in binary mode&quot;</span><span class="r11">)</span><span class="r9">                           </span>  
 <span class="r6">   455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">type </span><span class="r15">&amp;</span><span class="r11"> SOCK_STREAM:</span><span class="r9">                                                        </span>  
 <span class="r6">   456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;only SOCK_STREAM type sockets are supported&quot;</span><span class="r11">)</span><span class="r9">                    </span>  
 <span class="r6">   457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> count </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(count, </span><span class="r20">int</span><span class="r11">):</span><span class="r9">                                                     </span>  
 <span class="r6">   459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(</span><span class="r9">                                                               </span>  
 <span class="r6">   460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r16">&quot;count must be a positive integer (got </span><span class="r21">{!r}</span><span class="r16">)&quot;</span><span class="r15">.</span><span class="r11">format(count))</span><span class="r9">               </span>  
 <span class="r6">   461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> count </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r9">                                                              </span>  
 <span class="r6">   463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r16">&quot;count must be a positive integer (got </span><span class="r21">{!r}</span><span class="r16">)&quot;</span><span class="r15">.</span><span class="r11">format(count))</span><span class="r9">               </span>  
 <span class="r6">   464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">sendfile</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file, offset</span><span class="r15">=0</span><span class="r11">, count</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                            </span>  
 <span class="r6">   466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;sendfile(file[, offset[, count]]) -&gt; sent</span><span class="r9">                                           </span>  
 <span class="r6">   467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Send a file until EOF is reached by using high-performance</span><span class="r9">                             </span>  
 <span class="r6">   469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        os.sendfile() and return the total number of bytes which</span><span class="r9">                               </span>  
 <span class="r6">   470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        were sent.</span><span class="r9">                                                                             </span>  
 <span class="r6">   471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *file* must be a regular file object opened in binary mode.</span><span class="r9">                            </span>  
 <span class="r6">   472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If os.sendfile() is not available (e.g. Windows) or file is</span><span class="r9">                            </span>  
 <span class="r6">   473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        not a regular file socket.send() will be used instead.</span><span class="r9">                                 </span>  
 <span class="r6">   474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        *offset* tells from where to start reading the file.</span><span class="r9">                                   </span>  
 <span class="r6">   475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If specified, *count* is the total number of bytes to transmit</span><span class="r9">                         </span>  
 <span class="r6">   476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        as opposed to sending the file until EOF is reached.</span><span class="r9">                                   </span>  
 <span class="r6">   477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        File position is updated on return or also in case of error in</span><span class="r9">                         </span>  
 <span class="r6">   478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        which case file.tell() can be used to figure out the number of</span><span class="r9">                         </span>  
 <span class="r6">   479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        bytes which were sent.</span><span class="r9">                                                                 </span>  
 <span class="r6">   480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The socket must be of SOCK_STREAM type.</span><span class="r9">                                                </span>  
 <span class="r6">   481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Non-blocking sockets are not supported.</span><span class="r9">                                                </span>  
 <span class="r6">   482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sendfile_use_sendfile(file, offset, count)</span><span class="r9">                            </span>  
 <span class="r6">   485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> _GiveupOnSendfile:</span><span class="r9">                                                              </span>  
 <span class="r6">   486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sendfile_use_send(file, offset, count)</span><span class="r9">                                </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_decref_socketios</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                               </span>  
 <span class="r6">   489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_io_refs </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_io_refs </span><span class="r15">-=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                 </span>  
 <span class="r6">   491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_closed:</span><span class="r9">                                                                       </span>  
 <span class="r6">   492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                       </span>  
 <span class="r6">   493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_real_close</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, _ss</span><span class="r15">=</span><span class="r11">_socket</span><span class="r15">.</span><span class="r11">socket):</span><span class="r9">                                                 </span>  
 <span class="r6">   495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># This function should not reference any globals. See issue #808164.</span><span class="r9">                   </span>  
 <span class="r6">   496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _ss</span><span class="r15">.</span><span class="r11">close(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                        </span>  
 <span class="r6">   497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">close</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># This function should not reference any globals. See issue #808164.</span><span class="r9">                   </span>  
 <span class="r6">   500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_closed </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                    </span>  
 <span class="r6">   501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_io_refs </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_real_close()</span><span class="r9">                                                                 </span>  
 <span class="r6">   503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">detach</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;detach() -&gt; file descriptor</span><span class="r9">                                                         </span>  
 <span class="r6">   506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Close the socket object without closing the underlying file descriptor.</span><span class="r9">                </span>  
 <span class="r6">   508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The object cannot be used after this call, but the file descriptor</span><span class="r9">                     </span>  
 <span class="r6">   509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        can be reused for other purposes.  The file descriptor is returned.</span><span class="r9">                    </span>  
 <span class="r6">   510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_closed </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                    </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r11">detach()</span><span class="r9">                                                                </span>  
 <span class="r6">   513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">family</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Read-only access to the address family for this socket.</span><span class="r9">                             </span>  
 <span class="r6">   517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _intenum_converter(</span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r11">family, AddressFamily)</span><span class="r9">                               </span>  
 <span class="r6">   519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">type</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Read-only access to the socket type.</span><span class="r9">                                                </span>  
 <span class="r6">   523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _intenum_converter(</span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r11">type, SocketKind)</span><span class="r9">                                    </span>  
 <span class="r6">   525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&#x27;nt&#x27;</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_inheritable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">get_handle_inheritable(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno())</span><span class="r9">                                    </span>  
 <span class="r6">   529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">set_inheritable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, inheritable):</span><span class="r9">                                                </span>  
 <span class="r6">   530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            os</span><span class="r15">.</span><span class="r11">set_handle_inheritable(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno(), inheritable)</span><span class="r9">                              </span>  
 <span class="r6">   531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_inheritable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">get_inheritable(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno())</span><span class="r9">                                           </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">set_inheritable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, inheritable):</span><span class="r9">                                                </span>  
 <span class="r6">   535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            os</span><span class="r15">.</span><span class="r11">set_inheritable(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno(), inheritable)</span><span class="r9">                                     </span>  
 <span class="r6">   536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    get_inheritable</span><span class="r15">.</span><span class="r22">__doc__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Get the inheritable flag of the socket&quot;</span><span class="r9">                         </span>  
 <span class="r6">   537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    set_inheritable</span><span class="r15">.</span><span class="r22">__doc__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Set the inheritable flag of the socket&quot;</span><span class="r9">                         </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">fromfd</span><span class="r11">(fd, family, </span><span class="r20">type</span><span class="r11">, proto</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot; fromfd(fd, family, type[, proto]) -&gt; socket object</span><span class="r9">                                     </span>  
 <span class="r6">   541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Create a socket object from a duplicate of the given file</span><span class="r9">                                  </span>  
 <span class="r6">   543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    descriptor.  The remaining arguments are the same as for socket().</span><span class="r9">                         </span>  
 <span class="r6">   544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    nfd </span><span class="r15">=</span><span class="r11"> dup(fd)</span><span class="r9">                                                                              </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> socket(family, </span><span class="r20">type</span><span class="r11">, proto, nfd)</span><span class="r9">                                                    </span>  
 <span class="r6">   547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket</span><span class="r15">.</span><span class="r11">socket, </span><span class="r16">&quot;sendmsg&quot;</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">array</span><span class="r9">                                                                               </span>  
 <span class="r6">   550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">send_fds</span><span class="r11">(sock, buffers, fds, flags</span><span class="r15">=0</span><span class="r11">, address</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                   </span>  
 <span class="r6">   552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot; send_fds(sock, buffers, fds[, flags[, address]]) -&gt; integer</span><span class="r9">                        </span>  
 <span class="r6">   553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Send the list of file descriptors fds over an AF_UNIX socket.</span><span class="r9">                          </span>  
 <span class="r6">   555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> sock</span><span class="r15">.</span><span class="r11">sendmsg(buffers, [(_socket</span><span class="r15">.</span><span class="r11">SOL_SOCKET,</span><span class="r9">                                     </span>  
 <span class="r6">   557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _socket</span><span class="r15">.</span><span class="r11">SCM_RIGHTS, array</span><span class="r15">.</span><span class="r11">array(</span><span class="r16">&quot;i&quot;</span><span class="r11">, fds))])</span><span class="r9">                                       </span>  
 <span class="r6">   558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&quot;send_fds&quot;</span><span class="r11">)</span><span class="r9">                                                                 </span>  
 <span class="r6">   559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket</span><span class="r15">.</span><span class="r11">socket, </span><span class="r16">&quot;recvmsg&quot;</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">array</span><span class="r9">                                                                               </span>  
 <span class="r6">   562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">recv_fds</span><span class="r11">(sock, bufsize, maxfds, flags</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">   564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot; recv_fds(sock, bufsize, maxfds[, flags]) -&gt; (data, list of file</span><span class="r9">                    </span>  
 <span class="r6">   565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        descriptors, msg_flags, address)</span><span class="r9">                                                       </span>  
 <span class="r6">   566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Receive up to maxfds file descriptors returning the message</span><span class="r9">                            </span>  
 <span class="r6">   568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        data and a list containing the descriptors.</span><span class="r9">                                            </span>  
 <span class="r6">   569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Array of ints</span><span class="r9">                                                                        </span>  
 <span class="r6">   571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fds </span><span class="r15">=</span><span class="r11"> array</span><span class="r15">.</span><span class="r11">array(</span><span class="r16">&quot;i&quot;</span><span class="r11">)</span><span class="r9">                                                                 </span>  
 <span class="r6">   572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg, ancdata, flags, addr </span><span class="r15">=</span><span class="r11"> sock</span><span class="r15">.</span><span class="r11">recvmsg(bufsize,</span><span class="r9">                                      </span>  
 <span class="r6">   573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _socket</span><span class="r15">.</span><span class="r11">CMSG_LEN(maxfds </span><span class="r15">*</span><span class="r11"> fds</span><span class="r15">.</span><span class="r11">itemsize))</span><span class="r9">                                           </span>  
 <span class="r6">   574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> cmsg_level, cmsg_type, cmsg_data </span><span class="r19">in</span><span class="r11"> ancdata:</span><span class="r9">                                       </span>  
 <span class="r6">   575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> (cmsg_level </span><span class="r15">==</span><span class="r11"> _socket</span><span class="r15">.</span><span class="r11">SOL_SOCKET </span><span class="r19">and</span><span class="r11"> cmsg_type </span><span class="r15">==</span><span class="r11"> _socket</span><span class="r15">.</span><span class="r11">SCM_RIGHTS):</span><span class="r9">         </span>  
 <span class="r6">   576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fds</span><span class="r15">.</span><span class="r11">frombytes(cmsg_data[:</span><span class="r9">                                                      </span>  
 <span class="r6">   577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">len</span><span class="r11">(cmsg_data) </span><span class="r15">-</span><span class="r11"> (</span><span class="r20">len</span><span class="r11">(cmsg_data) </span><span class="r15">%</span><span class="r11"> fds</span><span class="r15">.</span><span class="r11">itemsize)])</span><span class="r9">                     </span>  
 <span class="r6">   578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> msg, </span><span class="r20">list</span><span class="r11">(fds), flags, addr</span><span class="r9">                                                     </span>  
 <span class="r6">   580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&quot;recv_fds&quot;</span><span class="r11">)</span><span class="r9">                                                                 </span>  
 <span class="r6">   581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket</span><span class="r15">.</span><span class="r11">socket, </span><span class="r16">&quot;share&quot;</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">   583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">fromshare</span><span class="r11">(info):</span><span class="r9">                                                                       </span>  
 <span class="r6">   584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot; fromshare(info) -&gt; socket object</span><span class="r9">                                                   </span>  
 <span class="r6">   585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Create a socket object from the bytes object returned by</span><span class="r9">                               </span>  
 <span class="r6">   587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        socket.share(pid).</span><span class="r9">                                                                     </span>  
 <span class="r6">   588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> socket(</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">, info)</span><span class="r9">                                                           </span>  
 <span class="r6">   590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&quot;fromshare&quot;</span><span class="r11">)</span><span class="r9">                                                                </span>  
 <span class="r6">   591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&quot;socketpair&quot;</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">socketpair</span><span class="r11">(family</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r20">type</span><span class="r15">=</span><span class="r11">SOCK_STREAM, proto</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;socketpair([family[, type[, proto]]]) -&gt; (socket object, socket object)</span><span class="r9">             </span>  
 <span class="r6">   596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Create a pair of socket objects from the sockets returned by the platform</span><span class="r9">              </span>  
 <span class="r6">   598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        socketpair() function.</span><span class="r9">                                                                 </span>  
 <span class="r6">   599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The arguments are the same as for socket() except the default family is</span><span class="r9">                </span>  
 <span class="r6">   600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        AF_UNIX if defined on the platform; otherwise, the default is AF_INET.</span><span class="r9">                 </span>  
 <span class="r6">   601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> family </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                family </span><span class="r15">=</span><span class="r11"> AF_UNIX</span><span class="r9">                                                               </span>  
 <span class="r6">   605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">NameError</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                family </span><span class="r15">=</span><span class="r11"> AF_INET</span><span class="r9">                                                               </span>  
 <span class="r6">   607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        a, b </span><span class="r15">=</span><span class="r11"> _socket</span><span class="r15">.</span><span class="r11">socketpair(family, </span><span class="r20">type</span><span class="r11">, proto)</span><span class="r9">                                         </span>  
 <span class="r6">   608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        a </span><span class="r15">=</span><span class="r11"> socket(family, </span><span class="r20">type</span><span class="r11">, proto, a</span><span class="r15">.</span><span class="r11">detach())</span><span class="r9">                                            </span>  
 <span class="r6">   609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        b </span><span class="r15">=</span><span class="r11"> socket(family, </span><span class="r20">type</span><span class="r11">, proto, b</span><span class="r15">.</span><span class="r11">detach())</span><span class="r9">                                            </span>  
 <span class="r6">   610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> a, b</span><span class="r9">                                                                            </span>  
 <span class="r6">   611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                          </span>  
 <span class="r6">   613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Origin: https://gist.github.com/4325783, by Geert Jansen.  Public domain.</span><span class="r9">                </span>  
 <span class="r6">   615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">socketpair</span><span class="r11">(family</span><span class="r15">=</span><span class="r11">AF_INET, </span><span class="r20">type</span><span class="r15">=</span><span class="r11">SOCK_STREAM, proto</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                 </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> family </span><span class="r15">==</span><span class="r11"> AF_INET:</span><span class="r9">                                                                  </span>  
 <span class="r6">   617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            host </span><span class="r15">=</span><span class="r11"> _LOCALHOST</span><span class="r9">                                                                  </span>  
 <span class="r6">   618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> family </span><span class="r15">==</span><span class="r11"> AF_INET6:</span><span class="r9">                                                               </span>  
 <span class="r6">   619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            host </span><span class="r15">=</span><span class="r11"> _LOCALHOST_V6</span><span class="r9">                                                               </span>  
 <span class="r6">   620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Only AF_INET and AF_INET6 socket address families &quot;</span><span class="r9">              </span>  
 <span class="r6">   622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                             </span><span class="r16">&quot;are supported&quot;</span><span class="r11">)</span><span class="r9">                                                  </span>  
 <span class="r6">   623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">type</span><span class="r11"> </span><span class="r15">!=</span><span class="r11"> SOCK_STREAM:</span><span class="r9">                                                                </span>  
 <span class="r6">   624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Only SOCK_STREAM socket type is supported&quot;</span><span class="r11">)</span><span class="r9">                      </span>  
 <span class="r6">   625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> proto </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">   626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Only protocol zero is supported&quot;</span><span class="r11">)</span><span class="r9">                                </span>  
 <span class="r6">   627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># We create a connected TCP socket. Note the trick with</span><span class="r9">                                </span>  
 <span class="r6">   629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># setblocking(False) that prevents us from having to create a thread.</span><span class="r9">                  </span>  
 <span class="r6">   630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        lsock </span><span class="r15">=</span><span class="r11"> socket(family, </span><span class="r20">type</span><span class="r11">, proto)</span><span class="r9">                                                    </span>  
 <span class="r6">   631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lsock</span><span class="r15">.</span><span class="r11">bind((host, </span><span class="r15">0</span><span class="r11">))</span><span class="r9">                                                              </span>  
 <span class="r6">   633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lsock</span><span class="r15">.</span><span class="r11">listen()</span><span class="r9">                                                                     </span>  
 <span class="r6">   634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># On IPv6, ignore flow_info and scope_id</span><span class="r9">                                           </span>  
 <span class="r6">   635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            addr, port </span><span class="r15">=</span><span class="r11"> lsock</span><span class="r15">.</span><span class="r11">getsockname()[:</span><span class="r15">2</span><span class="r11">]</span><span class="r9">                                               </span>  
 <span class="r6">   636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            csock </span><span class="r15">=</span><span class="r11"> socket(family, </span><span class="r20">type</span><span class="r11">, proto)</span><span class="r9">                                                </span>  
 <span class="r6">   637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                csock</span><span class="r15">.</span><span class="r11">setblocking(</span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                                       </span>  
 <span class="r6">   639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    csock</span><span class="r15">.</span><span class="r11">connect((addr, port))</span><span class="r9">                                                </span>  
 <span class="r6">   641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">BlockingIOError</span><span class="r11">, </span><span class="r13">InterruptedError</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">   643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                csock</span><span class="r15">.</span><span class="r11">setblocking(</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                                                        </span>  
 <span class="r6">   644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ssock, _ </span><span class="r15">=</span><span class="r11"> lsock</span><span class="r15">.</span><span class="r11">accept()</span><span class="r9">                                                      </span>  
 <span class="r6">   645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                csock</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                  </span>  
 <span class="r6">   647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r9">                                                                          </span>  
 <span class="r6">   648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lsock</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                      </span>  
 <span class="r6">   650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> (ssock, csock)</span><span class="r9">                                                                  </span>  
 <span class="r6">   651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __all__</span><span class="r15">.</span><span class="r11">append(</span><span class="r16">&quot;socketpair&quot;</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">   652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">socketpair</span><span class="r15">.</span><span class="r22">__doc__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;&quot;socketpair([family[, type[, proto]]]) -&gt; (socket object, socket object)</span>  
 <span class="r6">   654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r16">Create a pair of socket objects from the sockets returned by the platform</span><span class="r9">                      </span>  
 <span class="r6">   655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r16">socketpair() function.</span><span class="r9">                                                                         </span>  
 <span class="r6">   656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r16">The arguments are the same as for socket() except the default family is AF_UNIX</span><span class="r9">                </span>  
 <span class="r6">   657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r16">if defined on the platform; otherwise, the default is AF_INET.</span><span class="r9">                                 </span>  
 <span class="r6">   658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r16">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">   659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_blocking_errnos </span><span class="r15">=</span><span class="r11"> { EAGAIN, EWOULDBLOCK }</span><span class="r9">                                                     </span>  
 <span class="r6">   661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">SocketIO</span><span class="r11">(io</span><span class="r15">.</span><span class="r11">RawIOBase):</span><span class="r9">                                                                  </span>  
 <span class="r6">   663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Raw I/O implementation for stream sockets.</span><span class="r9">                                              </span>  
 <span class="r6">   665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This class supports the makefile() method on sockets.  It provides</span><span class="r9">                         </span>  
 <span class="r6">   667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the raw I/O interface on top of a socket object.</span><span class="r9">                                           </span>  
 <span class="r6">   668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># One might wonder why not let FileIO do the job instead.  There are two</span><span class="r9">                   </span>  
 <span class="r6">   671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># main reasons why FileIO is not adapted:</span><span class="r9">                                                  </span>  
 <span class="r6">   672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># - it wouldn&#x27;t work under Windows (where you can&#x27;t used read() and</span><span class="r9">                        </span>  
 <span class="r6">   673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#   write() on a socket handle)</span><span class="r9">                                                            </span>  
 <span class="r6">   674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># - it wouldn&#x27;t work with socket timeouts (FileIO would ignore the</span><span class="r9">                         </span>  
 <span class="r6">   675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#   timeout and consider the socket non-blocking)</span><span class="r9">                                          </span>  
 <span class="r6">   676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># XXX More docs</span><span class="r9">                                                                            </span>  
 <span class="r6">   678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, sock, mode):</span><span class="r9">                                                            </span>  
 <span class="r6">   680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;r&quot;</span><span class="r11">, </span><span class="r16">&quot;w&quot;</span><span class="r11">, </span><span class="r16">&quot;rw&quot;</span><span class="r11">, </span><span class="r16">&quot;rb&quot;</span><span class="r11">, </span><span class="r16">&quot;wb&quot;</span><span class="r11">, </span><span class="r16">&quot;rwb&quot;</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;invalid mode: </span><span class="r21">%r</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> mode)</span><span class="r9">                                        </span>  
 <span class="r6">   682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        io</span><span class="r15">.</span><span class="r11">RawIOBase</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">   683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock </span><span class="r15">=</span><span class="r11"> sock</span><span class="r9">                                                                      </span>  
 <span class="r6">   684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;b&quot;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode:</span><span class="r9">                                                                    </span>  
 <span class="r6">   685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mode </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot;b&quot;</span><span class="r9">                                                                        </span>  
 <span class="r6">   686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_mode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                      </span>  
 <span class="r6">   687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_reading </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;r&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode</span><span class="r9">                                                            </span>  
 <span class="r6">   688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_writing </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;w&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode</span><span class="r9">                                                            </span>  
 <span class="r6">   689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_timeout_occurred </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                         </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">readinto</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, b):</span><span class="r9">                                                                     </span>  
 <span class="r6">   692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Read up to len(b) bytes into the writable buffer *b* and return</span><span class="r9">                     </span>  
 <span class="r6">   693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the number of bytes read.  If the socket is non-blocking and no bytes</span><span class="r9">                  </span>  
 <span class="r6">   694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        are available, None is returned.</span><span class="r9">                                                       </span>  
 <span class="r6">   695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If *b* is non-empty, a 0 return value indicates that the connection</span><span class="r9">                    </span>  
 <span class="r6">   697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        was shutdown at the other end.</span><span class="r9">                                                         </span>  
 <span class="r6">   698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_checkClosed()</span><span class="r9">                                                                    </span>  
 <span class="r6">   700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_checkReadable()</span><span class="r9">                                                                  </span>  
 <span class="r6">   701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_timeout_occurred:</span><span class="r9">                                                             </span>  
 <span class="r6">   702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(</span><span class="r16">&quot;cannot read from timed out object&quot;</span><span class="r11">)</span><span class="r9">                                 </span>  
 <span class="r6">   703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock</span><span class="r15">.</span><span class="r11">recv_into(b)</span><span class="r9">                                                 </span>  
 <span class="r6">   706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> timeout:</span><span class="r9">                                                                    </span>  
 <span class="r6">   707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_timeout_occurred </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                  </span>  
 <span class="r6">   708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r9">                                                                          </span>  
 <span class="r6">   709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> error </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                 </span>  
 <span class="r6">   710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> e</span><span class="r15">.</span><span class="r11">errno </span><span class="r19">in</span><span class="r11"> _blocking_errnos:</span><span class="r9">                                                </span>  
 <span class="r6">   711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                </span>  
 <span class="r6">   712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r9">                                                                          </span>  
 <span class="r6">   713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">write</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, b):</span><span class="r9">                                                                        </span>  
 <span class="r6">   715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Write the given bytes or bytearray object *b* to the socket</span><span class="r9">                         </span>  
 <span class="r6">   716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and return the number of bytes written.  This can be less than</span><span class="r9">                         </span>  
 <span class="r6">   717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        len(b) if not all data could be written.  If the socket is</span><span class="r9">                             </span>  
 <span class="r6">   718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        non-blocking and no bytes could be written None is returned.</span><span class="r9">                           </span>  
 <span class="r6">   719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_checkClosed()</span><span class="r9">                                                                    </span>  
 <span class="r6">   721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_checkWritable()</span><span class="r9">                                                                  </span>  
 <span class="r6">   722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock</span><span class="r15">.</span><span class="r11">send(b)</span><span class="r9">                                                          </span>  
 <span class="r6">   724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> error </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                     </span>  
 <span class="r6">   725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># XXX what about EINTR?</span><span class="r9">                                                            </span>  
 <span class="r6">   726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> e</span><span class="r15">.</span><span class="r11">errno </span><span class="r19">in</span><span class="r11"> _blocking_errnos:</span><span class="r9">                                                    </span>  
 <span class="r6">   727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                    </span>  
 <span class="r6">   728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">readable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;True if the SocketIO is open for reading.</span><span class="r9">                                           </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">closed:</span><span class="r9">                                                                        </span>  
 <span class="r6">   734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;I/O operation on closed socket.&quot;</span><span class="r11">)</span><span class="r9">                                </span>  
 <span class="r6">   735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_reading</span><span class="r9">                                                                   </span>  
 <span class="r6">   736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">writable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;True if the SocketIO is open for writing.</span><span class="r9">                                           </span>  
 <span class="r6">   739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">closed:</span><span class="r9">                                                                        </span>  
 <span class="r6">   741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;I/O operation on closed socket.&quot;</span><span class="r11">)</span><span class="r9">                                </span>  
 <span class="r6">   742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_writing</span><span class="r9">                                                                   </span>  
 <span class="r6">   743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">seekable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;True if the SocketIO is open for seeking.</span><span class="r9">                                           </span>  
 <span class="r6">   746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">closed:</span><span class="r9">                                                                        </span>  
 <span class="r6">   748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;I/O operation on closed socket.&quot;</span><span class="r11">)</span><span class="r9">                                </span>  
 <span class="r6">   749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r11">seekable()</span><span class="r9">                                                              </span>  
 <span class="r6">   750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">fileno</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Return the file descriptor of the underlying socket.</span><span class="r9">                                </span>  
 <span class="r6">   753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_checkClosed()</span><span class="r9">                                                                    </span>  
 <span class="r6">   755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock</span><span class="r15">.</span><span class="r11">fileno()</span><span class="r9">                                                             </span>  
 <span class="r6">   756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">name</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">closed:</span><span class="r9">                                                                    </span>  
 <span class="r6">   760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fileno()</span><span class="r9">                                                               </span>  
 <span class="r6">   761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                                          </span>  
 <span class="r6">   763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">mode</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_mode</span><span class="r9">                                                                      </span>  
 <span class="r6">   767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">close</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Close the SocketIO object.  This doesn&#x27;t close the underlying</span><span class="r9">                       </span>  
 <span class="r6">   770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        socket, except if all references to it have disappeared.</span><span class="r9">                               </span>  
 <span class="r6">   771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">closed:</span><span class="r9">                                                                        </span>  
 <span class="r6">   773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">   774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        io</span><span class="r15">.</span><span class="r11">RawIOBase</span><span class="r15">.</span><span class="r11">close(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">   775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock</span><span class="r15">.</span><span class="r11">_decref_socketios()</span><span class="r9">                                                         </span>  
 <span class="r6">   776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_sock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                      </span>  
 <span class="r6">   777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getfqdn</span><span class="r11">(name</span><span class="r15">=</span><span class="r16">&#x27;&#x27;</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Get fully qualified domain name from name.</span><span class="r9">                                              </span>  
 <span class="r6">   781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    An empty argument is interpreted as meaning the local host.</span><span class="r9">                                </span>  
 <span class="r6">   783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    First the hostname returned by gethostbyaddr() is checked, then</span><span class="r9">                            </span>  
 <span class="r6">   785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    possibly existing aliases. In case no FQDN is available and `name`</span><span class="r9">                         </span>  
 <span class="r6">   786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    was given, it is returned unchanged. If `name` was empty, &#x27;0.0.0.0&#x27; or &#x27;::&#x27;,</span><span class="r9">               </span>  
 <span class="r6">   787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    hostname from gethostname() is returned.</span><span class="r9">                                                   </span>  
 <span class="r6">   788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    name </span><span class="r15">=</span><span class="r11"> name</span><span class="r15">.</span><span class="r11">strip()</span><span class="r9">                                                                        </span>  
 <span class="r6">   790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> name </span><span class="r19">or</span><span class="r11"> name </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&#x27;0.0.0.0&#x27;</span><span class="r11">, </span><span class="r16">&#x27;::&#x27;</span><span class="r11">):</span><span class="r9">                                                  </span>  
 <span class="r6">   791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        name </span><span class="r15">=</span><span class="r11"> gethostname()</span><span class="r9">                                                                   </span>  
 <span class="r6">   792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        hostname, aliases, ipaddrs </span><span class="r15">=</span><span class="r11"> gethostbyaddr(name)</span><span class="r9">                                       </span>  
 <span class="r6">   794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                              </span>  
 <span class="r6">   795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        aliases</span><span class="r15">.</span><span class="r11">insert(</span><span class="r15">0</span><span class="r11">, hostname)</span><span class="r9">                                                            </span>  
 <span class="r6">   798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> name </span><span class="r19">in</span><span class="r11"> aliases:</span><span class="r9">                                                                   </span>  
 <span class="r6">   799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&#x27;.&#x27;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> name:</span><span class="r9">                                                                    </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">break</span><span class="r9">                                                                          </span>  
 <span class="r6">   801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name </span><span class="r15">=</span><span class="r11"> hostname</span><span class="r9">                                                                    </span>  
 <span class="r6">   803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> name</span><span class="r9">                                                                                </span>  
 <span class="r6">   804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_GLOBAL_DEFAULT_TIMEOUT </span><span class="r15">=</span><span class="r11"> </span><span class="r20">object</span><span class="r11">()</span><span class="r9">                                                             </span>  
 <span class="r6">   807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">create_connection</span><span class="r11">(address, timeout</span><span class="r15">=</span><span class="r11">_GLOBAL_DEFAULT_TIMEOUT,</span><span class="r9">                                </span>  
 <span class="r6">   809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                      source_address</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">   810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Connect to *address* and return the socket object.</span><span class="r9">                                      </span>  
 <span class="r6">   811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Convenience function.  Connect to *address* (a 2-tuple ``(host,</span><span class="r9">                            </span>  
 <span class="r6">   813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    port)``) and return the socket object.  Passing the optional</span><span class="r9">                               </span>  
 <span class="r6">   814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    *timeout* parameter will set the timeout on the socket instance</span><span class="r9">                            </span>  
 <span class="r6">   815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    before attempting to connect.  If no *timeout* is supplied, the</span><span class="r9">                            </span>  
 <span class="r6">   816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    global default timeout setting returned by :func:`getdefaulttimeout`</span><span class="r9">                       </span>  
 <span class="r6">   817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    is used.  If *source_address* is set it must be a tuple of (host, port)</span><span class="r9">                    </span>  
 <span class="r6">   818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    for the socket to bind as a source address before making the connection.</span><span class="r9">                   </span>  
 <span class="r6">   819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A host of &#x27;&#x27; or port 0 tells the OS to use the default.</span><span class="r9">                                    </span>  
 <span class="r6">   820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    host, port </span><span class="r15">=</span><span class="r11"> address</span><span class="r9">                                                                       </span>  
 <span class="r6">   823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    err </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                                 </span>  
 <span class="r6">   824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> res </span><span class="r19">in</span><span class="r11"> getaddrinfo(host, port, </span><span class="r15">0</span><span class="r11">, SOCK_STREAM):</span><span class="r9">                                        </span>  
 <span class="r6">   825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        af, socktype, proto, canonname, sa </span><span class="r15">=</span><span class="r11"> res</span><span class="r9">                                               </span>  
 <span class="r6">   826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                            </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock </span><span class="r15">=</span><span class="r11"> socket(af, socktype, proto)</span><span class="r9">                                                 </span>  
 <span class="r6">   829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> timeout </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> _GLOBAL_DEFAULT_TIMEOUT:</span><span class="r9">                                         </span>  
 <span class="r6">   830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">settimeout(timeout)</span><span class="r9">                                                       </span>  
 <span class="r6">   831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> source_address:</span><span class="r9">                                                                 </span>  
 <span class="r6">   832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">bind(source_address)</span><span class="r9">                                                      </span>  
 <span class="r6">   833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">connect(sa)</span><span class="r9">                                                                   </span>  
 <span class="r6">   834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Break explicitly a reference cycle</span><span class="r9">                                               </span>  
 <span class="r6">   835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            err </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> sock</span><span class="r9">                                                                        </span>  
 <span class="r6">   837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> error </span><span class="r10">as</span><span class="r11"> _:</span><span class="r9">                                                                     </span>  
 <span class="r6">   839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            err </span><span class="r15">=</span><span class="r11"> _</span><span class="r9">                                                                            </span>  
 <span class="r6">   840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> sock </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                   </span>  
 <span class="r6">   842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> err </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> err</span><span class="r9">                                                                          </span>  
 <span class="r6">   846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Break explicitly a reference cycle</span><span class="r9">                                               </span>  
 <span class="r6">   848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            err </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> error(</span><span class="r16">&quot;getaddrinfo returns an empty list&quot;</span><span class="r11">)</span><span class="r9">                                       </span>  
 <span class="r6">   851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">has_dualstack_ipv6</span><span class="r11">():</span><span class="r9">                                                                      </span>  
 <span class="r6">   854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Return True if the platform supports creating a SOCK_STREAM socket</span><span class="r9">                      </span>  
 <span class="r6">   855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    which can handle both AF_INET and AF_INET6 (IPv4 / IPv6) connections.</span><span class="r9">                      </span>  
 <span class="r6">   856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> has_ipv6 \</span><span class="r9">                                                                          </span>  
 <span class="r6">   858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&#x27;IPPROTO_IPV6&#x27;</span><span class="r11">) \</span><span class="r9">                                          </span>  
 <span class="r6">   859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&#x27;IPV6_V6ONLY&#x27;</span><span class="r11">):</span><span class="r9">                                            </span>  
 <span class="r6">   860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                           </span>  
 <span class="r6">   861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">with</span><span class="r11"> socket(AF_INET6, SOCK_STREAM) </span><span class="r10">as</span><span class="r11"> sock:</span><span class="r9">                                            </span>  
 <span class="r6">   863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">setsockopt(IPPROTO_IPV6, IPV6_V6ONLY, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                      </span>  
 <span class="r6">   864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                        </span>  
 <span class="r6">   865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                              </span>  
 <span class="r6">   866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                           </span>  
 <span class="r6">   867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">create_server</span><span class="r11">(address, </span><span class="r15">*</span><span class="r11">, family</span><span class="r15">=</span><span class="r11">AF_INET, backlog</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, reuse_port</span><span class="r15">=</span><span class="r10">False</span><span class="r11">,</span><span class="r9">                  </span>  
 <span class="r6">   870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                  dualstack_ipv6</span><span class="r15">=</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">   871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Convenience function which creates a SOCK_STREAM type socket</span><span class="r9">                            </span>  
 <span class="r6">   872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    bound to *address* (a 2-tuple (host, port)) and return the socket</span><span class="r9">                          </span>  
 <span class="r6">   873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    object.</span><span class="r9">                                                                                    </span>  
 <span class="r6">   874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    *family* should be either AF_INET or AF_INET6.</span><span class="r9">                                             </span>  
 <span class="r6">   876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    *backlog* is the queue size passed to socket.listen().</span><span class="r9">                                     </span>  
 <span class="r6">   877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    *reuse_port* dictates whether to use the SO_REUSEPORT socket option.</span><span class="r9">                       </span>  
 <span class="r6">   878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    *dualstack_ipv6*: if true and the platform supports it, it will</span><span class="r9">                            </span>  
 <span class="r6">   879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    create an AF_INET6 socket able to accept both IPv4 or IPv6</span><span class="r9">                                 </span>  
 <span class="r6">   880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    connections. When false it will explicitly disable this option on</span><span class="r9">                          </span>  
 <span class="r6">   881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    platforms that enable it by default (e.g. Linux).</span><span class="r9">                                          </span>  
 <span class="r6">   882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &gt;&gt;&gt; with create_server((&#x27;&#x27;, 8000)) as server:</span><span class="r9">                                              </span>  
 <span class="r6">   884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    ...     while True:</span><span class="r9">                                                                        </span>  
 <span class="r6">   885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    ...         conn, addr = server.accept()</span><span class="r9">                                                   </span>  
 <span class="r6">   886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    ...         # handle new connection</span><span class="r9">                                                        </span>  
 <span class="r6">   887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> reuse_port </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&quot;SO_REUSEPORT&quot;</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">   889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;SO_REUSEPORT not supported on this platform&quot;</span><span class="r11">)</span><span class="r9">                        </span>  
 <span class="r6">   890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> dualstack_ipv6:</span><span class="r9">                                                                         </span>  
 <span class="r6">   891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> has_dualstack_ipv6():</span><span class="r9">                                                           </span>  
 <span class="r6">   892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;dualstack_ipv6 not supported on this platform&quot;</span><span class="r11">)</span><span class="r9">                  </span>  
 <span class="r6">   893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> family </span><span class="r15">!=</span><span class="r11"> AF_INET6:</span><span class="r9">                                                                 </span>  
 <span class="r6">   894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;dualstack_ipv6 requires AF_INET6 family&quot;</span><span class="r11">)</span><span class="r9">                        </span>  
 <span class="r6">   895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    sock </span><span class="r15">=</span><span class="r11"> socket(family, SOCK_STREAM)</span><span class="r9">                                                         </span>  
 <span class="r6">   896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Note about Windows. We don&#x27;t set SO_REUSEADDR because:</span><span class="r9">                               </span>  
 <span class="r6">   898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># 1) It&#x27;s unnecessary: bind() will succeed even in case of a</span><span class="r9">                           </span>  
 <span class="r6">   899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># previous closed socket on the same address and still in</span><span class="r9">                              </span>  
 <span class="r6">   900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># TIME_WAIT state.</span><span class="r9">                                                                     </span>  
 <span class="r6">   901 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># 2) If set, another socket is free to bind() on the same</span><span class="r9">                              </span>  
 <span class="r6">   902 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># address, effectively preventing this one from accepting</span><span class="r9">                              </span>  
 <span class="r6">   903 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># connections. Also, it may set the process in a state where</span><span class="r9">                           </span>  
 <span class="r6">   904 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># it&#x27;ll no longer respond to any signals or graceful kills.</span><span class="r9">                            </span>  
 <span class="r6">   905 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># See: https://learn.microsoft.com/windows/win32/winsock/using-so-reuseaddr-and-so-excl</span>  
 <span class="r6">   906 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">name </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&#x27;nt&#x27;</span><span class="r11">, </span><span class="r16">&#x27;cygwin&#x27;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> \</span><span class="r9">                                               </span>  
 <span class="r6">   907 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&#x27;SO_REUSEADDR&#x27;</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">   908 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   909 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">setsockopt(SOL_SOCKET, SO_REUSEADDR, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                   </span>  
 <span class="r6">   910 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                      </span>  
 <span class="r6">   911 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Fail later on bind(), for platforms which may not</span><span class="r9">                            </span>  
 <span class="r6">   912 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># support this option.</span><span class="r9">                                                         </span>  
 <span class="r6">   913 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   914 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reuse_port:</span><span class="r9">                                                                         </span>  
 <span class="r6">   915 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">setsockopt(SOL_SOCKET, SO_REUSEPORT, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                       </span>  
 <span class="r6">   916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> has_ipv6 </span><span class="r19">and</span><span class="r11"> family </span><span class="r15">==</span><span class="r11"> AF_INET6:</span><span class="r9">                                                    </span>  
 <span class="r6">   917 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> dualstack_ipv6:</span><span class="r9">                                                                 </span>  
 <span class="r6">   918 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">setsockopt(IPPROTO_IPV6, IPV6_V6ONLY, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                  </span>  
 <span class="r6">   919 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&quot;IPV6_V6ONLY&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> \</span><span class="r9">                                         </span>  
 <span class="r6">   920 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">hasattr</span><span class="r11">(_socket, </span><span class="r16">&quot;IPPROTO_IPV6&quot;</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">   921 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                sock</span><span class="r15">.</span><span class="r11">setsockopt(IPPROTO_IPV6, IPV6_V6ONLY, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                  </span>  
 <span class="r6">   922 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   923 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">bind(address)</span><span class="r9">                                                                 </span>  
 <span class="r6">   924 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> error </span><span class="r10">as</span><span class="r11"> err:</span><span class="r9">                                                                   </span>  
 <span class="r6">   925 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&#x27;</span><span class="r21">%s</span><span class="r16"> (while attempting to bind on address </span><span class="r21">%r</span><span class="r16">)&#x27;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> \</span><span class="r9">                            </span>  
 <span class="r6">   926 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (err</span><span class="r15">.</span><span class="r11">strerror, address)</span><span class="r9">                                                        </span>  
 <span class="r6">   927 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> error(err</span><span class="r15">.</span><span class="r11">errno, msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                              </span>  
 <span class="r6">   928 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> backlog </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   929 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">listen()</span><span class="r9">                                                                      </span>  
 <span class="r6">   930 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   931 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sock</span><span class="r15">.</span><span class="r11">listen(backlog)</span><span class="r9">                                                               </span>  
 <span class="r6">   932 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> sock</span><span class="r9">                                                                            </span>  
 <span class="r6">   933 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> error:</span><span class="r9">                                                                              </span>  
 <span class="r6">   934 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        sock</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                           </span>  
 <span class="r6">   935 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r9">                                                                                  </span>  
 <span class="r6">   936 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   937 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   938 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getaddrinfo</span><span class="r11">(host, port, family</span><span class="r15">=0</span><span class="r11">, </span><span class="r20">type</span><span class="r15">=0</span><span class="r11">, proto</span><span class="r15">=0</span><span class="r11">, flags</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                               </span>  
 <span class="r6">   939 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Resolve host and port into list of address info entries.</span><span class="r9">                                </span>  
 <span class="r6">   940 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   941 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Translate the host/port argument into a sequence of 5-tuples that contain</span><span class="r9">                  </span>  
 <span class="r6">   942 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    all the necessary arguments for creating a socket connected to that service.</span><span class="r9">               </span>  
 <span class="r6">   943 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    host is a domain name, a string representation of an IPv4/v6 address or</span><span class="r9">                    </span>  
 <span class="r6">   944 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    None. port is a string service name such as &#x27;http&#x27;, a numeric port number or</span><span class="r9">               </span>  
 <span class="r6">   945 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    None. By passing None as the value of host and port, you can pass NULL to</span><span class="r9">                  </span>  
 <span class="r6">   946 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the underlying C API.</span><span class="r9">                                                                      </span>  
 <span class="r6">   947 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   948 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    The family, type and proto arguments can be optionally specified in order to</span><span class="r9">               </span>  
 <span class="r6">   949 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    narrow the list of addresses returned. Passing zero as a value for each of</span><span class="r9">                 </span>  
 <span class="r6">   950 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    these arguments selects the full range of results.</span><span class="r9">                                         </span>  
 <span class="r6">   951 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   952 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># We override this function since we want to translate the numeric family</span><span class="r9">                  </span>  
 <span class="r6">   953 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># and socket type values to enum constants.</span><span class="r9">                                                </span>  
 <span class="r6">   954 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    addrlist </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                              </span>  
 <span class="r6">   955 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> res </span><span class="r19">in</span><span class="r11"> _socket</span><span class="r15">.</span><span class="r11">getaddrinfo(host, port, family, </span><span class="r20">type</span><span class="r11">, proto, flags):</span><span class="r9">                    </span>  
 <span class="r6">   956 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        af, socktype, proto, canonname, sa </span><span class="r15">=</span><span class="r11"> res</span><span class="r9">                                               </span>  
 <span class="r6">   957 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        addrlist</span><span class="r15">.</span><span class="r11">append((_intenum_converter(af, AddressFamily),</span><span class="r9">                                </span>  
 <span class="r6">   958 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                         _intenum_converter(socktype, SocketKind),</span><span class="r9">                             </span>  
 <span class="r6">   959 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                         proto, canonname, sa))</span><span class="r9">                                                </span>  
 <span class="r6">   960 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> addrlist</span><span class="r9">                                                                            </span>  
 <span class="r6">   961 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r24">function summary for /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/socket.py          </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">socket</span><span class="r15">.</span><span class="r17">__init__</span><span class="r9">                                                                                </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">    5% </span>│<span class="r7">  10%  </span>│<span class="r11">socket</span><span class="r15">.</span><span class="r11">accept</span><span class="r9">                                                                                  </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">socket</span><span class="r15">.</span><span class="r11">_real_close</span><span class="r9">                                                                             </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_ResourceSharer</span><span class="r15">.</span><span class="r11">fromfd</span><span class="r9">                                                                         </span>  
        ╵        ╵       ╵       ╵                                                                                                 
<span class="r1">    /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/Image.py: % of time =   7.99% (18m:36.461s) out of    </span>
<span class="r1">                                                          4h:40m:20.690s.                                                          </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/Image.py               </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># The Python Imaging Library.</span><span class="r9">                                                                  </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># $Id$</span><span class="r9">                                                                                         </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># the Image class wrapper</span><span class="r9">                                                                      </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># partial release history:</span><span class="r9">                                                                     </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1995-09-09 fl   Created</span><span class="r9">                                                                      </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-03-11 fl   PIL release 0.0 (proof of concept)</span><span class="r9">                                           </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-04-30 fl   PIL release 0.1b1</span><span class="r9">                                                            </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1999-07-28 fl   PIL release 1.0 final</span><span class="r9">                                                        </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2000-06-07 fl   PIL release 1.1</span><span class="r9">                                                              </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2000-10-20 fl   PIL release 1.1.1</span><span class="r9">                                                            </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2001-05-07 fl   PIL release 1.1.2</span><span class="r9">                                                            </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2002-03-15 fl   PIL release 1.1.3</span><span class="r9">                                                            </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-05-10 fl   PIL release 1.1.4</span><span class="r9">                                                            </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2005-03-28 fl   PIL release 1.1.5</span><span class="r9">                                                            </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2006-12-02 fl   PIL release 1.1.6</span><span class="r9">                                                            </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2009-11-15 fl   PIL release 1.1.7</span><span class="r9">                                                            </span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1997-2009 by Secret Labs AB.  All rights reserved.</span><span class="r9">                             </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1995-2009 by Fredrik Lundh.</span><span class="r9">                                                    </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># See the README file for information on usage and redistribution.</span><span class="r9">                             </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">atexit</span><span class="r9">                                                                                  </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">builtins</span><span class="r9">                                                                                </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">io</span><span class="r9">                                                                                      </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">logging</span><span class="r9">                                                                                 </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">math</span><span class="r9">                                                                                    </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">os</span><span class="r9">                                                                                      </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">re</span><span class="r9">                                                                                      </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">struct</span><span class="r9">                                                                                  </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">sys</span><span class="r9">                                                                                     </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">tempfile</span><span class="r9">                                                                                </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                                </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">collections.abc</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> Callable, MutableMapping</span><span class="r9">                                           </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">enum</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> IntEnum</span><span class="r9">                                                                       </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">pathlib</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> Path</span><span class="r9">                                                                       </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">defusedxml.ElementTree</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> </span><span class="r12">ElementTree</span><span class="r9">                                               </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ElementTree </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># VERSION was removed in Pillow 6.0.0.</span><span class="r9">                                                         </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># PILLOW_VERSION was removed in Pillow 9.0.0.</span><span class="r9">                                                  </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Use __version__ instead.</span><span class="r9">                                                                     </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> (</span><span class="r9">                                                                                </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ExifTags,</span><span class="r9">                                                                                  </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ImageMode,</span><span class="r9">                                                                                 </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    TiffTags,</span><span class="r9">                                                                                  </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    UnidentifiedImageError,</span><span class="r9">                                                                    </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __version__,</span><span class="r9">                                                                               </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _plugins,</span><span class="r9">                                                                                  </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">)</span><span class="r9">                                                                                              </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._binary</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> i32le, o32be, o32le</span><span class="r9">                                                       </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._deprecate</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> deprecate</span><span class="r9">                                                              </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._util</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> DeferredError, is_path</span><span class="r9">                                                      </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">__getattr__</span><span class="r11">(name):</span><span class="r9">                                                                         </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    categories </span><span class="r15">=</span><span class="r11"> {</span><span class="r16">&quot;NORMAL&quot;</span><span class="r11">: </span><span class="r15">0</span><span class="r11">, </span><span class="r16">&quot;SEQUENCE&quot;</span><span class="r11">: </span><span class="r15">1</span><span class="r11">, </span><span class="r16">&quot;CONTAINER&quot;</span><span class="r11">: </span><span class="r15">2</span><span class="r11">}</span><span class="r9">                                  </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> name </span><span class="r19">in</span><span class="r11"> categories:</span><span class="r9">                                                                     </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        deprecate(</span><span class="r16">&quot;Image categories&quot;</span><span class="r11">, </span><span class="r15">10</span><span class="r11">, </span><span class="r16">&quot;is_animated&quot;</span><span class="r11">, plural</span><span class="r15">=</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> categories[name]</span><span class="r9">                                                                </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    old_resampling </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                         </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&quot;LINEAR&quot;</span><span class="r11">: </span><span class="r16">&quot;BILINEAR&quot;</span><span class="r11">,</span><span class="r9">                                                                  </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&quot;CUBIC&quot;</span><span class="r11">: </span><span class="r16">&quot;BICUBIC&quot;</span><span class="r11">,</span><span class="r9">                                                                    </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r16">&quot;ANTIALIAS&quot;</span><span class="r11">: </span><span class="r16">&quot;LANCZOS&quot;</span><span class="r11">,</span><span class="r9">                                                                </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    }</span><span class="r9">                                                                                          </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> name </span><span class="r19">in</span><span class="r11"> old_resampling:</span><span class="r9">                                                                 </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        deprecate(</span><span class="r9">                                                                             </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            name, </span><span class="r15">10</span><span class="r11">, </span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r11">old_resampling[name]</span><span class="r21">}</span><span class="r16"> or Resampling.</span><span class="r21">{</span><span class="r11">old_resampling[name]</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">           </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> Resampling[old_resampling[name]]</span><span class="r9">                                                </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;module &#x27;</span><span class="r21">{</span><span class="r22">__name__</span><span class="r21">}</span><span class="r16">&#x27; has no attribute &#x27;</span><span class="r21">{</span><span class="r11">name</span><span class="r21">}</span><span class="r16">&#x27;&quot;</span><span class="r9">                                     </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">logger </span><span class="r15">=</span><span class="r11"> logging</span><span class="r15">.</span><span class="r11">getLogger(</span><span class="r22">__name__</span><span class="r11">)</span><span class="r9">                                                           </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">DecompressionBombWarning</span><span class="r11">(</span><span class="r13">RuntimeWarning</span><span class="r11">):</span><span class="r9">                                                </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">pass</span><span class="r9">                                                                                       </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">DecompressionBombError</span><span class="r11">(</span><span class="r13">Exception</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">pass</span><span class="r9">                                                                                       </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Limit to around a quarter gigabyte for a 24-bit (3 bpp) image</span><span class="r9">                                </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">MAX_IMAGE_PIXELS </span><span class="r15">=</span><span class="r11"> </span><span class="r20">int</span><span class="r11">(</span><span class="r15">1024</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> </span><span class="r15">1024</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> </span><span class="r15">1024</span><span class="r11"> </span><span class="r15">//</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r15">//</span><span class="r11"> </span><span class="r15">3</span><span class="r11">)</span><span class="r9">                                           </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># If the _imaging C module is not present, Pillow will not load.</span><span class="r9">                           </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Note that other modules should not refer to _imaging directly;</span><span class="r9">                           </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># import Image and use the Image.core variable instead.</span><span class="r9">                                    </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Also note that Image.core is not a publicly documented interface,</span><span class="r9">                        </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># and should be considered private and subject to change.</span><span class="r9">                                  </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> _imaging </span><span class="r10">as</span><span class="r11"> core</span><span class="r9">                                                             </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> __version__ </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(core, </span><span class="r16">&quot;PILLOW_VERSION&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                   </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                                </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;The _imaging extension was built for another version of Pillow or PIL:</span><span class="r25">\n</span><span class="r16">&quot;</span><span class="r9">         </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">f&quot;Core version: </span><span class="r21">{</span><span class="r20">getattr</span><span class="r11">(core,</span><span class="r18"> </span><span class="r16">&#x27;PILLOW_VERSION&#x27;</span><span class="r11">,</span><span class="r18"> </span><span class="r10">None</span><span class="r11">)</span><span class="r21">}</span><span class="r25">\n</span><span class="r16">&quot;</span><span class="r9">                         </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">f&quot;Pillow version: </span><span class="r21">{</span><span class="r11">__version__</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> v:</span><span class="r9">                                                                       </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    core </span><span class="r15">=</span><span class="r11"> DeferredError(</span><span class="r13">ImportError</span><span class="r11">(</span><span class="r16">&quot;The _imaging C module is not installed.&quot;</span><span class="r11">))</span><span class="r9">               </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Explanations for ways that we know we might have an import error</span><span class="r9">                         </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(v)</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&quot;Module use of python&quot;</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># The _imaging C module is present, but not compiled for</span><span class="r9">                               </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># the right version (windows only).  Print a warning, if</span><span class="r9">                               </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># possible.</span><span class="r9">                                                                            </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                                         </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;The _imaging extension was built for another version of Python.&quot;</span><span class="r11">,</span><span class="r9">                 </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r13">RuntimeWarning</span><span class="r11">,</span><span class="r9">                                                                    </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(v)</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&quot;The _imaging extension&quot;</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r20">str</span><span class="r11">(v), </span><span class="r13">RuntimeWarning</span><span class="r11">)</span><span class="r9">                                                  </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Fail here anyway. Don&#x27;t let people run with a mostly broken Pillow.</span><span class="r9">                      </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># see docs/porting.rst</span><span class="r9">                                                                     </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">raise</span><span class="r9">                                                                                      </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># works everywhere, win for pypy, not cpython</span><span class="r9">                                                  </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">USE_CFFI_ACCESS </span><span class="r15">=</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(sys, </span><span class="r16">&quot;pypy_version_info&quot;</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                           </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">cffi</span><span class="r9">                                                                                </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    cffi </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                                </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">isImageType</span><span class="r11">(t):</span><span class="r9">                                                                            </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Checks if an object is an image object.</span><span class="r9">                                                    </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    .. warning::</span><span class="r9">                                                                               </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       This function is for internal use only.</span><span class="r9">                                                 </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param t: object to check if it&#x27;s an image</span><span class="r9">                                                 </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: True if the object is an image</span><span class="r9">                                                   </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(t, </span><span class="r16">&quot;im&quot;</span><span class="r11">)</span><span class="r9">                                                                    </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Constants</span><span class="r9">                                                                                    </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># transpose</span><span class="r9">                                                                                    </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Transpose</span><span class="r11">(IntEnum):</span><span class="r9">                                                                      </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FLIP_LEFT_RIGHT </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FLIP_TOP_BOTTOM </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                        </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ROTATE_90 </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                              </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ROTATE_180 </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                             </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ROTATE_270 </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                             </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    TRANSPOSE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">5</span><span class="r9">                                                                              </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    TRANSVERSE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">6</span><span class="r9">                                                                             </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># transforms (also defined in Imaging.h)</span><span class="r9">                                                       </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Transform</span><span class="r11">(IntEnum):</span><span class="r9">                                                                      </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    AFFINE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                 </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    EXTENT </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                                 </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    PERSPECTIVE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                            </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    QUAD </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                                   </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    MESH </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                                   </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># resampling filters (also defined in Imaging.h)</span><span class="r9">                                               </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Resampling</span><span class="r11">(IntEnum):</span><span class="r9">                                                                     </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    NEAREST </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    BOX </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                                    </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    BILINEAR </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                               </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    HAMMING </span><span class="r15">=</span><span class="r11"> </span><span class="r15">5</span><span class="r9">                                                                                </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    BICUBIC </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                                </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    LANCZOS </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                                </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_filters_support </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                           </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    Resampling</span><span class="r15">.</span><span class="r11">BOX: </span><span class="r15">0.5</span><span class="r11">,</span><span class="r9">                                                                       </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    Resampling</span><span class="r15">.</span><span class="r11">BILINEAR: </span><span class="r15">1.0</span><span class="r11">,</span><span class="r9">                                                                  </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    Resampling</span><span class="r15">.</span><span class="r11">HAMMING: </span><span class="r15">1.0</span><span class="r11">,</span><span class="r9">                                                                   </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    Resampling</span><span class="r15">.</span><span class="r11">BICUBIC: </span><span class="r15">2.0</span><span class="r11">,</span><span class="r9">                                                                   </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    Resampling</span><span class="r15">.</span><span class="r11">LANCZOS: </span><span class="r15">3.0</span><span class="r11">,</span><span class="r9">                                                                   </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># dithers</span><span class="r9">                                                                                      </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Dither</span><span class="r11">(IntEnum):</span><span class="r9">                                                                         </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    NONE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                   </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ORDERED </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">  </span><span class="r14"># Not yet implemented</span><span class="r9">                                                         </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    RASTERIZE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r11">  </span><span class="r14"># Not yet implemented</span><span class="r9">                                                       </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FLOYDSTEINBERG </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r11">  </span><span class="r14"># default</span><span class="r9">                                                              </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># palettes/quantizers</span><span class="r9">                                                                          </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Palette</span><span class="r11">(IntEnum):</span><span class="r9">                                                                        </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    WEB </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                    </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ADAPTIVE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                               </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Quantize</span><span class="r11">(IntEnum):</span><span class="r9">                                                                       </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    MEDIANCUT </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                              </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    MAXCOVERAGE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                            </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FASTOCTREE </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                             </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    LIBIMAGEQUANT </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                          </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">module </span><span class="r15">=</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">modules[</span><span class="r22">__name__</span><span class="r11">]</span><span class="r9">                                                                 </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">for</span><span class="r11"> enum </span><span class="r19">in</span><span class="r11"> (Transpose, Transform, Resampling, Dither, Palette, Quantize):</span><span class="r9">                     </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> item </span><span class="r19">in</span><span class="r11"> enum:</span><span class="r9">                                                                          </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">setattr</span><span class="r11">(module, item</span><span class="r15">.</span><span class="r11">name, item</span><span class="r15">.</span><span class="r11">value)</span><span class="r9">                                                 </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(core, </span><span class="r16">&quot;DEFAULT_STRATEGY&quot;</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    DEFAULT_STRATEGY </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">DEFAULT_STRATEGY</span><span class="r9">                                                   </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FILTERED </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">FILTERED</span><span class="r9">                                                                   </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    HUFFMAN_ONLY </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">HUFFMAN_ONLY</span><span class="r9">                                                           </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    RLE </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">RLE</span><span class="r9">                                                                             </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    FIXED </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">FIXED</span><span class="r9">                                                                         </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Registries</span><span class="r9">                                                                                   </span>  
 <span class="r6">   232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ID </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                                        </span>  
 <span class="r6">   234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">OPEN </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                      </span>  
 <span class="r6">   235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">MIME </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                      </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">SAVE </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                      </span>  
 <span class="r6">   237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">SAVE_ALL </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                  </span>  
 <span class="r6">   238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">EXTENSION </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                 </span>  
 <span class="r6">   239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">DECODERS </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                  </span>  
 <span class="r6">   240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ENCODERS </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                                  </span>  
 <span class="r6">   241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Modes</span><span class="r9">                                                                                        </span>  
 <span class="r6">   244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_ENDIAN </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&lt;&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">byteorder </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;little&quot;</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;&gt;&quot;</span><span class="r9">                                            </span>  
 <span class="r6">   246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_conv_type_shape</span><span class="r11">(im):</span><span class="r9">                                                                      </span>  
 <span class="r6">   249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    m </span><span class="r15">=</span><span class="r11"> ImageMode</span><span class="r15">.</span><span class="r11">getmode(im</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                                             </span>  
 <span class="r6">   250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    shape </span><span class="r15">=</span><span class="r11"> (im</span><span class="r15">.</span><span class="r11">height, im</span><span class="r15">.</span><span class="r11">width)</span><span class="r9">                                                              </span>  
 <span class="r6">   251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    extra </span><span class="r15">=</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(m</span><span class="r15">.</span><span class="r11">bands)</span><span class="r9">                                                                       </span>  
 <span class="r6">   252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> extra </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                             </span>  
 <span class="r6">   253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        shape </span><span class="r15">+=</span><span class="r11"> (extra,)</span><span class="r9">                                                                      </span>  
 <span class="r6">   254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> shape, m</span><span class="r15">.</span><span class="r11">typestr</span><span class="r9">                                                                    </span>  
 <span class="r6">   255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">MODES </span><span class="r15">=</span><span class="r11"> [</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;CMYK&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;HSV&quot;</span><span class="r11">, </span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;LAB&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBX&quot;</span><span class="r11">, </span><span class="r16">&quot;YCbCr&quot;</span><span class="r11">]</span><span class="r9">        </span>  
 <span class="r6">   258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># raw modes that may be memory mapped.  NOTE: if you change this, you</span><span class="r9">                          </span>  
 <span class="r6">   260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># may have to modify the stride calculation in map.c too!</span><span class="r9">                                      </span>  
 <span class="r6">   261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_MAPMODES </span><span class="r15">=</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBX&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r16">&quot;CMYK&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16L&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16B&quot;</span><span class="r11">)</span><span class="r9">                       </span>  
 <span class="r6">   262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getmodebase</span><span class="r11">(mode):</span><span class="r9">                                                                         </span>  
 <span class="r6">   265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Gets the &quot;base&quot; mode for given mode.  This function returns &quot;L&quot; for</span><span class="r9">                        </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    images that contain grayscale data, and &quot;RGB&quot; for images that</span><span class="r9">                              </span>  
 <span class="r6">   268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    contain color data.</span><span class="r9">                                                                        </span>  
 <span class="r6">   269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">   271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: &quot;L&quot; or &quot;RGB&quot;.</span><span class="r9">                                                                    </span>  
 <span class="r6">   272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception KeyError: If the input mode was not a standard mode.</span><span class="r9">                            </span>  
 <span class="r6">   273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> ImageMode</span><span class="r15">.</span><span class="r11">getmode(mode)</span><span class="r15">.</span><span class="r11">basemode</span><span class="r9">                                                    </span>  
 <span class="r6">   275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getmodetype</span><span class="r11">(mode):</span><span class="r9">                                                                         </span>  
 <span class="r6">   278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Gets the storage type mode.  Given a mode, this function returns a</span><span class="r9">                         </span>  
 <span class="r6">   280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    single-layer mode suitable for storing individual bands.</span><span class="r9">                                   </span>  
 <span class="r6">   281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">   283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: &quot;L&quot;, &quot;I&quot;, or &quot;F&quot;.</span><span class="r9">                                                                </span>  
 <span class="r6">   284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception KeyError: If the input mode was not a standard mode.</span><span class="r9">                            </span>  
 <span class="r6">   285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> ImageMode</span><span class="r15">.</span><span class="r11">getmode(mode)</span><span class="r15">.</span><span class="r11">basetype</span><span class="r9">                                                    </span>  
 <span class="r6">   287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getmodebandnames</span><span class="r11">(mode):</span><span class="r9">                                                                    </span>  
 <span class="r6">   290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Gets a list of individual band names.  Given a mode, this function returns</span><span class="r9">                 </span>  
 <span class="r6">   292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    a tuple containing the names of individual bands (use</span><span class="r9">                                      </span>  
 <span class="r6">   293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:method:`~PIL.Image.getmodetype` to get the mode used to store each</span><span class="r9">                     </span>  
 <span class="r6">   294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    individual band.</span><span class="r9">                                                                           </span>  
 <span class="r6">   295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">   297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: A tuple containing band names.  The length of the tuple</span><span class="r9">                          </span>  
 <span class="r6">   298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        gives the number of bands in an image of the given mode.</span><span class="r9">                               </span>  
 <span class="r6">   299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception KeyError: If the input mode was not a standard mode.</span><span class="r9">                            </span>  
 <span class="r6">   300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> ImageMode</span><span class="r15">.</span><span class="r11">getmode(mode)</span><span class="r15">.</span><span class="r11">bands</span><span class="r9">                                                       </span>  
 <span class="r6">   302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">getmodebands</span><span class="r11">(mode):</span><span class="r9">                                                                        </span>  
 <span class="r6">   305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Gets the number of individual bands for this mode.</span><span class="r9">                                         </span>  
 <span class="r6">   307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">   309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: The number of bands in this mode.</span><span class="r9">                                                </span>  
 <span class="r6">   310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception KeyError: If the input mode was not a standard mode.</span><span class="r9">                            </span>  
 <span class="r6">   311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(ImageMode</span><span class="r15">.</span><span class="r11">getmode(mode)</span><span class="r15">.</span><span class="r11">bands)</span><span class="r9">                                                  </span>  
 <span class="r6">   313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Helpers</span><span class="r9">                                                                                      </span>  
 <span class="r6">   317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_initialized </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                               </span>  
 <span class="r6">   319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">preinit</span><span class="r11">():</span><span class="r9">                                                                                 </span>  
 <span class="r6">   322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Explicitly load standard file format drivers.&quot;&quot;&quot;</span><span class="r9">                                        </span>  
 <span class="r6">   323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _initialized</span><span class="r9">                                                                        </span>  
 <span class="r6">   325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _initialized </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r9">                                                                                 </span>  
 <span class="r6">   327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> BmpImagePlugin</span><span class="r9">                                                           </span>  
 <span class="r6">   330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> BmpImagePlugin</span><span class="r9">                                                                  </span>  
 <span class="r6">   332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> GifImagePlugin</span><span class="r9">                                                           </span>  
 <span class="r6">   336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> GifImagePlugin</span><span class="r9">                                                                  </span>  
 <span class="r6">   338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> JpegImagePlugin</span><span class="r9">                                                          </span>  
 <span class="r6">   342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> JpegImagePlugin</span><span class="r9">                                                                 </span>  
 <span class="r6">   344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> PpmImagePlugin</span><span class="r9">                                                           </span>  
 <span class="r6">   348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> PpmImagePlugin</span><span class="r9">                                                                  </span>  
 <span class="r6">   350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> PngImagePlugin</span><span class="r9">                                                           </span>  
 <span class="r6">   354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> PngImagePlugin</span><span class="r9">                                                                  </span>  
 <span class="r6">   356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># try:</span><span class="r9">                                                                                     </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#     import TiffImagePlugin</span><span class="r9">                                                               </span>  
 <span class="r6">   360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#     assert TiffImagePlugin</span><span class="r9">                                                               </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># except ImportError:</span><span class="r9">                                                                      </span>  
 <span class="r6">   362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#     pass</span><span class="r9">                                                                                 </span>  
 <span class="r6">   363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _initialized </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                           </span>  
 <span class="r6">   365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">init</span><span class="r11">():</span><span class="r9">                                                                                    </span>  
 <span class="r6">   368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Explicitly initializes the Python Imaging Library. This function</span><span class="r9">                           </span>  
 <span class="r6">   370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    loads all available file format drivers.</span><span class="r9">                                                   </span>  
 <span class="r6">   371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">global</span><span class="r11"> _initialized</span><span class="r9">                                                                        </span>  
 <span class="r6">   374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> _initialized </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">2</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                               </span>  
 <span class="r6">   376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> plugin </span><span class="r19">in</span><span class="r11"> _plugins:</span><span class="r9">                                                                    </span>  
 <span class="r6">   378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            logger</span><span class="r15">.</span><span class="r11">debug(</span><span class="r16">&quot;Importing </span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11">, plugin)</span><span class="r9">                                               </span>  
 <span class="r6">   380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">__import__</span><span class="r11">(</span><span class="r16">f&quot;PIL.</span><span class="r21">{</span><span class="r11">plugin</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r11">, </span><span class="r20">globals</span><span class="r11">(), </span><span class="r20">locals</span><span class="r11">(), [])</span><span class="r9">                               </span>  
 <span class="r6">   381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                               </span>  
 <span class="r6">   382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            logger</span><span class="r15">.</span><span class="r11">debug(</span><span class="r16">&quot;Image: failed to import </span><span class="r21">%s</span><span class="r16">: </span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11">, plugin, e)</span><span class="r9">                          </span>  
 <span class="r6">   383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> OPEN </span><span class="r19">or</span><span class="r11"> SAVE:</span><span class="r9">                                                                           </span>  
 <span class="r6">   385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _initialized </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                       </span>  
 <span class="r6">   386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                               </span>  
 <span class="r6">   387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Codec factories (used by tobytes/frombytes and ImageFile.load)</span><span class="r9">                               </span>  
 <span class="r6">   391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_getdecoder</span><span class="r11">(mode, decoder_name, args, extra</span><span class="r15">=</span><span class="r11">()):</span><span class="r9">                                           </span>  
 <span class="r6">   394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># tweak arguments</span><span class="r9">                                                                          </span>  
 <span class="r6">   396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> args </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> ()</span><span class="r9">                                                                              </span>  
 <span class="r6">   398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> (args,)</span><span class="r9">                                                                         </span>  
 <span class="r6">   400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        decoder </span><span class="r15">=</span><span class="r11"> DECODERS[decoder_name]</span><span class="r9">                                                       </span>  
 <span class="r6">   403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> decoder(mode, </span><span class="r15">*</span><span class="r11">args </span><span class="r15">+</span><span class="r11"> extra)</span><span class="r9">                                                    </span>  
 <span class="r6">   407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># get decoder</span><span class="r9">                                                                          </span>  
 <span class="r6">   410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        decoder </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(core, decoder_name </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;_decoder&quot;</span><span class="r11">)</span><span class="r9">                                     </span>  
 <span class="r6">   411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                </span>  
 <span class="r6">   412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;decoder </span><span class="r21">{</span><span class="r11">decoder_name</span><span class="r21">}</span><span class="r16"> not available&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                              </span>  
 <span class="r6">   414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> decoder(mode, </span><span class="r15">*</span><span class="r11">args </span><span class="r15">+</span><span class="r11"> extra)</span><span class="r9">                                                        </span>  
 <span class="r6">   415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_getencoder</span><span class="r11">(mode, encoder_name, args, extra</span><span class="r15">=</span><span class="r11">()):</span><span class="r9">                                           </span>  
 <span class="r6">   418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># tweak arguments</span><span class="r9">                                                                          </span>  
 <span class="r6">   420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> args </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> ()</span><span class="r9">                                                                              </span>  
 <span class="r6">   422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> (args,)</span><span class="r9">                                                                         </span>  
 <span class="r6">   424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        encoder </span><span class="r15">=</span><span class="r11"> ENCODERS[encoder_name]</span><span class="r9">                                                       </span>  
 <span class="r6">   427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> encoder(mode, </span><span class="r15">*</span><span class="r11">args </span><span class="r15">+</span><span class="r11"> extra)</span><span class="r9">                                                    </span>  
 <span class="r6">   431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># get encoder</span><span class="r9">                                                                          </span>  
 <span class="r6">   434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        encoder </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(core, encoder_name </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;_encoder&quot;</span><span class="r11">)</span><span class="r9">                                     </span>  
 <span class="r6">   435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                </span>  
 <span class="r6">   436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;encoder </span><span class="r21">{</span><span class="r11">encoder_name</span><span class="r21">}</span><span class="r16"> not available&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                              </span>  
 <span class="r6">   438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> encoder(mode, </span><span class="r15">*</span><span class="r11">args </span><span class="r15">+</span><span class="r11"> extra)</span><span class="r9">                                                        </span>  
 <span class="r6">   439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Simple expression analyzer</span><span class="r9">                                                                   </span>  
 <span class="r6">   443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">coerce_e</span><span class="r11">(value):</span><span class="r9">                                                                           </span>  
 <span class="r6">   446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    deprecate(</span><span class="r16">&quot;coerce_e&quot;</span><span class="r11">, </span><span class="r15">10</span><span class="r11">)</span><span class="r9">                                                                  </span>  
 <span class="r6">   447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> value </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value, _E) </span><span class="r10">else</span><span class="r11"> _E(</span><span class="r15">1</span><span class="r11">, value)</span><span class="r9">                                    </span>  
 <span class="r6">   448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># _E(scale, offset) represents the affine transformation scale * x + offset.</span><span class="r9">                   </span>  
 <span class="r6">   451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># The &quot;data&quot; field is named for compatibility with the old implementation,</span><span class="r9">                     </span>  
 <span class="r6">   452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># and should be renamed once coerce_e is removed.</span><span class="r9">                                              </span>  
 <span class="r6">   453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">_E</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, scale, data):</span><span class="r9">                                                           </span>  
 <span class="r6">   455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale </span><span class="r15">=</span><span class="r11"> scale</span><span class="r9">                                                                     </span>  
 <span class="r6">   456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> data</span><span class="r9">                                                                       </span>  
 <span class="r6">   457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__neg__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _E(</span><span class="r15">-</span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale, </span><span class="r15">-</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data)</span><span class="r9">                                                     </span>  
 <span class="r6">   460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__add__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                                  </span>  
 <span class="r6">   462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(other, _E):</span><span class="r9">                                                              </span>  
 <span class="r6">   463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> _E(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale </span><span class="r15">+</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">scale, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">+</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">data)</span><span class="r9">                        </span>  
 <span class="r6">   464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _E(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">+</span><span class="r11"> other)</span><span class="r9">                                               </span>  
 <span class="r6">   465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r17">__radd__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r17">__add__</span><span class="r9">                                                                         </span>  
 <span class="r6">   467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__sub__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                                  </span>  
 <span class="r6">   469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">-</span><span class="r11">other</span><span class="r9">                                                                   </span>  
 <span class="r6">   470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__rsub__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                                 </span>  
 <span class="r6">   472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> other </span><span class="r15">+</span><span class="r11"> </span><span class="r15">-</span><span class="r20">self</span><span class="r9">                                                                   </span>  
 <span class="r6">   473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__mul__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                                  </span>  
 <span class="r6">   475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(other, _E):</span><span class="r9">                                                              </span>  
 <span class="r6">   476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">NotImplemented</span><span class="r9">                                                              </span>  
 <span class="r6">   477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _E(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale </span><span class="r15">*</span><span class="r11"> other, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">*</span><span class="r11"> other)</span><span class="r9">                                       </span>  
 <span class="r6">   478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r17">__rmul__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r17">__mul__</span><span class="r9">                                                                         </span>  
 <span class="r6">   480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__truediv__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                              </span>  
 <span class="r6">   482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(other, _E):</span><span class="r9">                                                              </span>  
 <span class="r6">   483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">NotImplemented</span><span class="r9">                                                              </span>  
 <span class="r6">   484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _E(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">scale </span><span class="r15">/</span><span class="r11"> other, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">/</span><span class="r11"> other)</span><span class="r9">                                       </span>  
 <span class="r6">   485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_getscaleoffset</span><span class="r11">(expr):</span><span class="r9">                                                                     </span>  
 <span class="r6">   488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    a </span><span class="r15">=</span><span class="r11"> expr(_E(</span><span class="r15">1</span><span class="r11">, </span><span class="r15">0</span><span class="r11">))</span><span class="r9">                                                                         </span>  
 <span class="r6">   489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> (a</span><span class="r15">.</span><span class="r11">scale, a</span><span class="r15">.</span><span class="r11">data) </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(a, _E) </span><span class="r10">else</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, a)</span><span class="r9">                                  </span>  
 <span class="r6">   490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Implementation wrapper</span><span class="r9">                                                                       </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Image</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This class represents an image object.  To create</span><span class="r9">                                          </span>  
 <span class="r6">   499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:class:`~PIL.Image.Image` objects, use the appropriate factory</span><span class="r9">                          </span>  
 <span class="r6">   500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    functions.  There&#x27;s hardly ever any reason to call the Image constructor</span><span class="r9">                   </span>  
 <span class="r6">   501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    directly.</span><span class="r9">                                                                                  </span>  
 <span class="r6">   502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    * :py:func:`~PIL.Image.open`</span><span class="r9">                                                               </span>  
 <span class="r6">   504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    * :py:func:`~PIL.Image.new`</span><span class="r9">                                                                </span>  
 <span class="r6">   505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    * :py:func:`~PIL.Image.frombytes`</span><span class="r9">                                                          </span>  
 <span class="r6">   506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">format</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                              </span>  
 <span class="r6">   509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    format_description </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                  </span>  
 <span class="r6">   510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _close_exclusive_fp_after_loading </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                   </span>  
 <span class="r6">   511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, logging</span><span class="r15">=</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># FIXME: take &quot;new&quot; parameters / other image?</span><span class="r9">                                          </span>  
 <span class="r6">   514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># FIXME: turn mode and size into delegating properties?</span><span class="r9">                                </span>  
 <span class="r6">   515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                         </span>  
 <span class="r6">   517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                    </span>  
 <span class="r6">   518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                    </span>  
 <span class="r6">   519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                         </span>  
 <span class="r6">   520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_category </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                     </span>  
 <span class="r6">   521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                      </span>  
 <span class="r6">   522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                   </span>  
 <span class="r6">   523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                      </span>  
 <span class="r6">   524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging </span><span class="r15">=</span><span class="r11"> logging</span><span class="r9">                                                                 </span>  
 <span class="r6">   525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging:</span><span class="r9">                                                                       </span>  
 <span class="r6">   526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">log_time </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                 </span>  
 <span class="r6">   527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__getattr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name):</span><span class="r9">                                                               </span>  
 <span class="r6">   529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;category&quot;</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            deprecate(</span><span class="r16">&quot;Image categories&quot;</span><span class="r11">, </span><span class="r15">10</span><span class="r11">, </span><span class="r16">&quot;is_animated&quot;</span><span class="r11">, plural</span><span class="r15">=</span><span class="r10">True</span><span class="r11">)</span><span class="r9">                      </span>  
 <span class="r6">   531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_category</span><span class="r9">                                                              </span>  
 <span class="r6">   532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">(name)</span><span class="r9">                                                             </span>  
 <span class="r6">   533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">width</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">   537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">height</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">   541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">size</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size</span><span class="r9">                                                                      </span>  
 <span class="r6">   545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_new</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, im):</span><span class="r9">                                                                        </span>  
 <span class="r6">   547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new </span><span class="r15">=</span><span class="r11"> Image()</span><span class="r9">                                                                          </span>  
 <span class="r6">   548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> im</span><span class="r9">                                                                            </span>  
 <span class="r6">   549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                                     </span>  
 <span class="r6">   550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                                    </span>  
 <span class="r6">   551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette:</span><span class="r9">                                                                   </span>  
 <span class="r6">   553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                              </span>  
 <span class="r6">   554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                     </span>  
 <span class="r6">   556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette()</span><span class="r9">                                      </span>  
 <span class="r6">   558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new</span><span class="r15">.</span><span class="r11">info </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                            </span>  
 <span class="r6">   559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> new</span><span class="r9">                                                                             </span>  
 <span class="r6">   560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Context manager support</span><span class="r9">                                                                  </span>  
 <span class="r6">   562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__enter__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                                            </span>  
 <span class="r6">   564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                                 </span>  
 <span class="r6">   566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;fp&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;_exclusive_fp&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">):</span><span class="r9">                      </span>  
 <span class="r6">   567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;_fp&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">   568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp:</span><span class="r9">                                                        </span>  
 <span class="r6">   569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                           </span>  
 <span class="r6">   570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp </span><span class="r15">=</span><span class="r11"> DeferredError(</span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Operation on closed image&quot;</span><span class="r11">))</span><span class="r9">              </span>  
 <span class="r6">   571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp:</span><span class="r9">                                                                        </span>  
 <span class="r6">   572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                </span>  
 <span class="r6">   573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">close</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Closes the file pointer, if possible.</span><span class="r9">                                                  </span>  
 <span class="r6">   578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This operation will destroy the image core and release its memory.</span><span class="r9">                     </span>  
 <span class="r6">   580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The image data will be unusable afterward.</span><span class="r9">                                             </span>  
 <span class="r6">   581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This function is required to close images that have multiple frames or</span><span class="r9">                 </span>  
 <span class="r6">   583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        have not had their file read and closed by the</span><span class="r9">                                         </span>  
 <span class="r6">   584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :py:meth:`~PIL.Image.Image.load` method. See :ref:`file-handling` for</span><span class="r9">                  </span>  
 <span class="r6">   585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        more information.</span><span class="r9">                                                                      </span>  
 <span class="r6">   586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;_fp&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">   589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp:</span><span class="r9">                                                        </span>  
 <span class="r6">   590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                           </span>  
 <span class="r6">   591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fp </span><span class="r15">=</span><span class="r11"> DeferredError(</span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Operation on closed image&quot;</span><span class="r11">))</span><span class="r9">              </span>  
 <span class="r6">   592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp:</span><span class="r9">                                                                        </span>  
 <span class="r6">   593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                </span>  
 <span class="r6">   594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                     </span>  
 <span class="r6">   595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> msg:</span><span class="r9">                                                               </span>  
 <span class="r6">   596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            logger</span><span class="r15">.</span><span class="r11">debug(</span><span class="r16">&quot;Error closing: </span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11">, msg)</span><span class="r9">                                             </span>  
 <span class="r6">   597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;map&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                    </span>  
 <span class="r6">   600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Instead of simply setting to None, we&#x27;re setting up a</span><span class="r9">                                </span>  
 <span class="r6">   602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># deferred error that will better explain that the core image</span><span class="r9">                          </span>  
 <span class="r6">   603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># object is gone.</span><span class="r9">                                                                      </span>  
 <span class="r6">   604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> DeferredError(</span><span class="r13">ValueError</span><span class="r11">(</span><span class="r16">&quot;Operation on closed image&quot;</span><span class="r11">))</span><span class="r9">                       </span>  
 <span class="r6">   605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_copy</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">   608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                               </span>  
 <span class="r6">   609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                   </span>  
 <span class="r6">   610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                      </span>  
 <span class="r6">   611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_ensure_mutable</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">   613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly:</span><span class="r9">                                                                      </span>  
 <span class="r6">   614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_copy()</span><span class="r9">                                                                       </span>  
 <span class="r6">   615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                        </span>  
 <span class="r6">   617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_dump</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, file</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r20">format</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r15">**</span><span class="r11">options):</span><span class="r9">                                        </span>  
 <span class="r6">   619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        suffix </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                            </span>  
 <span class="r6">   620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">format</span><span class="r11">:</span><span class="r9">                                                                             </span>  
 <span class="r6">   621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            suffix </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;.&quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r20">format</span><span class="r9">                                                              </span>  
 <span class="r6">   622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> file:</span><span class="r9">                                                                           </span>  
 <span class="r6">   624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            f, filename </span><span class="r15">=</span><span class="r11"> tempfile</span><span class="r15">.</span><span class="r11">mkstemp(suffix)</span><span class="r9">                                             </span>  
 <span class="r6">   625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            os</span><span class="r15">.</span><span class="r11">close(f)</span><span class="r9">                                                                        </span>  
 <span class="r6">   626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filename </span><span class="r15">=</span><span class="r11"> file</span><span class="r9">                                                                    </span>  
 <span class="r6">   628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> filename</span><span class="r15">.</span><span class="r11">endswith(suffix):</span><span class="r9">                                                  </span>  
 <span class="r6">   629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                filename </span><span class="r15">=</span><span class="r11"> filename </span><span class="r15">+</span><span class="r11"> suffix</span><span class="r9">                                                   </span>  
 <span class="r6">   630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">   632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">format</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r20">format</span><span class="r11"> </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;PPM&quot;</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">save_ppm(filename)</span><span class="r9">                                                         </span>  
 <span class="r6">   635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">save(filename, </span><span class="r20">format</span><span class="r11">, </span><span class="r15">**</span><span class="r11">options)</span><span class="r9">                                             </span>  
 <span class="r6">   637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> filename</span><span class="r9">                                                                        </span>  
 <span class="r6">   639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__eq__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, other):</span><span class="r9">                                                                   </span>  
 <span class="r6">   641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> (</span><span class="r9">                                                                               </span>  
 <span class="r6">   642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r11"> </span><span class="r19">is</span><span class="r11"> other</span><span class="r15">.</span><span class="r22">__class__</span><span class="r9">                                                  </span>  
 <span class="r6">   643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                        </span>  
 <span class="r6">   644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                        </span>  
 <span class="r6">   645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">info</span><span class="r9">                                                        </span>  
 <span class="r6">   646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_category </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">_category</span><span class="r9">                                              </span>  
 <span class="r6">   647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getpalette() </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">getpalette()</span><span class="r9">                                        </span>  
 <span class="r6">   648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tobytes() </span><span class="r15">==</span><span class="r11"> other</span><span class="r15">.</span><span class="r11">tobytes()</span><span class="r9">                                              </span>  
 <span class="r6">   649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__repr__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">&quot;&lt;</span><span class="r21">%s</span><span class="r16">.</span><span class="r21">%s</span><span class="r16"> image mode=</span><span class="r21">%s</span><span class="r16"> size=</span><span class="r21">%d</span><span class="r16">x</span><span class="r21">%d</span><span class="r16"> at 0x</span><span class="r21">%X</span><span class="r16">&gt;&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (</span><span class="r9">                                  </span>  
 <span class="r6">   653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__module__</span><span class="r11">,</span><span class="r9">                                                         </span>  
 <span class="r6">   654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                           </span>  
 <span class="r6">   655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode,</span><span class="r9">                                                                         </span>  
 <span class="r6">   656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">],</span><span class="r9">                                                                      </span>  
 <span class="r6">   657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">],</span><span class="r9">                                                                      </span>  
 <span class="r6">   658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">id</span><span class="r11">(</span><span class="r20">self</span><span class="r11">),</span><span class="r9">                                                                          </span>  
 <span class="r6">   659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_repr_pretty_</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, p, cycle):</span><span class="r9">                                                         </span>  
 <span class="r6">   662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;IPython plain text display support&quot;&quot;&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Same as __repr__ but without unpredictable id(self),</span><span class="r9">                                 </span>  
 <span class="r6">   665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># to keep Jupyter notebook `text/plain` output stable.</span><span class="r9">                                 </span>  
 <span class="r6">   666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        p</span><span class="r15">.</span><span class="r11">text(</span><span class="r9">                                                                                </span>  
 <span class="r6">   667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;&lt;</span><span class="r21">%s</span><span class="r16">.</span><span class="r21">%s</span><span class="r16"> image mode=</span><span class="r21">%s</span><span class="r16"> size=</span><span class="r21">%d</span><span class="r16">x</span><span class="r21">%d</span><span class="r16">&gt;&quot;</span><span class="r9">                                                 </span>  
 <span class="r6">   668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r15">%</span><span class="r11"> (</span><span class="r9">                                                                                </span>  
 <span class="r6">   669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__module__</span><span class="r11">,</span><span class="r9">                                                     </span>  
 <span class="r6">   670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r15">.</span><span class="r22">__name__</span><span class="r11">,</span><span class="r9">                                                       </span>  
 <span class="r6">   671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode,</span><span class="r9">                                                                     </span>  
 <span class="r6">   672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">],</span><span class="r9">                                                                  </span>  
 <span class="r6">   673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">],</span><span class="r9">                                                                  </span>  
 <span class="r6">   674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">   675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_repr_png_</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">   678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;iPython display hook support</span><span class="r9">                                                        </span>  
 <span class="r6">   679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: png version of the image as bytes</span><span class="r9">                                            </span>  
 <span class="r6">   681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        b </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO()</span><span class="r9">                                                                       </span>  
 <span class="r6">   683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">save(b, </span><span class="r16">&quot;PNG&quot;</span><span class="r11">)</span><span class="r9">                                                                </span>  
 <span class="r6">   685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                 </span>  
 <span class="r6">   686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Could not save to PNG for display&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                       </span>  
 <span class="r6">   688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> b</span><span class="r15">.</span><span class="r11">getvalue()</span><span class="r9">                                                                    </span>  
 <span class="r6">   689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__array_interface__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># numpy array interface support</span><span class="r9">                                                        </span>  
 <span class="r6">   693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                               </span>  
 <span class="r6">   694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        shape, typestr </span><span class="r15">=</span><span class="r11"> _conv_type_shape(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                </span>  
 <span class="r6">   695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new[</span><span class="r16">&quot;shape&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> shape</span><span class="r9">                                                                   </span>  
 <span class="r6">   696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new[</span><span class="r16">&quot;typestr&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> typestr</span><span class="r9">                                                               </span>  
 <span class="r6">   697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new[</span><span class="r16">&quot;version&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                     </span>  
 <span class="r6">   698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;1&quot;</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Binary images need to be extended from bits to bytes</span><span class="r9">                         </span>  
 <span class="r6">   701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># See: https://github.com/python-pillow/Pillow/issues/350</span><span class="r9">                      </span>  
 <span class="r6">   702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new[</span><span class="r16">&quot;data&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tobytes(</span><span class="r16">&quot;raw&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">)</span><span class="r9">                                         </span>  
 <span class="r6">   703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new[</span><span class="r16">&quot;data&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tobytes()</span><span class="r9">                                                   </span>  
 <span class="r6">   705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                 </span>  
 <span class="r6">   706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(e, (</span><span class="r13">MemoryError</span><span class="r11">, </span><span class="r13">RecursionError</span><span class="r11">)):</span><span class="r9">                               </span>  
 <span class="r6">   707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">numpy</span><span class="r9">                                                               </span>  
 <span class="r6">   709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">packaging.version</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> parse </span><span class="r10">as</span><span class="r11"> parse_version</span><span class="r9">                       </span>  
 <span class="r6">   710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">   711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">   712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> parse_version(numpy</span><span class="r15">.</span><span class="r11">__version__) </span><span class="r15">&lt;</span><span class="r11"> parse_version(</span><span class="r16">&quot;1.23&quot;</span><span class="r11">):</span><span class="r9">               </span>  
 <span class="r6">   714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        warnings</span><span class="r15">.</span><span class="r11">warn(e)</span><span class="r9">                                                       </span>  
 <span class="r6">   715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> new</span><span class="r9">                                                                             </span>  
 <span class="r6">   717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__getstate__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">   719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> [</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getpalette(), </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tobytes()]</span><span class="r9">            </span>  
 <span class="r6">   720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__setstate__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, state):</span><span class="r9">                                                             </span>  
 <span class="r6">   722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        Image</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                   </span>  
 <span class="r6">   723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        info, mode, size, palette, data </span><span class="r15">=</span><span class="r11"> state</span><span class="r9">                                                </span>  
 <span class="r6">   724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info </span><span class="r15">=</span><span class="r11"> info</span><span class="r9">                                                                       </span>  
 <span class="r6">   725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                       </span>  
 <span class="r6">   726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> size</span><span class="r9">                                                                      </span>  
 <span class="r6">   727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> core</span><span class="r15">.</span><span class="r11">new(mode, size)</span><span class="r9">                                                         </span>  
 <span class="r6">   728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> palette:</span><span class="r9">                                         </span>  
 <span class="r6">   729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">putpalette(palette)</span><span class="r9">                                                           </span>  
 <span class="r6">   730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">frombytes(data)</span><span class="r9">                                                                   </span>  
 <span class="r6">   731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">tobytes</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, encoder_name</span><span class="r15">=</span><span class="r16">&quot;raw&quot;</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                              </span>  
 <span class="r6">   733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Return image as a bytes object.</span><span class="r9">                                                        </span>  
 <span class="r6">   735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        .. warning::</span><span class="r9">                                                                           </span>  
 <span class="r6">   737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            This method returns the raw image data from the internal</span><span class="r9">                           </span>  
 <span class="r6">   739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            storage.  For compressed image data (e.g. PNG, JPEG) use</span><span class="r9">                           </span>  
 <span class="r6">   740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            :meth:`~.save`, with a BytesIO parameter for in-memory</span><span class="r9">                             </span>  
 <span class="r6">   741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            data.</span><span class="r9">                                                                              </span>  
 <span class="r6">   742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param encoder_name: What encoder to use.  The default is to</span><span class="r9">                           </span>  
 <span class="r6">   744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                             use the standard &quot;raw&quot; encoder.</span><span class="r9">                                   </span>  
 <span class="r6">   745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                             A list of C encoders can be seen under</span><span class="r9">                            </span>  
 <span class="r6">   747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                             codecs section of the function array in</span><span class="r9">                           </span>  
 <span class="r6">   748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                             :file:`_imaging.c`. Python encoders are</span><span class="r9">                           </span>  
 <span class="r6">   749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                             registered within the relevant plugins.</span><span class="r9">                           </span>  
 <span class="r6">   750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param args: Extra arguments to the encoder.</span><span class="r9">                                           </span>  
 <span class="r6">   751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A :py:class:`bytes` object.</span><span class="r9">                                                  </span>  
 <span class="r6">   752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># may pass tuple instead of argument list</span><span class="r9">                                              </span>  
 <span class="r6">   755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(args) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args[</span><span class="r15">0</span><span class="r11">], </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                      </span>  
 <span class="r6">   756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">   757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> encoder_name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;raw&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> args </span><span class="r15">==</span><span class="r11"> ():</span><span class="r9">                                               </span>  
 <span class="r6">   759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                                   </span>  
 <span class="r6">   760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">   762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">width </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">height </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                </span>  
 <span class="r6">   764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r9">                                                                         </span>  
 <span class="r6">   765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># unpack data</span><span class="r9">                                                                          </span>  
 <span class="r6">   767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        e </span><span class="r15">=</span><span class="r11"> _getencoder(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, encoder_name, args)</span><span class="r9">                                         </span>  
 <span class="r6">   768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        e</span><span class="r15">.</span><span class="r11">setimage(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                                                    </span>  
 <span class="r6">   769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">max</span><span class="r11">(</span><span class="r15">65536</span><span class="r11">, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11">)  </span><span class="r14"># see RawEncode.c</span><span class="r9">                              </span>  
 <span class="r6">   771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                              </span>  
 <span class="r6">   773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            l, s, d </span><span class="r15">=</span><span class="r11"> e</span><span class="r15">.</span><span class="r11">encode(bufsize)</span><span class="r9">                                                        </span>  
 <span class="r6">   775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data</span><span class="r15">.</span><span class="r11">append(d)</span><span class="r9">                                                                     </span>  
 <span class="r6">   776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> s:</span><span class="r9">                                                                              </span>  
 <span class="r6">   777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">break</span><span class="r9">                                                                          </span>  
 <span class="r6">   778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> s </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;encoder error </span><span class="r21">{</span><span class="r11">s</span><span class="r21">}</span><span class="r16"> in tobytes&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">RuntimeError</span><span class="r11">(msg)</span><span class="r9">                                                            </span>  
 <span class="r6">   781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r15">.</span><span class="r11">join(data)</span><span class="r9">                                                                  </span>  
 <span class="r6">   783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">tobitmap</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, name</span><span class="r15">=</span><span class="r16">&quot;image&quot;</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">   785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns the image converted to an X11 bitmap.</span><span class="r9">                                          </span>  
 <span class="r6">   787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        .. note:: This method only works for mode &quot;1&quot; images.</span><span class="r9">                                  </span>  
 <span class="r6">   789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param name: The name prefix to use for the bitmap variables.</span><span class="r9">                          </span>  
 <span class="r6">   791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A string containing an X11 bitmap.</span><span class="r9">                                           </span>  
 <span class="r6">   792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :raises ValueError: If the mode is not &quot;1&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">   796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;1&quot;</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;not a bitmap&quot;</span><span class="r9">                                                               </span>  
 <span class="r6">   798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tobytes(</span><span class="r16">&quot;xbm&quot;</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r15">.</span><span class="r11">join(</span><span class="r9">                                                                       </span>  
 <span class="r6">   801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            [</span><span class="r9">                                                                                  </span>  
 <span class="r6">   802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;#define </span><span class="r21">{</span><span class="r11">name</span><span class="r21">}</span><span class="r16">_width </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">]</span><span class="r21">}</span><span class="r25">\n</span><span class="r16">&quot;</span><span class="r15">.</span><span class="r11">encode(</span><span class="r16">&quot;ascii&quot;</span><span class="r11">),</span><span class="r9">                      </span>  
 <span class="r6">   803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;#define </span><span class="r21">{</span><span class="r11">name</span><span class="r21">}</span><span class="r16">_height </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r21">}</span><span class="r25">\n</span><span class="r16">&quot;</span><span class="r15">.</span><span class="r11">encode(</span><span class="r16">&quot;ascii&quot;</span><span class="r11">),</span><span class="r9">                     </span>  
 <span class="r6">   804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;static char </span><span class="r21">{</span><span class="r11">name</span><span class="r21">}</span><span class="r16">_bits[] = </span><span class="r25">{{\n</span><span class="r16">&quot;</span><span class="r15">.</span><span class="r11">encode(</span><span class="r16">&quot;ascii&quot;</span><span class="r11">),</span><span class="r9">                           </span>  
 <span class="r6">   805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                data,</span><span class="r9">                                                                          </span>  
 <span class="r6">   806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">b&quot;};&quot;</span><span class="r11">,</span><span class="r9">                                                                         </span>  
 <span class="r6">   807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ]</span><span class="r9">                                                                                  </span>  
 <span class="r6">   808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">frombytes</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data, decoder_name</span><span class="r15">=</span><span class="r16">&quot;raw&quot;</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                      </span>  
 <span class="r6">   811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Loads this image with pixel data from a bytes object.</span><span class="r9">                                  </span>  
 <span class="r6">   813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method is similar to the :py:func:`~PIL.Image.frombytes` function,</span><span class="r9">                </span>  
 <span class="r6">   815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        but loads data into this image instead of creating a new image object.</span><span class="r9">                 </span>  
 <span class="r6">   816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># may pass tuple instead of argument list</span><span class="r9">                                              </span>  
 <span class="r6">   819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(args) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args[</span><span class="r15">0</span><span class="r11">], </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                      </span>  
 <span class="r6">   820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># default format</span><span class="r9">                                                                       </span>  
 <span class="r6">   823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> decoder_name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;raw&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> args </span><span class="r15">==</span><span class="r11"> ():</span><span class="r9">                                               </span>  
 <span class="r6">   824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                                   </span>  
 <span class="r6">   825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># unpack data</span><span class="r9">                                                                          </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        d </span><span class="r15">=</span><span class="r11"> _getdecoder(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, decoder_name, args)</span><span class="r9">                                         </span>  
 <span class="r6">   828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        d</span><span class="r15">.</span><span class="r11">setimage(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                                                    </span>  
 <span class="r6">   829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> d</span><span class="r15">.</span><span class="r11">decode(data)</span><span class="r9">                                                                     </span>  
 <span class="r6">   830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> s[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;not enough image data&quot;</span><span class="r9">                                                      </span>  
 <span class="r6">   833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> s[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot decode image data&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Allocates storage for the image and loads the pixel data.  In</span><span class="r9">                          </span>  
 <span class="r6">   841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        normal cases, you don&#x27;t need to call this method, since the</span><span class="r9">                            </span>  
 <span class="r6">   842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Image class automatically loads an opened image when it is</span><span class="r9">                             </span>  
 <span class="r6">   843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        accessed for the first time.</span><span class="r9">                                                           </span>  
 <span class="r6">   844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the file associated with the image was opened by Pillow, then this</span><span class="r9">                  </span>  
 <span class="r6">   846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method will close it. The exception to this is if the image has</span><span class="r9">                        </span>  
 <span class="r6">   847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        multiple frames, in which case the file will be left open for seek</span><span class="r9">                     </span>  
 <span class="r6">   848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        operations. See :ref:`file-handling` for more information.</span><span class="r9">                             </span>  
 <span class="r6">   849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An image access object.</span><span class="r9">                                                      </span>  
 <span class="r6">   851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :rtype: :ref:`PixelAccess` or :py:class:`PIL.PyAccess`</span><span class="r9">                                 </span>  
 <span class="r6">   852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">dirty:</span><span class="r9">                        </span>  
 <span class="r6">   854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># realize palette</span><span class="r9">                                                                  </span>  
 <span class="r6">   855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mode, arr </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getdata()</span><span class="r9">                                                 </span>  
 <span class="r6">   856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalette(mode, arr)</span><span class="r9">                                                      </span>  
 <span class="r6">   857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">dirty </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                             </span>  
 <span class="r6">   858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">rawmode </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                        </span>  
 <span class="r6">   859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;transparency&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info </span><span class="r19">and</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">):</span><span class="r9">                           </span>  
 <span class="r6">   860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">], </span><span class="r20">int</span><span class="r11">):</span><span class="r9">                                 </span>  
 <span class="r6">   861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalettealpha(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">], </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                      </span>  
 <span class="r6">   862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalettealphas(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">])</span><span class="r9">                        </span>  
 <span class="r6">   864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                palette_mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> mode</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">&quot;RGBA&quot;</span><span class="r11">) </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r9">                    </span>  
 <span class="r6">   867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> palette_mode</span><span class="r9">                                               </span>  
 <span class="r6">   868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(palette_mode, palette_mode)</span><span class="r9">          </span>  
 <span class="r6">   869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r9">                                                                                       </span>  
 <span class="r6">   871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> cffi </span><span class="r19">and</span><span class="r11"> USE_CFFI_ACCESS:</span><span class="r9">                                                       </span>  
 <span class="r6">   873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess:</span><span class="r9">                                                              </span>  
 <span class="r6">   874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess</span><span class="r9">                                                       </span>  
 <span class="r6">   875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> PyAccess</span><span class="r9">                                                         </span>  
 <span class="r6">   876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess </span><span class="r15">=</span><span class="r11"> PyAccess</span><span class="r15">.</span><span class="r11">new(</span><span class="r20">self</span><span class="r11">, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly)</span><span class="r9">                              </span>  
 <span class="r6">   878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess:</span><span class="r9">                                                              </span>  
 <span class="r6">   879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess</span><span class="r9">                                                       </span>  
 <span class="r6">   880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">pixel_access(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly)</span><span class="r9">                                         </span>  
 <span class="r6">   881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">verify</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Verifies the contents of a file. For data read from a file, this</span><span class="r9">                       </span>  
 <span class="r6">   885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method attempts to determine if the file is broken, without</span><span class="r9">                            </span>  
 <span class="r6">   886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        actually decoding the image data.  If this method finds any</span><span class="r9">                            </span>  
 <span class="r6">   887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        problems, it raises suitable exceptions.  If you need to load</span><span class="r9">                          </span>  
 <span class="r6">   888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the image after using this method, you must reopen the image</span><span class="r9">                           </span>  
 <span class="r6">   889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        file.</span><span class="r9">                                                                                  </span>  
 <span class="r6">   890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">convert</span><span class="r11">(</span><span class="r9">                                                                               </span>  
 <span class="r6">   894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r11">, mode</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, matrix</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, dither</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, palette</span><span class="r15">=</span><span class="r11">Palette</span><span class="r15">.</span><span class="r11">WEB, colors</span><span class="r15">=256</span><span class="r9">             </span>  
 <span class="r6">   895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ):</span><span class="r9">                                                                                         </span>  
 <span class="r6">   896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a converted copy of this image. For the &quot;P&quot; mode, this</span><span class="r9">                         </span>  
 <span class="r6">   898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method translates pixels through the palette.  If mode is</span><span class="r9">                              </span>  
 <span class="r6">   899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        omitted, a mode is chosen so that all information in the image</span><span class="r9">                         </span>  
 <span class="r6">   900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and the palette can be represented without a palette.</span><span class="r9">                                  </span>  
 <span class="r6">   901 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   902 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The current version supports all possible conversions between</span><span class="r9">                          </span>  
 <span class="r6">   903 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;L&quot;, &quot;RGB&quot; and &quot;CMYK&quot;. The ``matrix`` argument only supports &quot;L&quot;</span><span class="r9">                       </span>  
 <span class="r6">   904 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and &quot;RGB&quot;.</span><span class="r9">                                                                             </span>  
 <span class="r6">   905 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   906 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When translating a color image to greyscale (mode &quot;L&quot;),</span><span class="r9">                                </span>  
 <span class="r6">   907 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the library uses the ITU-R 601-2 luma transform::</span><span class="r9">                                      </span>  
 <span class="r6">   908 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   909 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            L = R * 299/1000 + G * 587/1000 + B * 114/1000</span><span class="r9">                                     </span>  
 <span class="r6">   910 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   911 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The default method of converting a greyscale (&quot;L&quot;) or &quot;RGB&quot;</span><span class="r9">                            </span>  
 <span class="r6">   912 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image into a bilevel (mode &quot;1&quot;) image uses Floyd-Steinberg</span><span class="r9">                             </span>  
 <span class="r6">   913 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        dither to approximate the original image luminosity levels. If</span><span class="r9">                         </span>  
 <span class="r6">   914 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        dither is ``None``, all values larger than 127 are set to 255 (white),</span><span class="r9">                 </span>  
 <span class="r6">   915 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        all other values to 0 (black). To use other thresholds, use the</span><span class="r9">                        </span>  
 <span class="r6">   916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :py:meth:`~PIL.Image.Image.point` method.</span><span class="r9">                                              </span>  
 <span class="r6">   917 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   918 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When converting from &quot;RGBA&quot; to &quot;P&quot; without a ``matrix`` argument,</span><span class="r9">                      </span>  
 <span class="r6">   919 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        this passes the operation to :py:meth:`~PIL.Image.Image.quantize`,</span><span class="r9">                     </span>  
 <span class="r6">   920 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and ``dither`` and ``palette`` are ignored.</span><span class="r9">                                            </span>  
 <span class="r6">   921 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   922 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        When converting from &quot;PA&quot;, if an &quot;RGBA&quot; palette is present, the alpha</span><span class="r9">                  </span>  
 <span class="r6">   923 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        channel from the image will be used instead of the values from the palette.</span><span class="r9">            </span>  
 <span class="r6">   924 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   925 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mode: The requested mode. See: :ref:`concept-modes`.</span><span class="r9">                            </span>  
 <span class="r6">   926 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param matrix: An optional conversion matrix.  If given, this</span><span class="r9">                          </span>  
 <span class="r6">   927 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           should be 4- or 12-tuple containing floating point values.</span><span class="r9">                          </span>  
 <span class="r6">   928 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param dither: Dithering method, used when converting from</span><span class="r9">                             </span>  
 <span class="r6">   929 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           mode &quot;RGB&quot; to &quot;P&quot; or from &quot;RGB&quot; or &quot;L&quot; to &quot;1&quot;.</span><span class="r9">                                      </span>  
 <span class="r6">   930 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           Available methods are :data:`Dither.NONE` or :data:`Dither.FLOYDSTEINBERG`</span><span class="r9">          </span>  
 <span class="r6">   931 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (default). Note that this is not used when ``matrix`` is supplied.</span><span class="r9">                  </span>  
 <span class="r6">   932 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param palette: Palette to use when converting from mode &quot;RGB&quot;</span><span class="r9">                         </span>  
 <span class="r6">   933 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           to &quot;P&quot;.  Available palettes are :data:`Palette.WEB` or</span><span class="r9">                              </span>  
 <span class="r6">   934 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :data:`Palette.ADAPTIVE`.</span><span class="r9">                                                           </span>  
 <span class="r6">   935 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param colors: Number of colors to use for the :data:`Palette.ADAPTIVE`</span><span class="r9">                </span>  
 <span class="r6">   936 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           palette. Defaults to 256.</span><span class="r9">                                                           </span>  
 <span class="r6">   937 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :rtype: :py:class:`~PIL.Image.Image`</span><span class="r9">                                                   </span>  
 <span class="r6">   938 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">   939 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   940 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">   941 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   942 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        has_transparency </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;transparency&quot;</span><span class="r11">) </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                           </span>  
 <span class="r6">   943 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> mode </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   944 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># determine default mode</span><span class="r9">                                                           </span>  
 <span class="r6">   945 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette:</span><span class="r9">                                                                   </span>  
 <span class="r6">   946 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                       </span>  
 <span class="r6">   947 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   948 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r9">                                                                   </span>  
 <span class="r6">   949 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> has_transparency:</span><span class="r9">                                             </span>  
 <span class="r6">   950 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r9">                                                                  </span>  
 <span class="r6">   951 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> mode </span><span class="r19">or</span><span class="r11"> (mode </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> matrix):</span><span class="r9">                                     </span>  
 <span class="r6">   952 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># below takes time, but the actual copy operation is measured inside the below copy</span>  
 <span class="r6">   953 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Note: The actual copy (memcpy) happens inside the _imaging shared library C code.</span>  
 <span class="r6">   954 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                 </span>  
 <span class="r6">   955 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   956 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> matrix:</span><span class="r9">                                                                             </span>  
 <span class="r6">   957 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># matrix conversion</span><span class="r9">                                                                </span>  
 <span class="r6">   958 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">   959 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal conversion&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   960 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">   961 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert_matrix(mode, matrix)</span><span class="r9">                                          </span>  
 <span class="r6">   962 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(im)</span><span class="r9">                                                                </span>  
 <span class="r6">   963 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> has_transparency </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands </span><span class="r15">==</span><span class="r11"> </span><span class="r15">3</span><span class="r11">:</span><span class="r9">                                        </span>  
 <span class="r6">   964 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                transparency </span><span class="r15">=</span><span class="r11"> new</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                        </span>  
 <span class="r6">   965 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   966 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">def</span><span class="r11"> </span><span class="r17">convert_transparency</span><span class="r11">(m, v):</span><span class="r9">                                                </span>  
 <span class="r6">   967 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    v </span><span class="r15">=</span><span class="r11"> m[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> v[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> m[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> v[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> m[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> v[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> m[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> </span><span class="r15">0.5</span><span class="r9">                   </span>  
 <span class="r6">   968 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">max</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r20">min</span><span class="r11">(</span><span class="r15">255</span><span class="r11">, </span><span class="r20">int</span><span class="r11">(v)))</span><span class="r9">                                            </span>  
 <span class="r6">   969 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   970 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;L&quot;</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   971 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    transparency </span><span class="r15">=</span><span class="r11"> convert_transparency(matrix, transparency)</span><span class="r9">                  </span>  
 <span class="r6">   972 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(mode) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">3</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">   973 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    transparency </span><span class="r15">=</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(</span><span class="r9">                                                      </span>  
 <span class="r6">   974 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        convert_transparency(matrix[i </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> : i </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">4</span><span class="r11">], transparency)</span><span class="r9">          </span>  
 <span class="r6">   975 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r20">len</span><span class="r11">(transparency))</span><span class="r9">                                   </span>  
 <span class="r6">   976 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    )</span><span class="r9">                                                                          </span>  
 <span class="r6">   977 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> transparency</span><span class="r9">                                        </span>  
 <span class="r6">   978 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> new</span><span class="r9">                                                                         </span>  
 <span class="r6">   979 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   980 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">:</span><span class="r9">                                                </span>  
 <span class="r6">   981 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">quantize(colors)</span><span class="r9">                                                       </span>  
 <span class="r6">   982 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   983 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        trns </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                            </span>  
 <span class="r6">   984 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        delete_trns </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                    </span>  
 <span class="r6">   985 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># transparency handling</span><span class="r9">                                                                </span>  
 <span class="r6">   986 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> has_transparency:</span><span class="r9">                                                                   </span>  
 <span class="r6">   987 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;I&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">)) </span><span class="r19">or</span><span class="r11"> (</span><span class="r9">                  </span>  
 <span class="r6">   988 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   989 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ):</span><span class="r9">                                                                                 </span>  
 <span class="r6">   990 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Use transparent conversion to promote from transparent</span><span class="r9">                       </span>  
 <span class="r6">   991 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># color to an alpha channel.</span><span class="r9">                                                   </span>  
 <span class="r6">   992 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new_im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r9">                                                            </span>  
 <span class="r6">   993 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert_transparent(mode, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">])</span><span class="r9">               </span>  
 <span class="r6">   994 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">   995 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">del</span><span class="r11"> new_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                </span>  
 <span class="r6">   996 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> new_im</span><span class="r9">                                                                  </span>  
 <span class="r6">   997 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">):</span><span class="r9">                 </span>  
 <span class="r6">   998 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                t </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                  </span>  
 <span class="r6">   999 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(t, </span><span class="r20">bytes</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">  1000 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># Dragons. This can&#x27;t be represented by a single color</span><span class="r9">                     </span>  
 <span class="r6">  1001 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                             </span>  
 <span class="r6">  1002 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;Palette images with Transparency expressed in bytes should be &quot;</span><span class="r9">       </span>  
 <span class="r6">  1003 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;converted to RGBA images&quot;</span><span class="r9">                                             </span>  
 <span class="r6">  1004 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    )</span><span class="r9">                                                                          </span>  
 <span class="r6">  1005 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    delete_trns </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                         </span>  
 <span class="r6">  1006 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">  1007 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># get the new transparency color.</span><span class="r9">                                          </span>  
 <span class="r6">  1008 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># use existing conversions</span><span class="r9">                                                 </span>  
 <span class="r6">  1009 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    trns_im </span><span class="r15">=</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">)))</span><span class="r9">                        </span>  
 <span class="r6">  1010 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">  1011 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        trns_im</span><span class="r15">.</span><span class="r11">putpalette(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette)</span><span class="r9">                                       </span>  
 <span class="r6">  1012 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(t, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                               </span>  
 <span class="r6">  1013 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            err </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Couldn&#x27;t allocate a palette color for transparency&quot;</span><span class="r9">         </span>  
 <span class="r6">  1014 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">  1015 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                t </span><span class="r15">=</span><span class="r11"> trns_im</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getcolor(t, </span><span class="r20">self</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">  1016 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                            </span>  
 <span class="r6">  1017 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(e) </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;cannot allocate more than 256 colors&quot;</span><span class="r11">:</span><span class="r9">           </span>  
 <span class="r6">  1018 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r14"># If all 256 colors are in use,</span><span class="r9">                            </span>  
 <span class="r6">  1019 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r14"># then there is no need for transparency</span><span class="r9">                   </span>  
 <span class="r6">  1020 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    t </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                   </span>  
 <span class="r6">  1021 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">  1022 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(err) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                               </span>  
 <span class="r6">  1023 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> t </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  1024 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        trns </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                            </span>  
 <span class="r6">  1025 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1026 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        trns_im</span><span class="r15">.</span><span class="r11">putpixel((</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">), t)</span><span class="r9">                                            </span>  
 <span class="r6">  1027 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1028 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">):</span><span class="r9">                                               </span>  
 <span class="r6">  1029 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            trns_im </span><span class="r15">=</span><span class="r11"> trns_im</span><span class="r15">.</span><span class="r11">convert(mode)</span><span class="r9">                                    </span>  
 <span class="r6">  1030 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">  1031 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># can&#x27;t just retrieve the palette number, got to do it</span><span class="r9">             </span>  
 <span class="r6">  1032 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r14"># after quantization.</span><span class="r9">                                              </span>  
 <span class="r6">  1033 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            trns_im </span><span class="r15">=</span><span class="r11"> trns_im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">)</span><span class="r9">                                   </span>  
 <span class="r6">  1034 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        trns </span><span class="r15">=</span><span class="r11"> trns_im</span><span class="r15">.</span><span class="r11">getpixel((</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">))</span><span class="r9">                                        </span>  
 <span class="r6">  1035 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1036 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">):</span><span class="r9">                            </span>  
 <span class="r6">  1037 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                t </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                  </span>  
 <span class="r6">  1038 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                delete_trns </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                             </span>  
 <span class="r6">  1039 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1040 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(t, </span><span class="r20">bytes</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">  1041 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalettealphas(t)</span><span class="r9">                                                </span>  
 <span class="r6">  1042 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(t, </span><span class="r20">int</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">  1043 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalettealpha(t, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                              </span>  
 <span class="r6">  1044 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">  1045 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Transparency for P mode should be bytes or int&quot;</span><span class="r9">                     </span>  
 <span class="r6">  1046 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                      </span>  
 <span class="r6">  1047 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1048 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> palette </span><span class="r15">==</span><span class="r11"> Palette</span><span class="r15">.</span><span class="r11">ADAPTIVE:</span><span class="r9">                                        </span>  
 <span class="r6">  1049 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">quantize(colors)</span><span class="r9">                                                      </span>  
 <span class="r6">  1050 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(im)</span><span class="r9">                                                                </span>  
 <span class="r6">  1051 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                         </span>  
 <span class="r6">  1052 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1053 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">, new</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">))</span><span class="r9">           </span>  
 <span class="r6">  1054 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> delete_trns:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1055 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># This could possibly happen if we requantize to fewer colors.</span><span class="r9">                 </span>  
 <span class="r6">  1056 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># The transparency would be totally off in that case.</span><span class="r9">                          </span>  
 <span class="r6">  1057 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">del</span><span class="r11"> new</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                   </span>  
 <span class="r6">  1058 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> trns </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">  1059 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1060 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    new</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> new</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getcolor(trns, new)</span><span class="r9">                 </span>  
 <span class="r6">  1061 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  1062 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># if we can&#x27;t make a transparent color, don&#x27;t leave the old</span><span class="r9">                </span>  
 <span class="r6">  1063 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># transparency hanging around to mess us up.</span><span class="r9">                               </span>  
 <span class="r6">  1064 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">del</span><span class="r11"> new</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                               </span>  
 <span class="r6">  1065 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&quot;Couldn&#x27;t allocate palette entry for transparency&quot;</span><span class="r11">)</span><span class="r9">          </span>  
 <span class="r6">  1066 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> new</span><span class="r9">                                                                         </span>  
 <span class="r6">  1067 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1068 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;LAB&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, mode):</span><span class="r9">                                                         </span>  
 <span class="r6">  1069 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            other_mode </span><span class="r15">=</span><span class="r11"> mode </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;LAB&quot;</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                             </span>  
 <span class="r6">  1070 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> other_mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBX&quot;</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">  1071 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageCms</span><span class="r9">                                                         </span>  
 <span class="r6">  1072 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1073 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                srgb </span><span class="r15">=</span><span class="r11"> ImageCms</span><span class="r15">.</span><span class="r11">createProfile(</span><span class="r16">&quot;sRGB&quot;</span><span class="r11">)</span><span class="r9">                                          </span>  
 <span class="r6">  1074 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                lab </span><span class="r15">=</span><span class="r11"> ImageCms</span><span class="r15">.</span><span class="r11">createProfile(</span><span class="r16">&quot;LAB&quot;</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  1075 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                profiles </span><span class="r15">=</span><span class="r11"> [lab, srgb] </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;LAB&quot;</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> [srgb, lab]</span><span class="r9">                  </span>  
 <span class="r6">  1076 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                transform </span><span class="r15">=</span><span class="r11"> ImageCms</span><span class="r15">.</span><span class="r11">buildTransform(</span><span class="r9">                                           </span>  
 <span class="r6">  1077 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    profiles[</span><span class="r15">0</span><span class="r11">], profiles[</span><span class="r15">1</span><span class="r11">], </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, mode</span><span class="r9">                                  </span>  
 <span class="r6">  1078 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  1079 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> transform</span><span class="r15">.</span><span class="r11">apply(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                   </span>  
 <span class="r6">  1080 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1081 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># colorspace conversion</span><span class="r9">                                                                </span>  
 <span class="r6">  1082 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> dither </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  1083 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            dither </span><span class="r15">=</span><span class="r11"> Dither</span><span class="r15">.</span><span class="r11">FLOYDSTEINBERG</span><span class="r9">                                                     </span>  
 <span class="r6">  1084 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1085 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1086 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert(mode, dither)</span><span class="r9">                                                 </span>  
 <span class="r6">  1087 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  1088 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1089 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># normalize source image and try again</span><span class="r9">                                         </span>  
 <span class="r6">  1090 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                modebase </span><span class="r15">=</span><span class="r11"> getmodebase(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                              </span>  
 <span class="r6">  1091 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> modebase </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode:</span><span class="r9">                                                      </span>  
 <span class="r6">  1092 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">raise</span><span class="r9">                                                                      </span>  
 <span class="r6">  1093 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert(modebase)</span><span class="r9">                                                 </span>  
 <span class="r6">  1094 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">convert(mode, dither)</span><span class="r9">                                                  </span>  
 <span class="r6">  1095 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                              </span>  
 <span class="r6">  1096 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal conversion&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">  1097 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                   </span>  
 <span class="r6">  1098 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1099 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new_im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(im)</span><span class="r9">                                                                 </span>  
 <span class="r6">  1100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> palette </span><span class="r15">!=</span><span class="r11"> Palette</span><span class="r15">.</span><span class="r11">ADAPTIVE:</span><span class="r9">                                        </span>  
 <span class="r6">  1101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                         </span>  
 <span class="r6">  1102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new_im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r20">list</span><span class="r11">(</span><span class="r20">range</span><span class="r11">(</span><span class="r15">256</span><span class="r11">)) </span><span class="r15">*</span><span class="r11"> </span><span class="r15">3</span><span class="r11">)</span><span class="r9">            </span>  
 <span class="r6">  1104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> delete_trns:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># crash fail if we leave a bytes transparency in an rgb/l mode.</span><span class="r9">                    </span>  
 <span class="r6">  1106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> new_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                    </span>  
 <span class="r6">  1107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> trns </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> new_im</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  1109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    new_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> new_im</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getcolor(trns, new_im)</span><span class="r9">        </span>  
 <span class="r6">  1111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                        </span>  
 <span class="r6">  1112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">del</span><span class="r11"> new_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                            </span>  
 <span class="r6">  1113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(e) </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;cannot allocate more than 256 colors&quot;</span><span class="r11">:</span><span class="r9">                       </span>  
 <span class="r6">  1114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r14"># If all 256 colors are in use,</span><span class="r9">                                        </span>  
 <span class="r6">  1115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r14"># then there is no need for transparency</span><span class="r9">                               </span>  
 <span class="r6">  1116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                         </span>  
 <span class="r6">  1117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r16">&quot;Couldn&#x27;t allocate palette entry for transparency&quot;</span><span class="r9">                 </span>  
 <span class="r6">  1118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        )</span><span class="r9">                                                                      </span>  
 <span class="r6">  1119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                new_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> trns</span><span class="r9">                                             </span>  
 <span class="r6">  1121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> new_im</span><span class="r9">                                                                          </span>  
 <span class="r6">  1122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">quantize</span><span class="r11">(</span><span class="r9">                                                                              </span>  
 <span class="r6">  1124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r11">,</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        colors</span><span class="r15">=256</span><span class="r11">,</span><span class="r9">                                                                            </span>  
 <span class="r6">  1126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        method</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                           </span>  
 <span class="r6">  1127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        kmeans</span><span class="r15">=0</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">  1128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        palette</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                          </span>  
 <span class="r6">  1129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        dither</span><span class="r15">=</span><span class="r11">Dither</span><span class="r15">.</span><span class="r11">FLOYDSTEINBERG,</span><span class="r9">                                                          </span>  
 <span class="r6">  1130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ):</span><span class="r9">                                                                                         </span>  
 <span class="r6">  1131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Convert the image to &#x27;P&#x27; mode with the specified number</span><span class="r9">                                </span>  
 <span class="r6">  1133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        of colors.</span><span class="r9">                                                                             </span>  
 <span class="r6">  1134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param colors: The desired number of colors, &lt;= 256</span><span class="r9">                                    </span>  
 <span class="r6">  1136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param method: :data:`Quantize.MEDIANCUT` (median cut),</span><span class="r9">                                </span>  
 <span class="r6">  1137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       :data:`Quantize.MAXCOVERAGE` (maximum coverage),</span><span class="r9">                        </span>  
 <span class="r6">  1138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       :data:`Quantize.FASTOCTREE` (fast octree),</span><span class="r9">                              </span>  
 <span class="r6">  1139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       :data:`Quantize.LIBIMAGEQUANT` (libimagequant; check support</span><span class="r9">            </span>  
 <span class="r6">  1140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       using :py:func:`PIL.features.check_feature` with</span><span class="r9">                        </span>  
 <span class="r6">  1141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       ``feature=&quot;libimagequant&quot;``).</span><span class="r9">                                           </span>  
 <span class="r6">  1142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       By default, :data:`Quantize.MEDIANCUT` will be used.</span><span class="r9">                    </span>  
 <span class="r6">  1144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       The exception to this is RGBA images. :data:`Quantize.MEDIANCUT`</span><span class="r9">        </span>  
 <span class="r6">  1146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       and :data:`Quantize.MAXCOVERAGE` do not support RGBA images, so</span><span class="r9">         </span>  
 <span class="r6">  1147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                       :data:`Quantize.FASTOCTREE` is used by default instead.</span><span class="r9">                 </span>  
 <span class="r6">  1148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param kmeans: Integer</span><span class="r9">                                                                 </span>  
 <span class="r6">  1149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param palette: Quantize to the palette of given</span><span class="r9">                                       </span>  
 <span class="r6">  1150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                        :py:class:`PIL.Image.Image`.</span><span class="r9">                                           </span>  
 <span class="r6">  1151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param dither: Dithering method, used when converting from</span><span class="r9">                             </span>  
 <span class="r6">  1152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           mode &quot;RGB&quot; to &quot;P&quot; or from &quot;RGB&quot; or &quot;L&quot; to &quot;1&quot;.</span><span class="r9">                                      </span>  
 <span class="r6">  1153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           Available methods are :data:`Dither.NONE` or :data:`Dither.FLOYDSTEINBERG`</span><span class="r9">          </span>  
 <span class="r6">  1154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (default).</span><span class="r9">                                                                          </span>  
 <span class="r6">  1155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A new image</span><span class="r9">                                                                  </span>  
 <span class="r6">  1156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> method </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  1162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># defaults:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            method </span><span class="r15">=</span><span class="r11"> Quantize</span><span class="r15">.</span><span class="r11">MEDIANCUT</span><span class="r9">                                                        </span>  
 <span class="r6">  1164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">  1165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                method </span><span class="r15">=</span><span class="r11"> Quantize</span><span class="r15">.</span><span class="r11">FASTOCTREE</span><span class="r9">                                                   </span>  
 <span class="r6">  1166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> method </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r9">                                             </span>  
 <span class="r6">  1168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Quantize</span><span class="r15">.</span><span class="r11">FASTOCTREE,</span><span class="r9">                                                               </span>  
 <span class="r6">  1169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Quantize</span><span class="r15">.</span><span class="r11">LIBIMAGEQUANT,</span><span class="r9">                                                            </span>  
 <span class="r6">  1170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">  1171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Caller specified an invalid mode.</span><span class="r9">                                                </span>  
 <span class="r6">  1172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                            </span>  
 <span class="r6">  1173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;Fast Octree (method == 2) and libimagequant (method == 3) &quot;</span><span class="r9">                   </span>  
 <span class="r6">  1174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;are the only valid methods for quantizing RGBA images&quot;</span><span class="r9">                        </span>  
 <span class="r6">  1175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> palette:</span><span class="r9">                                                                            </span>  
 <span class="r6">  1179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># use palette from reference image</span><span class="r9">                                                 </span>  
 <span class="r6">  1180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                     </span>  
 <span class="r6">  1181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> palette</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">  1182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;bad mode for palette image&quot;</span><span class="r9">                                             </span>  
 <span class="r6">  1183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">  1184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;L&quot;</span><span class="r11">:</span><span class="r9">                                        </span>  
 <span class="r6">  1185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;only RGB or L mode images can be quantized to a palette&quot;</span><span class="r9">                </span>  
 <span class="r6">  1186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">  1187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r16">&quot;P&quot;</span><span class="r11">, dither, palette</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                      </span>  
 <span class="r6">  1188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new_im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(im)</span><span class="r9">                                                             </span>  
 <span class="r6">  1189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new_im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> palette</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                            </span>  
 <span class="r6">  1190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> new_im</span><span class="r9">                                                                      </span>  
 <span class="r6">  1191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">quantize(colors, method, kmeans))</span><span class="r9">                               </span>  
 <span class="r6">  1193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                             </span>  
 <span class="r6">  1195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        mode </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalettemode()</span><span class="r9">                                                          </span>  
 <span class="r6">  1197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        palette </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(mode, mode)[: colors </span><span class="r15">*</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(mode)]</span><span class="r9">                           </span>  
 <span class="r6">  1198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(mode, palette)</span><span class="r9">                                  </span>  
 <span class="r6">  1199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                              </span>  
 <span class="r6">  1201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">copy</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">  1203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Copies this image. Use this method if you wish to paste things</span><span class="r9">                         </span>  
 <span class="r6">  1205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        into an image, but still retain the original.</span><span class="r9">                                          </span>  
 <span class="r6">  1206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :rtype: :py:class:`~PIL.Image.Image`</span><span class="r9">                                                   </span>  
 <span class="r6">  1208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  1209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging:</span><span class="r9">                                                                       </span>  
 <span class="r6">  1213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">import</span><span class="r11"> </span><span class="r12">time</span><span class="r9">                                                                        </span>  
 <span class="r6">  1214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r9">                                                                                       </span>  
 <span class="r6">  1215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            start </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                                                </span>  
 <span class="r6">  1216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            _copy_im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                          </span>  
 <span class="r6">  1217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            end </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">log_time[</span><span class="r16">&quot;copy&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                                                </span>  
 <span class="r6">  1220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(_copy_im)</span><span class="r9">                                                         </span>  
 <span class="r6">  1222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">copy())</span><span class="r9">                                                   </span>  
 <span class="r6">  1224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    __copy__ </span><span class="r15">=</span><span class="r11"> copy</span><span class="r9">                                                                            </span>  
 <span class="r6">  1226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">crop</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, box</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                                  </span>  
 <span class="r6">  1228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a rectangular region from this image. The box is a</span><span class="r9">                             </span>  
 <span class="r6">  1230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        4-tuple defining the left, upper, right, and lower pixel</span><span class="r9">                               </span>  
 <span class="r6">  1231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        coordinate. See :ref:`coordinate-system`.</span><span class="r9">                                              </span>  
 <span class="r6">  1232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note: Prior to Pillow 3.4.0, this was a lazy operation.</span><span class="r9">                                </span>  
 <span class="r6">  1234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param box: The crop rectangle, as a (left, upper, right, lower)-tuple.</span><span class="r9">                </span>  
 <span class="r6">  1236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :rtype: :py:class:`~PIL.Image.Image`</span><span class="r9">                                                   </span>  
 <span class="r6">  1237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  1238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">&lt;</span><span class="r11"> box[</span><span class="r15">0</span><span class="r11">]:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Coordinate &#x27;right&#x27; is less than &#x27;left&#x27;&quot;</span><span class="r9">                                     </span>  
 <span class="r6">  1245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">&lt;</span><span class="r11"> box[</span><span class="r15">1</span><span class="r11">]:</span><span class="r9">                                                                  </span>  
 <span class="r6">  1247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Coordinate &#x27;lower&#x27; is less than &#x27;upper&#x27;&quot;</span><span class="r9">                                    </span>  
 <span class="r6">  1248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_crop(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im, box))</span><span class="r9">                                             </span>  
 <span class="r6">  1252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_crop</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, im, box):</span><span class="r9">                                                                  </span>  
 <span class="r6">  1254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a rectangular region from the core image object im.</span><span class="r9">                            </span>  
 <span class="r6">  1256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This is equivalent to calling im.crop((x0, y0, x1, y1)), but</span><span class="r9">                           </span>  
 <span class="r6">  1258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        includes additional sanity checks.</span><span class="r9">                                                     </span>  
 <span class="r6">  1259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param im: a core image object</span><span class="r9">                                                         </span>  
 <span class="r6">  1261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param box: The crop rectangle, as a (left, upper, right, lower)-tuple.</span><span class="r9">                </span>  
 <span class="r6">  1262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A core image object.</span><span class="r9">                                                         </span>  
 <span class="r6">  1263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        x0, y0, x1, y1 </span><span class="r15">=</span><span class="r11"> </span><span class="r20">map</span><span class="r11">(</span><span class="r20">int</span><span class="r11">, </span><span class="r20">map</span><span class="r11">(</span><span class="r20">round</span><span class="r11">, box))</span><span class="r9">                                             </span>  
 <span class="r6">  1266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        absolute_values </span><span class="r15">=</span><span class="r11"> (</span><span class="r20">abs</span><span class="r11">(x1 </span><span class="r15">-</span><span class="r11"> x0), </span><span class="r20">abs</span><span class="r11">(y1 </span><span class="r15">-</span><span class="r11"> y0))</span><span class="r9">                                         </span>  
 <span class="r6">  1268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _decompression_bomb_check(absolute_values)</span><span class="r9">                                             </span>  
 <span class="r6">  1270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">crop((x0, y0, x1, y1))</span><span class="r9">                                                       </span>  
 <span class="r6">  1272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">draft</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mode, size):</span><span class="r9">                                                               </span>  
 <span class="r6">  1274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Configures the image file loader so it returns a version of the</span><span class="r9">                        </span>  
 <span class="r6">  1276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image that as closely as possible matches the given mode and</span><span class="r9">                           </span>  
 <span class="r6">  1277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        size. For example, you can use this method to convert a color</span><span class="r9">                          </span>  
 <span class="r6">  1278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        JPEG to greyscale while loading it.</span><span class="r9">                                                    </span>  
 <span class="r6">  1279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If any changes are made, returns a tuple with the chosen ``mode`` and</span><span class="r9">                  </span>  
 <span class="r6">  1281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        ``box`` with coordinates of the original image within the altered one.</span><span class="r9">                 </span>  
 <span class="r6">  1282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note that this method modifies the :py:class:`~PIL.Image.Image` object</span><span class="r9">                 </span>  
 <span class="r6">  1284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        in place. If the image has already been loaded, this method has no</span><span class="r9">                     </span>  
 <span class="r6">  1285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        effect.</span><span class="r9">                                                                                </span>  
 <span class="r6">  1286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note: This method is not implemented for most images. It is</span><span class="r9">                            </span>  
 <span class="r6">  1288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        currently implemented only for JPEG and MPO images.</span><span class="r9">                                    </span>  
 <span class="r6">  1289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mode: The requested mode.</span><span class="r9">                                                       </span>  
 <span class="r6">  1291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param size: The requested size in pixels, as a 2-tuple:</span><span class="r9">                               </span>  
 <span class="r6">  1292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (width, height).</span><span class="r9">                                                                    </span>  
 <span class="r6">  1293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_expand</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, xmargin, ymargin</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                  </span>  
 <span class="r6">  1297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ymargin </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ymargin </span><span class="r15">=</span><span class="r11"> xmargin</span><span class="r9">                                                                  </span>  
 <span class="r6">  1299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">expand(xmargin, ymargin, </span><span class="r15">0</span><span class="r11">))</span><span class="r9">                                  </span>  
 <span class="r6">  1301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">filter</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r20">filter</span><span class="r11">):</span><span class="r9">                                                                  </span>  
 <span class="r6">  1303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Filters this image using the given filter.  For a list of</span><span class="r9">                              </span>  
 <span class="r6">  1305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        available filters, see the :py:mod:`~PIL.ImageFilter` module.</span><span class="r9">                          </span>  
 <span class="r6">  1306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param filter: Filter kernel.</span><span class="r9">                                                          </span>  
 <span class="r6">  1308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.&quot;&quot;&quot;</span><span class="r9">                                   </span>  
 <span class="r6">  1309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageFilter</span><span class="r9">                                                              </span>  
 <span class="r6">  1311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(</span><span class="r20">filter</span><span class="r11">, Callable):</span><span class="r9">                                                       </span>  
 <span class="r6">  1315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">filter</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r20">filter</span><span class="r11">()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(</span><span class="r20">filter</span><span class="r11">, </span><span class="r16">&quot;filter&quot;</span><span class="r11">):</span><span class="r9">                                                      </span>  
 <span class="r6">  1317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;filter argument should be ImageFilter.Filter instance or class&quot;</span><span class="r9">             </span>  
 <span class="r6">  1318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(msg)</span><span class="r9">                                                               </span>  
 <span class="r6">  1319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        multiband </span><span class="r15">=</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(</span><span class="r20">filter</span><span class="r11">, ImageFilter</span><span class="r15">.</span><span class="r11">MultibandFilter)</span><span class="r9">                            </span>  
 <span class="r6">  1321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> multiband:</span><span class="r9">                                                    </span>  
 <span class="r6">  1322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">filter</span><span class="r15">.</span><span class="r11">filter(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im))</span><span class="r9">                                           </span>  
 <span class="r6">  1323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ims </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                               </span>  
 <span class="r6">  1325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> c </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands):</span><span class="r9">                                                         </span>  
 <span class="r6">  1326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ims</span><span class="r15">.</span><span class="r11">append(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">filter</span><span class="r15">.</span><span class="r11">filter(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getband(c))))</span><span class="r9">                           </span>  
 <span class="r6">  1327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> merge(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, ims)</span><span class="r9">                                                           </span>  
 <span class="r6">  1328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getbands</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  1330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a tuple containing the name of each band in this image.</span><span class="r9">                        </span>  
 <span class="r6">  1332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        For example, ``getbands`` on an RGB image returns (&quot;R&quot;, &quot;G&quot;, &quot;B&quot;).</span><span class="r9">                     </span>  
 <span class="r6">  1333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A tuple containing band names.</span><span class="r9">                                               </span>  
 <span class="r6">  1335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :rtype: tuple</span><span class="r9">                                                                          </span>  
 <span class="r6">  1336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> ImageMode</span><span class="r15">.</span><span class="r11">getmode(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r15">.</span><span class="r11">bands</span><span class="r9">                                              </span>  
 <span class="r6">  1338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getbbox</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  1340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Calculates the bounding box of the non-zero regions in the</span><span class="r9">                             </span>  
 <span class="r6">  1342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image.</span><span class="r9">                                                                                 </span>  
 <span class="r6">  1343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: The bounding box is returned as a 4-tuple defining the</span><span class="r9">                       </span>  
 <span class="r6">  1345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           left, upper, right, and lower pixel coordinate. See</span><span class="r9">                                 </span>  
 <span class="r6">  1346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :ref:`coordinate-system`. If the image is completely empty, this</span><span class="r9">                    </span>  
 <span class="r6">  1347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           method returns None.</span><span class="r9">                                                                </span>  
 <span class="r6">  1348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getbbox()</span><span class="r9">                                                               </span>  
 <span class="r6">  1353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getcolors</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, maxcolors</span><span class="r15">=256</span><span class="r11">):</span><span class="r9">                                                        </span>  
 <span class="r6">  1355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a list of colors used in this image.</span><span class="r9">                                           </span>  
 <span class="r6">  1357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The colors will be in the image&#x27;s mode. For example, an RGB image will</span><span class="r9">                 </span>  
 <span class="r6">  1359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        return a tuple of (red, green, blue) color values, and a P image will</span><span class="r9">                  </span>  
 <span class="r6">  1360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        return the index of the color in the palette.</span><span class="r9">                                          </span>  
 <span class="r6">  1361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param maxcolors: Maximum number of colors.  If this number is</span><span class="r9">                         </span>  
 <span class="r6">  1363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           exceeded, this method returns None.  The default limit is</span><span class="r9">                           </span>  
 <span class="r6">  1364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           256 colors.</span><span class="r9">                                                                         </span>  
 <span class="r6">  1365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An unsorted list of (count, pixel) values.</span><span class="r9">                                   </span>  
 <span class="r6">  1366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">  1370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            h </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">histogram()</span><span class="r9">                                                            </span>  
 <span class="r6">  1371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            out </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                           </span>  
 <span class="r6">  1372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">256</span><span class="r11">):</span><span class="r9">                                                               </span>  
 <span class="r6">  1373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> h[i]:</span><span class="r9">                                                                       </span>  
 <span class="r6">  1374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    out</span><span class="r15">.</span><span class="r11">append((h[i], i))</span><span class="r9">                                                      </span>  
 <span class="r6">  1375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(out) </span><span class="r15">&gt;</span><span class="r11"> maxcolors:</span><span class="r9">                                                           </span>  
 <span class="r6">  1376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                    </span>  
 <span class="r6">  1377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> out</span><span class="r9">                                                                         </span>  
 <span class="r6">  1378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getcolors(maxcolors)</span><span class="r9">                                                    </span>  
 <span class="r6">  1379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getdata</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, band</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">  1381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns the contents of this image as a sequence object</span><span class="r9">                                </span>  
 <span class="r6">  1383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        containing pixel values.  The sequence object is flattened, so</span><span class="r9">                         </span>  
 <span class="r6">  1384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        that values for line one follow directly after the values of</span><span class="r9">                           </span>  
 <span class="r6">  1385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        line zero, and so on.</span><span class="r9">                                                                  </span>  
 <span class="r6">  1386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note that the sequence object returned by this method is an</span><span class="r9">                            </span>  
 <span class="r6">  1388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        internal PIL data type, which only supports certain sequence</span><span class="r9">                           </span>  
 <span class="r6">  1389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        operations.  To convert it to an ordinary sequence (e.g. for</span><span class="r9">                           </span>  
 <span class="r6">  1390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        printing), use ``list(im.getdata())``.</span><span class="r9">                                                 </span>  
 <span class="r6">  1391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param band: What band to return.  The default is to return</span><span class="r9">                            </span>  
 <span class="r6">  1393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           all bands.  To return a single band, pass in the index</span><span class="r9">                              </span>  
 <span class="r6">  1394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           value (e.g. 0 to get the &quot;R&quot; band from an &quot;RGB&quot; image).</span><span class="r9">                             </span>  
 <span class="r6">  1395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A sequence-like object.</span><span class="r9">                                                      </span>  
 <span class="r6">  1396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> band </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getband(band)</span><span class="r9">                                                       </span>  
 <span class="r6">  1401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im  </span><span class="r14"># could be abused</span><span class="r9">                                                      </span>  
 <span class="r6">  1402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getextrema</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">  1404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Gets the minimum and maximum pixel values for each band in</span><span class="r9">                             </span>  
 <span class="r6">  1406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the image.</span><span class="r9">                                                                             </span>  
 <span class="r6">  1407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: For a single-band image, a 2-tuple containing the</span><span class="r9">                            </span>  
 <span class="r6">  1409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           minimum and maximum pixel value.  For a multi-band image,</span><span class="r9">                           </span>  
 <span class="r6">  1410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           a tuple containing one 2-tuple for each band.</span><span class="r9">                                       </span>  
 <span class="r6">  1411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">  1415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            extrema </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                       </span>  
 <span class="r6">  1416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands):</span><span class="r9">                                                     </span>  
 <span class="r6">  1417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                extrema</span><span class="r15">.</span><span class="r11">append(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getband(i)</span><span class="r15">.</span><span class="r11">getextrema())</span><span class="r9">                                </span>  
 <span class="r6">  1418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(extrema)</span><span class="r9">                                                              </span>  
 <span class="r6">  1419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getextrema()</span><span class="r9">                                                            </span>  
 <span class="r6">  1420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_getxmp</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, xmp_tags):</span><span class="r9">                                                               </span>  
 <span class="r6">  1422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_name</span><span class="r11">(tag):</span><span class="r9">                                                                     </span>  
 <span class="r6">  1423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> tag</span><span class="r15">.</span><span class="r11">split(</span><span class="r16">&quot;}&quot;</span><span class="r11">)[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                           </span>  
 <span class="r6">  1424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_value</span><span class="r11">(element):</span><span class="r9">                                                                </span>  
 <span class="r6">  1426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            value </span><span class="r15">=</span><span class="r11"> {get_name(k): v </span><span class="r10">for</span><span class="r11"> k, v </span><span class="r19">in</span><span class="r11"> element</span><span class="r15">.</span><span class="r11">attrib</span><span class="r15">.</span><span class="r11">items()}</span><span class="r9">                        </span>  
 <span class="r6">  1427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            children </span><span class="r15">=</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(element)</span><span class="r9">                                                           </span>  
 <span class="r6">  1428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> children:</span><span class="r9">                                                                       </span>  
 <span class="r6">  1429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> child </span><span class="r19">in</span><span class="r11"> children:</span><span class="r9">                                                         </span>  
 <span class="r6">  1430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    name </span><span class="r15">=</span><span class="r11"> get_name(child</span><span class="r15">.</span><span class="r11">tag)</span><span class="r9">                                                 </span>  
 <span class="r6">  1431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    child_value </span><span class="r15">=</span><span class="r11"> get_value(child)</span><span class="r9">                                             </span>  
 <span class="r6">  1432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> name </span><span class="r19">in</span><span class="r11"> value:</span><span class="r9">                                                          </span>  
 <span class="r6">  1433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value[name], </span><span class="r20">list</span><span class="r11">):</span><span class="r9">                                  </span>  
 <span class="r6">  1434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            value[name] </span><span class="r15">=</span><span class="r11"> [value[name]]</span><span class="r9">                                        </span>  
 <span class="r6">  1435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        value[name]</span><span class="r15">.</span><span class="r11">append(child_value)</span><span class="r9">                                        </span>  
 <span class="r6">  1436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        value[name] </span><span class="r15">=</span><span class="r11"> child_value</span><span class="r9">                                              </span>  
 <span class="r6">  1438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> value:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> element</span><span class="r15">.</span><span class="r11">text:</span><span class="r9">                                                               </span>  
 <span class="r6">  1440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    value[</span><span class="r16">&quot;text&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> element</span><span class="r15">.</span><span class="r11">text</span><span class="r9">                                               </span>  
 <span class="r6">  1441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> element</span><span class="r15">.</span><span class="r11">text</span><span class="r9">                                                            </span>  
 <span class="r6">  1443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> value</span><span class="r9">                                                                       </span>  
 <span class="r6">  1444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ElementTree </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">  1446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">&quot;XMP data cannot be read without defusedxml dependency&quot;</span><span class="r11">)</span><span class="r9">             </span>  
 <span class="r6">  1447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> {}</span><span class="r9">                                                                          </span>  
 <span class="r6">  1448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            root </span><span class="r15">=</span><span class="r11"> ElementTree</span><span class="r15">.</span><span class="r11">fromstring(xmp_tags)</span><span class="r9">                                            </span>  
 <span class="r6">  1450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> {get_name(root</span><span class="r15">.</span><span class="r11">tag): get_value(root)}</span><span class="r9">                                       </span>  
 <span class="r6">  1451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getexif</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  1453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif </span><span class="r15">=</span><span class="r11"> Exif()</span><span class="r9">                                                                </span>  
 <span class="r6">  1455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">_loaded </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                         </span>  
 <span class="r6">  1456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">_loaded:</span><span class="r9">                                                               </span>  
 <span class="r6">  1457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r9">                                                                  </span>  
 <span class="r6">  1458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">_loaded </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                              </span>  
 <span class="r6">  1459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exif_info </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;exif&quot;</span><span class="r11">)</span><span class="r9">                                                      </span>  
 <span class="r6">  1461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> exif_info </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">  1462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;Raw profile type exif&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                           </span>  
 <span class="r6">  1463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                exif_info </span><span class="r15">=</span><span class="r11"> </span><span class="r20">bytes</span><span class="r15">.</span><span class="r11">fromhex(</span><span class="r9">                                                     </span>  
 <span class="r6">  1464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r16">&quot;&quot;</span><span class="r15">.</span><span class="r11">join(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;Raw profile type exif&quot;</span><span class="r11">]</span><span class="r15">.</span><span class="r11">split(</span><span class="r16">&quot;</span><span class="r25">\n</span><span class="r16">&quot;</span><span class="r11">)[</span><span class="r15">3</span><span class="r11">:])</span><span class="r9">                </span>  
 <span class="r6">  1465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  1466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;tag_v2&quot;</span><span class="r11">):</span><span class="r9">                                                      </span>  
 <span class="r6">  1467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">bigtiff </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tag_v2</span><span class="r15">.</span><span class="r11">_bigtiff</span><span class="r9">                                      </span>  
 <span class="r6">  1468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">endian </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tag_v2</span><span class="r15">.</span><span class="r11">_endian</span><span class="r9">                                        </span>  
 <span class="r6">  1469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">load_from_fp(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tag_v2</span><span class="r15">.</span><span class="r11">_offset)</span><span class="r9">                          </span>  
 <span class="r6">  1470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> exif_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  1471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">load(exif_info)</span><span class="r9">                                                         </span>  
 <span class="r6">  1472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># XMP tags</span><span class="r9">                                                                             </span>  
 <span class="r6">  1474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r15">0x0112</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif:</span><span class="r9">                                                           </span>  
 <span class="r6">  1475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            xmp_tags </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;XML:com.adobe.xmp&quot;</span><span class="r11">)</span><span class="r9">                                      </span>  
 <span class="r6">  1476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> xmp_tags:</span><span class="r9">                                                                       </span>  
 <span class="r6">  1477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                match </span><span class="r15">=</span><span class="r11"> re</span><span class="r15">.</span><span class="r11">search(</span><span class="r16">r&#x27;tiff:Orientation(=&quot;|&gt;)([0-9])&#x27;</span><span class="r11">, xmp_tags)</span><span class="r9">                  </span>  
 <span class="r6">  1478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> match:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif[</span><span class="r15">0x0112</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">int</span><span class="r11">(match[</span><span class="r15">2</span><span class="r11">])</span><span class="r9">                                         </span>  
 <span class="r6">  1480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r9">                                                                      </span>  
 <span class="r6">  1482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_reload_exif</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">  1484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">_loaded:</span><span class="r9">                                       </span>  
 <span class="r6">  1485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  1486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif</span><span class="r15">.</span><span class="r11">_loaded </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                             </span>  
 <span class="r6">  1487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getexif()</span><span class="r9">                                                                         </span>  
 <span class="r6">  1488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_child_images</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">  1490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        child_images </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                      </span>  
 <span class="r6">  1491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exif </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getexif()</span><span class="r9">                                                                  </span>  
 <span class="r6">  1492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ifds </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                              </span>  
 <span class="r6">  1493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">Base</span><span class="r15">.</span><span class="r11">SubIFDs </span><span class="r19">in</span><span class="r11"> exif:</span><span class="r9">                                                      </span>  
 <span class="r6">  1494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            subifd_offsets </span><span class="r15">=</span><span class="r11"> exif[ExifTags</span><span class="r15">.</span><span class="r11">Base</span><span class="r15">.</span><span class="r11">SubIFDs]</span><span class="r9">                                       </span>  
 <span class="r6">  1495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> subifd_offsets:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(subifd_offsets, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                      </span>  
 <span class="r6">  1497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    subifd_offsets </span><span class="r15">=</span><span class="r11"> (subifd_offsets,)</span><span class="r9">                                         </span>  
 <span class="r6">  1498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> subifd_offset </span><span class="r19">in</span><span class="r11"> subifd_offsets:</span><span class="r9">                                           </span>  
 <span class="r6">  1499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    ifds</span><span class="r15">.</span><span class="r11">append((exif</span><span class="r15">.</span><span class="r11">_get_ifd_dict(subifd_offset), subifd_offset))</span><span class="r9">            </span>  
 <span class="r6">  1500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ifd1 </span><span class="r15">=</span><span class="r11"> exif</span><span class="r15">.</span><span class="r11">get_ifd(ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">IFD1)</span><span class="r9">                                                 </span>  
 <span class="r6">  1501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ifd1 </span><span class="r19">and</span><span class="r11"> ifd1</span><span class="r15">.</span><span class="r11">get(</span><span class="r15">513</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">  1502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ifds</span><span class="r15">.</span><span class="r11">append((ifd1, exif</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">next))</span><span class="r9">                                               </span>  
 <span class="r6">  1503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        offset </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                          </span>  
 <span class="r6">  1505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> ifd, ifd_offset </span><span class="r19">in</span><span class="r11"> ifds:</span><span class="r9">                                                           </span>  
 <span class="r6">  1506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            current_offset </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">tell()</span><span class="r9">                                                    </span>  
 <span class="r6">  1507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> offset </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">=</span><span class="r11"> current_offset</span><span class="r9">                                                        </span>  
 <span class="r6">  1509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            fp </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r9">                                                                       </span>  
 <span class="r6">  1511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            thumbnail_offset </span><span class="r15">=</span><span class="r11"> ifd</span><span class="r15">.</span><span class="r11">get(</span><span class="r15">513</span><span class="r11">)</span><span class="r9">                                                    </span>  
 <span class="r6">  1512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> thumbnail_offset </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                   </span>  
 <span class="r6">  1513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    thumbnail_offset </span><span class="r15">+=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif_offset</span><span class="r9">                                      </span>  
 <span class="r6">  1515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                         </span>  
 <span class="r6">  1516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">  1517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(thumbnail_offset)</span><span class="r9">                                                 </span>  
 <span class="r6">  1518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(ifd</span><span class="r15">.</span><span class="r11">get(</span><span class="r15">514</span><span class="r11">))</span><span class="r9">                                              </span>  
 <span class="r6">  1519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fp </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(data)</span><span class="r9">                                                          </span>  
 <span class="r6">  1520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> </span><span class="r20">open</span><span class="r11">(fp) </span><span class="r10">as</span><span class="r11"> im:</span><span class="r9">                                                               </span>  
 <span class="r6">  1522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> thumbnail_offset </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                   </span>  
 <span class="r6">  1523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im</span><span class="r15">.</span><span class="r11">_frame_pos </span><span class="r15">=</span><span class="r11"> [ifd_offset]</span><span class="r9">                                               </span>  
 <span class="r6">  1524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im</span><span class="r15">.</span><span class="r11">_seek(</span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                </span>  
 <span class="r6">  1525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                im</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                      </span>  
 <span class="r6">  1526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                child_images</span><span class="r15">.</span><span class="r11">append(im)</span><span class="r9">                                                        </span>  
 <span class="r6">  1527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> offset </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                                               </span>  
 <span class="r6">  1530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> child_images</span><span class="r9">                                                                    </span>  
 <span class="r6">  1531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getim</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">  1533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a capsule that points to the internal image memory.</span><span class="r9">                            </span>  
 <span class="r6">  1535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A capsule object.</span><span class="r9">                                                            </span>  
 <span class="r6">  1537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">ptr</span><span class="r9">                                                                     </span>  
 <span class="r6">  1541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getpalette</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, rawmode</span><span class="r15">=</span><span class="r16">&quot;RGB&quot;</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">  1543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns the image palette as a list.</span><span class="r9">                                                   </span>  
 <span class="r6">  1545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param rawmode: The mode in which to return the palette. ``None`` will</span><span class="r9">                 </span>  
 <span class="r6">  1547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           return the palette in its current mode.</span><span class="r9">                                             </span>  
 <span class="r6">  1548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           .. versionadded:: 9.1.0</span><span class="r9">                                                             </span>  
 <span class="r6">  1550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A list of color values [r, g, b, ...], or None if the</span><span class="r9">                        </span>  
 <span class="r6">  1552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           image has no palette.</span><span class="r9">                                                               </span>  
 <span class="r6">  1553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalettemode()</span><span class="r9">                                                    </span>  
 <span class="r6">  1558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  1559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r11">  </span><span class="r14"># no palette</span><span class="r9">                                                          </span>  
 <span class="r6">  1560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> rawmode </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rawmode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                     </span>  
 <span class="r6">  1562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(mode, rawmode))</span><span class="r9">                                         </span>  
 <span class="r6">  1563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">apply_transparency</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">  1565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If a P mode image has a &quot;transparency&quot; key in the info dictionary,</span><span class="r9">                     </span>  
 <span class="r6">  1567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        remove the key and instead apply the transparency to the palette.</span><span class="r9">                      </span>  
 <span class="r6">  1568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Otherwise, the image is unchanged.</span><span class="r9">                                                     </span>  
 <span class="r6">  1569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r16">&quot;transparency&quot;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                </span>  
 <span class="r6">  1571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  1572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                             </span>  
 <span class="r6">  1574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getpalette(</span><span class="r16">&quot;RGBA&quot;</span><span class="r11">)</span><span class="r9">                                                      </span>  
 <span class="r6">  1576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        transparency </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                               </span>  
 <span class="r6">  1577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(transparency, </span><span class="r20">bytes</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">  1578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> i, alpha </span><span class="r19">in</span><span class="r11"> </span><span class="r20">enumerate</span><span class="r11">(transparency):</span><span class="r9">                                           </span>  
 <span class="r6">  1579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                palette[i </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">3</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> alpha</span><span class="r9">                                                     </span>  
 <span class="r6">  1580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette[transparency </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">3</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                  </span>  
 <span class="r6">  1582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(</span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r20">bytes</span><span class="r11">(palette))</span><span class="r9">                       </span>  
 <span class="r6">  1583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">dirty </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                 </span>  
 <span class="r6">  1584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                                          </span>  
 <span class="r6">  1586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getpixel</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, xy):</span><span class="r9">                                                                    </span>  
 <span class="r6">  1588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns the pixel value at a given position.</span><span class="r9">                                           </span>  
 <span class="r6">  1590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param xy: The coordinate, given as (x, y). See</span><span class="r9">                                        </span>  
 <span class="r6">  1592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :ref:`coordinate-system`.</span><span class="r9">                                                           </span>  
 <span class="r6">  1593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: The pixel value.  If the image is a multi-layer image,</span><span class="r9">                       </span>  
 <span class="r6">  1594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           this method returns a tuple.</span><span class="r9">                                                        </span>  
 <span class="r6">  1595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess</span><span class="r15">.</span><span class="r11">getpixel(xy)</span><span class="r9">                                                  </span>  
 <span class="r6">  1600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpixel(xy)</span><span class="r9">                                                            </span>  
 <span class="r6">  1601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getprojection</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">  1603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Get projection to x and y axes</span><span class="r9">                                                         </span>  
 <span class="r6">  1605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: Two sequences, indicating where there are non-zero</span><span class="r9">                           </span>  
 <span class="r6">  1607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            pixels along the X-axis and the Y-axis, respectively.</span><span class="r9">                              </span>  
 <span class="r6">  1608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        x, y </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getprojection()</span><span class="r9">                                                         </span>  
 <span class="r6">  1612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(x), </span><span class="r20">list</span><span class="r11">(y)</span><span class="r9">                                                                </span>  
 <span class="r6">  1613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">histogram</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mask</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, extrema</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">  1615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a histogram for the image. The histogram is returned as a</span><span class="r9">                      </span>  
 <span class="r6">  1617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        list of pixel counts, one for each pixel value in the source</span><span class="r9">                           </span>  
 <span class="r6">  1618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image. Counts are grouped into 256 bins for each band, even if</span><span class="r9">                         </span>  
 <span class="r6">  1619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the image has more than 8 bits per band. If the image has more</span><span class="r9">                         </span>  
 <span class="r6">  1620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        than one band, the histograms for all bands are concatenated (for</span><span class="r9">                      </span>  
 <span class="r6">  1621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        example, the histogram for an &quot;RGB&quot; image contains 768 values).</span><span class="r9">                        </span>  
 <span class="r6">  1622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        A bilevel image (mode &quot;1&quot;) is treated as a greyscale (&quot;L&quot;) image</span><span class="r9">                       </span>  
 <span class="r6">  1624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        by this method.</span><span class="r9">                                                                        </span>  
 <span class="r6">  1625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If a mask is provided, the method returns a histogram for those</span><span class="r9">                        </span>  
 <span class="r6">  1627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        parts of the image where the mask image is non-zero. The mask</span><span class="r9">                          </span>  
 <span class="r6">  1628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image must have the same size as the image, and be either a</span><span class="r9">                            </span>  
 <span class="r6">  1629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        bi-level image (mode &quot;1&quot;) or a greyscale image (&quot;L&quot;).</span><span class="r9">                                  </span>  
 <span class="r6">  1630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mask: An optional mask.</span><span class="r9">                                                         </span>  
 <span class="r6">  1632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param extrema: An optional tuple of manually-specified extrema.</span><span class="r9">                       </span>  
 <span class="r6">  1633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A list containing pixel counts.</span><span class="r9">                                              </span>  
 <span class="r6">  1634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mask:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mask</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                        </span>  
 <span class="r6">  1638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">histogram((</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">), mask</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                          </span>  
 <span class="r6">  1639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">  1640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> extrema </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">  1641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                extrema </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getextrema()</span><span class="r9">                                                    </span>  
 <span class="r6">  1642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">histogram(extrema)</span><span class="r9">                                                  </span>  
 <span class="r6">  1643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">histogram()</span><span class="r9">                                                             </span>  
 <span class="r6">  1644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">entropy</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mask</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, extrema</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                </span>  
 <span class="r6">  1646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Calculates and returns the entropy for the image.</span><span class="r9">                                      </span>  
 <span class="r6">  1648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        A bilevel image (mode &quot;1&quot;) is treated as a greyscale (&quot;L&quot;)</span><span class="r9">                             </span>  
 <span class="r6">  1650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image by this method.</span><span class="r9">                                                                  </span>  
 <span class="r6">  1651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If a mask is provided, the method employs the histogram for</span><span class="r9">                            </span>  
 <span class="r6">  1653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        those parts of the image where the mask image is non-zero.</span><span class="r9">                             </span>  
 <span class="r6">  1654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The mask image must have the same size as the image, and be</span><span class="r9">                            </span>  
 <span class="r6">  1655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        either a bi-level image (mode &quot;1&quot;) or a greyscale image (&quot;L&quot;).</span><span class="r9">                         </span>  
 <span class="r6">  1656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mask: An optional mask.</span><span class="r9">                                                         </span>  
 <span class="r6">  1658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param extrema: An optional tuple of manually-specified extrema.</span><span class="r9">                       </span>  
 <span class="r6">  1659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A float value representing the image entropy</span><span class="r9">                                 </span>  
 <span class="r6">  1660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mask:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mask</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                        </span>  
 <span class="r6">  1664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">entropy((</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">), mask</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                            </span>  
 <span class="r6">  1665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">  1666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> extrema </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">  1667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                extrema </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getextrema()</span><span class="r9">                                                    </span>  
 <span class="r6">  1668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">entropy(extrema)</span><span class="r9">                                                    </span>  
 <span class="r6">  1669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">entropy()</span><span class="r9">                                                               </span>  
 <span class="r6">  1670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">paste</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, im, box</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, mask</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                  </span>  
 <span class="r6">  1672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Pastes another image into this image. The box argument is either</span><span class="r9">                       </span>  
 <span class="r6">  1674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        a 2-tuple giving the upper left corner, a 4-tuple defining the</span><span class="r9">                         </span>  
 <span class="r6">  1675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        left, upper, right, and lower pixel coordinate, or None (same as</span><span class="r9">                       </span>  
 <span class="r6">  1676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (0, 0)). See :ref:`coordinate-system`. If a 4-tuple is given, the size</span><span class="r9">                 </span>  
 <span class="r6">  1677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        of the pasted image must match the size of the region.</span><span class="r9">                                 </span>  
 <span class="r6">  1678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the modes don&#x27;t match, the pasted image is converted to the mode of</span><span class="r9">                 </span>  
 <span class="r6">  1680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        this image (see the :py:meth:`~PIL.Image.Image.convert` method for</span><span class="r9">                     </span>  
 <span class="r6">  1681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        details).</span><span class="r9">                                                                              </span>  
 <span class="r6">  1682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Instead of an image, the source can be a integer or tuple</span><span class="r9">                              </span>  
 <span class="r6">  1684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        containing pixel values.  The method then fills the region</span><span class="r9">                             </span>  
 <span class="r6">  1685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        with the given color.  When creating RGB images, you can</span><span class="r9">                               </span>  
 <span class="r6">  1686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        also use color strings as supported by the ImageColor module.</span><span class="r9">                          </span>  
 <span class="r6">  1687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If a mask is given, this method updates only the regions</span><span class="r9">                               </span>  
 <span class="r6">  1689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        indicated by the mask. You can use either &quot;1&quot;, &quot;L&quot;, &quot;LA&quot;, &quot;RGBA&quot;</span><span class="r9">                       </span>  
 <span class="r6">  1690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        or &quot;RGBa&quot; images (if present, the alpha band is used as mask).</span><span class="r9">                         </span>  
 <span class="r6">  1691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Where the mask is 255, the given image is copied as is.  Where</span><span class="r9">                         </span>  
 <span class="r6">  1692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the mask is 0, the current value is preserved.  Intermediate</span><span class="r9">                           </span>  
 <span class="r6">  1693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        values will mix the two images together, including their alpha</span><span class="r9">                         </span>  
 <span class="r6">  1694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        channels if they have them.</span><span class="r9">                                                            </span>  
 <span class="r6">  1695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        See :py:meth:`~PIL.Image.Image.alpha_composite` if you want to</span><span class="r9">                         </span>  
 <span class="r6">  1697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        combine images with respect to their alpha channels.</span><span class="r9">                                   </span>  
 <span class="r6">  1698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param im: Source image or pixel value (integer or tuple).</span><span class="r9">                             </span>  
 <span class="r6">  1700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param box: An optional 4-tuple giving the region to paste into.</span><span class="r9">                       </span>  
 <span class="r6">  1701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If a 2-tuple is used instead, it&#x27;s treated as the upper left</span><span class="r9">                        </span>  
 <span class="r6">  1702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           corner.  If omitted or None, the source is pasted into the</span><span class="r9">                          </span>  
 <span class="r6">  1703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           upper left corner.</span><span class="r9">                                                                  </span>  
 <span class="r6">  1704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If an image is given as the second argument and there is no</span><span class="r9">                         </span>  
 <span class="r6">  1706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           third, the box defaults to (0, 0), and the second argument</span><span class="r9">                          </span>  
 <span class="r6">  1707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           is interpreted as a mask image.</span><span class="r9">                                                     </span>  
 <span class="r6">  1708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mask: An optional mask image.</span><span class="r9">                                                   </span>  
 <span class="r6">  1709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> isImageType(box) </span><span class="r19">and</span><span class="r11"> mask </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                  </span>  
 <span class="r6">  1712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># abbreviated paste(im, mask) syntax</span><span class="r9">                                               </span>  
 <span class="r6">  1713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mask </span><span class="r15">=</span><span class="r11"> box</span><span class="r9">                                                                         </span>  
 <span class="r6">  1714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">  1715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                       </span>  
 <span class="r6">  1718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(box) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">2</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># upper left corner given; get size from image or mask</span><span class="r9">                             </span>  
 <span class="r6">  1721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> isImageType(im):</span><span class="r9">                                                                </span>  
 <span class="r6">  1722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                size </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                                 </span>  
 <span class="r6">  1723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> isImageType(mask):</span><span class="r9">                                                            </span>  
 <span class="r6">  1724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                size </span><span class="r15">=</span><span class="r11"> mask</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                               </span>  
 <span class="r6">  1725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># FIXME: use self.size here?</span><span class="r9">                                                   </span>  
 <span class="r6">  1727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot determine region size; use 4-item box&quot;</span><span class="r9">                           </span>  
 <span class="r6">  1728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">  1729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">+=</span><span class="r11"> (box[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">], box[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">])</span><span class="r9">                                        </span>  
 <span class="r6">  1730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(im, </span><span class="r20">str</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">  1732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageColor</span><span class="r9">                                                           </span>  
 <span class="r6">  1733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> ImageColor</span><span class="r15">.</span><span class="r11">getcolor(im, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                            </span>  
 <span class="r6">  1735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> isImageType(im):</span><span class="r9">                                                                  </span>  
 <span class="r6">  1737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                          </span>  
 <span class="r6">  1738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode:</span><span class="r9">                                                           </span>  
 <span class="r6">  1739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBa&quot;</span><span class="r11">):</span><span class="r9">                </span>  
 <span class="r6">  1740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># should use an adapter for this!</span><span class="r9">                                          </span>  
 <span class="r6">  1741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                                 </span>  
 <span class="r6">  1742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">im</span><span class="r9">                                                                         </span>  
 <span class="r6">  1743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ensure_mutable()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mask:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mask</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                        </span>  
 <span class="r6">  1748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">paste(im, box, mask</span><span class="r15">.</span><span class="r11">im)</span><span class="r9">                                                    </span>  
 <span class="r6">  1749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">paste(im, box)</span><span class="r9">                                                             </span>  
 <span class="r6">  1751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">alpha_composite</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, im, dest</span><span class="r15">=</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">), source</span><span class="r15">=</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">)):</span><span class="r9">                                 </span>  
 <span class="r6">  1753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;&#x27;In-place&#x27; analog of Image.alpha_composite. Composites an image</span><span class="r9">                     </span>  
 <span class="r6">  1754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        onto this image.</span><span class="r9">                                                                       </span>  
 <span class="r6">  1755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param im: image to composite over this one</span><span class="r9">                                            </span>  
 <span class="r6">  1757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param dest: Optional 2 tuple (left, top) specifying the upper</span><span class="r9">                         </span>  
 <span class="r6">  1758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          left corner in this (destination) image.</span><span class="r9">                                             </span>  
 <span class="r6">  1759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param source: Optional 2 (left, top) tuple for the upper left</span><span class="r9">                         </span>  
 <span class="r6">  1760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          corner in the overlay source image, or 4 tuple (left, top, right,</span><span class="r9">                    </span>  
 <span class="r6">  1761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          bottom) for the bounds of the source rectangle</span><span class="r9">                                       </span>  
 <span class="r6">  1762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Performance Note: Not currently implemented in-place in the core layer.</span><span class="r9">                </span>  
 <span class="r6">  1764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(source, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)):</span><span class="r9">                                              </span>  
 <span class="r6">  1767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Source must be a tuple&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">  1768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(dest, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)):</span><span class="r9">                                                </span>  
 <span class="r6">  1770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Destination must be a tuple&quot;</span><span class="r9">                                                </span>  
 <span class="r6">  1771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(source) </span><span class="r19">in</span><span class="r11"> (</span><span class="r15">2</span><span class="r11">, </span><span class="r15">4</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">  1773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Source must be a 2 or 4-tuple&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  1774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(dest) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">2</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  1776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Destination must be a 2-tuple&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  1777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(source) </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  1779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Source must be non-negative&quot;</span><span class="r9">                                                </span>  
 <span class="r6">  1780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(source) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">2</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            source </span><span class="r15">=</span><span class="r11"> source </span><span class="r15">+</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                          </span>  
 <span class="r6">  1784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># over image, crop if it&#x27;s not the whole thing.</span><span class="r9">                                        </span>  
 <span class="r6">  1786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> source </span><span class="r15">==</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">                                                         </span>  
 <span class="r6">  1787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            overlay </span><span class="r15">=</span><span class="r11"> im</span><span class="r9">                                                                       </span>  
 <span class="r6">  1788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            overlay </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">crop(source)</span><span class="r9">                                                          </span>  
 <span class="r6">  1790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># target for the paste</span><span class="r9">                                                                 </span>  
 <span class="r6">  1792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        box </span><span class="r15">=</span><span class="r11"> dest </span><span class="r15">+</span><span class="r11"> (dest[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> overlay</span><span class="r15">.</span><span class="r11">width, dest[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> overlay</span><span class="r15">.</span><span class="r11">height)</span><span class="r9">                       </span>  
 <span class="r6">  1793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># destination image. don&#x27;t copy if we&#x27;re using the whole image.</span><span class="r9">                        </span>  
 <span class="r6">  1795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r15">==</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">                                                          </span>  
 <span class="r6">  1796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            background </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                                  </span>  
 <span class="r6">  1797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            background </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">crop(box)</span><span class="r9">                                                        </span>  
 <span class="r6">  1799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        result </span><span class="r15">=</span><span class="r11"> alpha_composite(background, overlay)</span><span class="r9">                                          </span>  
 <span class="r6">  1801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">paste(result, box)</span><span class="r9">                                                                </span>  
 <span class="r6">  1802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">point</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, lut, mode</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">  1804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Maps this image through a lookup table or function.</span><span class="r9">                                    </span>  
 <span class="r6">  1806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param lut: A lookup table, containing 256 (or 65536 if</span><span class="r9">                                </span>  
 <span class="r6">  1808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           self.mode==&quot;I&quot; and mode == &quot;L&quot;) values per band in the</span><span class="r9">                              </span>  
 <span class="r6">  1809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           image.  A function can be used instead, it should take a</span><span class="r9">                            </span>  
 <span class="r6">  1810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           single argument. The function is called once for each</span><span class="r9">                               </span>  
 <span class="r6">  1811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           possible pixel value, and the resulting table is applied to</span><span class="r9">                         </span>  
 <span class="r6">  1812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           all bands of the image.</span><span class="r9">                                                             </span>  
 <span class="r6">  1813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           It may also be an :py:class:`~PIL.Image.ImagePointHandler`</span><span class="r9">                          </span>  
 <span class="r6">  1815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           object::</span><span class="r9">                                                                            </span>  
 <span class="r6">  1816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">               class Example(Image.ImagePointHandler):</span><span class="r9">                                         </span>  
 <span class="r6">  1818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                 def point(self, data):</span><span class="r9">                                                        </span>  
 <span class="r6">  1819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                   # Return result</span><span class="r9">                                                             </span>  
 <span class="r6">  1820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param mode: Output mode (default is same as input).  In the</span><span class="r9">                           </span>  
 <span class="r6">  1821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           current version, this can only be used if the source image</span><span class="r9">                          </span>  
 <span class="r6">  1822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           has mode &quot;L&quot; or &quot;P&quot;, and the output has mode &quot;1&quot; or the</span><span class="r9">                             </span>  
 <span class="r6">  1823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           source image mode is &quot;I&quot; and the output mode is &quot;L&quot;.</span><span class="r9">                                </span>  
 <span class="r6">  1824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  1825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(lut, ImagePointHandler):</span><span class="r9">                                                 </span>  
 <span class="r6">  1830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> lut</span><span class="r15">.</span><span class="r11">point(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">  1831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">callable</span><span class="r11">(lut):</span><span class="r9">                                                                      </span>  
 <span class="r6">  1833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># if it isn&#x27;t a list, it should be a function</span><span class="r9">                                      </span>  
 <span class="r6">  1834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">):</span><span class="r9">                                                </span>  
 <span class="r6">  1835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># check if the function can be used with point_transform</span><span class="r9">                       </span>  
 <span class="r6">  1836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># UNDONE wiredfool -- I think this prevents us from ever doing</span><span class="r9">                 </span>  
 <span class="r6">  1837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># a gamma function point transform on &gt; 8bit images.</span><span class="r9">                           </span>  
 <span class="r6">  1838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                scale, offset </span><span class="r15">=</span><span class="r11"> _getscaleoffset(lut)</span><span class="r9">                                           </span>  
 <span class="r6">  1839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">point_transform(scale, offset))</span><span class="r9">                       </span>  
 <span class="r6">  1840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># for other modes, convert the function to a table</span><span class="r9">                                 </span>  
 <span class="r6">  1841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lut </span><span class="r15">=</span><span class="r11"> [lut(i) </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">256</span><span class="r11">)] </span><span class="r15">*</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands</span><span class="r9">                                 </span>  
 <span class="r6">  1842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;F&quot;</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  1844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># FIXME: _imaging returns a confusing error message for this case</span><span class="r9">                  </span>  
 <span class="r6">  1845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;point operation not supported for this mode&quot;</span><span class="r9">                                </span>  
 <span class="r6">  1846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;F&quot;</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  1849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            lut </span><span class="r15">=</span><span class="r11"> [</span><span class="r20">round</span><span class="r11">(i) </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> lut]</span><span class="r9">                                                      </span>  
 <span class="r6">  1850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">point(lut, mode))</span><span class="r9">                                             </span>  
 <span class="r6">  1851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">putalpha</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, alpha):</span><span class="r9">                                                                 </span>  
 <span class="r6">  1853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Adds or replaces the alpha layer in this image.  If the image</span><span class="r9">                          </span>  
 <span class="r6">  1855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        does not have an alpha layer, it&#x27;s converted to &quot;LA&quot; or &quot;RGBA&quot;.</span><span class="r9">                        </span>  
 <span class="r6">  1856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The new layer must be either &quot;L&quot; or &quot;1&quot;.</span><span class="r9">                                               </span>  
 <span class="r6">  1857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param alpha: The new alpha layer.  This can either be an &quot;L&quot; or &quot;1&quot;</span><span class="r9">                   </span>  
 <span class="r6">  1859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           image having the same size as this image, or an integer or</span><span class="r9">                          </span>  
 <span class="r6">  1860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           other color value.</span><span class="r9">                                                                  </span>  
 <span class="r6">  1861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ensure_mutable()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">):</span><span class="r9">                                              </span>  
 <span class="r6">  1866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># attempt to promote self to a matching alpha mode</span><span class="r9">                                 </span>  
 <span class="r6">  1867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                mode </span><span class="r15">=</span><span class="r11"> getmodebase(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode) </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;A&quot;</span><span class="r9">                                            </span>  
 <span class="r6">  1869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  1870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">setmode(mode)</span><span class="r9">                                                      </span>  
 <span class="r6">  1871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, </span><span class="r13">ValueError</span><span class="r11">) </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                      </span>  
 <span class="r6">  1872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># do things the hard way</span><span class="r9">                                                   </span>  
 <span class="r6">  1873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">convert(mode)</span><span class="r9">                                                 </span>  
 <span class="r6">  1874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">  1875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r11">  </span><span class="r14"># sanity check</span><span class="r9">                                </span>  
 <span class="r6">  1876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> im</span><span class="r9">                                                               </span>  
 <span class="r6">  1877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                           </span>  
 <span class="r6">  1878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                       </span>  
 <span class="r6">  1879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                              </span>  
 <span class="r6">  1880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal image mode&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">  1881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                   </span>  
 <span class="r6">  1882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">  1884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            band </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                           </span>  
 <span class="r6">  1885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            band </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                           </span>  
 <span class="r6">  1887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> isImageType(alpha):</span><span class="r9">                                                                 </span>  
 <span class="r6">  1889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># alpha layer</span><span class="r9">                                                                      </span>  
 <span class="r6">  1890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> alpha</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">):</span><span class="r9">                                                   </span>  
 <span class="r6">  1891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal image mode&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">  1892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">  1893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            alpha</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                       </span>  
 <span class="r6">  1894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> alpha</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;1&quot;</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  1895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                alpha </span><span class="r15">=</span><span class="r11"> alpha</span><span class="r15">.</span><span class="r11">convert(</span><span class="r16">&quot;L&quot;</span><span class="r11">)</span><span class="r9">                                                     </span>  
 <span class="r6">  1896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># constant alpha</span><span class="r9">                                                                   </span>  
 <span class="r6">  1898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  1899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">fillband(band, alpha)</span><span class="r9">                                                  </span>  
 <span class="r6">  1900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, </span><span class="r13">ValueError</span><span class="r11">):</span><span class="r9">                                               </span>  
 <span class="r6">  1901 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># do things the hard way</span><span class="r9">                                                       </span>  
 <span class="r6">  1902 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                alpha </span><span class="r15">=</span><span class="r11"> new(</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size, alpha)</span><span class="r9">                                             </span>  
 <span class="r6">  1903 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  1904 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">  1905 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1906 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putband(alpha</span><span class="r15">.</span><span class="r11">im, band)</span><span class="r9">                                                        </span>  
 <span class="r6">  1907 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1908 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">putdata</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data, scale</span><span class="r15">=1.0</span><span class="r11">, offset</span><span class="r15">=0.0</span><span class="r11">):</span><span class="r9">                                            </span>  
 <span class="r6">  1909 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1910 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Copies pixel data from a flattened sequence object into the image. The</span><span class="r9">                 </span>  
 <span class="r6">  1911 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        values should start at the upper left corner (0, 0), continue to the</span><span class="r9">                   </span>  
 <span class="r6">  1912 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        end of the line, followed directly by the first value of the second</span><span class="r9">                    </span>  
 <span class="r6">  1913 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        line, and so on. Data will be read until either the image or the</span><span class="r9">                       </span>  
 <span class="r6">  1914 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        sequence ends. The scale and offset values are used to adjust the</span><span class="r9">                      </span>  
 <span class="r6">  1915 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        sequence values: **pixel = value*scale + offset**.</span><span class="r9">                                     </span>  
 <span class="r6">  1916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1917 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param data: A flattened sequence object.</span><span class="r9">                                              </span>  
 <span class="r6">  1918 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param scale: An optional scale value.  The default is 1.0.</span><span class="r9">                            </span>  
 <span class="r6">  1919 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param offset: An optional offset value.  The default is 0.0.</span><span class="r9">                          </span>  
 <span class="r6">  1920 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1921 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1922 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ensure_mutable()</span><span class="r9">                                                                 </span>  
 <span class="r6">  1923 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1924 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putdata(data, scale, offset)</span><span class="r9">                                                   </span>  
 <span class="r6">  1925 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1926 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">putpalette</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data, rawmode</span><span class="r15">=</span><span class="r16">&quot;RGB&quot;</span><span class="r11">):</span><span class="r9">                                                 </span>  
 <span class="r6">  1927 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1928 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Attaches a palette to this image.  The image must be a &quot;P&quot;, &quot;PA&quot;, &quot;L&quot;</span><span class="r9">                  </span>  
 <span class="r6">  1929 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        or &quot;LA&quot; image.</span><span class="r9">                                                                         </span>  
 <span class="r6">  1930 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1931 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The palette sequence must contain at most 256 colors, made up of one</span><span class="r9">                   </span>  
 <span class="r6">  1932 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        integer value for each channel in the raw mode.</span><span class="r9">                                        </span>  
 <span class="r6">  1933 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        For example, if the raw mode is &quot;RGB&quot;, then it can contain at most 768</span><span class="r9">                 </span>  
 <span class="r6">  1934 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        values, made up of red, green and blue values for the corresponding pixel</span><span class="r9">              </span>  
 <span class="r6">  1935 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        index in the 256 colors.</span><span class="r9">                                                               </span>  
 <span class="r6">  1936 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the raw mode is &quot;RGBA&quot;, then it can contain at most 1024 values,</span><span class="r9">                    </span>  
 <span class="r6">  1937 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        containing red, green, blue and alpha values.</span><span class="r9">                                          </span>  
 <span class="r6">  1938 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1939 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Alternatively, an 8-bit string may be used instead of an integer sequence.</span><span class="r9">             </span>  
 <span class="r6">  1940 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1941 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param data: A palette sequence (either a list or a string).</span><span class="r9">                           </span>  
 <span class="r6">  1942 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param rawmode: The raw mode of the palette. Either &quot;RGB&quot;, &quot;RGBA&quot;, or a mode</span><span class="r9">           </span>  
 <span class="r6">  1943 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           that can be transformed to &quot;RGB&quot; or &quot;RGBA&quot; (e.g. &quot;R&quot;, &quot;BGR;15&quot;, &quot;RGBA;L&quot;).</span><span class="r9">          </span>  
 <span class="r6">  1944 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1945 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                             </span>  
 <span class="r6">  1946 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1947 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">):</span><span class="r9">                                            </span>  
 <span class="r6">  1948 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal image mode&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">  1949 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  1950 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(data, ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette):</span><span class="r9">                                        </span>  
 <span class="r6">  1951 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">raw(data</span><span class="r15">.</span><span class="r11">rawmode, data</span><span class="r15">.</span><span class="r11">palette)</span><span class="r9">                             </span>  
 <span class="r6">  1952 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  1953 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(data, </span><span class="r20">bytes</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">  1954 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">bytes</span><span class="r11">(data)</span><span class="r9">                                                             </span>  
 <span class="r6">  1955 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">raw(rawmode, data)</span><span class="r9">                                          </span>  
 <span class="r6">  1956 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;PA&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;A&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r9">                                          </span>  
 <span class="r6">  1957 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> palette</span><span class="r9">                                                                 </span>  
 <span class="r6">  1958 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r9">                                                              </span>  
 <span class="r6">  1959 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()  </span><span class="r14"># install new palette</span><span class="r9">                                                     </span>  
 <span class="r6">  1960 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1961 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">putpixel</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, xy, value):</span><span class="r9">                                                             </span>  
 <span class="r6">  1962 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1963 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Modifies the pixel at the given position. The color is given as</span><span class="r9">                        </span>  
 <span class="r6">  1964 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        a single numerical value for single-band images, and a tuple for</span><span class="r9">                       </span>  
 <span class="r6">  1965 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        multi-band images. In addition to this, RGB and RGBA tuples are</span><span class="r9">                        </span>  
 <span class="r6">  1966 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        accepted for P and PA images.</span><span class="r9">                                                          </span>  
 <span class="r6">  1967 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1968 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note that this method is relatively slow.  For more extensive changes,</span><span class="r9">                 </span>  
 <span class="r6">  1969 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        use :py:meth:`~PIL.Image.Image.paste` or the :py:mod:`~PIL.ImageDraw`</span><span class="r9">                  </span>  
 <span class="r6">  1970 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        module instead.</span><span class="r9">                                                                        </span>  
 <span class="r6">  1971 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1972 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        See:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1973 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1974 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        * :py:meth:`~PIL.Image.Image.paste`</span><span class="r9">                                                    </span>  
 <span class="r6">  1975 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        * :py:meth:`~PIL.Image.Image.putdata`</span><span class="r9">                                                  </span>  
 <span class="r6">  1976 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        * :py:mod:`~PIL.ImageDraw`</span><span class="r9">                                                             </span>  
 <span class="r6">  1977 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1978 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param xy: The pixel coordinate, given as (x, y). See</span><span class="r9">                                  </span>  
 <span class="r6">  1979 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :ref:`coordinate-system`.</span><span class="r9">                                                           </span>  
 <span class="r6">  1980 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param value: The pixel value.</span><span class="r9">                                                         </span>  
 <span class="r6">  1981 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1982 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1983 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1984 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_copy()</span><span class="r9">                                                                       </span>  
 <span class="r6">  1985 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  1986 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1987 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess:</span><span class="r9">                                                                      </span>  
 <span class="r6">  1988 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess</span><span class="r15">.</span><span class="r11">putpixel(xy, value)</span><span class="r9">                                           </span>  
 <span class="r6">  1989 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  1990 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> (</span><span class="r9">                                                                                   </span>  
 <span class="r6">  1991 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;PA&quot;</span><span class="r11">)</span><span class="r9">                                                           </span>  
 <span class="r6">  1992 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">))</span><span class="r9">                                               </span>  
 <span class="r6">  1993 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">and</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(value) </span><span class="r19">in</span><span class="r11"> [</span><span class="r15">3</span><span class="r11">, </span><span class="r15">4</span><span class="r11">]</span><span class="r9">                                                           </span>  
 <span class="r6">  1994 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">  1995 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># RGB or RGBA value for a P or PA image</span><span class="r9">                                            </span>  
 <span class="r6">  1996 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;PA&quot;</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  1997 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                alpha </span><span class="r15">=</span><span class="r11"> value[</span><span class="r15">3</span><span class="r11">] </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(value) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r15">255</span><span class="r9">                                   </span>  
 <span class="r6">  1998 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                value </span><span class="r15">=</span><span class="r11"> value[:</span><span class="r15">3</span><span class="r11">]</span><span class="r9">                                                              </span>  
 <span class="r6">  1999 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            value </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getcolor(value, </span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                         </span>  
 <span class="r6">  2000 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;PA&quot;</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  2001 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                value </span><span class="r15">=</span><span class="r11"> (value, alpha)</span><span class="r9">                                                         </span>  
 <span class="r6">  2002 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpixel(xy, value)</span><span class="r9">                                                     </span>  
 <span class="r6">  2003 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2004 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">remap_palette</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, dest_map, source_palette</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                    </span>  
 <span class="r6">  2005 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2006 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Rewrites the image to reorder the palette.</span><span class="r9">                                             </span>  
 <span class="r6">  2007 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2008 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param dest_map: A list of indexes into the original palette.</span><span class="r9">                          </span>  
 <span class="r6">  2009 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           e.g. ``[1,0]`` would swap a two item palette, and ``list(range(256))``</span><span class="r9">              </span>  
 <span class="r6">  2010 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           is the identity transform.</span><span class="r9">                                                          </span>  
 <span class="r6">  2011 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param source_palette: Bytes or None.</span><span class="r9">                                                  </span>  
 <span class="r6">  2012 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns:  An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                     </span>  
 <span class="r6">  2013 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2014 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2015 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                             </span>  
 <span class="r6">  2016 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2017 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">):</span><span class="r9">                                                        </span>  
 <span class="r6">  2018 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;illegal image mode&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">  2019 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2020 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2021 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        bands </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                              </span>  
 <span class="r6">  2022 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        palette_mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r9">                                                                   </span>  
 <span class="r6">  2023 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> source_palette </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  2024 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">  2025 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                    </span>  
 <span class="r6">  2026 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                palette_mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalettemode()</span><span class="r9">                                        </span>  
 <span class="r6">  2027 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> palette_mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">:</span><span class="r9">                                                     </span>  
 <span class="r6">  2028 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    bands </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                  </span>  
 <span class="r6">  2029 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                source_palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(palette_mode, palette_mode)</span><span class="r9">                </span>  
 <span class="r6">  2030 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:  </span><span class="r14"># L-mode</span><span class="r9">                                                                    </span>  
 <span class="r6">  2031 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                source_palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">bytearray</span><span class="r11">(i </span><span class="r15">//</span><span class="r11"> </span><span class="r15">3</span><span class="r11"> </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">768</span><span class="r11">))</span><span class="r9">                         </span>  
 <span class="r6">  2032 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2033 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        palette_bytes </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r9">                                                                    </span>  
 <span class="r6">  2034 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        new_positions </span><span class="r15">=</span><span class="r11"> [</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> </span><span class="r15">256</span><span class="r9">                                                              </span>  
 <span class="r6">  2035 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2036 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># pick only the used colors from the palette</span><span class="r9">                                           </span>  
 <span class="r6">  2037 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> i, oldPosition </span><span class="r19">in</span><span class="r11"> </span><span class="r20">enumerate</span><span class="r11">(dest_map):</span><span class="r9">                                             </span>  
 <span class="r6">  2038 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette_bytes </span><span class="r15">+=</span><span class="r11"> source_palette[</span><span class="r9">                                                   </span>  
 <span class="r6">  2039 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                oldPosition </span><span class="r15">*</span><span class="r11"> bands : oldPosition </span><span class="r15">*</span><span class="r11"> bands </span><span class="r15">+</span><span class="r11"> bands</span><span class="r9">                              </span>  
 <span class="r6">  2040 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ]</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2041 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            new_positions[oldPosition] </span><span class="r15">=</span><span class="r11"> i</span><span class="r9">                                                     </span>  
 <span class="r6">  2042 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2043 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># replace the palette color id of all pixel with the new id</span><span class="r9">                            </span>  
 <span class="r6">  2044 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2045 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Palette images are [0..255], mapped through a 1 or 3</span><span class="r9">                                 </span>  
 <span class="r6">  2046 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># byte/color map.  We need to remap the whole image</span><span class="r9">                                    </span>  
 <span class="r6">  2047 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># from palette 1 to palette 2. New_positions is</span><span class="r9">                                        </span>  
 <span class="r6">  2048 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># an array of indexes into palette 1.  Palette 2 is</span><span class="r9">                                    </span>  
 <span class="r6">  2049 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># palette 1 with any holes removed.</span><span class="r9">                                                    </span>  
 <span class="r6">  2050 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2051 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># We&#x27;re going to leverage the convert mechanism to use the</span><span class="r9">                             </span>  
 <span class="r6">  2052 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># C code to remap the image from palette 1 to palette 2,</span><span class="r9">                               </span>  
 <span class="r6">  2053 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># by forcing the source image into &#x27;L&#x27; mode and adding a</span><span class="r9">                               </span>  
 <span class="r6">  2054 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># mapping &#x27;L&#x27; mode palette, then converting back to &#x27;L&#x27;</span><span class="r9">                                </span>  
 <span class="r6">  2055 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># sans palette thus converting the image bytes, then</span><span class="r9">                                   </span>  
 <span class="r6">  2056 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># assigning the optimized RGB palette.</span><span class="r9">                                                 </span>  
 <span class="r6">  2057 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2058 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># perf reference, 9500x4000 gif, w/~135 colors</span><span class="r9">                                         </span>  
 <span class="r6">  2059 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># 14 sec prepatch, 1 sec postpatch with optimization forced.</span><span class="r9">                           </span>  
 <span class="r6">  2060 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2061 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        mapping_palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">bytearray</span><span class="r11">(new_positions)</span><span class="r9">                                             </span>  
 <span class="r6">  2062 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2063 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                     </span>  
 <span class="r6">  2064 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r9">                                                                        </span>  
 <span class="r6">  2065 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2066 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(</span><span class="r9">                                              </span>  
 <span class="r6">  2067 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            palette_mode, palette</span><span class="r15">=</span><span class="r11">mapping_palette </span><span class="r15">*</span><span class="r11"> bands</span><span class="r9">                                      </span>  
 <span class="r6">  2068 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  2069 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># possibly set palette dirty, then</span><span class="r9">                                                     </span>  
 <span class="r6">  2070 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># m_im.putpalette(mapping_palette, &#x27;L&#x27;)  # converts to &#x27;P&#x27;</span><span class="r9">                             </span>  
 <span class="r6">  2071 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># or just force it.</span><span class="r9">                                                                    </span>  
 <span class="r6">  2072 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># UNDONE -- this is part of the general issue with palettes</span><span class="r9">                            </span>  
 <span class="r6">  2073 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">putpalette(palette_mode </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;;L&quot;</span><span class="r11">, m_im</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">tobytes())</span><span class="r9">                        </span>  
 <span class="r6">  2074 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2075 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im </span><span class="r15">=</span><span class="r11"> m_im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r16">&quot;L&quot;</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">  2076 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2077 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im</span><span class="r15">.</span><span class="r11">putpalette(palette_bytes, palette_mode)</span><span class="r9">                                           </span>  
 <span class="r6">  2078 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        m_im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(palette_mode, palette</span><span class="r15">=</span><span class="r11">palette_bytes)</span><span class="r9">          </span>  
 <span class="r6">  2079 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2080 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;transparency&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                                        </span>  
 <span class="r6">  2081 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  2082 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                m_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> dest_map</span><span class="r15">.</span><span class="r11">index(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">])</span><span class="r9">          </span>  
 <span class="r6">  2083 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  2084 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;transparency&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> m_im</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                                </span>  
 <span class="r6">  2085 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">del</span><span class="r11"> m_im</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;transparency&quot;</span><span class="r11">]</span><span class="r9">                                              </span>  
 <span class="r6">  2086 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2087 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> m_im</span><span class="r9">                                                                            </span>  
 <span class="r6">  2088 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2089 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_get_safe_box</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, size, resample, box):</span><span class="r9">                                              </span>  
 <span class="r6">  2090 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Expands the box so it includes adjacent pixels</span><span class="r9">                                      </span>  
 <span class="r6">  2091 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        that may be used by resampling with the given resampling filter.</span><span class="r9">                       </span>  
 <span class="r6">  2092 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2093 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        filter_support </span><span class="r15">=</span><span class="r11"> _filters_support[resample] </span><span class="r15">-</span><span class="r11"> </span><span class="r15">0.5</span><span class="r9">                                      </span>  
 <span class="r6">  2094 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        scale_x </span><span class="r15">=</span><span class="r11"> (box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">0</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                  </span>  
 <span class="r6">  2095 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        scale_y </span><span class="r15">=</span><span class="r11"> (box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">1</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                  </span>  
 <span class="r6">  2096 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        support_x </span><span class="r15">=</span><span class="r11"> filter_support </span><span class="r15">*</span><span class="r11"> scale_x</span><span class="r9">                                                   </span>  
 <span class="r6">  2097 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        support_y </span><span class="r15">=</span><span class="r11"> filter_support </span><span class="r15">*</span><span class="r11"> scale_y</span><span class="r9">                                                   </span>  
 <span class="r6">  2098 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2099 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> (</span><span class="r9">                                                                               </span>  
 <span class="r6">  2100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">max</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r20">int</span><span class="r11">(box[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> support_x)),</span><span class="r9">                                                   </span>  
 <span class="r6">  2101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">max</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r20">int</span><span class="r11">(box[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> support_y)),</span><span class="r9">                                                   </span>  
 <span class="r6">  2102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">min</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">], math</span><span class="r15">.</span><span class="r11">ceil(box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> support_x)),</span><span class="r9">                                  </span>  
 <span class="r6">  2103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">min</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">], math</span><span class="r15">.</span><span class="r11">ceil(box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> support_y)),</span><span class="r9">                                  </span>  
 <span class="r6">  2104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  2105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">resize</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, size, resample</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, box</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, reducing_gap</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                        </span>  
 <span class="r6">  2107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a resized copy of this image.</span><span class="r9">                                                  </span>  
 <span class="r6">  2109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param size: The requested size in pixels, as a 2-tuple:</span><span class="r9">                               </span>  
 <span class="r6">  2111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (width, height).</span><span class="r9">                                                                    </span>  
 <span class="r6">  2112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param resample: An optional resampling filter.  This can be</span><span class="r9">                           </span>  
 <span class="r6">  2113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           one of :py:data:`Resampling.NEAREST`, :py:data:`Resampling.BOX`,</span><span class="r9">                    </span>  
 <span class="r6">  2114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BILINEAR`, :py:data:`Resampling.HAMMING`,</span><span class="r9">                      </span>  
 <span class="r6">  2115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BICUBIC` or :py:data:`Resampling.LANCZOS`.</span><span class="r9">                     </span>  
 <span class="r6">  2116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If the image has mode &quot;1&quot; or &quot;P&quot;, it is always set to</span><span class="r9">                               </span>  
 <span class="r6">  2117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.NEAREST`. If the image mode specifies a number</span><span class="r9">                 </span>  
 <span class="r6">  2118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           of bits, such as &quot;I;16&quot;, then the default filter is</span><span class="r9">                                 </span>  
 <span class="r6">  2119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.NEAREST`. Otherwise, the default filter is</span><span class="r9">                     </span>  
 <span class="r6">  2120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BICUBIC`. See: :ref:`concept-filters`.</span><span class="r9">                         </span>  
 <span class="r6">  2121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param box: An optional 4-tuple of floats providing</span><span class="r9">                                    </span>  
 <span class="r6">  2122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the source image region to be scaled.</span><span class="r9">                                               </span>  
 <span class="r6">  2123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The values must be within (0, 0, width, height) rectangle.</span><span class="r9">                          </span>  
 <span class="r6">  2124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If omitted or None, the entire source is used.</span><span class="r9">                                      </span>  
 <span class="r6">  2125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param reducing_gap: Apply optimization by resizing the image</span><span class="r9">                          </span>  
 <span class="r6">  2126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           in two steps. First, reducing the image by integer times</span><span class="r9">                            </span>  
 <span class="r6">  2127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           using :py:meth:`~PIL.Image.Image.reduce`.</span><span class="r9">                                           </span>  
 <span class="r6">  2128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           Second, resizing using regular resampling. The last step</span><span class="r9">                            </span>  
 <span class="r6">  2129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           changes size no less than by ``reducing_gap`` times.</span><span class="r9">                                </span>  
 <span class="r6">  2130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           ``reducing_gap`` may be None (no first step is performed)</span><span class="r9">                           </span>  
 <span class="r6">  2131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           or should be greater than 1.0. The bigger ``reducing_gap``,</span><span class="r9">                         </span>  
 <span class="r6">  2132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the closer the result to the fair resampling.</span><span class="r9">                                       </span>  
 <span class="r6">  2133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The smaller ``reducing_gap``, the faster resizing.</span><span class="r9">                                  </span>  
 <span class="r6">  2134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           With ``reducing_gap`` greater or equal to 3.0, the result is</span><span class="r9">                        </span>  
 <span class="r6">  2135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           indistinguishable from fair resampling in most cases.</span><span class="r9">                               </span>  
 <span class="r6">  2136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The default value is None (no optimization).</span><span class="r9">                                        </span>  
 <span class="r6">  2137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  2138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> resample </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  2141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            type_special </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;;&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                    </span>  
 <span class="r6">  2142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            resample </span><span class="r15">=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST </span><span class="r10">if</span><span class="r11"> type_special </span><span class="r10">else</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">BICUBIC</span><span class="r9">              </span>  
 <span class="r6">  2143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> resample </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r9">                                                                 </span>  
 <span class="r6">  2144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">NEAREST,</span><span class="r9">                                                                </span>  
 <span class="r6">  2145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">BILINEAR,</span><span class="r9">                                                               </span>  
 <span class="r6">  2146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">BICUBIC,</span><span class="r9">                                                                </span>  
 <span class="r6">  2147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">LANCZOS,</span><span class="r9">                                                                </span>  
 <span class="r6">  2148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">BOX,</span><span class="r9">                                                                    </span>  
 <span class="r6">  2149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">HAMMING,</span><span class="r9">                                                                </span>  
 <span class="r6">  2150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">  2151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;Unknown resampling filter (</span><span class="r21">{</span><span class="r11">resample</span><span class="r21">}</span><span class="r16">).&quot;</span><span class="r9">                                   </span>  
 <span class="r6">  2152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filters </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                        </span>  
 <span class="r6">  2154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r20">filter</span><span class="r11">[</span><span class="r15">1</span><span class="r11">]</span><span class="r21">}</span><span class="r16"> (</span><span class="r21">{</span><span class="r20">filter</span><span class="r11">[</span><span class="r15">0</span><span class="r11">]</span><span class="r21">}</span><span class="r16">)&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">  2155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> </span><span class="r20">filter</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r9">                                                                </span>  
 <span class="r6">  2156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">NEAREST, </span><span class="r16">&quot;Image.Resampling.NEAREST&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">LANCZOS, </span><span class="r16">&quot;Image.Resampling.LANCZOS&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">BILINEAR, </span><span class="r16">&quot;Image.Resampling.BILINEAR&quot;</span><span class="r11">),</span><span class="r9">                        </span>  
 <span class="r6">  2159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">BICUBIC, </span><span class="r16">&quot;Image.Resampling.BICUBIC&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">BOX, </span><span class="r16">&quot;Image.Resampling.BOX&quot;</span><span class="r11">),</span><span class="r9">                                  </span>  
 <span class="r6">  2161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">HAMMING, </span><span class="r16">&quot;Image.Resampling.HAMMING&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ]</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot; Use &quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;, &quot;</span><span class="r15">.</span><span class="r11">join(filters[:</span><span class="r15">-1</span><span class="r11">]) </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot; or &quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> filters[</span><span class="r15">-1</span><span class="r11">]</span><span class="r9">                    </span>  
 <span class="r6">  2165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reducing_gap </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> reducing_gap </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">1.0</span><span class="r11">:</span><span class="r9">                                    </span>  
 <span class="r6">  2168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;reducing_gap must be 1.0 or greater&quot;</span><span class="r9">                                        </span>  
 <span class="r6">  2169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        size </span><span class="r15">=</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(size)</span><span class="r9">                                                                     </span>  
 <span class="r6">  2172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  2175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                           </span>  
 <span class="r6">  2176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(box)</span><span class="r9">                                                                   </span>  
 <span class="r6">  2178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size </span><span class="r15">==</span><span class="r11"> size </span><span class="r19">and</span><span class="r11"> box </span><span class="r15">==</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">                                    </span>  
 <span class="r6">  2180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                 </span>  
 <span class="r6">  2181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">  2183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            resample </span><span class="r15">=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST</span><span class="r9">                                                      </span>  
 <span class="r6">  2184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> [</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">] </span><span class="r19">and</span><span class="r11"> resample </span><span class="r15">!=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST:</span><span class="r9">                     </span>  
 <span class="r6">  2186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">convert({</span><span class="r16">&quot;LA&quot;</span><span class="r11">: </span><span class="r16">&quot;La&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">: </span><span class="r16">&quot;RGBa&quot;</span><span class="r11">}[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode])</span><span class="r9">                         </span>  
 <span class="r6">  2187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">resize(size, resample, box)</span><span class="r9">                                                </span>  
 <span class="r6">  2188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                                       </span>  
 <span class="r6">  2189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reducing_gap </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> resample </span><span class="r15">!=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST:</span><span class="r9">                        </span>  
 <span class="r6">  2193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            factor_x </span><span class="r15">=</span><span class="r11"> </span><span class="r20">int</span><span class="r11">((box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">0</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">/</span><span class="r11"> reducing_gap) </span><span class="r19">or</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                    </span>  
 <span class="r6">  2194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            factor_y </span><span class="r15">=</span><span class="r11"> </span><span class="r20">int</span><span class="r11">((box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">1</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">/</span><span class="r11"> reducing_gap) </span><span class="r19">or</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                    </span>  
 <span class="r6">  2195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> factor_x </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> factor_y </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                   </span>  
 <span class="r6">  2196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                reduce_box </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_safe_box(size, resample, box)</span><span class="r9">                           </span>  
 <span class="r6">  2197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                factor </span><span class="r15">=</span><span class="r11"> (factor_x, factor_y)</span><span class="r9">                                                  </span>  
 <span class="r6">  2198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">callable</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">reduce):</span><span class="r9">                                                      </span>  
 <span class="r6">  2199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">reduce(factor, box</span><span class="r15">=</span><span class="r11">reduce_box)</span><span class="r9">                                 </span>  
 <span class="r6">  2200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">  2201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">reduce(</span><span class="r20">self</span><span class="r11">, factor, box</span><span class="r15">=</span><span class="r11">reduce_box)</span><span class="r9">                          </span>  
 <span class="r6">  2202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                box </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                        </span>  
 <span class="r6">  2203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (box[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> reduce_box[</span><span class="r15">0</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> factor_x,</span><span class="r9">                                       </span>  
 <span class="r6">  2204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (box[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> reduce_box[</span><span class="r15">1</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> factor_y,</span><span class="r9">                                       </span>  
 <span class="r6">  2205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> reduce_box[</span><span class="r15">0</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> factor_x,</span><span class="r9">                                       </span>  
 <span class="r6">  2206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> reduce_box[</span><span class="r15">1</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> factor_y,</span><span class="r9">                                       </span>  
 <span class="r6">  2207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">resize(size, resample, box))</span><span class="r9">                                  </span>  
 <span class="r6">  2210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">reduce</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, factor, box</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                        </span>  
 <span class="r6">  2212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a copy of the image reduced ``factor`` times.</span><span class="r9">                                  </span>  
 <span class="r6">  2214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If the size of the image is not dividable by ``factor``,</span><span class="r9">                               </span>  
 <span class="r6">  2215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the resulting size will be rounded up.</span><span class="r9">                                                 </span>  
 <span class="r6">  2216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param factor: A greater than 0 integer or tuple of two integers</span><span class="r9">                       </span>  
 <span class="r6">  2218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           for width and height separately.</span><span class="r9">                                                    </span>  
 <span class="r6">  2219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param box: An optional 4-tuple of ints providing</span><span class="r9">                                      </span>  
 <span class="r6">  2220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the source image region to be reduced.</span><span class="r9">                                              </span>  
 <span class="r6">  2221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The values must be within ``(0, 0, width, height)`` rectangle.</span><span class="r9">                      </span>  
 <span class="r6">  2222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If omitted or ``None``, the entire source is used.</span><span class="r9">                                  </span>  
 <span class="r6">  2223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(factor, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)):</span><span class="r9">                                              </span>  
 <span class="r6">  2225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            factor </span><span class="r15">=</span><span class="r11"> (factor, factor)</span><span class="r9">                                                          </span>  
 <span class="r6">  2226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  2228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                           </span>  
 <span class="r6">  2229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            box </span><span class="r15">=</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(box)</span><span class="r9">                                                                   </span>  
 <span class="r6">  2231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> factor </span><span class="r15">==</span><span class="r11"> (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> box </span><span class="r15">==</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">                                     </span>  
 <span class="r6">  2233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                 </span>  
 <span class="r6">  2234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> [</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">]:</span><span class="r9">                                                        </span>  
 <span class="r6">  2236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">convert({</span><span class="r16">&quot;LA&quot;</span><span class="r11">: </span><span class="r16">&quot;La&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">: </span><span class="r16">&quot;RGBa&quot;</span><span class="r11">}[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode])</span><span class="r9">                         </span>  
 <span class="r6">  2237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">reduce(factor, box)</span><span class="r9">                                                        </span>  
 <span class="r6">  2238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">convert(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                                       </span>  
 <span class="r6">  2239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">reduce(factor, box))</span><span class="r9">                                          </span>  
 <span class="r6">  2243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">rotate</span><span class="r11">(</span><span class="r9">                                                                                </span>  
 <span class="r6">  2245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r11">,</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        angle,</span><span class="r9">                                                                                 </span>  
 <span class="r6">  2247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        resample</span><span class="r15">=</span><span class="r11">Resampling</span><span class="r15">.</span><span class="r11">NEAREST,</span><span class="r9">                                                           </span>  
 <span class="r6">  2248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        expand</span><span class="r15">=0</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">  2249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        center</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                           </span>  
 <span class="r6">  2250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        translate</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                        </span>  
 <span class="r6">  2251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fillcolor</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                        </span>  
 <span class="r6">  2252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ):</span><span class="r9">                                                                                         </span>  
 <span class="r6">  2253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a rotated copy of this image.  This method returns a</span><span class="r9">                           </span>  
 <span class="r6">  2255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        copy of this image, rotated the given number of degrees counter</span><span class="r9">                        </span>  
 <span class="r6">  2256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        clockwise around its centre.</span><span class="r9">                                                           </span>  
 <span class="r6">  2257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param angle: In degrees counter clockwise.</span><span class="r9">                                            </span>  
 <span class="r6">  2259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param resample: An optional resampling filter.  This can be</span><span class="r9">                           </span>  
 <span class="r6">  2260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           one of :py:data:`Resampling.NEAREST` (use nearest neighbour),</span><span class="r9">                       </span>  
 <span class="r6">  2261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BILINEAR` (linear interpolation in a 2x2</span><span class="r9">                       </span>  
 <span class="r6">  2262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           environment), or :py:data:`Resampling.BICUBIC` (cubic spline</span><span class="r9">                        </span>  
 <span class="r6">  2263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           interpolation in a 4x4 environment). If omitted, or if the image has</span><span class="r9">                </span>  
 <span class="r6">  2264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           mode &quot;1&quot; or &quot;P&quot;, it is set to :py:data:`Resampling.NEAREST`.</span><span class="r9">                        </span>  
 <span class="r6">  2265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           See :ref:`concept-filters`.</span><span class="r9">                                                         </span>  
 <span class="r6">  2266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param expand: Optional expansion flag.  If true, expands the output</span><span class="r9">                   </span>  
 <span class="r6">  2267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           image to make it large enough to hold the entire rotated image.</span><span class="r9">                     </span>  
 <span class="r6">  2268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If false or omitted, make the output image the same size as the</span><span class="r9">                     </span>  
 <span class="r6">  2269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           input image.  Note that the expand flag assumes rotation around</span><span class="r9">                     </span>  
 <span class="r6">  2270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the center and no translation.</span><span class="r9">                                                      </span>  
 <span class="r6">  2271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param center: Optional center of rotation (a 2-tuple).  Origin is</span><span class="r9">                     </span>  
 <span class="r6">  2272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the upper left corner.  Default is the center of the image.</span><span class="r9">                         </span>  
 <span class="r6">  2273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param translate: An optional post-rotate translation (a 2-tuple).</span><span class="r9">                     </span>  
 <span class="r6">  2274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fillcolor: An optional color for area outside the rotated image.</span><span class="r9">                </span>  
 <span class="r6">  2275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  2276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        angle </span><span class="r15">=</span><span class="r11"> angle </span><span class="r15">%</span><span class="r11"> </span><span class="r15">360.0</span><span class="r9">                                                                  </span>  
 <span class="r6">  2279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Fast paths regardless of filter, as long as we&#x27;re not</span><span class="r9">                                </span>  
 <span class="r6">  2281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># translating or changing the center.</span><span class="r9">                                                  </span>  
 <span class="r6">  2282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> (center </span><span class="r19">or</span><span class="r11"> translate):</span><span class="r9">                                                          </span>  
 <span class="r6">  2283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> angle </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  2284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                             </span>  
 <span class="r6">  2285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> angle </span><span class="r15">==</span><span class="r11"> </span><span class="r15">180</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  2286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">transpose(Transpose</span><span class="r15">.</span><span class="r11">ROTATE_180)</span><span class="r9">                                    </span>  
 <span class="r6">  2287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> angle </span><span class="r19">in</span><span class="r11"> (</span><span class="r15">90</span><span class="r11">, </span><span class="r15">270</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> (expand </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">width </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">height):</span><span class="r9">                   </span>  
 <span class="r6">  2288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">transpose(</span><span class="r9">                                                         </span>  
 <span class="r6">  2289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    Transpose</span><span class="r15">.</span><span class="r11">ROTATE_90 </span><span class="r10">if</span><span class="r11"> angle </span><span class="r15">==</span><span class="r11"> </span><span class="r15">90</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> Transpose</span><span class="r15">.</span><span class="r11">ROTATE_270</span><span class="r9">               </span>  
 <span class="r6">  2290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Calculate the affine matrix.  Note that this is the reverse</span><span class="r9">                          </span>  
 <span class="r6">  2293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># transformation (from destination image to source) because we</span><span class="r9">                         </span>  
 <span class="r6">  2294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># want to interpolate the (discrete) destination pixel from</span><span class="r9">                            </span>  
 <span class="r6">  2295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># the local area around the (floating) source pixel.</span><span class="r9">                                   </span>  
 <span class="r6">  2296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># The matrix we actually want (note that it operates from the right):</span><span class="r9">                  </span>  
 <span class="r6">  2298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (1, 0, tx)   (1, 0, cx)   ( cos a, sin a, 0)   (1, 0, -cx)</span><span class="r9">                           </span>  
 <span class="r6">  2299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (0, 1, ty) * (0, 1, cy) * (-sin a, cos a, 0) * (0, 1, -cy)</span><span class="r9">                           </span>  
 <span class="r6">  2300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (0, 0,  1)   (0, 0,  1)   (     0,     0, 1)   (0, 0,   1)</span><span class="r9">                           </span>  
 <span class="r6">  2301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># The reverse matrix is thus:</span><span class="r9">                                                          </span>  
 <span class="r6">  2303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (1, 0, cx)   ( cos -a, sin -a, 0)   (1, 0, -cx)   (1, 0, -tx)</span><span class="r9">                        </span>  
 <span class="r6">  2304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (0, 1, cy) * (-sin -a, cos -a, 0) * (0, 1, -cy) * (0, 1, -ty)</span><span class="r9">                        </span>  
 <span class="r6">  2305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># (0, 0,  1)   (      0,      0, 1)   (0, 0,   1)   (0, 0,   1)</span><span class="r9">                        </span>  
 <span class="r6">  2306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># In any case, the final translation may be updated at the end to</span><span class="r9">                      </span>  
 <span class="r6">  2308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># compensate for the expand flag.</span><span class="r9">                                                      </span>  
 <span class="r6">  2309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        w, h </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                                       </span>  
 <span class="r6">  2311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> translate </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">  2313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            post_trans </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                </span>  
 <span class="r6">  2314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            post_trans </span><span class="r15">=</span><span class="r11"> translate</span><span class="r9">                                                             </span>  
 <span class="r6">  2316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> center </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  2317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># FIXME These should be rounded to ints?</span><span class="r9">                                           </span>  
 <span class="r6">  2318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rotn_center </span><span class="r15">=</span><span class="r11"> (w </span><span class="r15">/</span><span class="r11"> </span><span class="r15">2.0</span><span class="r11">, h </span><span class="r15">/</span><span class="r11"> </span><span class="r15">2.0</span><span class="r11">)</span><span class="r9">                                                   </span>  
 <span class="r6">  2319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rotn_center </span><span class="r15">=</span><span class="r11"> center</span><span class="r9">                                                               </span>  
 <span class="r6">  2321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        angle </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-</span><span class="r11">math</span><span class="r15">.</span><span class="r11">radians(angle)</span><span class="r9">                                                           </span>  
 <span class="r6">  2323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        matrix </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                             </span>  
 <span class="r6">  2324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">round</span><span class="r11">(math</span><span class="r15">.</span><span class="r11">cos(angle), </span><span class="r15">15</span><span class="r11">),</span><span class="r9">                                                        </span>  
 <span class="r6">  2325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">round</span><span class="r11">(math</span><span class="r15">.</span><span class="r11">sin(angle), </span><span class="r15">15</span><span class="r11">),</span><span class="r9">                                                        </span>  
 <span class="r6">  2326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r15">0.0</span><span class="r11">,</span><span class="r9">                                                                               </span>  
 <span class="r6">  2327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">round</span><span class="r11">(</span><span class="r15">-</span><span class="r11">math</span><span class="r15">.</span><span class="r11">sin(angle), </span><span class="r15">15</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">  2328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">round</span><span class="r11">(math</span><span class="r15">.</span><span class="r11">cos(angle), </span><span class="r15">15</span><span class="r11">),</span><span class="r9">                                                        </span>  
 <span class="r6">  2329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r15">0.0</span><span class="r11">,</span><span class="r9">                                                                               </span>  
 <span class="r6">  2330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ]</span><span class="r9">                                                                                      </span>  
 <span class="r6">  2331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">transform</span><span class="r11">(x, y, matrix):</span><span class="r9">                                                           </span>  
 <span class="r6">  2333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            (a, b, c, d, e, f) </span><span class="r15">=</span><span class="r11"> matrix</span><span class="r9">                                                        </span>  
 <span class="r6">  2334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> a </span><span class="r15">*</span><span class="r11"> x </span><span class="r15">+</span><span class="r11"> b </span><span class="r15">*</span><span class="r11"> y </span><span class="r15">+</span><span class="r11"> c, d </span><span class="r15">*</span><span class="r11"> x </span><span class="r15">+</span><span class="r11"> e </span><span class="r15">*</span><span class="r11"> y </span><span class="r15">+</span><span class="r11"> f</span><span class="r9">                                        </span>  
 <span class="r6">  2335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        matrix[</span><span class="r15">2</span><span class="r11">], matrix[</span><span class="r15">5</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> transform(</span><span class="r9">                                                      </span>  
 <span class="r6">  2337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r15">-</span><span class="r11">rotn_center[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> post_trans[</span><span class="r15">0</span><span class="r11">], </span><span class="r15">-</span><span class="r11">rotn_center[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> post_trans[</span><span class="r15">1</span><span class="r11">], matrix</span><span class="r9">           </span>  
 <span class="r6">  2338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  2339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        matrix[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">+=</span><span class="r11"> rotn_center[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                            </span>  
 <span class="r6">  2340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        matrix[</span><span class="r15">5</span><span class="r11">] </span><span class="r15">+=</span><span class="r11"> rotn_center[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                            </span>  
 <span class="r6">  2341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> expand:</span><span class="r9">                                                                             </span>  
 <span class="r6">  2343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># calculate output size</span><span class="r9">                                                            </span>  
 <span class="r6">  2344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            xx </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                            </span>  
 <span class="r6">  2345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            yy </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                            </span>  
 <span class="r6">  2346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> x, y </span><span class="r19">in</span><span class="r11"> ((</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">), (w, </span><span class="r15">0</span><span class="r11">), (w, h), (</span><span class="r15">0</span><span class="r11">, h)):</span><span class="r9">                                      </span>  
 <span class="r6">  2347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                x, y </span><span class="r15">=</span><span class="r11"> transform(x, y, matrix)</span><span class="r9">                                                 </span>  
 <span class="r6">  2348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                xx</span><span class="r15">.</span><span class="r11">append(x)</span><span class="r9">                                                                   </span>  
 <span class="r6">  2349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                yy</span><span class="r15">.</span><span class="r11">append(y)</span><span class="r9">                                                                   </span>  
 <span class="r6">  2350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            nw </span><span class="r15">=</span><span class="r11"> math</span><span class="r15">.</span><span class="r11">ceil(</span><span class="r20">max</span><span class="r11">(xx)) </span><span class="r15">-</span><span class="r11"> math</span><span class="r15">.</span><span class="r11">floor(</span><span class="r20">min</span><span class="r11">(xx))</span><span class="r9">                                      </span>  
 <span class="r6">  2351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            nh </span><span class="r15">=</span><span class="r11"> math</span><span class="r15">.</span><span class="r11">ceil(</span><span class="r20">max</span><span class="r11">(yy)) </span><span class="r15">-</span><span class="r11"> math</span><span class="r15">.</span><span class="r11">floor(</span><span class="r20">min</span><span class="r11">(yy))</span><span class="r9">                                      </span>  
 <span class="r6">  2352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># We multiply a translation matrix from the right.  Because of its</span><span class="r9">                 </span>  
 <span class="r6">  2354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># special form, this is the same as taking the image of the</span><span class="r9">                        </span>  
 <span class="r6">  2355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># translation vector as new translation vector.</span><span class="r9">                                    </span>  
 <span class="r6">  2356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            matrix[</span><span class="r15">2</span><span class="r11">], matrix[</span><span class="r15">5</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> transform(</span><span class="r15">-</span><span class="r11">(nw </span><span class="r15">-</span><span class="r11"> w) </span><span class="r15">/</span><span class="r11"> </span><span class="r15">2.0</span><span class="r11">, </span><span class="r15">-</span><span class="r11">(nh </span><span class="r15">-</span><span class="r11"> h) </span><span class="r15">/</span><span class="r11"> </span><span class="r15">2.0</span><span class="r11">, matrix)</span><span class="r9">         </span>  
 <span class="r6">  2357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            w, h </span><span class="r15">=</span><span class="r11"> nw, nh</span><span class="r9">                                                                      </span>  
 <span class="r6">  2358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">transform(</span><span class="r9">                                                                 </span>  
 <span class="r6">  2360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            (w, h), Transform</span><span class="r15">.</span><span class="r11">AFFINE, matrix, resample, fillcolor</span><span class="r15">=</span><span class="r11">fillcolor</span><span class="r9">                    </span>  
 <span class="r6">  2361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  2362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">save</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, fp, </span><span class="r20">format</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, </span><span class="r15">**</span><span class="r11">params):</span><span class="r9">                                                 </span>  
 <span class="r6">  2364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Saves this image under the given filename.  If no format is</span><span class="r9">                            </span>  
 <span class="r6">  2366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        specified, the format to use is determined from the filename</span><span class="r9">                           </span>  
 <span class="r6">  2367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        extension, if possible.</span><span class="r9">                                                                </span>  
 <span class="r6">  2368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Keyword options can be used to provide additional instructions</span><span class="r9">                         </span>  
 <span class="r6">  2370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        to the writer. If a writer doesn&#x27;t recognise an option, it is</span><span class="r9">                          </span>  
 <span class="r6">  2371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        silently ignored. The available options are described in the</span><span class="r9">                           </span>  
 <span class="r6">  2372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :doc:`image format documentation</span><span class="r9">                                                       </span>  
 <span class="r6">  2373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &lt;../handbook/image-file-formats&gt;` for each writer.</span><span class="r9">                                     </span>  
 <span class="r6">  2374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        You can use a file object instead of a filename. In this case,</span><span class="r9">                         </span>  
 <span class="r6">  2376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        you must always specify the format. The file object must</span><span class="r9">                               </span>  
 <span class="r6">  2377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        implement the ``seek``, ``tell``, and ``write``</span><span class="r9">                                        </span>  
 <span class="r6">  2378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        methods, and be opened in binary mode.</span><span class="r9">                                                 </span>  
 <span class="r6">  2379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fp: A filename (string), pathlib.Path object or file object.</span><span class="r9">                    </span>  
 <span class="r6">  2381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param format: Optional format override.  If omitted, the</span><span class="r9">                              </span>  
 <span class="r6">  2382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           format to use is determined from the filename extension.</span><span class="r9">                            </span>  
 <span class="r6">  2383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If a file object was used instead of a filename, this</span><span class="r9">                               </span>  
 <span class="r6">  2384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           parameter should always be used.</span><span class="r9">                                                    </span>  
 <span class="r6">  2385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param params: Extra parameters to the image writer.</span><span class="r9">                                   </span>  
 <span class="r6">  2386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">  2387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :exception ValueError: If the output format could not be determined</span><span class="r9">                    </span>  
 <span class="r6">  2388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           from the file name.  Use the format option to solve this.</span><span class="r9">                           </span>  
 <span class="r6">  2389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :exception OSError: If the file could not be written.  The file</span><span class="r9">                        </span>  
 <span class="r6">  2390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           may have been created, and may contain partial data.</span><span class="r9">                                </span>  
 <span class="r6">  2391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        filename </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                          </span>  
 <span class="r6">  2394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        open_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                        </span>  
 <span class="r6">  2395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(fp, Path):</span><span class="r9">                                                               </span>  
 <span class="r6">  2396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filename </span><span class="r15">=</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(fp)</span><span class="r9">                                                                 </span>  
 <span class="r6">  2397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            open_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                     </span>  
 <span class="r6">  2398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> is_path(fp):</span><span class="r9">                                                                      </span>  
 <span class="r6">  2399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filename </span><span class="r15">=</span><span class="r11"> fp</span><span class="r9">                                                                      </span>  
 <span class="r6">  2400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            open_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                     </span>  
 <span class="r6">  2401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> fp </span><span class="r15">==</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">stdout:</span><span class="r9">                                                                 </span>  
 <span class="r6">  2402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  2403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fp </span><span class="r15">=</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">stdout</span><span class="r15">.</span><span class="r11">buffer</span><span class="r9">                                                         </span>  
 <span class="r6">  2404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  2405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">  2406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> filename </span><span class="r19">and</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(fp, </span><span class="r16">&quot;name&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> is_path(fp</span><span class="r15">.</span><span class="r11">name):</span><span class="r9">                          </span>  
 <span class="r6">  2407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># only set the name for metadata purposes</span><span class="r9">                                          </span>  
 <span class="r6">  2408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filename </span><span class="r15">=</span><span class="r11"> fp</span><span class="r15">.</span><span class="r11">name</span><span class="r9">                                                                 </span>  
 <span class="r6">  2409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># may mutate self!</span><span class="r9">                                                                     </span>  
 <span class="r6">  2411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ensure_mutable()</span><span class="r9">                                                                 </span>  
 <span class="r6">  2412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        save_all </span><span class="r15">=</span><span class="r11"> params</span><span class="r15">.</span><span class="r11">pop(</span><span class="r16">&quot;save_all&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                               </span>  
 <span class="r6">  2414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">encoderinfo </span><span class="r15">=</span><span class="r11"> params</span><span class="r9">                                                              </span>  
 <span class="r6">  2415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">encoderconfig </span><span class="r15">=</span><span class="r11"> ()</span><span class="r9">                                                                </span>  
 <span class="r6">  2416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        preinit()</span><span class="r9">                                                                              </span>  
 <span class="r6">  2418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ext </span><span class="r15">=</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">path</span><span class="r15">.</span><span class="r11">splitext(filename)[</span><span class="r15">1</span><span class="r11">]</span><span class="r15">.</span><span class="r11">lower()</span><span class="r9">                                            </span>  
 <span class="r6">  2420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">format</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">  2422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> ext </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> EXTENSION:</span><span class="r9">                                                           </span>  
 <span class="r6">  2423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                init()</span><span class="r9">                                                                         </span>  
 <span class="r6">  2424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  2425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">format</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> EXTENSION[ext]</span><span class="r9">                                                        </span>  
 <span class="r6">  2426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                              </span>  
 <span class="r6">  2427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;unknown file extension: </span><span class="r21">{</span><span class="r11">ext</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">                                         </span>  
 <span class="r6">  2428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                   </span>  
 <span class="r6">  2429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">format</span><span class="r15">.</span><span class="r11">upper() </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> SAVE:</span><span class="r9">                                                         </span>  
 <span class="r6">  2431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            init()</span><span class="r9">                                                                             </span>  
 <span class="r6">  2432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> save_all:</span><span class="r9">                                                                           </span>  
 <span class="r6">  2433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            save_handler </span><span class="r15">=</span><span class="r11"> SAVE_ALL[</span><span class="r20">format</span><span class="r15">.</span><span class="r11">upper()]</span><span class="r9">                                            </span>  
 <span class="r6">  2434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            save_handler </span><span class="r15">=</span><span class="r11"> SAVE[</span><span class="r20">format</span><span class="r15">.</span><span class="r11">upper()]</span><span class="r9">                                                </span>  
 <span class="r6">  2436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        created </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                        </span>  
 <span class="r6">  2438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> open_fp:</span><span class="r9">                                                                            </span>  
 <span class="r6">  2439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            created </span><span class="r15">=</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">path</span><span class="r15">.</span><span class="r11">exists(filename)</span><span class="r9">                                             </span>  
 <span class="r6">  2440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> params</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;append&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                                    </span>  
 <span class="r6">  2441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Open also for reading (&quot;+&quot;), because TIFF save_all</span><span class="r9">                           </span>  
 <span class="r6">  2442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># writer needs to go back and edit the written data.</span><span class="r9">                           </span>  
 <span class="r6">  2443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fp </span><span class="r15">=</span><span class="r11"> builtins</span><span class="r15">.</span><span class="r11">open(filename, </span><span class="r16">&quot;r+b&quot;</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  2444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  2445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fp </span><span class="r15">=</span><span class="r11"> builtins</span><span class="r15">.</span><span class="r11">open(filename, </span><span class="r16">&quot;w+b&quot;</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  2446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  2448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            save_handler(</span><span class="r20">self</span><span class="r11">, fp, filename)</span><span class="r9">                                                   </span>  
 <span class="r6">  2449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">  2450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> open_fp:</span><span class="r9">                                                                        </span>  
 <span class="r6">  2451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                     </span>  
 <span class="r6">  2452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> created:</span><span class="r9">                                                                        </span>  
 <span class="r6">  2453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  2454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    os</span><span class="r15">.</span><span class="r11">remove(filename)</span><span class="r9">                                                        </span>  
 <span class="r6">  2455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">PermissionError</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">  2456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">pass</span><span class="r9">                                                                       </span>  
 <span class="r6">  2457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">  2458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> open_fp:</span><span class="r9">                                                                            </span>  
 <span class="r6">  2459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                         </span>  
 <span class="r6">  2460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">seek</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, frame):</span><span class="r9">                                                                     </span>  
 <span class="r6">  2462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Seeks to the given frame in this sequence file. If you seek</span><span class="r9">                            </span>  
 <span class="r6">  2464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        beyond the end of the sequence, the method raises an</span><span class="r9">                                   </span>  
 <span class="r6">  2465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        ``EOFError`` exception. When a sequence file is opened, the</span><span class="r9">                            </span>  
 <span class="r6">  2466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        library automatically seeks to frame 0.</span><span class="r9">                                                </span>  
 <span class="r6">  2467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        See :py:meth:`~PIL.Image.Image.tell`.</span><span class="r9">                                                  </span>  
 <span class="r6">  2469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If defined, :attr:`~PIL.Image.Image.n_frames` refers to the</span><span class="r9">                            </span>  
 <span class="r6">  2471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        number of available frames.</span><span class="r9">                                                            </span>  
 <span class="r6">  2472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param frame: Frame number, starting at 0.</span><span class="r9">                                             </span>  
 <span class="r6">  2474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :exception EOFError: If the call attempts to seek beyond the end</span><span class="r9">                       </span>  
 <span class="r6">  2475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            of the sequence.</span><span class="r9">                                                                   </span>  
 <span class="r6">  2476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># overridden by file handlers</span><span class="r9">                                                          </span>  
 <span class="r6">  2479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> frame </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">  2480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">EOFError</span><span class="r9">                                                                     </span>  
 <span class="r6">  2481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">show</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, title</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">  2483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Displays this image. This method is mainly intended for debugging purposes.</span><span class="r9">            </span>  
 <span class="r6">  2485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        This method calls :py:func:`PIL.ImageShow.show` internally. You can use</span><span class="r9">                </span>  
 <span class="r6">  2487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :py:func:`PIL.ImageShow.register` to override its default behaviour.</span><span class="r9">                   </span>  
 <span class="r6">  2488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        The image is first saved to a temporary file. By default, it will be in</span><span class="r9">                </span>  
 <span class="r6">  2490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        PNG format.</span><span class="r9">                                                                            </span>  
 <span class="r6">  2491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        On Unix, the image is then opened using the **display**, **eog** or</span><span class="r9">                    </span>  
 <span class="r6">  2493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        **xv** utility, depending on which one can be found.</span><span class="r9">                                   </span>  
 <span class="r6">  2494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        On macOS, the image is opened with the native Preview application.</span><span class="r9">                     </span>  
 <span class="r6">  2496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        On Windows, the image is opened with the standard PNG display utility.</span><span class="r9">                 </span>  
 <span class="r6">  2498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param title: Optional title to use for the image window, where possible.</span><span class="r9">              </span>  
 <span class="r6">  2500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _show(</span><span class="r20">self</span><span class="r11">, title</span><span class="r15">=</span><span class="r11">title)</span><span class="r9">                                                               </span>  
 <span class="r6">  2503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">split</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">  2505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Split this image into individual bands. This method returns a</span><span class="r9">                          </span>  
 <span class="r6">  2507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        tuple of individual image bands from an image. For example,</span><span class="r9">                            </span>  
 <span class="r6">  2508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        splitting an &quot;RGB&quot; image creates three new images each</span><span class="r9">                                 </span>  
 <span class="r6">  2509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        containing a copy of one of the original bands (red, green,</span><span class="r9">                            </span>  
 <span class="r6">  2510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        blue).</span><span class="r9">                                                                                 </span>  
 <span class="r6">  2511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If you need only one band, :py:meth:`~PIL.Image.Image.getchannel`</span><span class="r9">                      </span>  
 <span class="r6">  2513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method can be more convenient and faster.</span><span class="r9">                                              </span>  
 <span class="r6">  2514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A tuple containing bands.</span><span class="r9">                                                    </span>  
 <span class="r6">  2516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">bands </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  2520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ims </span><span class="r15">=</span><span class="r11"> [</span><span class="r20">self</span><span class="r15">.</span><span class="r11">copy()]</span><span class="r9">                                                                </span>  
 <span class="r6">  2521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ims </span><span class="r15">=</span><span class="r11"> </span><span class="r20">map</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">split())</span><span class="r9">                                              </span>  
 <span class="r6">  2523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(ims)</span><span class="r9">                                                                      </span>  
 <span class="r6">  2524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getchannel</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, channel):</span><span class="r9">                                                             </span>  
 <span class="r6">  2526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns an image containing a single channel of the source image.</span><span class="r9">                      </span>  
 <span class="r6">  2528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param channel: What channel to return. Could be index</span><span class="r9">                                 </span>  
 <span class="r6">  2530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          (0 for &quot;R&quot; channel of &quot;RGB&quot;) or channel name</span><span class="r9">                                         </span>  
 <span class="r6">  2531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          (&quot;A&quot; for alpha channel of &quot;RGBA&quot;).</span><span class="r9">                                                   </span>  
 <span class="r6">  2532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An image in &quot;L&quot; mode.</span><span class="r9">                                                        </span>  
 <span class="r6">  2533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        .. versionadded:: 4.3.0</span><span class="r9">                                                                </span>  
 <span class="r6">  2535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(channel, </span><span class="r20">str</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">  2539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  2540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                channel </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getbands()</span><span class="r15">.</span><span class="r11">index(channel)</span><span class="r9">                                       </span>  
 <span class="r6">  2541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                            </span>  
 <span class="r6">  2542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&#x27;The image has no channel &quot;</span><span class="r21">{</span><span class="r11">channel</span><span class="r21">}</span><span class="r16">&quot;&#x27;</span><span class="r9">                                  </span>  
 <span class="r6">  2543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                   </span>  
 <span class="r6">  2544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getband(channel))</span><span class="r9">                                             </span>  
 <span class="r6">  2546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">tell</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">  2548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns the current frame number. See :py:meth:`~PIL.Image.Image.seek`.</span><span class="r9">                </span>  
 <span class="r6">  2550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If defined, :attr:`~PIL.Image.Image.n_frames` refers to the</span><span class="r9">                            </span>  
 <span class="r6">  2552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        number of available frames.</span><span class="r9">                                                            </span>  
 <span class="r6">  2553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: Frame number, starting with 0.</span><span class="r9">                                               </span>  
 <span class="r6">  2555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                               </span>  
 <span class="r6">  2557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">thumbnail</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, size, resample</span><span class="r15">=</span><span class="r11">Resampling</span><span class="r15">.</span><span class="r11">BICUBIC, reducing_gap</span><span class="r15">=2.0</span><span class="r11">):</span><span class="r9">                  </span>  
 <span class="r6">  2559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Make this image into a thumbnail.  This method modifies the</span><span class="r9">                            </span>  
 <span class="r6">  2561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image to contain a thumbnail version of itself, no larger than</span><span class="r9">                         </span>  
 <span class="r6">  2562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        the given size.  This method calculates an appropriate thumbnail</span><span class="r9">                       </span>  
 <span class="r6">  2563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        size to preserve the aspect of the image, calls the</span><span class="r9">                                    </span>  
 <span class="r6">  2564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :py:meth:`~PIL.Image.Image.draft` method to configure the file reader</span><span class="r9">                  </span>  
 <span class="r6">  2565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (where applicable), and finally resizes the image.</span><span class="r9">                                     </span>  
 <span class="r6">  2566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Note that this function modifies the :py:class:`~PIL.Image.Image`</span><span class="r9">                      </span>  
 <span class="r6">  2568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        object in place.  If you need to use the full resolution image as well,</span><span class="r9">                </span>  
 <span class="r6">  2569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        apply this method to a :py:meth:`~PIL.Image.Image.copy` of the original</span><span class="r9">                </span>  
 <span class="r6">  2570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        image.</span><span class="r9">                                                                                 </span>  
 <span class="r6">  2571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param size: The requested size in pixels, as a 2-tuple:</span><span class="r9">                               </span>  
 <span class="r6">  2573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (width, height).</span><span class="r9">                                                                    </span>  
 <span class="r6">  2574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param resample: Optional resampling filter.  This can be one</span><span class="r9">                          </span>  
 <span class="r6">  2575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           of :py:data:`Resampling.NEAREST`, :py:data:`Resampling.BOX`,</span><span class="r9">                        </span>  
 <span class="r6">  2576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BILINEAR`, :py:data:`Resampling.HAMMING`,</span><span class="r9">                      </span>  
 <span class="r6">  2577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BICUBIC` or :py:data:`Resampling.LANCZOS`.</span><span class="r9">                     </span>  
 <span class="r6">  2578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           If omitted, it defaults to :py:data:`Resampling.BICUBIC`.</span><span class="r9">                           </span>  
 <span class="r6">  2579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (was :py:data:`Resampling.NEAREST` prior to version 2.5.0).</span><span class="r9">                         </span>  
 <span class="r6">  2580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           See: :ref:`concept-filters`.</span><span class="r9">                                                        </span>  
 <span class="r6">  2581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param reducing_gap: Apply optimization by resizing the image</span><span class="r9">                          </span>  
 <span class="r6">  2582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           in two steps. First, reducing the image by integer times</span><span class="r9">                            </span>  
 <span class="r6">  2583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           using :py:meth:`~PIL.Image.Image.reduce` or</span><span class="r9">                                         </span>  
 <span class="r6">  2584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:meth:`~PIL.Image.Image.draft` for JPEG images.</span><span class="r9">                                  </span>  
 <span class="r6">  2585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           Second, resizing using regular resampling. The last step</span><span class="r9">                            </span>  
 <span class="r6">  2586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           changes size no less than by ``reducing_gap`` times.</span><span class="r9">                                </span>  
 <span class="r6">  2587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           ``reducing_gap`` may be None (no first step is performed)</span><span class="r9">                           </span>  
 <span class="r6">  2588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           or should be greater than 1.0. The bigger ``reducing_gap``,</span><span class="r9">                         </span>  
 <span class="r6">  2589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           the closer the result to the fair resampling.</span><span class="r9">                                       </span>  
 <span class="r6">  2590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The smaller ``reducing_gap``, the faster resizing.</span><span class="r9">                                  </span>  
 <span class="r6">  2591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           With ``reducing_gap`` greater or equal to 3.0, the result is</span><span class="r9">                        </span>  
 <span class="r6">  2592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           indistinguishable from fair resampling in most cases.</span><span class="r9">                               </span>  
 <span class="r6">  2593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           The default value is 2.0 (very close to fair resampling</span><span class="r9">                             </span>  
 <span class="r6">  2594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           while still being faster in many cases).</span><span class="r9">                                            </span>  
 <span class="r6">  2595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">  2596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        provided_size </span><span class="r15">=</span><span class="r11"> </span><span class="r20">tuple</span><span class="r11">(</span><span class="r20">map</span><span class="r11">(math</span><span class="r15">.</span><span class="r11">floor, size))</span><span class="r9">                                           </span>  
 <span class="r6">  2599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">def</span><span class="r11"> </span><span class="r17">preserve_aspect_ratio</span><span class="r11">():</span><span class="r9">                                                           </span>  
 <span class="r6">  2601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">def</span><span class="r11"> </span><span class="r17">round_aspect</span><span class="r11">(number, key):</span><span class="r9">                                                     </span>  
 <span class="r6">  2602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> </span><span class="r20">max</span><span class="r11">(</span><span class="r20">min</span><span class="r11">(math</span><span class="r15">.</span><span class="r11">floor(number), math</span><span class="r15">.</span><span class="r11">ceil(number), key</span><span class="r15">=</span><span class="r11">key), </span><span class="r15">1</span><span class="r11">)</span><span class="r9">             </span>  
 <span class="r6">  2603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            x, y </span><span class="r15">=</span><span class="r11"> provided_size</span><span class="r9">                                                               </span>  
 <span class="r6">  2605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> x </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">width </span><span class="r19">and</span><span class="r11"> y </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">height:</span><span class="r9">                                           </span>  
 <span class="r6">  2606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">  2607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            aspect </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">width </span><span class="r15">/</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">height</span><span class="r9">                                                  </span>  
 <span class="r6">  2609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> x </span><span class="r15">/</span><span class="r11"> y </span><span class="r15">&gt;=</span><span class="r11"> aspect:</span><span class="r9">                                                                </span>  
 <span class="r6">  2610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                x </span><span class="r15">=</span><span class="r11"> round_aspect(y </span><span class="r15">*</span><span class="r11"> aspect, key</span><span class="r15">=</span><span class="r10">lambda</span><span class="r11"> n: </span><span class="r20">abs</span><span class="r11">(aspect </span><span class="r15">-</span><span class="r11"> n </span><span class="r15">/</span><span class="r11"> y))</span><span class="r9">                </span>  
 <span class="r6">  2611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  2612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                y </span><span class="r15">=</span><span class="r11"> round_aspect(</span><span class="r9">                                                              </span>  
 <span class="r6">  2613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    x </span><span class="r15">/</span><span class="r11"> aspect, key</span><span class="r15">=</span><span class="r10">lambda</span><span class="r11"> n: </span><span class="r15">0</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r20">abs</span><span class="r11">(aspect </span><span class="r15">-</span><span class="r11"> x </span><span class="r15">/</span><span class="r11"> n)</span><span class="r9">             </span>  
 <span class="r6">  2614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> x, y</span><span class="r9">                                                                        </span>  
 <span class="r6">  2616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        box </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                             </span>  
 <span class="r6">  2618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> reducing_gap </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">  2619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            size </span><span class="r15">=</span><span class="r11"> preserve_aspect_ratio()</span><span class="r9">                                                     </span>  
 <span class="r6">  2620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> size </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  2621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">  2622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            res </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">draft(</span><span class="r10">None</span><span class="r11">, (size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> reducing_gap, size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> reducing_gap))</span><span class="r9">           </span>  
 <span class="r6">  2624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> res </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">  2625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                box </span><span class="r15">=</span><span class="r11"> res[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                                   </span>  
 <span class="r6">  2626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> box </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  2627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                        </span>  
 <span class="r6">  2628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># load() may have changed the size of the image</span><span class="r9">                                    </span>  
 <span class="r6">  2630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            size </span><span class="r15">=</span><span class="r11"> preserve_aspect_ratio()</span><span class="r9">                                                     </span>  
 <span class="r6">  2631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> size </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  2632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r9">                                                                         </span>  
 <span class="r6">  2633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size </span><span class="r15">!=</span><span class="r11"> size:</span><span class="r9">                                                                  </span>  
 <span class="r6">  2635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">resize(size, resample, box</span><span class="r15">=</span><span class="r11">box, reducing_gap</span><span class="r15">=</span><span class="r11">reducing_gap)</span><span class="r9">               </span>  
 <span class="r6">  2636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">im</span><span class="r9">                                                                    </span>  
 <span class="r6">  2638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> size</span><span class="r9">                                                                  </span>  
 <span class="r6">  2639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                           </span>  
 <span class="r6">  2640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                      </span>  
 <span class="r6">  2642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pyaccess </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                   </span>  
 <span class="r6">  2643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># FIXME: the different transform methods need further explanation</span><span class="r9">                          </span>  
 <span class="r6">  2645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># instead of bloating the method docs, add a separate chapter.</span><span class="r9">                             </span>  
 <span class="r6">  2646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">transform</span><span class="r11">(</span><span class="r9">                                                                             </span>  
 <span class="r6">  2647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r11">,</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        size,</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        method,</span><span class="r9">                                                                                </span>  
 <span class="r6">  2650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                             </span>  
 <span class="r6">  2651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        resample</span><span class="r15">=</span><span class="r11">Resampling</span><span class="r15">.</span><span class="r11">NEAREST,</span><span class="r9">                                                           </span>  
 <span class="r6">  2652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fill</span><span class="r15">=1</span><span class="r11">,</span><span class="r9">                                                                                </span>  
 <span class="r6">  2653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fillcolor</span><span class="r15">=</span><span class="r10">None</span><span class="r11">,</span><span class="r9">                                                                        </span>  
 <span class="r6">  2654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ):</span><span class="r9">                                                                                         </span>  
 <span class="r6">  2655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Transforms this image.  This method creates a new image with the</span><span class="r9">                       </span>  
 <span class="r6">  2657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        given size, and the same mode as the original, and copies data</span><span class="r9">                         </span>  
 <span class="r6">  2658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        to the new image using the given transform.</span><span class="r9">                                            </span>  
 <span class="r6">  2659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param size: The output size in pixels, as a 2-tuple:</span><span class="r9">                                  </span>  
 <span class="r6">  2661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           (width, height).</span><span class="r9">                                                                    </span>  
 <span class="r6">  2662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param method: The transformation method.  This is one of</span><span class="r9">                              </span>  
 <span class="r6">  2663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transform.EXTENT` (cut out a rectangular subregion),</span><span class="r9">                       </span>  
 <span class="r6">  2664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transform.AFFINE` (affine transform),</span><span class="r9">                                      </span>  
 <span class="r6">  2665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transform.PERSPECTIVE` (perspective transform),</span><span class="r9">                            </span>  
 <span class="r6">  2666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transform.QUAD` (map a quadrilateral to a rectangle), or</span><span class="r9">                   </span>  
 <span class="r6">  2667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transform.MESH` (map a number of source quadrilaterals</span><span class="r9">                     </span>  
 <span class="r6">  2668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          in one operation).</span><span class="r9">                                                                   </span>  
 <span class="r6">  2669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          It may also be an :py:class:`~PIL.Image.ImageTransformHandler`</span><span class="r9">                       </span>  
 <span class="r6">  2671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          object::</span><span class="r9">                                                                             </span>  
 <span class="r6">  2672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            class Example(Image.ImageTransformHandler):</span><span class="r9">                                        </span>  
 <span class="r6">  2674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                def transform(self, size, data, resample, fill=1):</span><span class="r9">                             </span>  
 <span class="r6">  2675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    # Return result</span><span class="r9">                                                            </span>  
 <span class="r6">  2676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          It may also be an object with a ``method.getdata`` method</span><span class="r9">                            </span>  
 <span class="r6">  2678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          that returns a tuple supplying new ``method`` and ``data`` values::</span><span class="r9">                  </span>  
 <span class="r6">  2679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            class Example:</span><span class="r9">                                                                     </span>  
 <span class="r6">  2681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                def getdata(self):</span><span class="r9">                                                             </span>  
 <span class="r6">  2682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    method = Image.Transform.EXTENT</span><span class="r9">                                            </span>  
 <span class="r6">  2683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    data = (0, 0, 100, 100)</span><span class="r9">                                                    </span>  
 <span class="r6">  2684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    return method, data</span><span class="r9">                                                        </span>  
 <span class="r6">  2685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param data: Extra data to the transformation method.</span><span class="r9">                                  </span>  
 <span class="r6">  2686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param resample: Optional resampling filter.  It can be one of</span><span class="r9">                         </span>  
 <span class="r6">  2687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.NEAREST` (use nearest neighbour),</span><span class="r9">                              </span>  
 <span class="r6">  2688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           :py:data:`Resampling.BILINEAR` (linear interpolation in a 2x2</span><span class="r9">                       </span>  
 <span class="r6">  2689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           environment), or :py:data:`Resampling.BICUBIC` (cubic spline</span><span class="r9">                        </span>  
 <span class="r6">  2690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           interpolation in a 4x4 environment). If omitted, or if the image</span><span class="r9">                    </span>  
 <span class="r6">  2691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           has mode &quot;1&quot; or &quot;P&quot;, it is set to :py:data:`Resampling.NEAREST`.</span><span class="r9">                    </span>  
 <span class="r6">  2692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           See: :ref:`concept-filters`.</span><span class="r9">                                                        </span>  
 <span class="r6">  2693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fill: If ``method`` is an</span><span class="r9">                                                       </span>  
 <span class="r6">  2694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:class:`~PIL.Image.ImageTransformHandler` object, this is one of</span><span class="r9">                  </span>  
 <span class="r6">  2695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          the arguments passed to it. Otherwise, it is unused.</span><span class="r9">                                 </span>  
 <span class="r6">  2696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fillcolor: Optional fill color for the area outside the</span><span class="r9">                         </span>  
 <span class="r6">  2697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">           transform in the output image.</span><span class="r9">                                                      </span>  
 <span class="r6">  2698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                      </span>  
 <span class="r6">  2699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> resample </span><span class="r15">!=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST:</span><span class="r9">                     </span>  
 <span class="r6">  2702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> (</span><span class="r9">                                                                           </span>  
 <span class="r6">  2703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">convert({</span><span class="r16">&quot;LA&quot;</span><span class="r11">: </span><span class="r16">&quot;La&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">: </span><span class="r16">&quot;RGBa&quot;</span><span class="r11">}[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode])</span><span class="r9">                          </span>  
 <span class="r6">  2704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">.</span><span class="r11">transform(size, method, data, resample, fill, fillcolor)</span><span class="r9">                      </span>  
 <span class="r6">  2705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">.</span><span class="r11">convert(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode)</span><span class="r9">                                                            </span>  
 <span class="r6">  2706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(method, ImageTransformHandler):</span><span class="r9">                                          </span>  
 <span class="r6">  2709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> method</span><span class="r15">.</span><span class="r11">transform(size, </span><span class="r20">self</span><span class="r11">, resample</span><span class="r15">=</span><span class="r11">resample, fill</span><span class="r15">=</span><span class="r11">fill)</span><span class="r9">                  </span>  
 <span class="r6">  2710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(method, </span><span class="r16">&quot;getdata&quot;</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">  2712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># compatibility w. old-style transform objects</span><span class="r9">                                     </span>  
 <span class="r6">  2713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            method, data </span><span class="r15">=</span><span class="r11"> method</span><span class="r15">.</span><span class="r11">getdata()</span><span class="r9">                                                    </span>  
 <span class="r6">  2714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> data </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">  2716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;missing method data&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">  2717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im </span><span class="r15">=</span><span class="r11"> new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, size, fillcolor)</span><span class="r9">                                                   </span>  
 <span class="r6">  2720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette:</span><span class="r9">                                                  </span>  
 <span class="r6">  2721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                   </span>  
 <span class="r6">  2722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im</span><span class="r15">.</span><span class="r11">info </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                             </span>  
 <span class="r6">  2723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> method </span><span class="r15">==</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">MESH:</span><span class="r9">                                                           </span>  
 <span class="r6">  2724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># list of quads</span><span class="r9">                                                                    </span>  
 <span class="r6">  2725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> box, quad </span><span class="r19">in</span><span class="r11"> data:</span><span class="r9">                                                             </span>  
 <span class="r6">  2726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                im</span><span class="r15">.</span><span class="r11">__transformer(</span><span class="r9">                                                              </span>  
 <span class="r6">  2727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    box, </span><span class="r20">self</span><span class="r11">, Transform</span><span class="r15">.</span><span class="r11">QUAD, quad, resample, fillcolor </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r9">               </span>  
 <span class="r6">  2728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im</span><span class="r15">.</span><span class="r11">__transformer(</span><span class="r9">                                                                  </span>  
 <span class="r6">  2731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> size, </span><span class="r20">self</span><span class="r11">, method, data, resample, fillcolor </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                 </span>  
 <span class="r6">  2732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                              </span>  
 <span class="r6">  2735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__transformer</span><span class="r11">(</span><span class="r9">                                                                         </span>  
 <span class="r6">  2737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r11">, box, image, method, data, resample</span><span class="r15">=</span><span class="r11">Resampling</span><span class="r15">.</span><span class="r11">NEAREST, fill</span><span class="r15">=1</span><span class="r9">                    </span>  
 <span class="r6">  2738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ):</span><span class="r9">                                                                                         </span>  
 <span class="r6">  2739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        w </span><span class="r15">=</span><span class="r11"> box[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">  2740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        h </span><span class="r15">=</span><span class="r11"> box[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> box[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">  2741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> method </span><span class="r15">==</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">AFFINE:</span><span class="r9">                                                         </span>  
 <span class="r6">  2743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data </span><span class="r15">=</span><span class="r11"> data[:</span><span class="r15">6</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">  2744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> method </span><span class="r15">==</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">EXTENT:</span><span class="r9">                                                       </span>  
 <span class="r6">  2746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># convert extent to an affine transform</span><span class="r9">                                            </span>  
 <span class="r6">  2747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            x0, y0, x1, y1 </span><span class="r15">=</span><span class="r11"> data</span><span class="r9">                                                              </span>  
 <span class="r6">  2748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            xs </span><span class="r15">=</span><span class="r11"> (x1 </span><span class="r15">-</span><span class="r11"> x0) </span><span class="r15">/</span><span class="r11"> w</span><span class="r9">                                                                 </span>  
 <span class="r6">  2749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ys </span><span class="r15">=</span><span class="r11"> (y1 </span><span class="r15">-</span><span class="r11"> y0) </span><span class="r15">/</span><span class="r11"> h</span><span class="r9">                                                                 </span>  
 <span class="r6">  2750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            method </span><span class="r15">=</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">AFFINE</span><span class="r9">                                                          </span>  
 <span class="r6">  2751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data </span><span class="r15">=</span><span class="r11"> (xs, </span><span class="r15">0</span><span class="r11">, x0, </span><span class="r15">0</span><span class="r11">, ys, y0)</span><span class="r9">                                                      </span>  
 <span class="r6">  2752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> method </span><span class="r15">==</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">PERSPECTIVE:</span><span class="r9">                                                  </span>  
 <span class="r6">  2754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data </span><span class="r15">=</span><span class="r11"> data[:</span><span class="r15">8</span><span class="r11">]</span><span class="r9">                                                                    </span>  
 <span class="r6">  2755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> method </span><span class="r15">==</span><span class="r11"> Transform</span><span class="r15">.</span><span class="r11">QUAD:</span><span class="r9">                                                         </span>  
 <span class="r6">  2757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># quadrilateral warp.  data specifies the four corners</span><span class="r9">                             </span>  
 <span class="r6">  2758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># given as NW, SW, SE, and NE.</span><span class="r9">                                                     </span>  
 <span class="r6">  2759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            nw </span><span class="r15">=</span><span class="r11"> data[:</span><span class="r15">2</span><span class="r11">]</span><span class="r9">                                                                      </span>  
 <span class="r6">  2760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            sw </span><span class="r15">=</span><span class="r11"> data[</span><span class="r15">2</span><span class="r11">:</span><span class="r15">4</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">  2761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            se </span><span class="r15">=</span><span class="r11"> data[</span><span class="r15">4</span><span class="r11">:</span><span class="r15">6</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">  2762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ne </span><span class="r15">=</span><span class="r11"> data[</span><span class="r15">6</span><span class="r11">:</span><span class="r15">8</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">  2763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            x0, y0 </span><span class="r15">=</span><span class="r11"> nw</span><span class="r9">                                                                        </span>  
 <span class="r6">  2764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            As </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1.0</span><span class="r11"> </span><span class="r15">/</span><span class="r11"> w</span><span class="r9">                                                                       </span>  
 <span class="r6">  2765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            At </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1.0</span><span class="r11"> </span><span class="r15">/</span><span class="r11"> h</span><span class="r9">                                                                       </span>  
 <span class="r6">  2766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                           </span>  
 <span class="r6">  2767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                x0,</span><span class="r9">                                                                            </span>  
 <span class="r6">  2768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (ne[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> x0) </span><span class="r15">*</span><span class="r11"> As,</span><span class="r9">                                                             </span>  
 <span class="r6">  2769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (sw[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> x0) </span><span class="r15">*</span><span class="r11"> At,</span><span class="r9">                                                             </span>  
 <span class="r6">  2770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (se[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> sw[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> ne[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> x0) </span><span class="r15">*</span><span class="r11"> As </span><span class="r15">*</span><span class="r11"> At,</span><span class="r9">                                        </span>  
 <span class="r6">  2771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                y0,</span><span class="r9">                                                                            </span>  
 <span class="r6">  2772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (ne[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> y0) </span><span class="r15">*</span><span class="r11"> As,</span><span class="r9">                                                             </span>  
 <span class="r6">  2773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (sw[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> y0) </span><span class="r15">*</span><span class="r11"> At,</span><span class="r9">                                                             </span>  
 <span class="r6">  2774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (se[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> sw[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> ne[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> y0) </span><span class="r15">*</span><span class="r11"> As </span><span class="r15">*</span><span class="r11"> At,</span><span class="r9">                                        </span>  
 <span class="r6">  2775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;unknown transformation method&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  2779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> resample </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r9">                                                                   </span>  
 <span class="r6">  2782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">NEAREST,</span><span class="r9">                                                                </span>  
 <span class="r6">  2783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">BILINEAR,</span><span class="r9">                                                               </span>  
 <span class="r6">  2784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Resampling</span><span class="r15">.</span><span class="r11">BICUBIC,</span><span class="r9">                                                                </span>  
 <span class="r6">  2785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">  2786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> resample </span><span class="r19">in</span><span class="r11"> (Resampling</span><span class="r15">.</span><span class="r11">BOX, Resampling</span><span class="r15">.</span><span class="r11">HAMMING, Resampling</span><span class="r15">.</span><span class="r11">LANCZOS):</span><span class="r9">           </span>  
 <span class="r6">  2787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                        </span>  
 <span class="r6">  2788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    Resampling</span><span class="r15">.</span><span class="r11">BOX: </span><span class="r16">&quot;Image.Resampling.BOX&quot;</span><span class="r11">,</span><span class="r9">                                    </span>  
 <span class="r6">  2789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    Resampling</span><span class="r15">.</span><span class="r11">HAMMING: </span><span class="r16">&quot;Image.Resampling.HAMMING&quot;</span><span class="r11">,</span><span class="r9">                            </span>  
 <span class="r6">  2790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    Resampling</span><span class="r15">.</span><span class="r11">LANCZOS: </span><span class="r16">&quot;Image.Resampling.LANCZOS&quot;</span><span class="r11">,</span><span class="r9">                            </span>  
 <span class="r6">  2791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                }[resample] </span><span class="r15">+</span><span class="r11"> </span><span class="r16">f&quot; (</span><span class="r21">{</span><span class="r11">resample</span><span class="r21">}</span><span class="r16">) cannot be used.&quot;</span><span class="r9">                                 </span>  
 <span class="r6">  2792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">  2793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;Unknown resampling filter (</span><span class="r21">{</span><span class="r11">resample</span><span class="r21">}</span><span class="r16">).&quot;</span><span class="r9">                               </span>  
 <span class="r6">  2794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            filters </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                        </span>  
 <span class="r6">  2796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r20">filter</span><span class="r11">[</span><span class="r15">1</span><span class="r11">]</span><span class="r21">}</span><span class="r16"> (</span><span class="r21">{</span><span class="r20">filter</span><span class="r11">[</span><span class="r15">0</span><span class="r11">]</span><span class="r21">}</span><span class="r16">)&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">  2797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> </span><span class="r20">filter</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (</span><span class="r9">                                                                </span>  
 <span class="r6">  2798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">NEAREST, </span><span class="r16">&quot;Image.Resampling.NEAREST&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">BILINEAR, </span><span class="r16">&quot;Image.Resampling.BILINEAR&quot;</span><span class="r11">),</span><span class="r9">                        </span>  
 <span class="r6">  2800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    (Resampling</span><span class="r15">.</span><span class="r11">BICUBIC, </span><span class="r16">&quot;Image.Resampling.BICUBIC&quot;</span><span class="r11">),</span><span class="r9">                          </span>  
 <span class="r6">  2801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">  2802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ]</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot; Use &quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;, &quot;</span><span class="r15">.</span><span class="r11">join(filters[:</span><span class="r15">-1</span><span class="r11">]) </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot; or &quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> filters[</span><span class="r15">-1</span><span class="r11">]</span><span class="r9">                    </span>  
 <span class="r6">  2804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  2805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        image</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                           </span>  
 <span class="r6">  2807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> image</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">in</span><span class="r11"> (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">  2811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            resample </span><span class="r15">=</span><span class="r11"> Resampling</span><span class="r15">.</span><span class="r11">NEAREST</span><span class="r9">                                                      </span>  
 <span class="r6">  2812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">transform2(box, image</span><span class="r15">.</span><span class="r11">im, method, data, resample, fill)</span><span class="r9">                        </span>  
 <span class="r6">  2814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">transpose</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, method):</span><span class="r9">                                                               </span>  
 <span class="r6">  2816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Transpose image (flip or rotate in 90 degree steps)</span><span class="r9">                                    </span>  
 <span class="r6">  2818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param method: One of :py:data:`Transpose.FLIP_LEFT_RIGHT`,</span><span class="r9">                            </span>  
 <span class="r6">  2820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transpose.FLIP_TOP_BOTTOM`, :py:data:`Transpose.ROTATE_90`,</span><span class="r9">                </span>  
 <span class="r6">  2821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transpose.ROTATE_180`, :py:data:`Transpose.ROTATE_270`,</span><span class="r9">                    </span>  
 <span class="r6">  2822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">          :py:data:`Transpose.TRANSPOSE` or :py:data:`Transpose.TRANSVERSE`.</span><span class="r9">                   </span>  
 <span class="r6">  2823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: Returns a flipped or rotated copy of this image.</span><span class="r9">                             </span>  
 <span class="r6">  2824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">transpose(method))</span><span class="r9">                                            </span>  
 <span class="r6">  2828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">effect_spread</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, distance):</span><span class="r9">                                                         </span>  
 <span class="r6">  2830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Randomly spread pixels in an image.</span><span class="r9">                                                    </span>  
 <span class="r6">  2832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param distance: Distance to spread pixels.</span><span class="r9">                                            </span>  
 <span class="r6">  2834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  2836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">effect_spread(distance))</span><span class="r9">                                      </span>  
 <span class="r6">  2837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">toqimage</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  2839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Returns a QImage copy of this image&quot;&quot;&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  2840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageQt</span><span class="r9">                                                                  </span>  
 <span class="r6">  2841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">qt_is_installed:</span><span class="r9">                                                        </span>  
 <span class="r6">  2843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Qt bindings are not installed&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  2844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">(msg)</span><span class="r9">                                                             </span>  
 <span class="r6">  2845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">toqimage(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                          </span>  
 <span class="r6">  2846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">toqpixmap</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">  2848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Returns a QPixmap copy of this image&quot;&quot;&quot;</span><span class="r9">                                             </span>  
 <span class="r6">  2849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageQt</span><span class="r9">                                                                  </span>  
 <span class="r6">  2850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">qt_is_installed:</span><span class="r9">                                                        </span>  
 <span class="r6">  2852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Qt bindings are not installed&quot;</span><span class="r9">                                              </span>  
 <span class="r6">  2853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">(msg)</span><span class="r9">                                                             </span>  
 <span class="r6">  2854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">toqpixmap(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">  2855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  2858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Abstract handlers.</span><span class="r9">                                                                           </span>  
 <span class="r6">  2859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">ImagePointHandler</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">  2862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Used as a mixin by point transforms</span><span class="r9">                                                        </span>  
 <span class="r6">  2864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    (for use with :py:meth:`~PIL.Image.Image.point`)</span><span class="r9">                                           </span>  
 <span class="r6">  2865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">pass</span><span class="r9">                                                                                       </span>  
 <span class="r6">  2868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">ImageTransformHandler</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">  2871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Used as a mixin by geometry transforms</span><span class="r9">                                                     </span>  
 <span class="r6">  2873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    (for use with :py:meth:`~PIL.Image.Image.transform`)</span><span class="r9">                                       </span>  
 <span class="r6">  2874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">pass</span><span class="r9">                                                                                       </span>  
 <span class="r6">  2877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  2880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Factories</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">  2883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Debugging</span><span class="r9">                                                                                    </span>  
 <span class="r6">  2884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_wedge</span><span class="r11">():</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Create greyscale wedge (for debugging only)&quot;&quot;&quot;</span><span class="r9">                                          </span>  
 <span class="r6">  2888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">wedge(</span><span class="r16">&quot;L&quot;</span><span class="r11">))</span><span class="r9">                                                       </span>  
 <span class="r6">  2890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_check_size</span><span class="r11">(size):</span><span class="r9">                                                                         </span>  
 <span class="r6">  2893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Common check to enforce type and sanity check on size tuples</span><span class="r9">                               </span>  
 <span class="r6">  2895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: Should be a 2 tuple of (width, height)</span><span class="r9">                                        </span>  
 <span class="r6">  2897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: True, or raises a ValueError</span><span class="r9">                                                     </span>  
 <span class="r6">  2898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(size, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)):</span><span class="r9">                                                    </span>  
 <span class="r6">  2901 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Size must be a tuple&quot;</span><span class="r9">                                                           </span>  
 <span class="r6">  2902 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  2903 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(size) </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">2</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">  2904 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Size must be a tuple of length 2&quot;</span><span class="r9">                                               </span>  
 <span class="r6">  2905 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  2906 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  2907 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Width and height must be &gt;= 0&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">  2908 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  2909 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2910 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                                </span>  
 <span class="r6">  2911 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2912 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2913 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">new</span><span class="r11">(mode, size, color</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                                                  </span>  
 <span class="r6">  2914 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2915 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Creates a new image with the given mode and size.</span><span class="r9">                                          </span>  
 <span class="r6">  2916 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2917 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: The mode to use for the new image. See:</span><span class="r9">                                       </span>  
 <span class="r6">  2918 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       :ref:`concept-modes`.</span><span class="r9">                                                                   </span>  
 <span class="r6">  2919 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: A 2-tuple, containing (width, height) in pixels.</span><span class="r9">                              </span>  
 <span class="r6">  2920 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param color: What color to use for the image.  Default is black.</span><span class="r9">                          </span>  
 <span class="r6">  2921 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       If given, this should be a single integer or floating point value</span><span class="r9">                       </span>  
 <span class="r6">  2922 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       for single-band modes, and a tuple for multi-band modes (one value</span><span class="r9">                      </span>  
 <span class="r6">  2923 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       per band).  When creating RGB images, you can also use color</span><span class="r9">                            </span>  
 <span class="r6">  2924 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       strings as supported by the ImageColor module.  If the color is</span><span class="r9">                         </span>  
 <span class="r6">  2925 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       None, the image is not initialised.</span><span class="r9">                                                     </span>  
 <span class="r6">  2926 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  2927 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2928 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2929 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _check_size(size)</span><span class="r9">                                                                          </span>  
 <span class="r6">  2930 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2931 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> color </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">  2932 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># don&#x27;t initialize</span><span class="r9">                                                                     </span>  
 <span class="r6">  2933 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">new(mode, size))</span><span class="r9">                                              </span>  
 <span class="r6">  2934 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2935 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(color, </span><span class="r20">str</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">  2936 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># css3-style specifier</span><span class="r9">                                                                 </span>  
 <span class="r6">  2937 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2938 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageColor</span><span class="r9">                                                               </span>  
 <span class="r6">  2939 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2940 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        color </span><span class="r15">=</span><span class="r11"> ImageColor</span><span class="r15">.</span><span class="r11">getcolor(color, mode)</span><span class="r9">                                               </span>  
 <span class="r6">  2941 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2942 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im </span><span class="r15">=</span><span class="r11"> Image()</span><span class="r9">                                                                               </span>  
 <span class="r6">  2943 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(color, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)) </span><span class="r19">and</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(color) </span><span class="r19">in</span><span class="r11"> [</span><span class="r15">3</span><span class="r11">, </span><span class="r15">4</span><span class="r11">]:</span><span class="r9">              </span>  
 <span class="r6">  2944 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># RGB or RGBA value for a P image</span><span class="r9">                                                      </span>  
 <span class="r6">  2945 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                             </span>  
 <span class="r6">  2946 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2947 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette()</span><span class="r9">                                               </span>  
 <span class="r6">  2948 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        color </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">getcolor(color)</span><span class="r9">                                                     </span>  
 <span class="r6">  2949 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">fill(mode, size, color))</span><span class="r9">                                               </span>  
 <span class="r6">  2950 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2951 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2952 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">frombytes</span><span class="r11">(mode, size, data, decoder_name</span><span class="r15">=</span><span class="r16">&quot;raw&quot;</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                    </span>  
 <span class="r6">  2953 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2954 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Creates a copy of an image memory from pixel data in a buffer.</span><span class="r9">                             </span>  
 <span class="r6">  2955 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2956 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    In its simplest form, this function takes three arguments</span><span class="r9">                                  </span>  
 <span class="r6">  2957 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    (mode, size, and unpacked pixel data).</span><span class="r9">                                                     </span>  
 <span class="r6">  2958 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2959 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    You can also use any pixel decoder supported by PIL. For more</span><span class="r9">                              </span>  
 <span class="r6">  2960 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    information on available decoders, see the section</span><span class="r9">                                         </span>  
 <span class="r6">  2961 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :ref:`Writing Your Own File Codec &lt;file-codecs&gt;`.</span><span class="r9">                                          </span>  
 <span class="r6">  2962 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2963 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Note that this function decodes pixel data only, not entire images.</span><span class="r9">                        </span>  
 <span class="r6">  2964 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If you have an entire image in a string, wrap it in a</span><span class="r9">                                      </span>  
 <span class="r6">  2965 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:class:`~io.BytesIO` object, and use :py:func:`~PIL.Image.open` to load</span><span class="r9">                 </span>  
 <span class="r6">  2966 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    it.</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2967 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2968 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: The image mode. See: :ref:`concept-modes`.</span><span class="r9">                                    </span>  
 <span class="r6">  2969 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: The image size.</span><span class="r9">                                                               </span>  
 <span class="r6">  2970 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param data: A byte buffer containing raw data for the given mode.</span><span class="r9">                         </span>  
 <span class="r6">  2971 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param decoder_name: What decoder to use.</span><span class="r9">                                                  </span>  
 <span class="r6">  2972 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param args: Additional parameters for the given decoder.</span><span class="r9">                                  </span>  
 <span class="r6">  2973 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  2974 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2975 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2976 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _check_size(size)</span><span class="r9">                                                                          </span>  
 <span class="r6">  2977 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2978 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># may pass tuple instead of argument list</span><span class="r9">                                                  </span>  
 <span class="r6">  2979 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(args) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args[</span><span class="r15">0</span><span class="r11">], </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">  2980 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                         </span>  
 <span class="r6">  2981 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2982 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> decoder_name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;raw&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> args </span><span class="r15">==</span><span class="r11"> ():</span><span class="r9">                                                   </span>  
 <span class="r6">  2983 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                            </span>  
 <span class="r6">  2984 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2985 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im </span><span class="r15">=</span><span class="r11"> new(mode, size)</span><span class="r9">                                                                       </span>  
 <span class="r6">  2986 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im</span><span class="r15">.</span><span class="r11">frombytes(data, decoder_name, args)</span><span class="r9">                                                     </span>  
 <span class="r6">  2987 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                                  </span>  
 <span class="r6">  2988 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2989 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2990 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">frombuffer</span><span class="r11">(mode, size, data, decoder_name</span><span class="r15">=</span><span class="r16">&quot;raw&quot;</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                   </span>  
 <span class="r6">  2991 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  2992 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Creates an image memory referencing pixel data in a byte buffer.</span><span class="r9">                           </span>  
 <span class="r6">  2993 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2994 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This function is similar to :py:func:`~PIL.Image.frombytes`, but uses data</span><span class="r9">                 </span>  
 <span class="r6">  2995 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    in the byte buffer, where possible.  This means that changes to the</span><span class="r9">                        </span>  
 <span class="r6">  2996 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    original buffer object are reflected in this image).  Not all modes can</span><span class="r9">                    </span>  
 <span class="r6">  2997 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    share memory; supported modes include &quot;L&quot;, &quot;RGBX&quot;, &quot;RGBA&quot;, and &quot;CMYK&quot;.</span><span class="r9">                     </span>  
 <span class="r6">  2998 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  2999 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Note that this function decodes pixel data only, not entire images.</span><span class="r9">                        </span>  
 <span class="r6">  3000 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If you have an entire image file in a string, wrap it in a</span><span class="r9">                                 </span>  
 <span class="r6">  3001 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:class:`~io.BytesIO` object, and use :py:func:`~PIL.Image.open` to load it.</span><span class="r9">             </span>  
 <span class="r6">  3002 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3003 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    In the current version, the default parameters used for the &quot;raw&quot; decoder</span><span class="r9">                  </span>  
 <span class="r6">  3004 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    differs from that used for :py:func:`~PIL.Image.frombytes`.  This is a</span><span class="r9">                     </span>  
 <span class="r6">  3005 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    bug, and will probably be fixed in a future release.  The current release</span><span class="r9">                  </span>  
 <span class="r6">  3006 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    issues a warning if you do this; to disable the warning, you should provide</span><span class="r9">                </span>  
 <span class="r6">  3007 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the full set of parameters.  See below for details.</span><span class="r9">                                        </span>  
 <span class="r6">  3008 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3009 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: The image mode. See: :ref:`concept-modes`.</span><span class="r9">                                    </span>  
 <span class="r6">  3010 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: The image size.</span><span class="r9">                                                               </span>  
 <span class="r6">  3011 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param data: A bytes or other buffer object containing raw</span><span class="r9">                                 </span>  
 <span class="r6">  3012 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        data for the given mode.</span><span class="r9">                                                               </span>  
 <span class="r6">  3013 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param decoder_name: What decoder to use.</span><span class="r9">                                                  </span>  
 <span class="r6">  3014 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param args: Additional parameters for the given decoder.  For the</span><span class="r9">                         </span>  
 <span class="r6">  3015 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        default encoder (&quot;raw&quot;), it&#x27;s recommended that you provide the</span><span class="r9">                         </span>  
 <span class="r6">  3016 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        full set of parameters::</span><span class="r9">                                                               </span>  
 <span class="r6">  3017 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3018 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            frombuffer(mode, size, data, &quot;raw&quot;, mode, 0, 1)</span><span class="r9">                                    </span>  
 <span class="r6">  3019 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3020 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3021 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3022 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    .. versionadded:: 1.1.4</span><span class="r9">                                                                    </span>  
 <span class="r6">  3023 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3024 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3025 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _check_size(size)</span><span class="r9">                                                                          </span>  
 <span class="r6">  3026 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3027 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># may pass tuple instead of argument list</span><span class="r9">                                                  </span>  
 <span class="r6">  3028 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(args) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(args[</span><span class="r15">0</span><span class="r11">], </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">  3029 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        args </span><span class="r15">=</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                         </span>  
 <span class="r6">  3030 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3031 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> decoder_name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;raw&quot;</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">  3032 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> args </span><span class="r15">==</span><span class="r11"> ():</span><span class="r9">                                                                         </span>  
 <span class="r6">  3033 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            args </span><span class="r15">=</span><span class="r11"> mode, </span><span class="r15">0</span><span class="r11">, </span><span class="r15">1</span><span class="r9">                                                                  </span>  
 <span class="r6">  3034 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">] </span><span class="r19">in</span><span class="r11"> _MAPMODES:</span><span class="r9">                                                               </span>  
 <span class="r6">  3035 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> new(mode, (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">))</span><span class="r9">                                                             </span>  
 <span class="r6">  3036 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">map_buffer(data, size, decoder_name, </span><span class="r15">0</span><span class="r11">, args))</span><span class="r9">                   </span>  
 <span class="r6">  3037 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  3038 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImagePalette</span><span class="r9">                                                     </span>  
 <span class="r6">  3039 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3040 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                im</span><span class="r15">.</span><span class="r11">palette </span><span class="r15">=</span><span class="r11"> ImagePalette</span><span class="r15">.</span><span class="r11">ImagePalette(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">, im</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">getpalette(</span><span class="r16">&quot;RGB&quot;</span><span class="r11">))</span><span class="r9">         </span>  
 <span class="r6">  3041 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                    </span>  
 <span class="r6">  3042 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                          </span>  
 <span class="r6">  3043 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3044 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> frombytes(mode, size, data, decoder_name, args)</span><span class="r9">                                     </span>  
 <span class="r6">  3045 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3046 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3047 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">fromarray</span><span class="r11">(obj, mode</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                                 </span>  
 <span class="r6">  3048 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3049 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Creates an image memory from an object exporting the array interface</span><span class="r9">                       </span>  
 <span class="r6">  3050 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    (using the buffer protocol).</span><span class="r9">                                                               </span>  
 <span class="r6">  3051 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3052 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If ``obj`` is not contiguous, then the ``tobytes`` method is called</span><span class="r9">                        </span>  
 <span class="r6">  3053 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    and :py:func:`~PIL.Image.frombuffer` is used.</span><span class="r9">                                              </span>  
 <span class="r6">  3054 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3055 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    If you have an image in NumPy::</span><span class="r9">                                                            </span>  
 <span class="r6">  3056 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3057 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      from PIL import Image</span><span class="r9">                                                                    </span>  
 <span class="r6">  3058 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      import numpy as np</span><span class="r9">                                                                       </span>  
 <span class="r6">  3059 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      im = Image.open(&quot;hopper.jpg&quot;)</span><span class="r9">                                                            </span>  
 <span class="r6">  3060 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      a = np.asarray(im)</span><span class="r9">                                                                       </span>  
 <span class="r6">  3061 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3062 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Then this can be used to convert it to a Pillow image::</span><span class="r9">                                    </span>  
 <span class="r6">  3063 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3064 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      im = Image.fromarray(a)</span><span class="r9">                                                                  </span>  
 <span class="r6">  3065 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3066 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param obj: Object with array interface</span><span class="r9">                                                    </span>  
 <span class="r6">  3067 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Optional mode to use when reading ``obj``. Will be determined from</span><span class="r9">            </span>  
 <span class="r6">  3068 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      type if ``None``.</span><span class="r9">                                                                        </span>  
 <span class="r6">  3069 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3070 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      This will not be used to convert the data after reading, but will be used to</span><span class="r9">             </span>  
 <span class="r6">  3071 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      change how the data is read::</span><span class="r9">                                                            </span>  
 <span class="r6">  3072 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3073 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        from PIL import Image</span><span class="r9">                                                                  </span>  
 <span class="r6">  3074 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        import numpy as np</span><span class="r9">                                                                     </span>  
 <span class="r6">  3075 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        a = np.full((1, 1), 300)</span><span class="r9">                                                               </span>  
 <span class="r6">  3076 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        im = Image.fromarray(a, mode=&quot;L&quot;)</span><span class="r9">                                                      </span>  
 <span class="r6">  3077 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        im.getpixel((0, 0))  # 44</span><span class="r9">                                                              </span>  
 <span class="r6">  3078 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        im = Image.fromarray(a, mode=&quot;RGB&quot;)</span><span class="r9">                                                    </span>  
 <span class="r6">  3079 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        im.getpixel((0, 0))  # (44, 1, 0)</span><span class="r9">                                                      </span>  
 <span class="r6">  3080 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3081 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">      See: :ref:`concept-modes` for general information about modes.</span><span class="r9">                           </span>  
 <span class="r6">  3082 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An image object.</span><span class="r9">                                                                 </span>  
 <span class="r6">  3083 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3084 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    .. versionadded:: 1.1.6</span><span class="r9">                                                                    </span>  
 <span class="r6">  3085 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3086 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    arr </span><span class="r15">=</span><span class="r11"> obj</span><span class="r15">.</span><span class="r11">__array_interface__</span><span class="r9">                                                              </span>  
 <span class="r6">  3087 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    shape </span><span class="r15">=</span><span class="r11"> arr[</span><span class="r16">&quot;shape&quot;</span><span class="r11">]</span><span class="r9">                                                                       </span>  
 <span class="r6">  3088 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ndim </span><span class="r15">=</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(shape)</span><span class="r9">                                                                          </span>  
 <span class="r6">  3089 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    strides </span><span class="r15">=</span><span class="r11"> arr</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;strides&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">  3090 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">  3091 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3092 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            typekey </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> shape[</span><span class="r15">2</span><span class="r11">:], arr[</span><span class="r16">&quot;typestr&quot;</span><span class="r11">]</span><span class="r9">                                       </span>  
 <span class="r6">  3093 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                  </span>  
 <span class="r6">  3094 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot handle this data type&quot;</span><span class="r9">                                               </span>  
 <span class="r6">  3095 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                        </span>  
 <span class="r6">  3096 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3097 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mode, rawmode </span><span class="r15">=</span><span class="r11"> _fromarray_typemap[typekey]</span><span class="r9">                                        </span>  
 <span class="r6">  3098 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                  </span>  
 <span class="r6">  3099 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot handle this data type: </span><span class="r21">%s</span><span class="r16">, </span><span class="r21">%s</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> typekey</span><span class="r9">                             </span>  
 <span class="r6">  3100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                        </span>  
 <span class="r6">  3101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rawmode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                         </span>  
 <span class="r6">  3103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> [</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;P&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">]:</span><span class="r9">                                                      </span>  
 <span class="r6">  3104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ndmax </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                              </span>  
 <span class="r6">  3105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  3106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ndmax </span><span class="r15">=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                                              </span>  
 <span class="r6">  3107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ndmax </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                              </span>  
 <span class="r6">  3109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> ndim </span><span class="r15">&gt;</span><span class="r11"> ndmax:</span><span class="r9">                                                                           </span>  
 <span class="r6">  3110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;Too many dimensions: </span><span class="r21">{</span><span class="r11">ndim</span><span class="r21">}</span><span class="r16"> &gt; </span><span class="r21">{</span><span class="r11">ndmax</span><span class="r21">}</span><span class="r16">.&quot;</span><span class="r9">                                        </span>  
 <span class="r6">  3111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  3112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    size </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> ndim </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> shape[</span><span class="r15">1</span><span class="r11">], shape[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                              </span>  
 <span class="r6">  3114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> strides </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  3115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(obj, </span><span class="r16">&quot;tobytes&quot;</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">  3116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            obj </span><span class="r15">=</span><span class="r11"> obj</span><span class="r15">.</span><span class="r11">tobytes()</span><span class="r9">                                                                </span>  
 <span class="r6">  3117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            obj </span><span class="r15">=</span><span class="r11"> obj</span><span class="r15">.</span><span class="r11">tostring()</span><span class="r9">                                                               </span>  
 <span class="r6">  3119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> frombuffer(mode, size, obj, </span><span class="r16">&quot;raw&quot;</span><span class="r11">, rawmode, </span><span class="r15">0</span><span class="r11">, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                   </span>  
 <span class="r6">  3121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">fromqimage</span><span class="r11">(im):</span><span class="r9">                                                                            </span>  
 <span class="r6">  3124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Creates an image instance from a QImage image&quot;&quot;&quot;</span><span class="r9">                                        </span>  
 <span class="r6">  3125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageQt</span><span class="r9">                                                                      </span>  
 <span class="r6">  3126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">qt_is_installed:</span><span class="r9">                                                            </span>  
 <span class="r6">  3128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Qt bindings are not installed&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">  3129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">fromqimage(im)</span><span class="r9">                                                              </span>  
 <span class="r6">  3131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">fromqpixmap</span><span class="r11">(im):</span><span class="r9">                                                                           </span>  
 <span class="r6">  3134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Creates an image instance from a QPixmap image&quot;&quot;&quot;</span><span class="r9">                                       </span>  
 <span class="r6">  3135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageQt</span><span class="r9">                                                                      </span>  
 <span class="r6">  3136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">qt_is_installed:</span><span class="r9">                                                            </span>  
 <span class="r6">  3138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Qt bindings are not installed&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">  3139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ImportError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> ImageQt</span><span class="r15">.</span><span class="r11">fromqpixmap(im)</span><span class="r9">                                                             </span>  
 <span class="r6">  3141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_fromarray_typemap </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                         </span>  
 <span class="r6">  3144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># (shape, typestr) =&gt; mode, rawmode</span><span class="r9">                                                        </span>  
 <span class="r6">  3145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># first two members of shape are set to one</span><span class="r9">                                                </span>  
 <span class="r6">  3146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;|b1&quot;</span><span class="r11">): (</span><span class="r16">&quot;1&quot;</span><span class="r11">, </span><span class="r16">&quot;1;8&quot;</span><span class="r11">),</span><span class="r9">                                                             </span>  
 <span class="r6">  3147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;|u1&quot;</span><span class="r11">): (</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;L&quot;</span><span class="r11">),</span><span class="r9">                                                               </span>  
 <span class="r6">  3148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;|i1&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;8&quot;</span><span class="r11">),</span><span class="r9">                                                             </span>  
 <span class="r6">  3149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;u2&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16&quot;</span><span class="r11">),</span><span class="r9">                                                            </span>  
 <span class="r6">  3150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;u2&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16B&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;i2&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16S&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;i2&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;16BS&quot;</span><span class="r11">),</span><span class="r9">                                                          </span>  
 <span class="r6">  3153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;u4&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;32&quot;</span><span class="r11">),</span><span class="r9">                                                            </span>  
 <span class="r6">  3154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;u4&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;32B&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;i4&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;32S&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;i4&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I;32BS&quot;</span><span class="r11">),</span><span class="r9">                                                          </span>  
 <span class="r6">  3157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;f4&quot;</span><span class="r11">): (</span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;F;32F&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;f4&quot;</span><span class="r11">): (</span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;F;32BF&quot;</span><span class="r11">),</span><span class="r9">                                                          </span>  
 <span class="r6">  3159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&lt;f8&quot;</span><span class="r11">): (</span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;F;64F&quot;</span><span class="r11">),</span><span class="r9">                                                           </span>  
 <span class="r6">  3160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), </span><span class="r16">&quot;&gt;f8&quot;</span><span class="r11">): (</span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;F;64BF&quot;</span><span class="r11">),</span><span class="r9">                                                          </span>  
 <span class="r6">  3161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">2</span><span class="r11">), </span><span class="r16">&quot;|u1&quot;</span><span class="r11">): (</span><span class="r16">&quot;LA&quot;</span><span class="r11">, </span><span class="r16">&quot;LA&quot;</span><span class="r11">),</span><span class="r9">                                                          </span>  
 <span class="r6">  3162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">3</span><span class="r11">), </span><span class="r16">&quot;|u1&quot;</span><span class="r11">): (</span><span class="r16">&quot;RGB&quot;</span><span class="r11">, </span><span class="r16">&quot;RGB&quot;</span><span class="r11">),</span><span class="r9">                                                        </span>  
 <span class="r6">  3163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">4</span><span class="r11">), </span><span class="r16">&quot;|u1&quot;</span><span class="r11">): (</span><span class="r16">&quot;RGBA&quot;</span><span class="r11">, </span><span class="r16">&quot;RGBA&quot;</span><span class="r11">),</span><span class="r9">                                                      </span>  
 <span class="r6">  3164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># shortcuts:</span><span class="r9">                                                                               </span>  
 <span class="r6">  3165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), _ENDIAN </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;i4&quot;</span><span class="r11">): (</span><span class="r16">&quot;I&quot;</span><span class="r11">, </span><span class="r16">&quot;I&quot;</span><span class="r11">),</span><span class="r9">                                                      </span>  
 <span class="r6">  3166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ((</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">), _ENDIAN </span><span class="r15">+</span><span class="r11"> </span><span class="r16">&quot;f4&quot;</span><span class="r11">): (</span><span class="r16">&quot;F&quot;</span><span class="r11">, </span><span class="r16">&quot;F&quot;</span><span class="r11">),</span><span class="r9">                                                      </span>  
 <span class="r6">  3167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">  3168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_decompression_bomb_check</span><span class="r11">(size):</span><span class="r9">                                                           </span>  
 <span class="r6">  3171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> MAX_IMAGE_PIXELS </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">  3172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r9">                                                                                 </span>  
 <span class="r6">  3173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    pixels </span><span class="r15">=</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                                 </span>  
 <span class="r6">  3175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> pixels </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">2</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> MAX_IMAGE_PIXELS:</span><span class="r9">                                                          </span>  
 <span class="r6">  3177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                                </span>  
 <span class="r6">  3178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">f&quot;Image size (</span><span class="r21">{</span><span class="r11">pixels</span><span class="r21">}</span><span class="r16"> pixels) exceeds limit of </span><span class="r21">{</span><span class="r15">2</span><span class="r18"> </span><span class="r15">*</span><span class="r18"> </span><span class="r11">MAX_IMAGE_PIXELS</span><span class="r21">}</span><span class="r16"> &quot;</span><span class="r9">           </span>  
 <span class="r6">  3179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;pixels, could be decompression bomb DOS attack.&quot;</span><span class="r9">                                  </span>  
 <span class="r6">  3180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> DecompressionBombError(msg)</span><span class="r9">                                                      </span>  
 <span class="r6">  3182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> pixels </span><span class="r15">&gt;</span><span class="r11"> MAX_IMAGE_PIXELS:</span><span class="r9">                                                              </span>  
 <span class="r6">  3184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                                         </span>  
 <span class="r6">  3185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">f&quot;Image size (</span><span class="r21">{</span><span class="r11">pixels</span><span class="r21">}</span><span class="r16"> pixels) exceeds limit of </span><span class="r21">{</span><span class="r11">MAX_IMAGE_PIXELS</span><span class="r21">}</span><span class="r16"> pixels, &quot;</span><span class="r9">       </span>  
 <span class="r6">  3186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;could be decompression bomb DOS attack.&quot;</span><span class="r11">,</span><span class="r9">                                         </span>  
 <span class="r6">  3187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            DecompressionBombWarning,</span><span class="r9">                                                          </span>  
 <span class="r6">  3188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">open</span><span class="r11">(fp, mode</span><span class="r15">=</span><span class="r16">&quot;r&quot;</span><span class="r11">, formats</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, logging</span><span class="r15">=</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                           </span>  
 <span class="r6">  3192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Opens and identifies the given image file.</span><span class="r9">                                                 </span>  
 <span class="r6">  3194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    This is a lazy operation; this function identifies the file, but</span><span class="r9">                           </span>  
 <span class="r6">  3196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the file remains open and the actual image data is not read from</span><span class="r9">                           </span>  
 <span class="r6">  3197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    the file until you try to process the data (or call the</span><span class="r9">                                    </span>  
 <span class="r6">  3198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:meth:`~PIL.Image.Image.load` method).  See</span><span class="r9">                                             </span>  
 <span class="r6">  3199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :py:func:`~PIL.Image.new`. See :ref:`file-handling`.</span><span class="r9">                                       </span>  
 <span class="r6">  3200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param fp: A filename (string), pathlib.Path object or a file object.</span><span class="r9">                      </span>  
 <span class="r6">  3202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       The file object must implement ``file.read``,</span><span class="r9">                                           </span>  
 <span class="r6">  3203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       ``file.seek``, and ``file.tell`` methods,</span><span class="r9">                                               </span>  
 <span class="r6">  3204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       and be opened in binary mode.</span><span class="r9">                                                           </span>  
 <span class="r6">  3205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: The mode.  If given, this argument must be &quot;r&quot;.</span><span class="r9">                               </span>  
 <span class="r6">  3206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param formats: A list or tuple of formats to attempt to load the file in.</span><span class="r9">                 </span>  
 <span class="r6">  3207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       This can be used to restrict the set of formats checked.</span><span class="r9">                                </span>  
 <span class="r6">  3208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       Pass ``None`` to try all supported formats. You can print the set of</span><span class="r9">                    </span>  
 <span class="r6">  3209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       available formats by running ``python3 -m PIL`` or using</span><span class="r9">                                </span>  
 <span class="r6">  3210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       the :py:func:`PIL.features.pilinfo` function.</span><span class="r9">                                           </span>  
 <span class="r6">  3211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception FileNotFoundError: If the file cannot be found.</span><span class="r9">                                 </span>  
 <span class="r6">  3213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception PIL.UnidentifiedImageError: If the image cannot be opened and</span><span class="r9">                   </span>  
 <span class="r6">  3214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       identified.</span><span class="r9">                                                                             </span>  
 <span class="r6">  3215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception ValueError: If the ``mode`` is not &quot;r&quot;, or if a ``StringIO``</span><span class="r9">                    </span>  
 <span class="r6">  3216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       instance is used for ``fp``.</span><span class="r9">                                                            </span>  
 <span class="r6">  3217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :exception TypeError: If ``formats`` is not ``None``, a list or a tuple.</span><span class="r9">                   </span>  
 <span class="r6">  3218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;r&quot;</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">  3223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;bad mode </span><span class="r21">{</span><span class="r20">repr</span><span class="r11">(mode)</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">  3224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  3225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(fp, io</span><span class="r15">.</span><span class="r11">StringIO):</span><span class="r9">                                                          </span>  
 <span class="r6">  3226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                                </span>  
 <span class="r6">  3227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;StringIO cannot be used to open an image. &quot;</span><span class="r9">                                       </span>  
 <span class="r6">  3228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;Binary data must be used instead.&quot;</span><span class="r9">                                                </span>  
 <span class="r6">  3229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  3231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> formats </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">  3233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        formats </span><span class="r15">=</span><span class="r11"> ID</span><span class="r9">                                                                           </span>  
 <span class="r6">  3234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(formats, (</span><span class="r20">list</span><span class="r11">, </span><span class="r20">tuple</span><span class="r11">)):</span><span class="r9">                                               </span>  
 <span class="r6">  3235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;formats must be a list or tuple&quot;</span><span class="r9">                                                </span>  
 <span class="r6">  3236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">(msg)</span><span class="r9">                                                                   </span>  
 <span class="r6">  3237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    exclusive_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                       </span>  
 <span class="r6">  3239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    filename </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                              </span>  
 <span class="r6">  3240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(fp, Path):</span><span class="r9">                                                                   </span>  
 <span class="r6">  3241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        filename </span><span class="r15">=</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(fp</span><span class="r15">.</span><span class="r11">resolve())</span><span class="r9">                                                           </span>  
 <span class="r6">  3242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> is_path(fp):</span><span class="r9">                                                                          </span>  
 <span class="r6">  3243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        filename </span><span class="r15">=</span><span class="r11"> fp</span><span class="r9">                                                                          </span>  
 <span class="r6">  3244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> filename:</span><span class="r9">                                                                               </span>  
 <span class="r6">  3246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp </span><span class="r15">=</span><span class="r11"> builtins</span><span class="r15">.</span><span class="r11">open(filename, </span><span class="r16">&quot;rb&quot;</span><span class="r11">)</span><span class="r9">                                                     </span>  
 <span class="r6">  3247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exclusive_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                    </span>  
 <span class="r6">  3248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">  3250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp</span><span class="r15">.</span><span class="r11">seek(</span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                             </span>  
 <span class="r6">  3251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, io</span><span class="r15">.</span><span class="r11">UnsupportedOperation):</span><span class="r9">                                          </span>  
 <span class="r6">  3252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(fp</span><span class="r15">.</span><span class="r11">read())</span><span class="r9">                                                             </span>  
 <span class="r6">  3253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exclusive_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                    </span>  
 <span class="r6">  3254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3255 </span>│<span class="r7">    1%  </span>│<span class="r7">       </span>│<span class="r7">   5%  </span>│<span class="r11">    prefix </span><span class="r15">=</span><span class="r11"> fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">16</span><span class="r11">)</span><span class="r9">                                                                       </span>  
 <span class="r6">  3256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    preinit()</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    accept_warnings </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                       </span>  
 <span class="r6">  3260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_open_core</span><span class="r11">(fp, filename, prefix, formats):</span><span class="r9">                                             </span>  
 <span class="r6">  3262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> formats:</span><span class="r9">                                                                      </span>  
 <span class="r6">  3263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            i </span><span class="r15">=</span><span class="r11"> i</span><span class="r15">.</span><span class="r11">upper()</span><span class="r9">                                                                      </span>  
 <span class="r6">  3264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> i </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> OPEN:</span><span class="r9">                                                                  </span>  
 <span class="r6">  3265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                init()</span><span class="r9">                                                                         </span>  
 <span class="r6">  3266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">  3267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># import pdb</span><span class="r9">                                                                   </span>  
 <span class="r6">  3268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># pdb.set_trace()</span><span class="r9">                                                              </span>  
 <span class="r6">  3269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                factory, accept </span><span class="r15">=</span><span class="r11"> OPEN[i]</span><span class="r9">                                                      </span>  
 <span class="r6">  3270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                result </span><span class="r15">=</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> accept </span><span class="r19">or</span><span class="r11"> accept(prefix)</span><span class="r9">                                          </span>  
 <span class="r6">  3271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">type</span><span class="r11">(result) </span><span class="r19">in</span><span class="r11"> [</span><span class="r20">str</span><span class="r11">, </span><span class="r20">bytes</span><span class="r11">]:</span><span class="r9">                                               </span>  
 <span class="r6">  3272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    accept_warnings</span><span class="r15">.</span><span class="r11">append(result)</span><span class="r9">                                             </span>  
 <span class="r6">  3273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">elif</span><span class="r11"> result:</span><span class="r9">                                                                   </span>  
 <span class="r6">  3274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    fp</span><span class="r15">.</span><span class="r11">seek(</span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im </span><span class="r15">=</span><span class="r11"> factory(fp, filename, logging</span><span class="r15">=</span><span class="r11">logging)</span><span class="r9">                                </span>  
 <span class="r6">  3276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    _decompression_bomb_check(im</span><span class="r15">.</span><span class="r11">size)</span><span class="r9">                                         </span>  
 <span class="r6">  3277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                  </span>  
 <span class="r6">  3278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">SyntaxError</span><span class="r11">, </span><span class="r13">IndexError</span><span class="r11">, </span><span class="r13">TypeError</span><span class="r11">, struct</span><span class="r15">.</span><span class="r11">error):</span><span class="r9">                         </span>  
 <span class="r6">  3279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Leave disabled by default, spams the logs with image</span><span class="r9">                         </span>  
 <span class="r6">  3280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># opening failures that are entirely expected.</span><span class="r9">                                 </span>  
 <span class="r6">  3281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># logger.debug(&quot;&quot;, exc_info=True)</span><span class="r9">                                              </span>  
 <span class="r6">  3282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">continue</span><span class="r9">                                                                       </span>  
 <span class="r6">  3283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">BaseException</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  3284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> exclusive_fp:</span><span class="r9">                                                               </span>  
 <span class="r6">  3285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                 </span>  
 <span class="r6">  3286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r9">                                                                          </span>  
 <span class="r6">  3287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                            </span>  
 <span class="r6">  3288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im </span><span class="r15">=</span><span class="r11"> _open_core(fp, filename, prefix, formats)</span><span class="r9">                                             </span>  
 <span class="r6">  3290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> im </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                             </span>  
 <span class="r6">  3292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> init():</span><span class="r9">                                                                             </span>  
 <span class="r6">  3293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> _open_core(fp, filename, prefix, formats)</span><span class="r9">                                     </span>  
 <span class="r6">  3294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> im:</span><span class="r9">                                                                                     </span>  
 <span class="r6">  3296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im</span><span class="r15">.</span><span class="r11">_exclusive_fp </span><span class="r15">=</span><span class="r11"> exclusive_fp</span><span class="r9">                                                        </span>  
 <span class="r6">  3297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                              </span>  
 <span class="r6">  3298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> exclusive_fp:</span><span class="r9">                                                                           </span>  
 <span class="r6">  3300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                             </span>  
 <span class="r6">  3301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> message </span><span class="r19">in</span><span class="r11"> accept_warnings:</span><span class="r9">                                                            </span>  
 <span class="r6">  3302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(message)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot identify image file </span><span class="r21">%r</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (filename </span><span class="r10">if</span><span class="r11"> filename </span><span class="r10">else</span><span class="r11"> fp)</span><span class="r9">                     </span>  
 <span class="r6">  3304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">raise</span><span class="r11"> UnidentifiedImageError(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">  3305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">  3308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Image processing.</span><span class="r9">                                                                            </span>  
 <span class="r6">  3309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">alpha_composite</span><span class="r11">(im1, im2):</span><span class="r9">                                                                 </span>  
 <span class="r6">  3312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Alpha composite im2 over im1.</span><span class="r9">                                                              </span>  
 <span class="r6">  3314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param im1: The first image. Must have mode RGBA.</span><span class="r9">                                          </span>  
 <span class="r6">  3316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param im2: The second image.  Must have mode RGBA, and the same size as</span><span class="r9">                   </span>  
 <span class="r6">  3317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       the first image.</span><span class="r9">                                                                        </span>  
 <span class="r6">  3318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im1</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                                 </span>  
 <span class="r6">  3322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im2</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                                 </span>  
 <span class="r6">  3323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> im1</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">alpha_composite(im1</span><span class="r15">.</span><span class="r11">im, im2</span><span class="r15">.</span><span class="r11">im))</span><span class="r9">                                      </span>  
 <span class="r6">  3324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">blend</span><span class="r11">(im1, im2, alpha):</span><span class="r9">                                                                    </span>  
 <span class="r6">  3327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Creates a new image by interpolating between two input images, using</span><span class="r9">                       </span>  
 <span class="r6">  3329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    a constant alpha::</span><span class="r9">                                                                         </span>  
 <span class="r6">  3330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        out = image1 * (1.0 - alpha) + image2 * alpha</span><span class="r9">                                          </span>  
 <span class="r6">  3332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param im1: The first image.</span><span class="r9">                                                               </span>  
 <span class="r6">  3334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param im2: The second image.  Must have the same mode and size as</span><span class="r9">                         </span>  
 <span class="r6">  3335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       the first image.</span><span class="r9">                                                                        </span>  
 <span class="r6">  3336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param alpha: The interpolation alpha factor.  If alpha is 0.0, a</span><span class="r9">                          </span>  
 <span class="r6">  3337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       copy of the first image is returned. If alpha is 1.0, a copy of</span><span class="r9">                         </span>  
 <span class="r6">  3338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       the second image is returned. There are no restrictions on the</span><span class="r9">                          </span>  
 <span class="r6">  3339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       alpha value. If necessary, the result is clipped to fit into</span><span class="r9">                            </span>  
 <span class="r6">  3340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       the allowed output range.</span><span class="r9">                                                               </span>  
 <span class="r6">  3341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im1</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                                 </span>  
 <span class="r6">  3345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im2</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                                 </span>  
 <span class="r6">  3346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> im1</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">blend(im1</span><span class="r15">.</span><span class="r11">im, im2</span><span class="r15">.</span><span class="r11">im, alpha))</span><span class="r9">                                         </span>  
 <span class="r6">  3347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">composite</span><span class="r11">(image1, image2, mask):</span><span class="r9">                                                           </span>  
 <span class="r6">  3350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Create composite image by blending images using a transparency mask.</span><span class="r9">                       </span>  
 <span class="r6">  3352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param image1: The first image.</span><span class="r9">                                                            </span>  
 <span class="r6">  3354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param image2: The second image.  Must have the same mode and</span><span class="r9">                              </span>  
 <span class="r6">  3355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       size as the first image.</span><span class="r9">                                                                </span>  
 <span class="r6">  3356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mask: A mask image.  This image can have mode</span><span class="r9">                                       </span>  
 <span class="r6">  3357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       &quot;1&quot;, &quot;L&quot;, or &quot;RGBA&quot;, and must have the same size as the</span><span class="r9">                                 </span>  
 <span class="r6">  3358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       other two images.</span><span class="r9">                                                                       </span>  
 <span class="r6">  3359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    image </span><span class="r15">=</span><span class="r11"> image2</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                                      </span>  
 <span class="r6">  3362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    image</span><span class="r15">.</span><span class="r11">paste(image1, </span><span class="r10">None</span><span class="r11">, mask)</span><span class="r9">                                                            </span>  
 <span class="r6">  3363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> image</span><span class="r9">                                                                               </span>  
 <span class="r6">  3364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">eval</span><span class="r11">(image, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                                        </span>  
 <span class="r6">  3367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Applies the function (which should take one argument) to each pixel</span><span class="r9">                        </span>  
 <span class="r6">  3369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    in the given image. If the image has more than one band, the same</span><span class="r9">                          </span>  
 <span class="r6">  3370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    function is applied to each band. Note that the function is</span><span class="r9">                                </span>  
 <span class="r6">  3371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    evaluated once for each possible pixel value, so you cannot use</span><span class="r9">                            </span>  
 <span class="r6">  3372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    random components or other generators.</span><span class="r9">                                                     </span>  
 <span class="r6">  3373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param image: The input image.</span><span class="r9">                                                             </span>  
 <span class="r6">  3375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param function: A function object, taking one integer argument.</span><span class="r9">                           </span>  
 <span class="r6">  3376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> image</span><span class="r15">.</span><span class="r11">point(args[</span><span class="r15">0</span><span class="r11">])</span><span class="r9">                                                                </span>  
 <span class="r6">  3380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">merge</span><span class="r11">(mode, bands):</span><span class="r9">                                                                        </span>  
 <span class="r6">  3383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Merge a set of single band images into a new multiband image.</span><span class="r9">                              </span>  
 <span class="r6">  3385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: The mode to use for the output image. See:</span><span class="r9">                                    </span>  
 <span class="r6">  3387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :ref:`concept-modes`.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param bands: A sequence containing one single-band image for</span><span class="r9">                              </span>  
 <span class="r6">  3389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        each band in the output image.  All bands must have the</span><span class="r9">                                </span>  
 <span class="r6">  3390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        same size.</span><span class="r9">                                                                             </span>  
 <span class="r6">  3391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: An :py:class:`~PIL.Image.Image` object.</span><span class="r9">                                          </span>  
 <span class="r6">  3392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> getmodebands(mode) </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(bands) </span><span class="r19">or</span><span class="r11"> </span><span class="r16">&quot;*&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> mode:</span><span class="r9">                                        </span>  
 <span class="r6">  3395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;wrong number of bands&quot;</span><span class="r9">                                                          </span>  
 <span class="r6">  3396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">  3397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> band </span><span class="r19">in</span><span class="r11"> bands[</span><span class="r15">1</span><span class="r11">:]:</span><span class="r9">                                                                     </span>  
 <span class="r6">  3398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> band</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> getmodetype(mode):</span><span class="r9">                                                     </span>  
 <span class="r6">  3399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;mode mismatch&quot;</span><span class="r9">                                                              </span>  
 <span class="r6">  3400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  3401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> band</span><span class="r15">.</span><span class="r11">size </span><span class="r15">!=</span><span class="r11"> bands[</span><span class="r15">0</span><span class="r11">]</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">                                                         </span>  
 <span class="r6">  3402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;size mismatch&quot;</span><span class="r9">                                                              </span>  
 <span class="r6">  3403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">  3404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> band </span><span class="r19">in</span><span class="r11"> bands:</span><span class="r9">                                                                         </span>  
 <span class="r6">  3405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        band</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                            </span>  
 <span class="r6">  3406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> bands[</span><span class="r15">0</span><span class="r11">]</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">merge(mode, </span><span class="r15">*</span><span class="r11">[b</span><span class="r15">.</span><span class="r11">im </span><span class="r10">for</span><span class="r11"> b </span><span class="r19">in</span><span class="r11"> bands]))</span><span class="r9">                             </span>  
 <span class="r6">  3407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  3410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Plugin registry</span><span class="r9">                                                                              </span>  
 <span class="r6">  3411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_open</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, factory, accept</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                   </span>  
 <span class="r6">  3414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Register an image file plugin.  This function should not be used</span><span class="r9">                           </span>  
 <span class="r6">  3416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    in application code.</span><span class="r9">                                                                       </span>  
 <span class="r6">  3417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param factory: An image file factory method.</span><span class="r9">                                              </span>  
 <span class="r6">  3420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param accept: An optional function that can be used to quickly</span><span class="r9">                            </span>  
 <span class="r6">  3421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       reject images having another format.</span><span class="r9">                                                    </span>  
 <span class="r6">  3422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">id</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r20">id</span><span class="r15">.</span><span class="r11">upper()</span><span class="r9">                                                                            </span>  
 <span class="r6">  3424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ID</span><span class="r15">.</span><span class="r11">append(</span><span class="r20">id</span><span class="r11">)</span><span class="r9">                                                                              </span>  
 <span class="r6">  3425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    OPEN[</span><span class="r20">id</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> factory, accept</span><span class="r9">                                                                 </span>  
 <span class="r6">  3426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_mime</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, mimetype):</span><span class="r9">                                                               </span>  
 <span class="r6">  3429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image MIME type.  This function should not be used</span><span class="r9">                            </span>  
 <span class="r6">  3431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    in application code.</span><span class="r9">                                                                       </span>  
 <span class="r6">  3432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mimetype: The image MIME type for this format.</span><span class="r9">                                      </span>  
 <span class="r6">  3435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    MIME[</span><span class="r20">id</span><span class="r15">.</span><span class="r11">upper()] </span><span class="r15">=</span><span class="r11"> mimetype</span><span class="r9">                                                                </span>  
 <span class="r6">  3437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_save</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, driver):</span><span class="r9">                                                                 </span>  
 <span class="r6">  3440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image save function.  This function should not be</span><span class="r9">                             </span>  
 <span class="r6">  3442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param driver: A function to save images in this format.</span><span class="r9">                                   </span>  
 <span class="r6">  3446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    SAVE[</span><span class="r20">id</span><span class="r15">.</span><span class="r11">upper()] </span><span class="r15">=</span><span class="r11"> driver</span><span class="r9">                                                                  </span>  
 <span class="r6">  3448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_save_all</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, driver):</span><span class="r9">                                                             </span>  
 <span class="r6">  3451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image function to save all the frames</span><span class="r9">                                         </span>  
 <span class="r6">  3453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    of a multiframe format.  This function should not be</span><span class="r9">                                       </span>  
 <span class="r6">  3454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param driver: A function to save images in this format.</span><span class="r9">                                   </span>  
 <span class="r6">  3458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    SAVE_ALL[</span><span class="r20">id</span><span class="r15">.</span><span class="r11">upper()] </span><span class="r15">=</span><span class="r11"> driver</span><span class="r9">                                                              </span>  
 <span class="r6">  3460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_extension</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, extension):</span><span class="r9">                                                         </span>  
 <span class="r6">  3463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image extension.  This function should not be</span><span class="r9">                                 </span>  
 <span class="r6">  3465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param extension: An extension used for this format.</span><span class="r9">                                       </span>  
 <span class="r6">  3469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    EXTENSION[extension</span><span class="r15">.</span><span class="r11">lower()] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">id</span><span class="r15">.</span><span class="r11">upper()</span><span class="r9">                                                  </span>  
 <span class="r6">  3471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_extensions</span><span class="r11">(</span><span class="r20">id</span><span class="r11">, extensions):</span><span class="r9">                                                       </span>  
 <span class="r6">  3474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers image extensions.  This function should not be</span><span class="r9">                                   </span>  
 <span class="r6">  3476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param id: An image format identifier.</span><span class="r9">                                                     </span>  
 <span class="r6">  3479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param extensions: A list of extensions used for this format.</span><span class="r9">                              </span>  
 <span class="r6">  3480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> extension </span><span class="r19">in</span><span class="r11"> extensions:</span><span class="r9">                                                               </span>  
 <span class="r6">  3482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        register_extension(</span><span class="r20">id</span><span class="r11">, extension)</span><span class="r9">                                                      </span>  
 <span class="r6">  3483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">registered_extensions</span><span class="r11">():</span><span class="r9">                                                                   </span>  
 <span class="r6">  3486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Returns a dictionary containing all file extensions belonging</span><span class="r9">                              </span>  
 <span class="r6">  3488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    to registered plugins</span><span class="r9">                                                                      </span>  
 <span class="r6">  3489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    init()</span><span class="r9">                                                                                     </span>  
 <span class="r6">  3491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> EXTENSION</span><span class="r9">                                                                           </span>  
 <span class="r6">  3492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_decoder</span><span class="r11">(name, decoder):</span><span class="r9">                                                           </span>  
 <span class="r6">  3495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image decoder.  This function should not be</span><span class="r9">                                   </span>  
 <span class="r6">  3497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param name: The name of the decoder</span><span class="r9">                                                       </span>  
 <span class="r6">  3500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param decoder: A callable(mode, args) that returns an</span><span class="r9">                                     </span>  
 <span class="r6">  3501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    ImageFile.PyDecoder object</span><span class="r9">                                                 </span>  
 <span class="r6">  3502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    .. versionadded:: 4.1.0</span><span class="r9">                                                                    </span>  
 <span class="r6">  3504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    DECODERS[name] </span><span class="r15">=</span><span class="r11"> decoder</span><span class="r9">                                                                   </span>  
 <span class="r6">  3506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">register_encoder</span><span class="r11">(name, encoder):</span><span class="r9">                                                           </span>  
 <span class="r6">  3509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Registers an image encoder.  This function should not be</span><span class="r9">                                   </span>  
 <span class="r6">  3511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    used in application code.</span><span class="r9">                                                                  </span>  
 <span class="r6">  3512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param name: The name of the encoder</span><span class="r9">                                                       </span>  
 <span class="r6">  3514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param encoder: A callable(mode, args) that returns an</span><span class="r9">                                     </span>  
 <span class="r6">  3515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                    ImageFile.PyEncoder object</span><span class="r9">                                                 </span>  
 <span class="r6">  3516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    .. versionadded:: 4.1.0</span><span class="r9">                                                                    </span>  
 <span class="r6">  3518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ENCODERS[name] </span><span class="r15">=</span><span class="r11"> encoder</span><span class="r9">                                                                   </span>  
 <span class="r6">  3520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  3523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Simple display support.</span><span class="r9">                                                                      </span>  
 <span class="r6">  3524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_show</span><span class="r11">(image, </span><span class="r15">**</span><span class="r11">options):</span><span class="r9">                                                                   </span>  
 <span class="r6">  3527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageShow</span><span class="r9">                                                                    </span>  
 <span class="r6">  3528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ImageShow</span><span class="r15">.</span><span class="r11">show(image, </span><span class="r15">**</span><span class="r11">options)</span><span class="r9">                                                           </span>  
 <span class="r6">  3530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  3533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Effects</span><span class="r9">                                                                                      </span>  
 <span class="r6">  3534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">effect_mandelbrot</span><span class="r11">(size, extent, quality):</span><span class="r9">                                                  </span>  
 <span class="r6">  3537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Generate a Mandelbrot set covering the given extent.</span><span class="r9">                                       </span>  
 <span class="r6">  3539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: The requested size in pixels, as a 2-tuple:</span><span class="r9">                                   </span>  
 <span class="r6">  3541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       (width, height).</span><span class="r9">                                                                        </span>  
 <span class="r6">  3542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param extent: The extent to cover, as a 4-tuple:</span><span class="r9">                                          </span>  
 <span class="r6">  3543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       (x0, y0, x1, y1).</span><span class="r9">                                                                       </span>  
 <span class="r6">  3544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param quality: Quality.</span><span class="r9">                                                                   </span>  
 <span class="r6">  3545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">effect_mandelbrot(size, extent, quality))</span><span class="r9">                         </span>  
 <span class="r6">  3547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">effect_noise</span><span class="r11">(size, sigma):</span><span class="r9">                                                                 </span>  
 <span class="r6">  3550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Generate Gaussian noise centered around 128.</span><span class="r9">                                               </span>  
 <span class="r6">  3552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: The requested size in pixels, as a 2-tuple:</span><span class="r9">                                   </span>  
 <span class="r6">  3554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">       (width, height).</span><span class="r9">                                                                        </span>  
 <span class="r6">  3555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param sigma: Standard deviation of noise.</span><span class="r9">                                                 </span>  
 <span class="r6">  3556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">effect_noise(size, sigma))</span><span class="r9">                                        </span>  
 <span class="r6">  3558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">linear_gradient</span><span class="r11">(mode):</span><span class="r9">                                                                     </span>  
 <span class="r6">  3561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Generate 256x256 linear gradient from black to white, top to bottom.</span><span class="r9">                       </span>  
 <span class="r6">  3563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">  3565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">linear_gradient(mode))</span><span class="r9">                                            </span>  
 <span class="r6">  3567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">radial_gradient</span><span class="r11">(mode):</span><span class="r9">                                                                     </span>  
 <span class="r6">  3570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Generate 256x256 radial gradient from black to white, centre to edge.</span><span class="r9">                      </span>  
 <span class="r6">  3572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param mode: Input mode.</span><span class="r9">                                                                   </span>  
 <span class="r6">  3574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">  3575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> Image()</span><span class="r15">.</span><span class="r11">_new(core</span><span class="r15">.</span><span class="r11">radial_gradient(mode))</span><span class="r9">                                            </span>  
 <span class="r6">  3576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">  3579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Resources</span><span class="r9">                                                                                    </span>  
 <span class="r6">  3580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_apply_env_variables</span><span class="r11">(env</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">  3583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> env </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">  3584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        env </span><span class="r15">=</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">environ</span><span class="r9">                                                                       </span>  
 <span class="r6">  3585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> var_name, setter </span><span class="r19">in</span><span class="r11"> [</span><span class="r9">                                                                  </span>  
 <span class="r6">  3587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        (</span><span class="r16">&quot;PILLOW_ALIGNMENT&quot;</span><span class="r11">, core</span><span class="r15">.</span><span class="r11">set_alignment),</span><span class="r9">                                              </span>  
 <span class="r6">  3588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        (</span><span class="r16">&quot;PILLOW_BLOCK_SIZE&quot;</span><span class="r11">, core</span><span class="r15">.</span><span class="r11">set_block_size),</span><span class="r9">                                            </span>  
 <span class="r6">  3589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        (</span><span class="r16">&quot;PILLOW_BLOCKS_MAX&quot;</span><span class="r11">, core</span><span class="r15">.</span><span class="r11">set_blocks_max),</span><span class="r9">                                            </span>  
 <span class="r6">  3590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ]:</span><span class="r9">                                                                                         </span>  
 <span class="r6">  3591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> var_name </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> env:</span><span class="r9">                                                                </span>  
 <span class="r6">  3592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">continue</span><span class="r9">                                                                           </span>  
 <span class="r6">  3593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        var </span><span class="r15">=</span><span class="r11"> env[var_name]</span><span class="r15">.</span><span class="r11">lower()</span><span class="r9">                                                            </span>  
 <span class="r6">  3595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        units </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                              </span>  
 <span class="r6">  3597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> postfix, mul </span><span class="r19">in</span><span class="r11"> [(</span><span class="r16">&quot;k&quot;</span><span class="r11">, </span><span class="r15">1024</span><span class="r11">), (</span><span class="r16">&quot;m&quot;</span><span class="r11">, </span><span class="r15">1024</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> </span><span class="r15">1024</span><span class="r11">)]:</span><span class="r9">                                 </span>  
 <span class="r6">  3598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> var</span><span class="r15">.</span><span class="r11">endswith(postfix):</span><span class="r9">                                                          </span>  
 <span class="r6">  3599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                units </span><span class="r15">=</span><span class="r11"> mul</span><span class="r9">                                                                    </span>  
 <span class="r6">  3600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                var </span><span class="r15">=</span><span class="r11"> var[: </span><span class="r15">-</span><span class="r20">len</span><span class="r11">(postfix)]</span><span class="r9">                                                     </span>  
 <span class="r6">  3601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            var </span><span class="r15">=</span><span class="r11"> </span><span class="r20">int</span><span class="r11">(var) </span><span class="r15">*</span><span class="r11"> units</span><span class="r9">                                                             </span>  
 <span class="r6">  3604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  3605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r11">var_name</span><span class="r21">}</span><span class="r16"> is not int&quot;</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">  3606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">continue</span><span class="r9">                                                                           </span>  
 <span class="r6">  3607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            setter(var)</span><span class="r9">                                                                        </span>  
 <span class="r6">  3610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                </span>  
 <span class="r6">  3611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r11">var_name</span><span class="r21">}</span><span class="r16">: </span><span class="r21">{</span><span class="r11">e</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r11">)</span><span class="r9">                                                  </span>  
 <span class="r6">  3612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">_apply_env_variables()</span><span class="r9">                                                                         </span>  
 <span class="r6">  3615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">atexit</span><span class="r15">.</span><span class="r11">register(core</span><span class="r15">.</span><span class="r11">clear_cache)</span><span class="r9">                                                              </span>  
 <span class="r6">  3616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Exif</span><span class="r11">(MutableMapping):</span><span class="r9">                                                                    </span>  
 <span class="r6">  3619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    endian </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                              </span>  
 <span class="r6">  3620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    bigtiff </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                            </span>  
 <span class="r6">  3621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  3623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                        </span>  
 <span class="r6">  3624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                 </span>  
 <span class="r6">  3625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                        </span>  
 <span class="r6">  3626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                      </span>  
 <span class="r6">  3627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_loaded_exif </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">  3628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_fixup</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, value):</span><span class="r9">                                                                   </span>  
 <span class="r6">  3630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(value) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                   </span>  
 <span class="r6">  3632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">return</span><span class="r11"> value[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                </span>  
 <span class="r6">  3633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">  3634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">  3635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> value</span><span class="r9">                                                                           </span>  
 <span class="r6">  3636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_fixup_dict</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, src_dict):</span><span class="r9">                                                           </span>  
 <span class="r6">  3638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Helper function</span><span class="r9">                                                                      </span>  
 <span class="r6">  3639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># returns a dict with any single item tuples/lists as individual values</span><span class="r9">                </span>  
 <span class="r6">  3640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> {k: </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fixup(v) </span><span class="r10">for</span><span class="r11"> k, v </span><span class="r19">in</span><span class="r11"> src_dict</span><span class="r15">.</span><span class="r11">items()}</span><span class="r9">                                </span>  
 <span class="r6">  3641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_get_ifd_dict</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, offset):</span><span class="r9">                                                           </span>  
 <span class="r6">  3643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">  3644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># an offset pointer to the location of the nested embedded IFD.</span><span class="r9">                    </span>  
 <span class="r6">  3645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># It should be a long, but may be corrupted.</span><span class="r9">                                       </span>  
 <span class="r6">  3646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                                               </span>  
 <span class="r6">  3647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">KeyError</span><span class="r11">, </span><span class="r13">TypeError</span><span class="r11">):</span><span class="r9">                                                          </span>  
 <span class="r6">  3648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">  3649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> TiffImagePlugin</span><span class="r9">                                                      </span>  
 <span class="r6">  3651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            info </span><span class="r15">=</span><span class="r11"> TiffImagePlugin</span><span class="r15">.</span><span class="r11">ImageFileDirectory_v2(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">head)</span><span class="r9">                            </span>  
 <span class="r6">  3653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            info</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fixup_dict(info)</span><span class="r9">                                                      </span>  
 <span class="r6">  3655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_get_head</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">  3657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        version </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\x2B</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">bigtiff </span><span class="r10">else</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\x2A</span><span class="r16">&quot;</span><span class="r9">                                         </span>  
 <span class="r6">  3658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">endian </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;&lt;&quot;</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  3659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            head </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;II&quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> version </span><span class="r15">+</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\x00</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> o32le(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  3660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            head </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;MM</span><span class="r25">\x00</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> version </span><span class="r15">+</span><span class="r11"> o32be(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                              </span>  
 <span class="r6">  3662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">bigtiff:</span><span class="r9">                                                                       </span>  
 <span class="r6">  3663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            head </span><span class="r15">+=</span><span class="r11"> o32le(</span><span class="r15">8</span><span class="r11">) </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">endian </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;&lt;&quot;</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> o32be(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                               </span>  
 <span class="r6">  3664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            head </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\x00\x00\x00\x00</span><span class="r16">&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">  3665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> head</span><span class="r9">                                                                            </span>  
 <span class="r6">  3666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data):</span><span class="r9">                                                                      </span>  
 <span class="r6">  3668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Extract EXIF information.  This is highly experimental,</span><span class="r9">                              </span>  
 <span class="r6">  3669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># and is likely to be replaced with something better in a future</span><span class="r9">                       </span>  
 <span class="r6">  3670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># version.</span><span class="r9">                                                                             </span>  
 <span class="r6">  3671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># The EXIF record consists of a TIFF file embedded in a JPEG</span><span class="r9">                           </span>  
 <span class="r6">  3673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># application marker (!).</span><span class="r9">                                                              </span>  
 <span class="r6">  3674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> data </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_loaded_exif:</span><span class="r9">                                                          </span>  
 <span class="r6">  3675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  3676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_loaded_exif </span><span class="r15">=</span><span class="r11"> data</span><span class="r9">                                                               </span>  
 <span class="r6">  3677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                     </span>  
 <span class="r6">  3678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                              </span>  
 <span class="r6">  3679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                     </span>  
 <span class="r6">  3680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> data </span><span class="r19">and</span><span class="r11"> data</span><span class="r15">.</span><span class="r11">startswith(</span><span class="r16">b&quot;Exif</span><span class="r25">\x00\x00</span><span class="r16">&quot;</span><span class="r11">):</span><span class="r9">                                          </span>  
 <span class="r6">  3681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data </span><span class="r15">=</span><span class="r11"> data[</span><span class="r15">6</span><span class="r11">:]</span><span class="r9">                                                                    </span>  
 <span class="r6">  3682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> data:</span><span class="r9">                                                                           </span>  
 <span class="r6">  3683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                  </span>  
 <span class="r6">  3684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">  3685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(data)</span><span class="r9">                                                             </span>  
 <span class="r6">  3687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">head </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">  3688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># process dictionary</span><span class="r9">                                                                   </span>  
 <span class="r6">  3689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> TiffImagePlugin</span><span class="r9">                                                          </span>  
 <span class="r6">  3690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r15">=</span><span class="r11"> TiffImagePlugin</span><span class="r15">.</span><span class="r11">ImageFileDirectory_v2(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">head)</span><span class="r9">                          </span>  
 <span class="r6">  3692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">endian </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">_endian</span><span class="r9">                                                       </span>  
 <span class="r6">  3693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">next)</span><span class="r9">                                                          </span>  
 <span class="r6">  3694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp)</span><span class="r9">                                                               </span>  
 <span class="r6">  3695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load_from_fp</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, fp, offset</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                   </span>  
 <span class="r6">  3697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_loaded_exif </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">  3698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                     </span>  
 <span class="r6">  3699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                              </span>  
 <span class="r6">  3700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds</span><span class="r15">.</span><span class="r11">clear()</span><span class="r9">                                                                     </span>  
 <span class="r6">  3701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># process dictionary</span><span class="r9">                                                                   </span>  
 <span class="r6">  3703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> TiffImagePlugin</span><span class="r9">                                                          </span>  
 <span class="r6">  3704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> fp</span><span class="r9">                                                                           </span>  
 <span class="r6">  3706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> offset </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">  3707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">head </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_head()</span><span class="r9">                                                       </span>  
 <span class="r6">  3708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">head </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                                        </span>  
 <span class="r6">  3710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r15">=</span><span class="r11"> TiffImagePlugin</span><span class="r15">.</span><span class="r11">ImageFileDirectory_v2(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">head)</span><span class="r9">                          </span>  
 <span class="r6">  3711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">endian </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">  3712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">endian </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">_endian</span><span class="r9">                                                   </span>  
 <span class="r6">  3713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> offset </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">  3714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            offset </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">next</span><span class="r9">                                                           </span>  
 <span class="r6">  3715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                                                   </span>  
 <span class="r6">  3716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp)</span><span class="r9">                                                               </span>  
 <span class="r6">  3717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_get_merged_dict</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                </span>  
 <span class="r6">  3719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        merged_dict </span><span class="r15">=</span><span class="r11"> </span><span class="r20">dict</span><span class="r11">(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">  3720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># get EXIF extension</span><span class="r9">                                                                   </span>  
 <span class="r6">  3722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">  3723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ifd </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_ifd_dict(</span><span class="r20">self</span><span class="r11">[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif])</span><span class="r9">                                  </span>  
 <span class="r6">  3724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> ifd:</span><span class="r9">                                                                            </span>  
 <span class="r6">  3725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                merged_dict</span><span class="r15">.</span><span class="r11">update(ifd)</span><span class="r9">                                                        </span>  
 <span class="r6">  3726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># GPS</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">  3729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            merged_dict[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_ifd_dict(</span><span class="r9">                            </span>  
 <span class="r6">  3730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r11">[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo]</span><span class="r9">                                                     </span>  
 <span class="r6">  3731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> merged_dict</span><span class="r9">                                                                     </span>  
 <span class="r6">  3734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">tobytes</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, offset</span><span class="r15">=8</span><span class="r11">):</span><span class="r9">                                                               </span>  
 <span class="r6">  3736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> TiffImagePlugin</span><span class="r9">                                                          </span>  
 <span class="r6">  3737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        head </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_head()</span><span class="r9">                                                                </span>  
 <span class="r6">  3739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ifd </span><span class="r15">=</span><span class="r11"> TiffImagePlugin</span><span class="r15">.</span><span class="r11">ImageFileDirectory_v2(ifh</span><span class="r15">=</span><span class="r11">head)</span><span class="r9">                                  </span>  
 <span class="r6">  3740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> tag, value </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">items():</span><span class="r9">                                                        </span>  
 <span class="r6">  3741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> [</span><span class="r9">                                                                        </span>  
 <span class="r6">  3742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif,</span><span class="r9">                                                             </span>  
 <span class="r6">  3743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo,</span><span class="r9">                                                          </span>  
 <span class="r6">  3744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ] </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value, </span><span class="r20">dict</span><span class="r11">):</span><span class="r9">                                                 </span>  
 <span class="r6">  3745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                value </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">get_ifd(tag)</span><span class="r9">                                                      </span>  
 <span class="r6">  3746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> (</span><span class="r9">                                                                           </span>  
 <span class="r6">  3747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    tag </span><span class="r15">==</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif</span><span class="r9">                                                   </span>  
 <span class="r6">  3748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r19">and</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop </span><span class="r19">in</span><span class="r11"> value</span><span class="r9">                                          </span>  
 <span class="r6">  3749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(value[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop], </span><span class="r20">dict</span><span class="r11">)</span><span class="r9">                      </span>  
 <span class="r6">  3750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ):</span><span class="r9">                                                                             </span>  
 <span class="r6">  3751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    value </span><span class="r15">=</span><span class="r11"> value</span><span class="r15">.</span><span class="r11">copy()</span><span class="r9">                                                       </span>  
 <span class="r6">  3752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    value[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">get_ifd(ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop)</span><span class="r9">           </span>  
 <span class="r6">  3753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ifd[tag] </span><span class="r15">=</span><span class="r11"> value</span><span class="r9">                                                                   </span>  
 <span class="r6">  3754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;Exif</span><span class="r25">\x00\x00</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> head </span><span class="r15">+</span><span class="r11"> ifd</span><span class="r15">.</span><span class="r11">tobytes(offset)</span><span class="r9">                                    </span>  
 <span class="r6">  3755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_ifd</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, tag):</span><span class="r9">                                                                    </span>  
 <span class="r6">  3757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> tag </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds:</span><span class="r9">                                                              </span>  
 <span class="r6">  3758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> tag </span><span class="r15">==</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">IFD1:</span><span class="r9">                                                       </span>  
 <span class="r6">  3759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">next </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                            </span>  
 <span class="r6">  3760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_ifd_dict(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">next)</span><span class="r9">                      </span>  
 <span class="r6">  3761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> [ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif, ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo]:</span><span class="r9">                             </span>  
 <span class="r6">  3762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data</span><span class="r15">.</span><span class="r11">get(tag, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">get(tag))</span><span class="r9">                             </span>  
 <span class="r6">  3763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> offset </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                         </span>  
 <span class="r6">  3764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_ifd_dict(offset)</span><span class="r9">                               </span>  
 <span class="r6">  3765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> [ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop, ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Makernote]:</span><span class="r9">                        </span>  
 <span class="r6">  3766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds:</span><span class="r9">                                        </span>  
 <span class="r6">  3767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">get_ifd(ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif)</span><span class="r9">                                            </span>  
 <span class="r6">  3768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                tag_data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif][tag]</span><span class="r9">                                  </span>  
 <span class="r6">  3769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> tag </span><span class="r15">==</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Makernote:</span><span class="r9">                                              </span>  
 <span class="r6">  3770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.TiffImagePlugin</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> ImageFileDirectory_v2</span><span class="r9">                         </span>  
 <span class="r6">  3771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> tag_data[:</span><span class="r15">8</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;FUJIFILM&quot;</span><span class="r11">:</span><span class="r9">                                            </span>  
 <span class="r6">  3773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        ifd_offset </span><span class="r15">=</span><span class="r11"> i32le(tag_data, </span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">  3774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        ifd_data </span><span class="r15">=</span><span class="r11"> tag_data[ifd_offset:]</span><span class="r9">                                       </span>  
 <span class="r6">  3775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        makernote </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                         </span>  
 <span class="r6">  3777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r16">&quot;&lt;H&quot;</span><span class="r11">, ifd_data[:</span><span class="r15">2</span><span class="r11">])[</span><span class="r15">0</span><span class="r11">]):</span><span class="r9">               </span>  
 <span class="r6">  3778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            ifd_tag, typ, count, data </span><span class="r15">=</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r9">                         </span>  
 <span class="r6">  3779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r16">&quot;&lt;HHL4s&quot;</span><span class="r11">, ifd_data[i </span><span class="r15">*</span><span class="r11"> </span><span class="r15">12</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">2</span><span class="r11"> : (i </span><span class="r15">+</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">*</span><span class="r11"> </span><span class="r15">12</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">2</span><span class="r11">]</span><span class="r9">              </span>  
 <span class="r6">  3780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            )</span><span class="r9">                                                                  </span>  
 <span class="r6">  3781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">  3782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                (</span><span class="r9">                                                              </span>  
 <span class="r6">  3783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    unit_size,</span><span class="r9">                                                 </span>  
 <span class="r6">  3784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    handler,</span><span class="r9">                                                   </span>  
 <span class="r6">  3785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                ) </span><span class="r15">=</span><span class="r11"> ImageFileDirectory_v2</span><span class="r15">.</span><span class="r11">_load_dispatch[typ]</span><span class="r9">                  </span>  
 <span class="r6">  3786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                   </span>  
 <span class="r6">  3787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">continue</span><span class="r9">                                                       </span>  
 <span class="r6">  3788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            size </span><span class="r15">=</span><span class="r11"> count </span><span class="r15">*</span><span class="r11"> unit_size</span><span class="r9">                                           </span>  
 <span class="r6">  3789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">if</span><span class="r11"> size </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">4</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">  3790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                (offset,) </span><span class="r15">=</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r16">&quot;&lt;L&quot;</span><span class="r11">, data)</span><span class="r9">                          </span>  
 <span class="r6">  3791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                data </span><span class="r15">=</span><span class="r11"> ifd_data[offset </span><span class="r15">-</span><span class="r11"> </span><span class="r15">12</span><span class="r11"> : offset </span><span class="r15">+</span><span class="r11"> size </span><span class="r15">-</span><span class="r11"> </span><span class="r15">12</span><span class="r11">]</span><span class="r9">              </span>  
 <span class="r6">  3792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">  3793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                data </span><span class="r15">=</span><span class="r11"> data[:size]</span><span class="r9">                                             </span>  
 <span class="r6">  3794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(data) </span><span class="r15">!=</span><span class="r11"> size:</span><span class="r9">                                              </span>  
 <span class="r6">  3796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                 </span>  
 <span class="r6">  3797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r16">&quot;Possibly corrupt EXIF MakerNote data.  &quot;</span><span class="r9">                  </span>  
 <span class="r6">  3798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r16">f&quot;Expecting to read </span><span class="r21">{</span><span class="r11">size</span><span class="r21">}</span><span class="r16"> bytes but only got &quot;</span><span class="r9">            </span>  
 <span class="r6">  3799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r20">len</span><span class="r11">(data)</span><span class="r21">}</span><span class="r16">. Skipping tag </span><span class="r21">{</span><span class="r11">ifd_tag</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">                     </span>  
 <span class="r6">  3800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                )</span><span class="r9">                                                              </span>  
 <span class="r6">  3801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">continue</span><span class="r9">                                                       </span>  
 <span class="r6">  3802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> data:</span><span class="r9">                                                       </span>  
 <span class="r6">  3804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">continue</span><span class="r9">                                                       </span>  
 <span class="r6">  3805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            makernote[ifd_tag] </span><span class="r15">=</span><span class="r11"> handler(</span><span class="r9">                                      </span>  
 <span class="r6">  3807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                ImageFileDirectory_v2(), data, </span><span class="r10">False</span><span class="r9">                           </span>  
 <span class="r6">  3808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            )</span><span class="r9">                                                                  </span>  
 <span class="r6">  3809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">dict</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fixup_dict(makernote))</span><span class="r9">                    </span>  
 <span class="r6">  3810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">get(</span><span class="r15">0x010F</span><span class="r11">) </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;Nintendo&quot;</span><span class="r11">:</span><span class="r9">                                       </span>  
 <span class="r6">  3811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        makernote </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                         </span>  
 <span class="r6">  3812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r16">&quot;&gt;H&quot;</span><span class="r11">, tag_data[:</span><span class="r15">2</span><span class="r11">])[</span><span class="r15">0</span><span class="r11">]):</span><span class="r9">               </span>  
 <span class="r6">  3813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            ifd_tag, typ, count, data </span><span class="r15">=</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r9">                         </span>  
 <span class="r6">  3814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r16">&quot;&gt;HHL4s&quot;</span><span class="r11">, tag_data[i </span><span class="r15">*</span><span class="r11"> </span><span class="r15">12</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">2</span><span class="r11"> : (i </span><span class="r15">+</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">*</span><span class="r11"> </span><span class="r15">12</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> </span><span class="r15">2</span><span class="r11">]</span><span class="r9">              </span>  
 <span class="r6">  3815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            )</span><span class="r9">                                                                  </span>  
 <span class="r6">  3816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">if</span><span class="r11"> ifd_tag </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0x1101</span><span class="r11">:</span><span class="r9">                                              </span>  
 <span class="r6">  3817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r14"># CameraInfo</span><span class="r9">                                                   </span>  
 <span class="r6">  3818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                (offset,) </span><span class="r15">=</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">unpack(</span><span class="r16">&quot;&gt;L&quot;</span><span class="r11">, data)</span><span class="r9">                          </span>  
 <span class="r6">  3819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek(offset)</span><span class="r9">                                           </span>  
 <span class="r6">  3820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                camerainfo </span><span class="r15">=</span><span class="r11"> {</span><span class="r16">&quot;ModelID&quot;</span><span class="r11">: </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)}</span><span class="r9">                      </span>  
 <span class="r6">  3822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)</span><span class="r9">                                                </span>  
 <span class="r6">  3824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r14"># Seconds since 2000</span><span class="r9">                                           </span>  
 <span class="r6">  3825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                camerainfo[</span><span class="r16">&quot;TimeStamp&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> i32le(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">12</span><span class="r11">))</span><span class="r9">              </span>  
 <span class="r6">  3826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)</span><span class="r9">                                                </span>  
 <span class="r6">  3828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                camerainfo[</span><span class="r16">&quot;InternalSerialNumber&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)</span><span class="r9">           </span>  
 <span class="r6">  3829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">12</span><span class="r11">)</span><span class="r9">                                               </span>  
 <span class="r6">  3831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                parallax </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)</span><span class="r9">                                     </span>  
 <span class="r6">  3832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                handler </span><span class="r15">=</span><span class="r11"> ImageFileDirectory_v2</span><span class="r15">.</span><span class="r11">_load_dispatch[</span><span class="r9">                </span>  
 <span class="r6">  3833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    TiffTags</span><span class="r15">.</span><span class="r11">FLOAT</span><span class="r9">                                             </span>  
 <span class="r6">  3834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                ][</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                           </span>  
 <span class="r6">  3835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                camerainfo[</span><span class="r16">&quot;Parallax&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> handler(</span><span class="r9">                              </span>  
 <span class="r6">  3836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    ImageFileDirectory_v2(), parallax, </span><span class="r10">False</span><span class="r9">                   </span>  
 <span class="r6">  3837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                )</span><span class="r9">                                                              </span>  
 <span class="r6">  3838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">4</span><span class="r11">)</span><span class="r9">                                                </span>  
 <span class="r6">  3840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                camerainfo[</span><span class="r16">&quot;Category&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)</span><span class="r9">                       </span>  
 <span class="r6">  3841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                makernote </span><span class="r15">=</span><span class="r11"> {</span><span class="r15">0x1101</span><span class="r11">: </span><span class="r20">dict</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fixup_dict(camerainfo))}</span><span class="r9">       </span>  
 <span class="r6">  3843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[tag] </span><span class="r15">=</span><span class="r11"> makernote</span><span class="r9">                                            </span>  
 <span class="r6">  3844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">  3845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># Interop</span><span class="r9">                                                                  </span>  
 <span class="r6">  3846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_get_ifd_dict(tag_data)</span><span class="r9">                             </span>  
 <span class="r6">  3847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ifd </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ifds</span><span class="r15">.</span><span class="r11">get(tag, {})</span><span class="r9">                                                          </span>  
 <span class="r6">  3848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> tag </span><span class="r15">==</span><span class="r11"> ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data:</span><span class="r9">                                     </span>  
 <span class="r6">  3849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ifd </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                            </span>  
 <span class="r6">  3850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                k: v</span><span class="r9">                                                                           </span>  
 <span class="r6">  3851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> (k, v) </span><span class="r19">in</span><span class="r11"> ifd</span><span class="r15">.</span><span class="r11">items()</span><span class="r9">                                                      </span>  
 <span class="r6">  3852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> k </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> (ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Interop, ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Makernote)</span><span class="r9">                     </span>  
 <span class="r6">  3853 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            }</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3854 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> ifd</span><span class="r9">                                                                             </span>  
 <span class="r6">  3855 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3856 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">hide_offsets</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">  3857 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> (ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">Exif, ExifTags</span><span class="r15">.</span><span class="r11">IFD</span><span class="r15">.</span><span class="r11">GPSInfo):</span><span class="r9">                                  </span>  
 <span class="r6">  3858 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">  3859 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_hidden_data[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r11">[tag]</span><span class="r9">                                             </span>  
 <span class="r6">  3860 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r11">[tag]</span><span class="r9">                                                                  </span>  
 <span class="r6">  3861 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3862 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__str__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  3863 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  3864 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Load all keys into self._data</span><span class="r9">                                                    </span>  
 <span class="r6">  3865 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info</span><span class="r15">.</span><span class="r11">keys():</span><span class="r9">                                                      </span>  
 <span class="r6">  3866 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r11">[tag]</span><span class="r9">                                                                      </span>  
 <span class="r6">  3867 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3868 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">str</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3869 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3870 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__len__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">  3871 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        keys </span><span class="r15">=</span><span class="r11"> </span><span class="r20">set</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3872 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  3873 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            keys</span><span class="r15">.</span><span class="r11">update(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info)</span><span class="r9">                                                            </span>  
 <span class="r6">  3874 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(keys)</span><span class="r9">                                                                       </span>  
 <span class="r6">  3875 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3876 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__getitem__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, tag):</span><span class="r9">                                                                </span>  
 <span class="r6">  3877 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> tag </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data </span><span class="r19">and</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info:</span><span class="r9">             </span>  
 <span class="r6">  3878 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data[tag] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_fixup(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info[tag])</span><span class="r9">                                     </span>  
 <span class="r6">  3879 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info[tag]</span><span class="r9">                                                                </span>  
 <span class="r6">  3880 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data[tag]</span><span class="r9">                                                                 </span>  
 <span class="r6">  3881 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3882 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__contains__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, tag):</span><span class="r9">                                                               </span>  
 <span class="r6">  3883 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data </span><span class="r19">or</span><span class="r11"> (</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info)</span><span class="r9">             </span>  
 <span class="r6">  3884 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3885 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__setitem__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, tag, value):</span><span class="r9">                                                         </span>  
 <span class="r6">  3886 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info:</span><span class="r9">                                       </span>  
 <span class="r6">  3887 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info[tag]</span><span class="r9">                                                                </span>  
 <span class="r6">  3888 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data[tag] </span><span class="r15">=</span><span class="r11"> value</span><span class="r9">                                                                </span>  
 <span class="r6">  3889 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3890 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__delitem__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, tag):</span><span class="r9">                                                                </span>  
 <span class="r6">  3891 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> tag </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info:</span><span class="r9">                                       </span>  
 <span class="r6">  3892 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info[tag]</span><span class="r9">                                                                </span>  
 <span class="r6">  3893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">  3894 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">del</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data[tag]</span><span class="r9">                                                                </span>  
 <span class="r6">  3895 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">  3896 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__iter__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">  3897 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        keys </span><span class="r15">=</span><span class="r11"> </span><span class="r20">set</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_data)</span><span class="r9">                                                                 </span>  
 <span class="r6">  3898 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">  3899 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            keys</span><span class="r15">.</span><span class="r11">update(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">_info)</span><span class="r9">                                                            </span>  
 <span class="r6">  3900 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">iter</span><span class="r11">(keys)</span><span class="r9">                                                                      </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r24">function summary for /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/…</span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">load</span><span class="r9">                                                                             </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">_conv_type_shape</span><span class="r9">                                                                         </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">preinit</span><span class="r9">                                                                            </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_getdecoder</span><span class="r9">                                                                      </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">_getencoder</span><span class="r9">                                                                              </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r17">__init__</span><span class="r9">                                                                                 </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r17">__getattr__</span><span class="r9">                                                                      </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">width</span><span class="r9">                                                                                    </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">height</span><span class="r9">                                                                                   </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                                             </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_new</span><span class="r9">                                                                             </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">_new</span><span class="r9">                                                                                     </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">__array_interface__</span><span class="r9">                                                                      </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">tobytes</span><span class="r9">                                                                                  </span>  
 <span class="r6">   838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">load</span><span class="r9">                                                                                     </span>  
 <span class="r6">   893 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">convert</span><span class="r9">                                                                          </span>  
 <span class="r6">  1202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">copy</span><span class="r9">                                                                             </span>  
 <span class="r6">  1227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">crop</span><span class="r9">                                                                                     </span>  
 <span class="r6">  1253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">_crop</span><span class="r9">                                                                                    </span>  
 <span class="r6">  1329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">getbands</span><span class="r9">                                                                                 </span>  
 <span class="r6">  1452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">getexif</span><span class="r9">                                                                          </span>  
 <span class="r6">  2106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">resize</span><span class="r9">                                                                                   </span>  
 <span class="r6">  2815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">transpose</span><span class="r9">                                                                                </span>  
 <span class="r6">  3170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">_decompression_bomb_check</span><span class="r9">                                                                </span>  
 <span class="r6">  3170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">_decompression_bomb_check</span><span class="r9">                                                          </span>  
 <span class="r6">  3191 </span>│<span class="r7">    1%  </span>│<span class="r7">       </span>│<span class="r7">   5%  </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">open</span><span class="r9">                                                                               </span>  
 <span class="r6">  3261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">_open_core</span><span class="r9">                                                                         </span>  
        ╵        ╵       ╵       ╵                                                                                                 
<span class="r1">  /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/ImageFile.py: % of time =   3.01% (7m:38.423s) out of   </span>
<span class="r1">                                                          4h:40m:20.690s.                                                          </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/ImageFile.py           </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># The Python Imaging Library.</span><span class="r9">                                                                  </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># $Id$</span><span class="r9">                                                                                         </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># base class for image file handlers</span><span class="r9">                                                           </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># history:</span><span class="r9">                                                                                     </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1995-09-09 fl   Created</span><span class="r9">                                                                      </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-03-11 fl   Fixed load mechanism.</span><span class="r9">                                                        </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-04-15 fl   Added pcx/xbm decoders.</span><span class="r9">                                                      </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-04-30 fl   Added encoders.</span><span class="r9">                                                              </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-12-14 fl   Added load helpers</span><span class="r9">                                                           </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1997-01-11 fl   Use encode_to_file where possible</span><span class="r9">                                            </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1997-08-27 fl   Flush output in _save</span><span class="r9">                                                        </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1998-03-05 fl   Use memory mapping for some modes</span><span class="r9">                                            </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1999-02-04 fl   Use memory mapping also for &quot;I;16&quot; and &quot;I;16B&quot;</span><span class="r9">                               </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1999-05-31 fl   Added image parser</span><span class="r9">                                                           </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2000-10-12 fl   Set readonly flag on memory-mapped images</span><span class="r9">                                    </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2002-03-20 fl   Use better messages for common decoder errors</span><span class="r9">                                </span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-04-21 fl   Fall back on mmap/map_buffer if map is not available</span><span class="r9">                         </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-10-30 fl   Added StubImageFile class</span><span class="r9">                                                    </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2004-02-25 fl   Made incremental parser more robust</span><span class="r9">                                          </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1997-2004 by Secret Labs AB</span><span class="r9">                                                    </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1995-2004 by Fredrik Lundh</span><span class="r9">                                                     </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># See the README file for information on usage and redistribution.</span><span class="r9">                             </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">io</span><span class="r9">                                                                                      </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">itertools</span><span class="r9">                                                                               </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">struct</span><span class="r9">                                                                                  </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">sys</span><span class="r9">                                                                                     </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> Image</span><span class="r9">                                                                            </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._util</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> is_path</span><span class="r9">                                                                     </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">MAXBLOCK </span><span class="r15">=</span><span class="r11"> </span><span class="r15">65536</span><span class="r9">                                                                               </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">SAFEBLOCK </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1024</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> </span><span class="r15">1024</span><span class="r9">                                                                        </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">LOAD_TRUNCATED_IMAGES </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                  </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;Whether or not to load truncated image files. User code may change this.&quot;&quot;&quot;</span><span class="r9">                 </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ERRORS </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                                     </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">-1</span><span class="r11">: </span><span class="r16">&quot;image buffer overrun error&quot;</span><span class="r11">,</span><span class="r9">                                                          </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">-2</span><span class="r11">: </span><span class="r16">&quot;decoding error&quot;</span><span class="r11">,</span><span class="r9">                                                                      </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">-3</span><span class="r11">: </span><span class="r16">&quot;unknown error&quot;</span><span class="r11">,</span><span class="r9">                                                                       </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">-8</span><span class="r11">: </span><span class="r16">&quot;bad configuration&quot;</span><span class="r11">,</span><span class="r9">                                                                   </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">-9</span><span class="r11">: </span><span class="r16">&quot;out of memory error&quot;</span><span class="r11">,</span><span class="r9">                                                                 </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">Dict of known error codes returned from :meth:`.PyDecoder.decode`,</span><span class="r9">                             </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">:meth:`.PyEncoder.encode` :meth:`.PyEncoder.encode_to_pyfd` and</span><span class="r9">                                </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">:meth:`.PyEncoder.encode_to_file`.</span><span class="r9">                                                             </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Helpers</span><span class="r9">                                                                                      </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">raise_oserror</span><span class="r11">(error):</span><span class="r9">                                                                      </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">core</span><span class="r15">.</span><span class="r11">getcodecstatus(error)</span><span class="r9">                                                 </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> ERRORS</span><span class="r15">.</span><span class="r11">get(error)</span><span class="r9">                                                                </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> msg:</span><span class="r9">                                                                                </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;decoder error </span><span class="r21">{</span><span class="r11">error</span><span class="r21">}</span><span class="r16">&quot;</span><span class="r9">                                                         </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    msg </span><span class="r15">+=</span><span class="r11"> </span><span class="r16">&quot; when reading image file&quot;</span><span class="r9">                                                          </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                         </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_tilesort</span><span class="r11">(t):</span><span class="r9">                                                                              </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># sort on offset</span><span class="r9">                                                                           </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> t[</span><span class="r15">2</span><span class="r11">]</span><span class="r9">                                                                                </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># ImageFile base class</span><span class="r9">                                                                         </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">ImageFile</span><span class="r11">(Image</span><span class="r15">.</span><span class="r11">Image):</span><span class="r9">                                                                  </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Base class for image file format handlers.&quot;&quot;&quot;</span><span class="r9">                                           </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, fp</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, filename</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, logging</span><span class="r15">=</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                 </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r17">__init__</span><span class="r11">(logging</span><span class="r15">=</span><span class="r11">logging)</span><span class="r9">                                                      </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_min_frame </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                    </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">custom_mimetype </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                            </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                       </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot; A list of tile descriptors, or ``None`` &quot;&quot;&quot;</span><span class="r9">                                        </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">  </span><span class="r14"># until we know better</span><span class="r9">                                              </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoderconfig </span><span class="r15">=</span><span class="r11"> ()</span><span class="r9">                                                                </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decodermaxblock </span><span class="r15">=</span><span class="r11"> MAXBLOCK</span><span class="r9">                                                        </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> is_path(fp):</span><span class="r9">                                                                        </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># filename</span><span class="r9">                                                                         </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> </span><span class="r20">open</span><span class="r11">(fp, </span><span class="r16">&quot;rb&quot;</span><span class="r11">)</span><span class="r9">                                                           </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename </span><span class="r15">=</span><span class="r11"> fp</span><span class="r9">                                                                 </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exclusive_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                          </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># stream</span><span class="r9">                                                                           </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> fp</span><span class="r9">                                                                       </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename </span><span class="r15">=</span><span class="r11"> filename</span><span class="r9">                                                           </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># can be overridden</span><span class="r9">                                                                </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exclusive_fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                          </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_open()</span><span class="r9">                                                                   </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> (</span><span class="r9">                                                                           </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r13">IndexError</span><span class="r11">,  </span><span class="r14"># end of data</span><span class="r9">                                                     </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r13">TypeError</span><span class="r11">,  </span><span class="r14"># end of data (ord)</span><span class="r9">                                                </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r13">KeyError</span><span class="r11">,  </span><span class="r14"># unsupported mode</span><span class="r9">                                                  </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r13">EOFError</span><span class="r11">,  </span><span class="r14"># got header but not the first frame</span><span class="r9">                                </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                struct</span><span class="r15">.</span><span class="r11">error,</span><span class="r9">                                                                  </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ) </span><span class="r10">as</span><span class="r11"> v:</span><span class="r9">                                                                            </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(v) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">v</span><span class="r9">                                                    </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                        </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;not identified by this driver&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                         </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">BaseException</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># close the file only if we have opened it this constructor</span><span class="r9">                        </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exclusive_fp:</span><span class="r9">                                                             </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r9">                                                                              </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">get_format_mimetype</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                             </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">custom_mimetype:</span><span class="r9">                                                               </span>  
 <span class="r6">   138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">custom_mimetype</span><span class="r9">                                                        </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">format </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                            </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">MIME</span><span class="r15">.</span><span class="r11">get(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">format</span><span class="r15">.</span><span class="r11">upper())</span><span class="r9">                                         </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__setstate__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, state):</span><span class="r9">                                                             </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                         </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">super</span><span class="r11">()</span><span class="r15">.</span><span class="r11">__setstate__(state)</span><span class="r9">                                                            </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">verify</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Check file integrity&quot;&quot;&quot;</span><span class="r9">                                                             </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># raise exception if something&#x27;s wrong.  must be called</span><span class="r9">                                </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># directly after open, and closes file when finished.</span><span class="r9">                                  </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exclusive_fp:</span><span class="r9">                                                                 </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                    </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;Load image data based on tile list&quot;&quot;&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">import</span><span class="r11"> </span><span class="r12">time</span><span class="r9">                                                                            </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot load this image&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        pixel </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">Image</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile:</span><span class="r9">                                                                      </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> pixel</span><span class="r9">                                                                       </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                        </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        use_mmap </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename </span><span class="r19">and</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile) </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                       </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># As of pypy 2.1.0, memory mapping was failing here.</span><span class="r9">                                   </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        use_mmap </span><span class="r15">=</span><span class="r11"> use_mmap </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(sys, </span><span class="r16">&quot;pypy_version_info&quot;</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                           </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># look for read/seek overrides</span><span class="r9">                                                         </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            read </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load_read</span><span class="r9">                                                              </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># don&#x27;t use mmap if there are custom read/seek functions</span><span class="r9">                           </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            use_mmap </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                   </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            read </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read</span><span class="r9">                                                                </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            seek </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load_seek</span><span class="r9">                                                              </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            use_mmap </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                   </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            seek </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">seek</span><span class="r9">                                                                </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> use_mmap:</span><span class="r9">                                                                           </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># try memory mapping</span><span class="r9">                                                               </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            decoder_name, extents, offset, args </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                 </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> (</span><span class="r9">                                                                               </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                decoder_name </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;raw&quot;</span><span class="r9">                                                          </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r19">and</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(args) </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">3</span><span class="r9">                                                             </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r19">and</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                       </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r19">and</span><span class="r11"> args[</span><span class="r15">0</span><span class="r11">] </span><span class="r19">in</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">_MAPMODES</span><span class="r9">                                                 </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ):</span><span class="r9">                                                                                 </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># use mmap, if possible</span><span class="r9">                                                    </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">import</span><span class="r11"> </span><span class="r12">mmap</span><span class="r9">                                                                </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">with</span><span class="r11"> </span><span class="r20">open</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename) </span><span class="r10">as</span><span class="r11"> fp:</span><span class="r9">                                            </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map </span><span class="r15">=</span><span class="r11"> mmap</span><span class="r15">.</span><span class="r11">mmap(fp</span><span class="r15">.</span><span class="r11">fileno(), </span><span class="r15">0</span><span class="r11">, access</span><span class="r15">=</span><span class="r11">mmap</span><span class="r15">.</span><span class="r11">ACCESS_READ)</span><span class="r9">          </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> offset </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> args[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map</span><span class="r15">.</span><span class="r11">size():</span><span class="r9">                      </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r14"># buffer is not large enough</span><span class="r9">                                           </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r9">                                                          </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">core</span><span class="r15">.</span><span class="r11">map_buffer(</span><span class="r9">                                           </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size, decoder_name, offset, args</span><span class="r9">                        </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    )</span><span class="r9">                                                                          </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    readonly </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                               </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># After trashing self.im,</span><span class="r9">                                                  </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># we might need to reload the palette data.</span><span class="r9">                                </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette:</span><span class="r9">                                                           </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">palette</span><span class="r15">.</span><span class="r11">dirty </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                 </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, </span><span class="r13">OSError</span><span class="r11">, </span><span class="r13">ImportError</span><span class="r11">):</span><span class="r9">                                 </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                            </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging:</span><span class="r9">                                                                       </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            start </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                                                </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Allocates memory for the new image based on its mode and size</span><span class="r9">                    </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load_prepare()</span><span class="r9">                                                                </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            end </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                                                  </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">log_time[</span><span class="r16">&quot;load_prepare&quot;</span><span class="r11">]  </span><span class="r15">=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                                       </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># print(f&quot;load_prepare: {end - start}&quot;)</span><span class="r9">                                            </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load_prepare()</span><span class="r9">                                                                </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11"> </span><span class="r9">                                                                                              </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        err_code </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-3</span><span class="r11">  </span><span class="r14"># initialize to unknown error</span><span class="r9">                                           </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map:</span><span class="r9">                                                                       </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># sort tiles in file order</span><span class="r9">                                                         </span>  
 <span class="r6">   230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile</span><span class="r15">.</span><span class="r11">sort(key</span><span class="r15">=</span><span class="r11">_tilesort)</span><span class="r9">                                                      </span>  
 <span class="r6">   231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># FIXME: This is a hack to handle TIFF&#x27;s JpegTables tag.</span><span class="r9">                       </span>  
 <span class="r6">   234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                prefix </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile_prefix</span><span class="r9">                                                      </span>  
 <span class="r6">   235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">AttributeError</span><span class="r11">:</span><span class="r9">                                                             </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                prefix </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r9">                                                                   </span>  
 <span class="r6">   237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Remove consecutive duplicates that only differ by their offset</span><span class="r9">                   </span>  
 <span class="r6">   239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                      </span>  
 <span class="r6">   240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">list</span><span class="r11">(tiles)[</span><span class="r15">-1</span><span class="r11">]</span><span class="r9">                                                                </span>  
 <span class="r6">   241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">for</span><span class="r11"> _, tiles </span><span class="r19">in</span><span class="r11"> itertools</span><span class="r15">.</span><span class="r11">groupby(</span><span class="r9">                                             </span>  
 <span class="r6">   242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile, </span><span class="r10">lambda</span><span class="r11"> tile: (tile[</span><span class="r15">0</span><span class="r11">], tile[</span><span class="r15">1</span><span class="r11">], tile[</span><span class="r15">3</span><span class="r11">])</span><span class="r9">                        </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">   244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            ]</span><span class="r9">                                                                                  </span>  
 <span class="r6">   245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> decoder_name, extents, offset, args </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile:</span><span class="r9">                              </span>  
 <span class="r6">   246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                seek(offset)</span><span class="r9">                                                                   </span>  
 <span class="r6">   247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                decoder </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">_getdecoder(</span><span class="r9">                                                   </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, decoder_name, args, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoderconfig</span><span class="r9">                          </span>  
 <span class="r6">   249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">   250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    decoder</span><span class="r15">.</span><span class="r11">setimage(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im, extents)</span><span class="r9">                                         </span>  
 <span class="r6">   252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> decoder</span><span class="r15">.</span><span class="r11">pulls_fd:</span><span class="r9">                                                       </span>  
 <span class="r6">   253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        decoder</span><span class="r15">.</span><span class="r11">setfd(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp)</span><span class="r9">                                                 </span>  
 <span class="r6">   254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        err_code </span><span class="r15">=</span><span class="r11"> decoder</span><span class="r15">.</span><span class="r11">decode(</span><span class="r16">b&quot;&quot;</span><span class="r11">)[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                      </span>  
 <span class="r6">   255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging:</span><span class="r9">                                                       </span>  
 <span class="r6">   257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            b </span><span class="r15">=</span><span class="r11"> prefix</span><span class="r9">                                                         </span>  
 <span class="r6">   258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            read_time </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                   </span>  
 <span class="r6">   259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            decode_time </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                 </span>  
 <span class="r6">   260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">   262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    start </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                        </span>  
 <span class="r6">   263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    s </span><span class="r15">=</span><span class="r11"> read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">decodermaxblock)</span><span class="r9">                             </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    end </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                          </span>  
 <span class="r6">   265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">if</span><span class="r11">(read_time):</span><span class="r9">                                             </span>  
 <span class="r6">   266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        read_time </span><span class="r15">+=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                               </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        read_time </span><span class="r15">=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                                </span>  
 <span class="r6">   269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">IndexError</span><span class="r11">, struct</span><span class="r15">.</span><span class="r11">error) </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                        </span>  
 <span class="r6">   271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r14"># truncated png/gif</span><span class="r9">                                        </span>  
 <span class="r6">   272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">if</span><span class="r11"> LOAD_TRUNCATED_IMAGES:</span><span class="r9">                                  </span>  
 <span class="r6">   273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">break</span><span class="r9">                                                  </span>  
 <span class="r6">   274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;image file is truncated&quot;</span><span class="r9">                        </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                              </span>  
 <span class="r6">   277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> s:  </span><span class="r14"># truncated jpeg</span><span class="r9">                                    </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">if</span><span class="r11"> LOAD_TRUNCATED_IMAGES:</span><span class="r9">                                  </span>  
 <span class="r6">   280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">break</span><span class="r9">                                                  </span>  
 <span class="r6">   281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                </span>  
 <span class="r6">   283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                            </span><span class="r16">&quot;image file is truncated &quot;</span><span class="r9">                         </span>  
 <span class="r6">   284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                            </span><span class="r16">f&quot;(</span><span class="r21">{</span><span class="r20">len</span><span class="r11">(b)</span><span class="r21">}</span><span class="r16"> bytes not processed)&quot;</span><span class="r9">                  </span>  
 <span class="r6">   285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        )</span><span class="r9">                                                      </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                     </span>  
 <span class="r6">   287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                b </span><span class="r15">=</span><span class="r11"> b </span><span class="r15">+</span><span class="r11"> s</span><span class="r9">                                                      </span>  
 <span class="r6">   289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                start </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                            </span>  
 <span class="r6">   291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                n, err_code </span><span class="r15">=</span><span class="r11"> decoder</span><span class="r15">.</span><span class="r11">decode(b)</span><span class="r9">                                </span>  
 <span class="r6">   292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                end </span><span class="r15">=</span><span class="r11"> time</span><span class="r15">.</span><span class="r11">time()</span><span class="r9">                                              </span>  
 <span class="r6">   293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11">(decode_time):</span><span class="r9">                                               </span>  
 <span class="r6">   295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    decode_time </span><span class="r15">+=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                                 </span>  
 <span class="r6">   296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                          </span>  
 <span class="r6">   297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    decode_time </span><span class="r15">=</span><span class="r11"> end </span><span class="r15">-</span><span class="r11"> start</span><span class="r9">                                  </span>  
 <span class="r6">   298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">break</span><span class="r9">                                                      </span>  
 <span class="r6">   301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                b </span><span class="r15">=</span><span class="r11"> b[n:]</span><span class="r9">                                                      </span>  
 <span class="r6">   302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            b </span><span class="r15">=</span><span class="r11"> prefix</span><span class="r9">                                                         </span>  
 <span class="r6">   304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                           </span>  
 <span class="r6">   306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    s </span><span class="r15">=</span><span class="r11"> read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">decodermaxblock)</span><span class="r9">                             </span>  
 <span class="r6">   307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">IndexError</span><span class="r11">, struct</span><span class="r15">.</span><span class="r11">error) </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                        </span>  
 <span class="r6">   308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r14"># truncated png/gif</span><span class="r9">                                        </span>  
 <span class="r6">   309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">if</span><span class="r11"> LOAD_TRUNCATED_IMAGES:</span><span class="r9">                                  </span>  
 <span class="r6">   310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">break</span><span class="r9">                                                  </span>  
 <span class="r6">   311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;image file is truncated&quot;</span><span class="r9">                        </span>  
 <span class="r6">   313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                              </span>  
 <span class="r6">   314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> s:  </span><span class="r14"># truncated jpeg</span><span class="r9">                                    </span>  
 <span class="r6">   316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">if</span><span class="r11"> LOAD_TRUNCATED_IMAGES:</span><span class="r9">                                  </span>  
 <span class="r6">   317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">break</span><span class="r9">                                                  </span>  
 <span class="r6">   318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        msg </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                </span>  
 <span class="r6">   320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                            </span><span class="r16">&quot;image file is truncated &quot;</span><span class="r9">                         </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                            </span><span class="r16">f&quot;(</span><span class="r21">{</span><span class="r20">len</span><span class="r11">(b)</span><span class="r21">}</span><span class="r16"> bytes not processed)&quot;</span><span class="r9">                  </span>  
 <span class="r6">   322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        )</span><span class="r9">                                                      </span>  
 <span class="r6">   323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                     </span>  
 <span class="r6">   324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                b </span><span class="r15">=</span><span class="r11"> b </span><span class="r15">+</span><span class="r11"> s</span><span class="r9">                                                      </span>  
 <span class="r6">   326 </span>│<span class="r7">    1%  </span>│<span class="r7">       </span>│<span class="r7">   1%  </span>│<span class="r11">                                n, err_code </span><span class="r15">=</span><span class="r11"> decoder</span><span class="r15">.</span><span class="r11">decode(b)</span><span class="r9">                                </span>  
 <span class="r6">   327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                      </span>  
 <span class="r6">   328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                    </span><span class="r10">break</span><span class="r9">                                                      </span>  
 <span class="r6">   329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                                b </span><span class="r15">=</span><span class="r11"> b[n:]</span><span class="r9">                                                      </span>  
 <span class="r6">   330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># Need to cleanup here to prevent leaks</span><span class="r9">                                    </span>  
 <span class="r6">   332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    decoder</span><span class="r15">.</span><span class="r11">cleanup()</span><span class="r9">                                                          </span>  
 <span class="r6">   333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">logging:</span><span class="r9">                                                           </span>  
 <span class="r6">   334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">log_time[</span><span class="r16">&quot;read&quot;</span><span class="r11">]</span><span class="r15">=</span><span class="r11"> read_time</span><span class="r9">                                       </span>  
 <span class="r6">   335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">log_time[</span><span class="r16">&quot;decode&quot;</span><span class="r11">]</span><span class="r15">=</span><span class="r11"> decode_time</span><span class="r9">                                   </span>  
 <span class="r6">   336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r14"># print(&quot;read:&quot;, read_time)</span><span class="r9">                                            </span>  
 <span class="r6">   337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r14"># print(&quot;decode:&quot;, decode_time)</span><span class="r9">                                        </span>  
 <span class="r6">   338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                         </span>  
 <span class="r6">   339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">readonly </span><span class="r15">=</span><span class="r11"> readonly</span><span class="r9">                                                               </span>  
 <span class="r6">   340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">load_end()</span><span class="r9">                                                                        </span>  
 <span class="r6">   342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exclusive_fp </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_close_exclusive_fp_after_loading:</span><span class="r9">                      </span>  
 <span class="r6">   344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                    </span>  
 <span class="r6">   345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">map </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> LOAD_TRUNCATED_IMAGES </span><span class="r19">and</span><span class="r11"> err_code </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                        </span>  
 <span class="r6">   348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># still raised if decoder fails to return anything</span><span class="r9">                                 </span>  
 <span class="r6">   349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            raise_oserror(err_code)</span><span class="r9">                                                            </span>  
 <span class="r6">   350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">Image</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                          </span>  
 <span class="r6">   352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load_prepare</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                    </span>  
 <span class="r6">   354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># create image memory if necessary</span><span class="r9">                                                     </span>  
 <span class="r6">   355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">size </span><span class="r15">!=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size:</span><span class="r9">              </span>  
 <span class="r6">   356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">core</span><span class="r15">.</span><span class="r11">new(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size)</span><span class="r9">                                     </span>  
 <span class="r6">   357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># create palette (optional)</span><span class="r9">                                                            </span>  
 <span class="r6">   358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;P&quot;</span><span class="r11">:</span><span class="r9">                                                                   </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            Image</span><span class="r15">.</span><span class="r11">Image</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">   360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load_end</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># may be overridden</span><span class="r9">                                                                    </span>  
 <span class="r6">   363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># may be defined for contained formats</span><span class="r9">                                                     </span>  
 <span class="r6">   366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># def load_seek(self, pos):</span><span class="r9">                                                                </span>  
 <span class="r6">   367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#     pass</span><span class="r9">                                                                                 </span>  
 <span class="r6">   368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># may be defined for blocked formats (e.g. PNG)</span><span class="r9">                                            </span>  
 <span class="r6">   370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># def load_read(self, bytes):</span><span class="r9">                                                              </span>  
 <span class="r6">   371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#     pass</span><span class="r9">                                                                                 </span>  
 <span class="r6">   372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_seek_check</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, frame):</span><span class="r9">                                                              </span>  
 <span class="r6">   374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> (</span><span class="r9">                                                                                   </span>  
 <span class="r6">   375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            frame </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_min_frame</span><span class="r9">                                                            </span>  
 <span class="r6">   376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Only check upper limit on frames if additional seek operations</span><span class="r9">                   </span>  
 <span class="r6">   377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># are not required to do so</span><span class="r9">                                                        </span>  
 <span class="r6">   378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">or</span><span class="r11"> (</span><span class="r9">                                                                               </span>  
 <span class="r6">   379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r19">not</span><span class="r11"> (</span><span class="r20">hasattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;_n_frames&quot;</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_n_frames </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">)</span><span class="r9">                    </span>  
 <span class="r6">   380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r19">and</span><span class="r11"> frame </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">n_frames </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_min_frame</span><span class="r9">                                   </span>  
 <span class="r6">   381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">   382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">   383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;attempt to seek outside sequence&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">EOFError</span><span class="r11">(msg)</span><span class="r9">                                                                </span>  
 <span class="r6">   385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tell() </span><span class="r15">!=</span><span class="r11"> frame</span><span class="r9">                                                            </span>  
 <span class="r6">   387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">StubImageFile</span><span class="r11">(ImageFile):</span><span class="r9">                                                                </span>  
 <span class="r6">   390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Base class for stub image loaders.</span><span class="r9">                                                         </span>  
 <span class="r6">   392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    A stub loader is an image loader that can identify files of a</span><span class="r9">                              </span>  
 <span class="r6">   394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    certain format, but relies on external code to load the file.</span><span class="r9">                              </span>  
 <span class="r6">   395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_open</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;StubImageFile subclass must implement _open&quot;</span><span class="r9">                                    </span>  
 <span class="r6">   399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">NotImplementedError</span><span class="r11">(msg)</span><span class="r9">                                                         </span>  
 <span class="r6">   400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        loader </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_load()</span><span class="r9">                                                                  </span>  
 <span class="r6">   403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> loader </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;cannot find loader for this </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r11">format</span><span class="r21">}</span><span class="r16"> file&quot;</span><span class="r9">                            </span>  
 <span class="r6">   405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        image </span><span class="r15">=</span><span class="r11"> loader</span><span class="r15">.</span><span class="r11">load(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                              </span>  
 <span class="r6">   407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> image </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">   408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># become the other object (!)</span><span class="r9">                                                          </span>  
 <span class="r6">   409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__class__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> image</span><span class="r15">.</span><span class="r22">__class__</span><span class="r9">                                                       </span>  
 <span class="r6">   410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r22">__dict__</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> image</span><span class="r15">.</span><span class="r22">__dict__</span><span class="r9">                                                         </span>  
 <span class="r6">   411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> image</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                    </span>  
 <span class="r6">   412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_load</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;(Hook) Find actual image loader.&quot;&quot;&quot;</span><span class="r9">                                                 </span>  
 <span class="r6">   415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;StubImageFile subclass must implement _load&quot;</span><span class="r9">                                    </span>  
 <span class="r6">   416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">NotImplementedError</span><span class="r11">(msg)</span><span class="r9">                                                         </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">Parser</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Incremental image parser.  This class implements the standard</span><span class="r9">                              </span>  
 <span class="r6">   422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    feed/close consumer interface.</span><span class="r9">                                                             </span>  
 <span class="r6">   423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    incremental </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    image </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                               </span>  
 <span class="r6">   427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    data </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                                </span>  
 <span class="r6">   428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    decoder </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                             </span>  
 <span class="r6">   429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    offset </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                 </span>  
 <span class="r6">   430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    finished </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                               </span>  
 <span class="r6">   431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">reset</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (Consumer) Reset the parser.  Note that you can only call this</span><span class="r9">                         </span>  
 <span class="r6">   435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        method immediately after you&#x27;ve created a parser; parser</span><span class="r9">                               </span>  
 <span class="r6">   436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        instances cannot be reused.</span><span class="r9">                                                            </span>  
 <span class="r6">   437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">assert</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">, </span><span class="r16">&quot;cannot reuse parsers&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">feed</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data):</span><span class="r9">                                                                      </span>  
 <span class="r6">   441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (Consumer) Feed data to the parser.</span><span class="r9">                                                    </span>  
 <span class="r6">   443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param data: A string buffer.</span><span class="r9">                                                          </span>  
 <span class="r6">   445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :exception OSError: If the parser failed to parse the image file.</span><span class="r9">                      </span>  
 <span class="r6">   446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># collect data</span><span class="r9">                                                                         </span>  
 <span class="r6">   448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished:</span><span class="r9">                                                                      </span>  
 <span class="r6">   450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">   451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> data</span><span class="r9">                                                                   </span>  
 <span class="r6">   454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">+</span><span class="r11"> data</span><span class="r9">                                                       </span>  
 <span class="r6">   456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># parse what we have</span><span class="r9">                                                                   </span>  
 <span class="r6">   458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder:</span><span class="r9">                                                                       </span>  
 <span class="r6">   459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># skip header</span><span class="r9">                                                                  </span>  
 <span class="r6">   462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                skip </span><span class="r15">=</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(</span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data), </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset)</span><span class="r9">                                        </span>  
 <span class="r6">   463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data[skip:]</span><span class="r9">                                                   </span>  
 <span class="r6">   464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">-</span><span class="r11"> skip</span><span class="r9">                                               </span>  
 <span class="r6">   465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data:</span><span class="r9">                                           </span>  
 <span class="r6">   466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r9">                                                                     </span>  
 <span class="r6">   467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            n, e </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder</span><span class="r15">.</span><span class="r11">decode(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data)</span><span class="r9">                                              </span>  
 <span class="r6">   469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> n </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># end of stream</span><span class="r9">                                                                </span>  
 <span class="r6">   472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                               </span>  
 <span class="r6">   473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                              </span>  
 <span class="r6">   474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> e </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># decoding error</span><span class="r9">                                                           </span>  
 <span class="r6">   476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                          </span>  
 <span class="r6">   477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    raise_oserror(e)</span><span class="r9">                                                           </span>  
 <span class="r6">   478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># end of image</span><span class="r9">                                                             </span>  
 <span class="r6">   480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r9">                                                                     </span>  
 <span class="r6">   481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data[n:]</span><span class="r9">                                                          </span>  
 <span class="r6">   482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image:</span><span class="r9">                                                                       </span>  
 <span class="r6">   484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># if we end up here with no decoder, this file cannot</span><span class="r9">                              </span>  
 <span class="r6">   486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># be incrementally parsed.  wait until we&#x27;ve gotten all</span><span class="r9">                            </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># available data</span><span class="r9">                                                                   </span>  
 <span class="r6">   488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># attempt to open this file</span><span class="r9">                                                        </span>  
 <span class="r6">   493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">with</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data) </span><span class="r10">as</span><span class="r11"> fp:</span><span class="r9">                                              </span>  
 <span class="r6">   495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">open(fp)</span><span class="r9">                                                        </span>  
 <span class="r6">   496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># traceback.print_exc()</span><span class="r9">                                                        </span>  
 <span class="r6">   498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r11">  </span><span class="r14"># not enough data</span><span class="r9">                                                        </span>  
 <span class="r6">   499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                flag </span><span class="r15">=</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(im, </span><span class="r16">&quot;load_seek&quot;</span><span class="r11">) </span><span class="r19">or</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(im, </span><span class="r16">&quot;load_read&quot;</span><span class="r11">)</span><span class="r9">                    </span>  
 <span class="r6">   501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> flag </span><span class="r19">or</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(im</span><span class="r15">.</span><span class="r11">tile) </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                  </span>  
 <span class="r6">   502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># custom load code, or multiple tiles</span><span class="r9">                                      </span>  
 <span class="r6">   503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decode </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                         </span>  
 <span class="r6">   504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># initialize decoder</span><span class="r9">                                                       </span>  
 <span class="r6">   506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im</span><span class="r15">.</span><span class="r11">load_prepare()</span><span class="r9">                                                          </span>  
 <span class="r6">   507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    d, e, o, a </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">tile[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                    </span>  
 <span class="r6">   508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    im</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                               </span>  
 <span class="r6">   509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">_getdecoder(im</span><span class="r15">.</span><span class="r11">mode, d, a, im</span><span class="r15">.</span><span class="r11">decoderconfig)</span><span class="r9">          </span>  
 <span class="r6">   510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder</span><span class="r15">.</span><span class="r11">setimage(im</span><span class="r15">.</span><span class="r11">im, e)</span><span class="r9">                                            </span>  
 <span class="r6">   511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># calculate decoder offset</span><span class="r9">                                                 </span>  
 <span class="r6">   513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">=</span><span class="r11"> o</span><span class="r9">                                                            </span>  
 <span class="r6">   514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data):</span><span class="r9">                                          </span>  
 <span class="r6">   515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data[</span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset :]</span><span class="r9">                                   </span>  
 <span class="r6">   516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">offset </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                        </span>  
 <span class="r6">   517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image </span><span class="r15">=</span><span class="r11"> im</span><span class="r9">                                                                </span>  
 <span class="r6">   519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__enter__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r9">                                                                            </span>  
 <span class="r6">   522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__exit__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                                 </span>  
 <span class="r6">   524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">close()</span><span class="r9">                                                                           </span>  
 <span class="r6">   525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">close</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        (Consumer) Close the stream.</span><span class="r9">                                                           </span>  
 <span class="r6">   529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: An image object.</span><span class="r9">                                                             </span>  
 <span class="r6">   531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :exception OSError: If the parser failed to parse the image file either</span><span class="r9">                </span>  
 <span class="r6">   532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                            because it cannot be identified or cannot be</span><span class="r9">                       </span>  
 <span class="r6">   533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">                            decoded.</span><span class="r9">                                                           </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># finish decoding</span><span class="r9">                                                                      </span>  
 <span class="r6">   536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder:</span><span class="r9">                                                                       </span>  
 <span class="r6">   537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># get rid of what&#x27;s left in the buffers</span><span class="r9">                                            </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">feed(</span><span class="r16">b&quot;&quot;</span><span class="r11">)</span><span class="r9">                                                                     </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoder </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                    </span>  
 <span class="r6">   540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">finished:</span><span class="r9">                                                              </span>  
 <span class="r6">   541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;image was incomplete&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                             </span>  
 <span class="r6">   543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image:</span><span class="r9">                                                                     </span>  
 <span class="r6">   544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot parse this image&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">data:</span><span class="r9">                                                                          </span>  
 <span class="r6">   547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># incremental parsing not possible; reopen the file</span><span class="r9">                                </span>  
 <span class="r6">   548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># not that we have all data</span><span class="r9">                                                        </span>  
 <span class="r6">   549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">data) </span><span class="r10">as</span><span class="r11"> fp:</span><span class="r9">                                                  </span>  
 <span class="r6">   550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">open(fp)</span><span class="r9">                                                </span>  
 <span class="r6">   552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                          </span>  
 <span class="r6">   554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">image</span><span class="r9">                                                                      </span>  
 <span class="r6">   555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_save</span><span class="r11">(im, fp, tile, bufsize</span><span class="r15">=0</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">   561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;Helper to save image based on tile list</span><span class="r9">                                                 </span>  
 <span class="r6">   562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param im: Image object.</span><span class="r9">                                                                   </span>  
 <span class="r6">   564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param fp: File object.</span><span class="r9">                                                                    </span>  
 <span class="r6">   565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param tile: Tile list.</span><span class="r9">                                                                    </span>  
 <span class="r6">   566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param bufsize: Optional buffer size</span><span class="r9">                                                       </span>  
 <span class="r6">   567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                                  </span>  
 <span class="r6">   570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(im, </span><span class="r16">&quot;encoderconfig&quot;</span><span class="r11">):</span><span class="r9">                                                       </span>  
 <span class="r6">   571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        im</span><span class="r15">.</span><span class="r11">encoderconfig </span><span class="r15">=</span><span class="r11"> ()</span><span class="r9">                                                                  </span>  
 <span class="r6">   572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    tile</span><span class="r15">.</span><span class="r11">sort(key</span><span class="r15">=</span><span class="r11">_tilesort)</span><span class="r9">                                                                   </span>  
 <span class="r6">   573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># FIXME: make MAXBLOCK a configuration parameter</span><span class="r9">                                           </span>  
 <span class="r6">   574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># It would be great if we could have the encoder specify what it needs</span><span class="r9">                     </span>  
 <span class="r6">   575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># But, it would need at least the image size in most cases. RawEncode is</span><span class="r9">                   </span>  
 <span class="r6">   576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># a tricky case.</span><span class="r9">                                                                           </span>  
 <span class="r6">   577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">max</span><span class="r11">(MAXBLOCK, bufsize, im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> </span><span class="r15">4</span><span class="r11">)  </span><span class="r14"># see RawEncode.c</span><span class="r9">                        </span>  
 <span class="r6">   578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fh </span><span class="r15">=</span><span class="r11"> fp</span><span class="r15">.</span><span class="r11">fileno()</span><span class="r9">                                                                       </span>  
 <span class="r6">   580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp</span><span class="r15">.</span><span class="r11">flush()</span><span class="r9">                                                                             </span>  
 <span class="r6">   581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _encode_tile(im, fp, tile, bufsize, fh)</span><span class="r9">                                                </span>  
 <span class="r6">   582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">AttributeError</span><span class="r11">, io</span><span class="r15">.</span><span class="r11">UnsupportedOperation) </span><span class="r10">as</span><span class="r11"> exc:</span><span class="r9">                                   </span>  
 <span class="r6">   583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        _encode_tile(im, fp, tile, bufsize, </span><span class="r10">None</span><span class="r11">, exc)</span><span class="r9">                                         </span>  
 <span class="r6">   584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(fp, </span><span class="r16">&quot;flush&quot;</span><span class="r11">):</span><span class="r9">                                                                   </span>  
 <span class="r6">   585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        fp</span><span class="r15">.</span><span class="r11">flush()</span><span class="r9">                                                                             </span>  
 <span class="r6">   586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_encode_tile</span><span class="r11">(im, fp, tile, bufsize, fh, exc</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                         </span>  
 <span class="r6">   589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> e, b, o, a </span><span class="r19">in</span><span class="r11"> tile:</span><span class="r9">                                                                    </span>  
 <span class="r6">   590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> o </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            fp</span><span class="r15">.</span><span class="r11">seek(o)</span><span class="r9">                                                                         </span>  
 <span class="r6">   592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        encoder </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">_getencoder(im</span><span class="r15">.</span><span class="r11">mode, e, a, im</span><span class="r15">.</span><span class="r11">encoderconfig)</span><span class="r9">                           </span>  
 <span class="r6">   593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            encoder</span><span class="r15">.</span><span class="r11">setimage(im</span><span class="r15">.</span><span class="r11">im, b)</span><span class="r9">                                                         </span>  
 <span class="r6">   595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> encoder</span><span class="r15">.</span><span class="r11">pushes_fd:</span><span class="r9">                                                              </span>  
 <span class="r6">   596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                encoder</span><span class="r15">.</span><span class="r11">setfd(fp)</span><span class="r9">                                                              </span>  
 <span class="r6">   597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                l, s </span><span class="r15">=</span><span class="r11"> encoder</span><span class="r15">.</span><span class="r11">encode_to_pyfd()</span><span class="r9">                                                </span>  
 <span class="r6">   598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> exc:</span><span class="r9">                                                                        </span>  
 <span class="r6">   600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># compress to Python file-compatible object</span><span class="r9">                                </span>  
 <span class="r6">   601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        l, s, d </span><span class="r15">=</span><span class="r11"> encoder</span><span class="r15">.</span><span class="r11">encode(bufsize)</span><span class="r9">                                      </span>  
 <span class="r6">   603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        fp</span><span class="r15">.</span><span class="r11">write(d)</span><span class="r9">                                                            </span>  
 <span class="r6">   604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">if</span><span class="r11"> s:</span><span class="r9">                                                                  </span>  
 <span class="r6">   605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                            </span><span class="r10">break</span><span class="r9">                                                              </span>  
 <span class="r6">   606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># slight speedup: compress to real file object</span><span class="r9">                             </span>  
 <span class="r6">   608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    s </span><span class="r15">=</span><span class="r11"> encoder</span><span class="r15">.</span><span class="r11">encode_to_file(fh, bufsize)</span><span class="r9">                                    </span>  
 <span class="r6">   609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> s </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;encoder error </span><span class="r21">{</span><span class="r11">s</span><span class="r21">}</span><span class="r16"> when writing image file&quot;</span><span class="r9">                             </span>  
 <span class="r6">   611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">exc</span><span class="r9">                                                    </span>  
 <span class="r6">   612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            encoder</span><span class="r15">.</span><span class="r11">cleanup()</span><span class="r9">                                                                  </span>  
 <span class="r6">   614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_safe_read</span><span class="r11">(fp, size):</span><span class="r9">                                                                      </span>  
 <span class="r6">   617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Reads large blocks in a safe way.  Unlike fp.read(n), this function</span><span class="r9">                        </span>  
 <span class="r6">   619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    doesn&#x27;t trust the user.  If the requested size is larger than</span><span class="r9">                              </span>  
 <span class="r6">   620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    SAFEBLOCK, the file is read block by block.</span><span class="r9">                                                </span>  
 <span class="r6">   621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param fp: File handle.  Must implement a &lt;b&gt;read&lt;/b&gt; method.</span><span class="r9">                              </span>  
 <span class="r6">   623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :param size: Number of bytes to read.</span><span class="r9">                                                      </span>  
 <span class="r6">   624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    :returns: A string containing &lt;i&gt;size&lt;/i&gt; bytes of data.</span><span class="r9">                                   </span>  
 <span class="r6">   625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Raises an OSError if the file is truncated and the read cannot be completed</span><span class="r9">                </span>  
 <span class="r6">   627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> size </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r9">                                                                             </span>  
 <span class="r6">   631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> size </span><span class="r15">&lt;=</span><span class="r11"> SAFEBLOCK:</span><span class="r9">                                                                      </span>  
 <span class="r6">   632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data </span><span class="r15">=</span><span class="r11"> fp</span><span class="r15">.</span><span class="r11">read(size)</span><span class="r9">                                                                   </span>  
 <span class="r6">   633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(data) </span><span class="r15">&lt;</span><span class="r11"> size:</span><span class="r9">                                                                   </span>  
 <span class="r6">   634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Truncated File Read&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> data</span><span class="r9">                                                                            </span>  
 <span class="r6">   637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    data </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                                  </span>  
 <span class="r6">   638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    remaining_size </span><span class="r15">=</span><span class="r11"> size</span><span class="r9">                                                                      </span>  
 <span class="r6">   639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">while</span><span class="r11"> remaining_size </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        block </span><span class="r15">=</span><span class="r11"> fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r20">min</span><span class="r11">(remaining_size, SAFEBLOCK))</span><span class="r9">                                        </span>  
 <span class="r6">   641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> block:</span><span class="r9">                                                                          </span>  
 <span class="r6">   642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">break</span><span class="r9">                                                                              </span>  
 <span class="r6">   643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data</span><span class="r15">.</span><span class="r11">append(block)</span><span class="r9">                                                                     </span>  
 <span class="r6">   644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        remaining_size </span><span class="r15">-=</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(block)</span><span class="r9">                                                           </span>  
 <span class="r6">   645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">sum</span><span class="r11">(</span><span class="r20">len</span><span class="r11">(d) </span><span class="r10">for</span><span class="r11"> d </span><span class="r19">in</span><span class="r11"> data) </span><span class="r15">&lt;</span><span class="r11"> size:</span><span class="r9">                                                       </span>  
 <span class="r6">   646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Truncated File Read&quot;</span><span class="r9">                                                            </span>  
 <span class="r6">   647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg)</span><span class="r9">                                                                     </span>  
 <span class="r6">   648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r15">.</span><span class="r11">join(data)</span><span class="r9">                                                                      </span>  
 <span class="r6">   649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">PyCodecState</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">xsize </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                         </span>  
 <span class="r6">   654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">ysize </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                         </span>  
 <span class="r6">   655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">xoff </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                          </span>  
 <span class="r6">   656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">yoff </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                          </span>  
 <span class="r6">   657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">extents</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">xoff, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">yoff, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">xoff </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">xsize, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">yoff </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">ysize</span><span class="r9">            </span>  
 <span class="r6">   660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">PyCodec</span><span class="r11">:</span><span class="r9">                                                                                 </span>  
 <span class="r6">   663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">__init__</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mode, </span><span class="r15">*</span><span class="r11">args):</span><span class="r9">                                                           </span>  
 <span class="r6">   664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state </span><span class="r15">=</span><span class="r11"> PyCodecState()</span><span class="r9">                                                            </span>  
 <span class="r6">   666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fd </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                         </span>  
 <span class="r6">   667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                       </span>  
 <span class="r6">   668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">init(args)</span><span class="r9">                                                                        </span>  
 <span class="r6">   669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">init</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, args):</span><span class="r9">                                                                      </span>  
 <span class="r6">   671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Override to perform codec specific initialization</span><span class="r9">                                      </span>  
 <span class="r6">   673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param args: Array of args items from the tile entry</span><span class="r9">                                   </span>  
 <span class="r6">   675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">   676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">args </span><span class="r15">=</span><span class="r11"> args</span><span class="r9">                                                                       </span>  
 <span class="r6">   678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">cleanup</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Override to perform codec specific cleanup</span><span class="r9">                                             </span>  
 <span class="r6">   682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">   684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">setfd</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, fd):</span><span class="r9">                                                                       </span>  
 <span class="r6">   688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Called from ImageFile to set the Python file-like object</span><span class="r9">                               </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fd: A Python file-like object</span><span class="r9">                                                   </span>  
 <span class="r6">   692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">   693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fd </span><span class="r15">=</span><span class="r11"> fd</span><span class="r9">                                                                           </span>  
 <span class="r6">   695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">setimage</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, im, extents</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                      </span>  
 <span class="r6">   697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Called from ImageFile to set the core output image for the codec</span><span class="r9">                       </span>  
 <span class="r6">   699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param im: A core image object</span><span class="r9">                                                         </span>  
 <span class="r6">   701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param extents: a 4 tuple of (x0, y0, x1, y1) defining the rectangle</span><span class="r9">                   </span>  
 <span class="r6">   702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            for this tile</span><span class="r9">                                                                      </span>  
 <span class="r6">   703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">   704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># following c code</span><span class="r9">                                                                     </span>  
 <span class="r6">   707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> im</span><span class="r9">                                                                           </span>  
 <span class="r6">   708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> extents:</span><span class="r9">                                                                            </span>  
 <span class="r6">   710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            (x0, y0, x1, y1) </span><span class="r15">=</span><span class="r11"> extents</span><span class="r9">                                                         </span>  
 <span class="r6">   711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            (x0, y0, x1, y1) </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                    </span>  
 <span class="r6">   713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> x0 </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> x1 </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xsize, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">ysize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                  </span>  
 <span class="r6">   716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xoff </span><span class="r15">=</span><span class="r11"> x0</span><span class="r9">                                                               </span>  
 <span class="r6">   718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">yoff </span><span class="r15">=</span><span class="r11"> y0</span><span class="r9">                                                               </span>  
 <span class="r6">   719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xsize </span><span class="r15">=</span><span class="r11"> x1 </span><span class="r15">-</span><span class="r11"> x0</span><span class="r9">                                                         </span>  
 <span class="r6">   720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">ysize </span><span class="r15">=</span><span class="r11"> y1 </span><span class="r15">-</span><span class="r11"> y0</span><span class="r9">                                                         </span>  
 <span class="r6">   721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xsize </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">ysize </span><span class="r15">&lt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                     </span>  
 <span class="r6">   723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Size cannot be negative&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> (</span><span class="r9">                                                                                   </span>  
 <span class="r6">   727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xsize </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">xoff </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                               </span>  
 <span class="r6">   728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r19">or</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">ysize </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">yoff </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                            </span>  
 <span class="r6">   729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ):</span><span class="r9">                                                                                     </span>  
 <span class="r6">   730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Tile cannot extend outside image&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">PyDecoder</span><span class="r11">(PyCodec):</span><span class="r9">                                                                      </span>  
 <span class="r6">   735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Python implementation of a format decoder. Override this class and</span><span class="r9">                         </span>  
 <span class="r6">   737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    add the decoding logic in the :meth:`decode` method.</span><span class="r9">                                       </span>  
 <span class="r6">   738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    See :ref:`Writing Your Own File Codec in Python&lt;file-codecs-py&gt;`</span><span class="r9">                           </span>  
 <span class="r6">   740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _pulls_fd </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                          </span>  
 <span class="r6">   743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">pulls_fd</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_pulls_fd</span><span class="r9">                                                                  </span>  
 <span class="r6">   747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">decode</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, buffer):</span><span class="r9">                                                                  </span>  
 <span class="r6">   749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Override to perform the decoding process.</span><span class="r9">                                              </span>  
 <span class="r6">   751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param buffer: A bytes object with the data to be decoded.</span><span class="r9">                             </span>  
 <span class="r6">   753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A tuple of ``(bytes consumed, errcode)``.</span><span class="r9">                                    </span>  
 <span class="r6">   754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            If finished with decoding return -1 for the bytes consumed.</span><span class="r9">                        </span>  
 <span class="r6">   755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            Err codes are from :data:`.ImageFile.ERRORS`.</span><span class="r9">                                      </span>  
 <span class="r6">   756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">NotImplementedError</span><span class="r11">()</span><span class="r9">                                                            </span>  
 <span class="r6">   758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">set_as_raw</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, data, rawmode</span><span class="r15">=</span><span class="r10">None</span><span class="r11">):</span><span class="r9">                                                  </span>  
 <span class="r6">   760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Convenience method to set the internal image from a stream of raw data</span><span class="r9">                 </span>  
 <span class="r6">   762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param data: Bytes to be set</span><span class="r9">                                                           </span>  
 <span class="r6">   764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param rawmode: The rawmode to be used for the decoder.</span><span class="r9">                                </span>  
 <span class="r6">   765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            If not specified, it will default to the mode of the image</span><span class="r9">                         </span>  
 <span class="r6">   766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: None</span><span class="r9">                                                                         </span>  
 <span class="r6">   767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> rawmode:</span><span class="r9">                                                                        </span>  
 <span class="r6">   770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            rawmode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                                </span>  
 <span class="r6">   771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        d </span><span class="r15">=</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">_getdecoder(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, </span><span class="r16">&quot;raw&quot;</span><span class="r11">, rawmode)</span><span class="r9">                                       </span>  
 <span class="r6">   772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        d</span><span class="r15">.</span><span class="r11">setimage(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">im, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">state</span><span class="r15">.</span><span class="r11">extents())</span><span class="r9">                                              </span>  
 <span class="r6">   773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> d</span><span class="r15">.</span><span class="r11">decode(data)</span><span class="r9">                                                                     </span>  
 <span class="r6">   774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> s[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;not enough image data&quot;</span><span class="r9">                                                      </span>  
 <span class="r6">   777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> s[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot decode image data&quot;</span><span class="r9">                                                   </span>  
 <span class="r6">   780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">PyEncoder</span><span class="r11">(PyCodec):</span><span class="r9">                                                                      </span>  
 <span class="r6">   784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">    </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    Python implementation of a format encoder. Override this class and</span><span class="r9">                         </span>  
 <span class="r6">   786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    add the decoding logic in the :meth:`encode` method.</span><span class="r9">                                       </span>  
 <span class="r6">   787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    See :ref:`Writing Your Own File Codec in Python&lt;file-codecs-py&gt;`</span><span class="r9">                           </span>  
 <span class="r6">   789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">    &quot;&quot;&quot;</span><span class="r9">                                                                                        </span>  
 <span class="r6">   790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    _pushes_fd </span><span class="r15">=</span><span class="r11"> </span><span class="r10">False</span><span class="r9">                                                                         </span>  
 <span class="r6">   792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r23">@property</span><span class="r9">                                                                                  </span>  
 <span class="r6">   794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">pushes_fd</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                       </span>  
 <span class="r6">   795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_pushes_fd</span><span class="r9">                                                                 </span>  
 <span class="r6">   796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">encode</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, bufsize):</span><span class="r9">                                                                 </span>  
 <span class="r6">   798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Override to perform the encoding process.</span><span class="r9">                                              </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param bufsize: Buffer size.</span><span class="r9">                                                           </span>  
 <span class="r6">   802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A tuple of ``(bytes encoded, errcode, bytes)``.</span><span class="r9">                              </span>  
 <span class="r6">   803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            If finished with encoding return 1 for the error code.</span><span class="r9">                             </span>  
 <span class="r6">   804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            Err codes are from :data:`.ImageFile.ERRORS`.</span><span class="r9">                                      </span>  
 <span class="r6">   805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">NotImplementedError</span><span class="r11">()</span><span class="r9">                                                            </span>  
 <span class="r6">   807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">encode_to_pyfd</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                  </span>  
 <span class="r6">   809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        If ``pushes_fd`` is ``True``, then this method will be used,</span><span class="r9">                           </span>  
 <span class="r6">   811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        and ``encode()`` will only be called once.</span><span class="r9">                                             </span>  
 <span class="r6">   812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: A tuple of ``(bytes consumed, errcode)``.</span><span class="r9">                                    </span>  
 <span class="r6">   814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            Err codes are from :data:`.ImageFile.ERRORS`.</span><span class="r9">                                      </span>  
 <span class="r6">   815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">pushes_fd:</span><span class="r9">                                                                 </span>  
 <span class="r6">   817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r15">0</span><span class="r11">, </span><span class="r15">-8</span><span class="r11">  </span><span class="r14"># bad configuration</span><span class="r9">                                                  </span>  
 <span class="r6">   818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        bytes_consumed, errcode, data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">encode(</span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                         </span>  
 <span class="r6">   819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> data:</span><span class="r9">                                                                               </span>  
 <span class="r6">   820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fd</span><span class="r15">.</span><span class="r11">write(data)</span><span class="r9">                                                                </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> bytes_consumed, errcode</span><span class="r9">                                                         </span>  
 <span class="r6">   822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">encode_to_file</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, fh, bufsize):</span><span class="r9">                                                     </span>  
 <span class="r6">   824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param fh: File handle.</span><span class="r9">                                                                </span>  
 <span class="r6">   826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :param bufsize: Buffer size.</span><span class="r9">                                                           </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: If finished successfully, return 0.</span><span class="r9">                                          </span>  
 <span class="r6">   829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            Otherwise, return an error code. Err codes are from</span><span class="r9">                                </span>  
 <span class="r6">   830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">            :data:`.ImageFile.ERRORS`.</span><span class="r9">                                                         </span>  
 <span class="r6">   831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        errcode </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                            </span>  
 <span class="r6">   833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> errcode </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            status, errcode, buf </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">encode(bufsize)</span><span class="r9">                                        </span>  
 <span class="r6">   835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> status </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                fh</span><span class="r15">.</span><span class="r11">write(buf[status:])</span><span class="r9">                                                         </span>  
 <span class="r6">   837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> errcode</span><span class="r9">                                                                         </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r24">function summary for /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/…</span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_tilesort</span><span class="r9">                                                                        </span>  
 <span class="r6">   155 </span>│<span class="r7">    1%  </span>│<span class="r7">       </span>│<span class="r7">   1%  </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">load</span><span class="r9">                                                                             </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">load_prepare</span><span class="r9">                                                                     </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">load_end</span><span class="r9">                                                                         </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r17">__init__</span><span class="r9">                                                                         </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_safe_read</span><span class="r9">                                                                       </span>  
        ╵        ╵       ╵       ╵                                                                                                 
<span class="r1"> /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/JpegImagePlugin.py: % of time =   2.48% (5m:28.336s) out </span>
<span class="r1">                                                        of 4h:40m:20.690s.                                                         </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/JpegImagePlugin.py     </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># The Python Imaging Library.</span><span class="r9">                                                                  </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># $Id$</span><span class="r9">                                                                                         </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># JPEG (JFIF) file handling</span><span class="r9">                                                                    </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># See &quot;Digital Compression and Coding of Continuous-Tone Still Images,</span><span class="r9">                         </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Part 1, Requirements and Guidelines&quot; (CCITT T.81 / ISO 10918-1)</span><span class="r9">                              </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># History:</span><span class="r9">                                                                                     </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1995-09-09 fl   Created</span><span class="r9">                                                                      </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1995-09-13 fl   Added full parser</span><span class="r9">                                                            </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-03-25 fl   Added hack to use the IJG command line utilities</span><span class="r9">                             </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-05-05 fl   Workaround Photoshop 2.5 CMYK polarity bug</span><span class="r9">                                   </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-05-28 fl   Added draft support, JFIF version (0.1)</span><span class="r9">                                      </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1996-12-30 fl   Added encoder options, added progression property (0.2)</span><span class="r9">                      </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1997-08-27 fl   Save mode 1 images as BW (0.3)</span><span class="r9">                                               </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1998-07-12 fl   Added YCbCr to draft and save methods (0.4)</span><span class="r9">                                  </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 1998-10-19 fl   Don&#x27;t hang on files using 16-bit DQT&#x27;s (0.4.1)</span><span class="r9">                               </span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2001-04-16 fl   Extract DPI settings from JFIF files (0.4.2)</span><span class="r9">                                 </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2002-07-01 fl   Skip pad bytes before markers; identify Exif files (0.4.3)</span><span class="r9">                   </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-04-25 fl   Added experimental EXIF decoder (0.5)</span><span class="r9">                                        </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-06-06 fl   Added experimental EXIF GPSinfo decoder</span><span class="r9">                                      </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2003-09-13 fl   Extract COM markers</span><span class="r9">                                                          </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2009-09-06 fl   Added icc_profile support (from Florian Hoech)</span><span class="r9">                               </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2009-03-06 fl   Changed CMYK handling; always use Adobe polarity (0.6)</span><span class="r9">                       </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># 2009-03-08 fl   Added subsampling support (from Justin Huff).</span><span class="r9">                                </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1997-2003 by Secret Labs AB.</span><span class="r9">                                                   </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Copyright (c) 1995-1996 by Fredrik Lundh.</span><span class="r9">                                                    </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># See the README file for information on usage and redistribution.</span><span class="r9">                             </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">array</span><span class="r9">                                                                                   </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">io</span><span class="r9">                                                                                      </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">math</span><span class="r9">                                                                                    </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">os</span><span class="r9">                                                                                      </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">struct</span><span class="r9">                                                                                  </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">subprocess</span><span class="r9">                                                                              </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">sys</span><span class="r9">                                                                                     </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">tempfile</span><span class="r9">                                                                                </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">import</span><span class="r11"> </span><span class="r12">warnings</span><span class="r9">                                                                                </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">.</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> Image, ImageFile, TiffImagePlugin</span><span class="r9">                                                </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._binary</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> i16be </span><span class="r10">as</span><span class="r11"> i16</span><span class="r9">                                                              </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._binary</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> i32be </span><span class="r10">as</span><span class="r11"> i32</span><span class="r9">                                                              </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._binary</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> o8</span><span class="r9">                                                                        </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._binary</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> o16be </span><span class="r10">as</span><span class="r11"> o16</span><span class="r9">                                                              </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">._deprecate</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> deprecate</span><span class="r9">                                                              </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">from</span><span class="r11"> </span><span class="r12">.JpegPresets</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> presets</span><span class="r9">                                                               </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Parser</span><span class="r9">                                                                                       </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">Skip</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, marker):</span><span class="r9">                                                                        </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    n </span><span class="r15">=</span><span class="r11"> i16(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)) </span><span class="r15">-</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                               </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ImageFile</span><span class="r15">.</span><span class="r11">_safe_read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, n)</span><span class="r9">                                                           </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">APP</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, marker):</span><span class="r9">                                                                         </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#</span><span class="r9">                                                                                          </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Application marker.  Store these in the APP dictionary.</span><span class="r9">                                  </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Also look for well-known application markers.</span><span class="r9">                                            </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    n </span><span class="r15">=</span><span class="r11"> i16(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)) </span><span class="r15">-</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                               </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    s </span><span class="r15">=</span><span class="r11"> ImageFile</span><span class="r15">.</span><span class="r11">_safe_read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, n)</span><span class="r9">                                                       </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    app </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;APP</span><span class="r21">%d</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r15">%</span><span class="r11"> (marker </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">15</span><span class="r11">)</span><span class="r9">                                                              </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">app[app] </span><span class="r15">=</span><span class="r11"> s  </span><span class="r14"># compatibility</span><span class="r9">                                                         </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">applist</span><span class="r15">.</span><span class="r11">append((app, s))</span><span class="r9">                                                              </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFE0</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">4</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;JFIF&quot;</span><span class="r11">:</span><span class="r9">                                                  </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># extract JFIF information</span><span class="r9">                                                             </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;jfif&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> version </span><span class="r15">=</span><span class="r11"> i16(s, </span><span class="r15">5</span><span class="r11">)  </span><span class="r14"># version</span><span class="r9">                                     </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;jfif_version&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">divmod</span><span class="r11">(version, </span><span class="r15">256</span><span class="r11">)</span><span class="r9">                                       </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># extract JFIF properties</span><span class="r9">                                                              </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            jfif_unit </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">7</span><span class="r11">]</span><span class="r9">                                                                   </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            jfif_density </span><span class="r15">=</span><span class="r11"> i16(s, </span><span class="r15">8</span><span class="r11">), i16(s, </span><span class="r15">10</span><span class="r11">)</span><span class="r9">                                               </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> jfif_unit </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;dpi&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> jfif_density</span><span class="r9">                                                </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;jfif_unit&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> jfif_unit</span><span class="r9">                                                 </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;jfif_density&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> jfif_density</span><span class="r9">                                           </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFE1</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">5</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;Exif</span><span class="r25">\0</span><span class="r16">&quot;</span><span class="r11">:</span><span class="r9">                                              </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;exif&quot;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                                            </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># extract EXIF information (incomplete)</span><span class="r9">                                            </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;exif&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> s  </span><span class="r14"># FIXME: value will change</span><span class="r9">                                  </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_exif_offset </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">tell() </span><span class="r15">-</span><span class="r11"> n </span><span class="r15">+</span><span class="r11"> </span><span class="r15">6</span><span class="r9">                                         </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFE2</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">5</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;FPXR</span><span class="r25">\0</span><span class="r16">&quot;</span><span class="r11">:</span><span class="r9">                                              </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># extract FlashPix information (incomplete)</span><span class="r9">                                            </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;flashpix&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> s  </span><span class="r14"># FIXME: value will change</span><span class="r9">                                  </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFE2</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">12</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;ICC_PROFILE</span><span class="r25">\0</span><span class="r16">&quot;</span><span class="r11">:</span><span class="r9">                                      </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Since an ICC profile can be larger than the maximum size of</span><span class="r9">                          </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># a JPEG marker (64K), we need provisions to split it into</span><span class="r9">                             </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># multiple markers. The format defined by the ICC specifies</span><span class="r9">                            </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># one or more APP2 markers containing the following data:</span><span class="r9">                              </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#   Identifying string      ASCII &quot;ICC_PROFILE\0&quot;  (12 bytes)</span><span class="r9">                          </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#   Marker sequence number  1, 2, etc (1 byte)</span><span class="r9">                                         </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#   Number of markers       Total of APP2&#x27;s used (1 byte)</span><span class="r9">                              </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14">#   Profile data            (remainder of APP2 data)</span><span class="r9">                                   </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Decoders should use the marker sequence numbers to</span><span class="r9">                                   </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># reassemble the profile, rather than assuming that the APP2</span><span class="r9">                           </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># markers appear in the correct sequence.</span><span class="r9">                                              </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist</span><span class="r15">.</span><span class="r11">append(s)</span><span class="r9">                                                                 </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFED</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">14</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;Photoshop 3.0</span><span class="r25">\x00</span><span class="r16">&quot;</span><span class="r11">:</span><span class="r9">                                  </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># parse the image resource block</span><span class="r9">                                                       </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        offset </span><span class="r15">=</span><span class="r11"> </span><span class="r15">14</span><span class="r9">                                                                            </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        photoshop </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">setdefault(</span><span class="r16">&quot;photoshop&quot;</span><span class="r11">, {})</span><span class="r9">                                      </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> s[offset : offset </span><span class="r15">+</span><span class="r11"> </span><span class="r15">4</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;8BIM&quot;</span><span class="r11">:</span><span class="r9">                                               </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                    </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># resource code</span><span class="r9">                                                                </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                code </span><span class="r15">=</span><span class="r11"> i16(s, offset)</span><span class="r9">                                                          </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                    </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># resource name (usually empty)</span><span class="r9">                                                </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                name_len </span><span class="r15">=</span><span class="r11"> s[offset]</span><span class="r9">                                                           </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># name = s[offset+1:offset+1+name_len]</span><span class="r9">                                         </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> name_len</span><span class="r9">                                                         </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> offset </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">  </span><span class="r14"># align</span><span class="r9">                                                  </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># resource data block</span><span class="r9">                                                          </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                size </span><span class="r15">=</span><span class="r11"> i32(s, offset)</span><span class="r9">                                                          </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                                                    </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                data </span><span class="r15">=</span><span class="r11"> s[offset : offset </span><span class="r15">+</span><span class="r11"> size]</span><span class="r9">                                               </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> code </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0x03ED</span><span class="r11">:  </span><span class="r14"># ResolutionInfo</span><span class="r9">                                           </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    data </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                   </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;XResolution&quot;</span><span class="r11">: i32(data, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">/</span><span class="r11"> </span><span class="r15">65536</span><span class="r11">,</span><span class="r9">                                   </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;DisplayedUnitsX&quot;</span><span class="r11">: i16(data, </span><span class="r15">4</span><span class="r11">),</span><span class="r9">                                       </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;YResolution&quot;</span><span class="r11">: i32(data, </span><span class="r15">8</span><span class="r11">) </span><span class="r15">/</span><span class="r11"> </span><span class="r15">65536</span><span class="r11">,</span><span class="r9">                                   </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r16">&quot;DisplayedUnitsY&quot;</span><span class="r11">: i16(data, </span><span class="r15">12</span><span class="r11">),</span><span class="r9">                                      </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    }</span><span class="r9">                                                                          </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                photoshop[code] </span><span class="r15">=</span><span class="r11"> data</span><span class="r9">                                                         </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> size</span><span class="r9">                                                                 </span>  
 <span class="r6">   138 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                offset </span><span class="r15">+=</span><span class="r11"> offset </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">  </span><span class="r14"># align</span><span class="r9">                                                  </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">error:</span><span class="r9">                                                               </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">break</span><span class="r11">  </span><span class="r14"># insufficient data</span><span class="r9">                                                     </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFEE</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">5</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;Adobe&quot;</span><span class="r11">:</span><span class="r9">                                               </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;adobe&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> i16(s, </span><span class="r15">5</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># extract Adobe custom properties</span><span class="r9">                                                      </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            adobe_transform </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">11</span><span class="r11">]</span><span class="r9">                                                            </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> </span><span class="r13">IndexError</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">pass</span><span class="r9">                                                                               </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;adobe_transform&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> adobe_transform</span><span class="r9">                                     </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFE2</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> s[:</span><span class="r15">4</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;MPF</span><span class="r25">\0</span><span class="r16">&quot;</span><span class="r11">:</span><span class="r9">                                               </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># extract MPO information</span><span class="r9">                                                              </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;mp&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">4</span><span class="r11">:]</span><span class="r9">                                                                </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># offset is current location minus buffer size</span><span class="r9">                                         </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># plus constant header size</span><span class="r9">                                                            </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;mpoffset&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">tell() </span><span class="r15">-</span><span class="r11"> n </span><span class="r15">+</span><span class="r11"> </span><span class="r15">4</span><span class="r9">                                         </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># If DPI isn&#x27;t in JPEG header, fetch from EXIF</span><span class="r9">                                             </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;dpi&quot;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info </span><span class="r19">and</span><span class="r11"> </span><span class="r16">&quot;exif&quot;</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                         </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            exif </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getexif()</span><span class="r9">                                                              </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            resolution_unit </span><span class="r15">=</span><span class="r11"> exif[</span><span class="r15">0x0128</span><span class="r11">]</span><span class="r9">                                                     </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            x_resolution </span><span class="r15">=</span><span class="r11"> exif[</span><span class="r15">0x011A</span><span class="r11">]</span><span class="r9">                                                        </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                dpi </span><span class="r15">=</span><span class="r11"> </span><span class="r20">float</span><span class="r11">(x_resolution[</span><span class="r15">0</span><span class="r11">]) </span><span class="r15">/</span><span class="r11"> x_resolution[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                 </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                dpi </span><span class="r15">=</span><span class="r11"> x_resolution</span><span class="r9">                                                             </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> math</span><span class="r15">.</span><span class="r11">isnan(dpi):</span><span class="r9">                                                                </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r9">                                                               </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> resolution_unit </span><span class="r15">==</span><span class="r11"> </span><span class="r15">3</span><span class="r11">:  </span><span class="r14"># cm</span><span class="r9">                                                     </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># 1 dpcm = 2.54 dpi</span><span class="r9">                                                            </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                dpi </span><span class="r15">*=</span><span class="r11"> </span><span class="r15">2.54</span><span class="r9">                                                                    </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;dpi&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> dpi, dpi</span><span class="r9">                                                        </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">TypeError</span><span class="r11">, </span><span class="r13">KeyError</span><span class="r11">, </span><span class="r13">SyntaxError</span><span class="r11">, </span><span class="r13">ValueError</span><span class="r11">, </span><span class="r13">ZeroDivisionError</span><span class="r11">):</span><span class="r9">              </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># SyntaxError for invalid/unreadable EXIF</span><span class="r9">                                          </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># KeyError for dpi not included</span><span class="r9">                                                    </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># ZeroDivisionError for invalid dpi rational value</span><span class="r9">                                 </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># ValueError or TypeError for dpi being an invalid float</span><span class="r9">                           </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;dpi&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r15">72</span><span class="r11">, </span><span class="r15">72</span><span class="r9">                                                          </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">COM</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, marker):</span><span class="r9">                                                                         </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#</span><span class="r9">                                                                                          </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Comment marker.  Store these in the APP dictionary.</span><span class="r9">                                      </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    n </span><span class="r15">=</span><span class="r11"> i16(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)) </span><span class="r15">-</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                               </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    s </span><span class="r15">=</span><span class="r11"> ImageFile</span><span class="r15">.</span><span class="r11">_safe_read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, n)</span><span class="r9">                                                       </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;comment&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> s</span><span class="r9">                                                                   </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">app[</span><span class="r16">&quot;COM&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> s  </span><span class="r14"># compatibility</span><span class="r9">                                                       </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">applist</span><span class="r15">.</span><span class="r11">append((</span><span class="r16">&quot;COM&quot;</span><span class="r11">, s))</span><span class="r9">                                                            </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">SOF</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, marker):</span><span class="r9">                                                                         </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#</span><span class="r9">                                                                                          </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Start of frame marker.  Defines the size and mode of the</span><span class="r9">                                 </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># image.  JPEG is colour blind, so we use some simple</span><span class="r9">                                      </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># heuristics to map the number of layers to an appropriate</span><span class="r9">                                 </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># mode.  Note that this could be made a bit brighter, by</span><span class="r9">                                   </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># looking for JFIF and Adobe APP markers.</span><span class="r9">                                                  </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    n </span><span class="r15">=</span><span class="r11"> i16(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)) </span><span class="r15">-</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                               </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    s </span><span class="r15">=</span><span class="r11"> ImageFile</span><span class="r15">.</span><span class="r11">_safe_read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, n)</span><span class="r9">                                                       </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> i16(s, </span><span class="r15">3</span><span class="r11">), i16(s, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                                          </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">bits </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                           </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">bits </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">8</span><span class="r11">:</span><span class="r9">                                                                         </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;cannot handle </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r11">bits</span><span class="r21">}</span><span class="r16">-bit layers&quot;</span><span class="r9">                                          </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">5</span><span class="r11">]</span><span class="r9">                                                                         </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                       </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;L&quot;</span><span class="r9">                                                                        </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers </span><span class="r15">==</span><span class="r11"> </span><span class="r15">3</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r9">                                                                      </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers </span><span class="r15">==</span><span class="r11"> </span><span class="r15">4</span><span class="r11">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;CMYK&quot;</span><span class="r9">                                                                     </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;cannot handle </span><span class="r21">{</span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers</span><span class="r21">}</span><span class="r16">-layer images&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                                 </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> marker </span><span class="r19">in</span><span class="r11"> [</span><span class="r15">0xFFC2</span><span class="r11">, </span><span class="r15">0xFFC6</span><span class="r11">, </span><span class="r15">0xFFCA</span><span class="r11">, </span><span class="r15">0xFFCE</span><span class="r11">]:</span><span class="r9">                                             </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;progressive&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;progression&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist:</span><span class="r9">                                                                           </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># fixup icc profile</span><span class="r9">                                                                    </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist</span><span class="r15">.</span><span class="r11">sort()  </span><span class="r14"># sort by sequence number</span><span class="r9">                                         </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist[</span><span class="r15">0</span><span class="r11">][</span><span class="r15">13</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist):</span><span class="r9">                                           </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            profile </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                       </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> p </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist:</span><span class="r9">                                                             </span>  
 <span class="r6">   230 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                profile</span><span class="r15">.</span><span class="r11">append(p[</span><span class="r15">14</span><span class="r11">:])</span><span class="r9">                                                         </span>  
 <span class="r6">   231 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            icc_profile </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;&quot;</span><span class="r15">.</span><span class="r11">join(profile)</span><span class="r9">                                                    </span>  
 <span class="r6">   232 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   233 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            icc_profile </span><span class="r15">=</span><span class="r11"> </span><span class="r10">None</span><span class="r11">  </span><span class="r14"># wrong number of fragments</span><span class="r9">                                    </span>  
 <span class="r6">   234 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;icc_profile&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> icc_profile</span><span class="r9">                                                 </span>  
 <span class="r6">   235 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                      </span>  
 <span class="r6">   236 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   237 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">6</span><span class="r11">, </span><span class="r20">len</span><span class="r11">(s), </span><span class="r15">3</span><span class="r11">):</span><span class="r9">                                                              </span>  
 <span class="r6">   238 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        t </span><span class="r15">=</span><span class="r11"> s[i : i </span><span class="r15">+</span><span class="r11"> </span><span class="r15">3</span><span class="r11">]</span><span class="r9">                                                                       </span>  
 <span class="r6">   239 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># 4-tuples: id, vsamp, hsamp, qtable</span><span class="r9">                                                   </span>  
 <span class="r6">   240 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layer</span><span class="r15">.</span><span class="r11">append((t[</span><span class="r15">0</span><span class="r11">], t[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">//</span><span class="r11"> </span><span class="r15">16</span><span class="r11">, t[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">15</span><span class="r11">, t[</span><span class="r15">2</span><span class="r11">]))</span><span class="r9">                                 </span>  
 <span class="r6">   241 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   242 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">DQT</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, marker):</span><span class="r9">                                                                         </span>  
 <span class="r6">   244 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#</span><span class="r9">                                                                                          </span>  
 <span class="r6">   245 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Define quantization table.  Note that there might be more</span><span class="r9">                                </span>  
 <span class="r6">   246 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># than one table in each marker.</span><span class="r9">                                                           </span>  
 <span class="r6">   247 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   248 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># FIXME: The quantization tables can be used to estimate the</span><span class="r9">                               </span>  
 <span class="r6">   249 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># compression quality.</span><span class="r9">                                                                     </span>  
 <span class="r6">   250 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   251 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    n </span><span class="r15">=</span><span class="r11"> i16(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">2</span><span class="r11">)) </span><span class="r15">-</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                               </span>  
 <span class="r6">   252 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    s </span><span class="r15">=</span><span class="r11"> ImageFile</span><span class="r15">.</span><span class="r11">_safe_read(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp, n)</span><span class="r9">                                                       </span>  
 <span class="r6">   253 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">while</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(s):</span><span class="r9">                                                                              </span>  
 <span class="r6">   254 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        v </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                               </span>  
 <span class="r6">   255 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        precision </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> (v </span><span class="r15">//</span><span class="r11"> </span><span class="r15">16</span><span class="r11"> </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">) </span><span class="r10">else</span><span class="r11"> </span><span class="r15">2</span><span class="r11">  </span><span class="r14"># in bytes</span><span class="r9">                                     </span>  
 <span class="r6">   256 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        qt_length </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> precision </span><span class="r15">*</span><span class="r11"> </span><span class="r15">64</span><span class="r9">                                                         </span>  
 <span class="r6">   257 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(s) </span><span class="r15">&lt;</span><span class="r11"> qt_length:</span><span class="r9">                                                                 </span>  
 <span class="r6">   258 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;bad quantization table marker&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   259 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                             </span>  
 <span class="r6">   260 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data </span><span class="r15">=</span><span class="r11"> array</span><span class="r15">.</span><span class="r11">array(</span><span class="r16">&quot;B&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> precision </span><span class="r15">==</span><span class="r11"> </span><span class="r15">1</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;H&quot;</span><span class="r11">, s[</span><span class="r15">1</span><span class="r11">:qt_length])</span><span class="r9">                     </span>  
 <span class="r6">   261 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> sys</span><span class="r15">.</span><span class="r11">byteorder </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;little&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> precision </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                        </span>  
 <span class="r6">   262 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            data</span><span class="r15">.</span><span class="r11">byteswap()  </span><span class="r14"># the values are always big-endian</span><span class="r9">                                </span>  
 <span class="r6">   263 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">quantization[v </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">15</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> [data[i] </span><span class="r10">for</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> zigzag_index]</span><span class="r9">                            </span>  
 <span class="r6">   264 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> s[qt_length:]</span><span class="r9">                                                                      </span>  
 <span class="r6">   265 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   266 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   267 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">#</span><span class="r9">                                                                                              </span>  
 <span class="r6">   268 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># JPEG marker table</span><span class="r9">                                                                            </span>  
 <span class="r6">   269 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   270 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">MARKER </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                                     </span>  
 <span class="r6">   271 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC0</span><span class="r11">: (</span><span class="r16">&quot;SOF0&quot;</span><span class="r11">, </span><span class="r16">&quot;Baseline DCT&quot;</span><span class="r11">, SOF),</span><span class="r9">                                                     </span>  
 <span class="r6">   272 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC1</span><span class="r11">: (</span><span class="r16">&quot;SOF1&quot;</span><span class="r11">, </span><span class="r16">&quot;Extended Sequential DCT&quot;</span><span class="r11">, SOF),</span><span class="r9">                                          </span>  
 <span class="r6">   273 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC2</span><span class="r11">: (</span><span class="r16">&quot;SOF2&quot;</span><span class="r11">, </span><span class="r16">&quot;Progressive DCT&quot;</span><span class="r11">, SOF),</span><span class="r9">                                                  </span>  
 <span class="r6">   274 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC3</span><span class="r11">: (</span><span class="r16">&quot;SOF3&quot;</span><span class="r11">, </span><span class="r16">&quot;Spatial lossless&quot;</span><span class="r11">, SOF),</span><span class="r9">                                                 </span>  
 <span class="r6">   275 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC4</span><span class="r11">: (</span><span class="r16">&quot;DHT&quot;</span><span class="r11">, </span><span class="r16">&quot;Define Huffman table&quot;</span><span class="r11">, Skip),</span><span class="r9">                                             </span>  
 <span class="r6">   276 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC5</span><span class="r11">: (</span><span class="r16">&quot;SOF5&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential sequential DCT&quot;</span><span class="r11">, SOF),</span><span class="r9">                                      </span>  
 <span class="r6">   277 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC6</span><span class="r11">: (</span><span class="r16">&quot;SOF6&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential progressive DCT&quot;</span><span class="r11">, SOF),</span><span class="r9">                                     </span>  
 <span class="r6">   278 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC7</span><span class="r11">: (</span><span class="r16">&quot;SOF7&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential spatial&quot;</span><span class="r11">, SOF),</span><span class="r9">                                             </span>  
 <span class="r6">   279 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC8</span><span class="r11">: (</span><span class="r16">&quot;JPG&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                        </span>  
 <span class="r6">   280 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFC9</span><span class="r11">: (</span><span class="r16">&quot;SOF9&quot;</span><span class="r11">, </span><span class="r16">&quot;Extended sequential DCT (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                                     </span>  
 <span class="r6">   281 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCA</span><span class="r11">: (</span><span class="r16">&quot;SOF10&quot;</span><span class="r11">, </span><span class="r16">&quot;Progressive DCT (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                                            </span>  
 <span class="r6">   282 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCB</span><span class="r11">: (</span><span class="r16">&quot;SOF11&quot;</span><span class="r11">, </span><span class="r16">&quot;Spatial lossless DCT (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                                       </span>  
 <span class="r6">   283 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCC</span><span class="r11">: (</span><span class="r16">&quot;DAC&quot;</span><span class="r11">, </span><span class="r16">&quot;Define arithmetic coding conditioning&quot;</span><span class="r11">, Skip),</span><span class="r9">                            </span>  
 <span class="r6">   284 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCD</span><span class="r11">: (</span><span class="r16">&quot;SOF13&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential sequential DCT (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                                </span>  
 <span class="r6">   285 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCE</span><span class="r11">: (</span><span class="r16">&quot;SOF14&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential progressive DCT (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                               </span>  
 <span class="r6">   286 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFCF</span><span class="r11">: (</span><span class="r16">&quot;SOF15&quot;</span><span class="r11">, </span><span class="r16">&quot;Differential spatial (AC)&quot;</span><span class="r11">, SOF),</span><span class="r9">                                       </span>  
 <span class="r6">   287 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD0</span><span class="r11">: (</span><span class="r16">&quot;RST0&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 0&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   288 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD1</span><span class="r11">: (</span><span class="r16">&quot;RST1&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 1&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   289 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD2</span><span class="r11">: (</span><span class="r16">&quot;RST2&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 2&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   290 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD3</span><span class="r11">: (</span><span class="r16">&quot;RST3&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 3&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   291 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD4</span><span class="r11">: (</span><span class="r16">&quot;RST4&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 4&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   292 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD5</span><span class="r11">: (</span><span class="r16">&quot;RST5&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 5&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   293 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD6</span><span class="r11">: (</span><span class="r16">&quot;RST6&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 6&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   294 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD7</span><span class="r11">: (</span><span class="r16">&quot;RST7&quot;</span><span class="r11">, </span><span class="r16">&quot;Restart 7&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                       </span>  
 <span class="r6">   295 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD8</span><span class="r11">: (</span><span class="r16">&quot;SOI&quot;</span><span class="r11">, </span><span class="r16">&quot;Start of image&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                   </span>  
 <span class="r6">   296 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFD9</span><span class="r11">: (</span><span class="r16">&quot;EOI&quot;</span><span class="r11">, </span><span class="r16">&quot;End of image&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   297 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDA</span><span class="r11">: (</span><span class="r16">&quot;SOS&quot;</span><span class="r11">, </span><span class="r16">&quot;Start of scan&quot;</span><span class="r11">, Skip),</span><span class="r9">                                                    </span>  
 <span class="r6">   298 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDB</span><span class="r11">: (</span><span class="r16">&quot;DQT&quot;</span><span class="r11">, </span><span class="r16">&quot;Define quantization table&quot;</span><span class="r11">, DQT),</span><span class="r9">                                         </span>  
 <span class="r6">   299 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDC</span><span class="r11">: (</span><span class="r16">&quot;DNL&quot;</span><span class="r11">, </span><span class="r16">&quot;Define number of lines&quot;</span><span class="r11">, Skip),</span><span class="r9">                                           </span>  
 <span class="r6">   300 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDD</span><span class="r11">: (</span><span class="r16">&quot;DRI&quot;</span><span class="r11">, </span><span class="r16">&quot;Define restart interval&quot;</span><span class="r11">, Skip),</span><span class="r9">                                          </span>  
 <span class="r6">   301 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDE</span><span class="r11">: (</span><span class="r16">&quot;DHP&quot;</span><span class="r11">, </span><span class="r16">&quot;Define hierarchical progression&quot;</span><span class="r11">, SOF),</span><span class="r9">                                   </span>  
 <span class="r6">   302 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFDF</span><span class="r11">: (</span><span class="r16">&quot;EXP&quot;</span><span class="r11">, </span><span class="r16">&quot;Expand reference component&quot;</span><span class="r11">, Skip),</span><span class="r9">                                       </span>  
 <span class="r6">   303 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE0</span><span class="r11">: (</span><span class="r16">&quot;APP0&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 0&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   304 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE1</span><span class="r11">: (</span><span class="r16">&quot;APP1&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 1&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   305 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE2</span><span class="r11">: (</span><span class="r16">&quot;APP2&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 2&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   306 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE3</span><span class="r11">: (</span><span class="r16">&quot;APP3&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 3&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   307 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE4</span><span class="r11">: (</span><span class="r16">&quot;APP4&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 4&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   308 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE5</span><span class="r11">: (</span><span class="r16">&quot;APP5&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 5&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   309 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE6</span><span class="r11">: (</span><span class="r16">&quot;APP6&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 6&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   310 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE7</span><span class="r11">: (</span><span class="r16">&quot;APP7&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 7&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   311 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE8</span><span class="r11">: (</span><span class="r16">&quot;APP8&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 8&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   312 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFE9</span><span class="r11">: (</span><span class="r16">&quot;APP9&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 9&quot;</span><span class="r11">, APP),</span><span class="r9">                                            </span>  
 <span class="r6">   313 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFEA</span><span class="r11">: (</span><span class="r16">&quot;APP10&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 10&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   314 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFEB</span><span class="r11">: (</span><span class="r16">&quot;APP11&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 11&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   315 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFEC</span><span class="r11">: (</span><span class="r16">&quot;APP12&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 12&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   316 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFED</span><span class="r11">: (</span><span class="r16">&quot;APP13&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 13&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   317 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFEE</span><span class="r11">: (</span><span class="r16">&quot;APP14&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 14&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   318 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFEF</span><span class="r11">: (</span><span class="r16">&quot;APP15&quot;</span><span class="r11">, </span><span class="r16">&quot;Application segment 15&quot;</span><span class="r11">, APP),</span><span class="r9">                                          </span>  
 <span class="r6">   319 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF0</span><span class="r11">: (</span><span class="r16">&quot;JPG0&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 0&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   320 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF1</span><span class="r11">: (</span><span class="r16">&quot;JPG1&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 1&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   321 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF2</span><span class="r11">: (</span><span class="r16">&quot;JPG2&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 2&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   322 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF3</span><span class="r11">: (</span><span class="r16">&quot;JPG3&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 3&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   323 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF4</span><span class="r11">: (</span><span class="r16">&quot;JPG4&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 4&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   324 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF5</span><span class="r11">: (</span><span class="r16">&quot;JPG5&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 5&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   325 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF6</span><span class="r11">: (</span><span class="r16">&quot;JPG6&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 6&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   326 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF7</span><span class="r11">: (</span><span class="r16">&quot;JPG7&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 7&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   327 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF8</span><span class="r11">: (</span><span class="r16">&quot;JPG8&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 8&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   328 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFF9</span><span class="r11">: (</span><span class="r16">&quot;JPG9&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 9&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                     </span>  
 <span class="r6">   329 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFFA</span><span class="r11">: (</span><span class="r16">&quot;JPG10&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 10&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                   </span>  
 <span class="r6">   330 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFFB</span><span class="r11">: (</span><span class="r16">&quot;JPG11&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 11&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                   </span>  
 <span class="r6">   331 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFFC</span><span class="r11">: (</span><span class="r16">&quot;JPG12&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 12&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                   </span>  
 <span class="r6">   332 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFFD</span><span class="r11">: (</span><span class="r16">&quot;JPG13&quot;</span><span class="r11">, </span><span class="r16">&quot;Extension 13&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">),</span><span class="r9">                                                   </span>  
 <span class="r6">   333 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0xFFFE</span><span class="r11">: (</span><span class="r16">&quot;COM&quot;</span><span class="r11">, </span><span class="r16">&quot;Comment&quot;</span><span class="r11">, COM),</span><span class="r9">                                                           </span>  
 <span class="r6">   334 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">   335 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   336 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   337 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_accept</span><span class="r11">(prefix):</span><span class="r9">                                                                           </span>  
 <span class="r6">   338 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Magic number was taken from https://en.wikipedia.org/wiki/JPEG</span><span class="r9">                           </span>  
 <span class="r6">   339 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> prefix[:</span><span class="r15">3</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\xFF\xD8\xFF</span><span class="r16">&quot;</span><span class="r9">                                                       </span>  
 <span class="r6">   340 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   341 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   342 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">##</span><span class="r9">                                                                                             </span>  
 <span class="r6">   343 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Image plugin for JPEG and JFIF images.</span><span class="r9">                                                       </span>  
 <span class="r6">   344 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   345 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   346 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">class</span><span class="r11"> </span><span class="r12">JpegImageFile</span><span class="r11">(ImageFile</span><span class="r15">.</span><span class="r11">ImageFile):</span><span class="r9">                                                      </span>  
 <span class="r6">   347 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   348 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r20">format</span><span class="r11"> </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;JPEG&quot;</span><span class="r9">                                                                            </span>  
 <span class="r6">   349 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    format_description </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;JPEG (ISO 10918)&quot;</span><span class="r9">                                                    </span>  
 <span class="r6">   350 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_open</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                           </span>  
 <span class="r6">   352 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   353 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">3</span><span class="r11">)</span><span class="r9">                                                                    </span>  
 <span class="r6">   354 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   355 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> _accept(s):</span><span class="r9">                                                                     </span>  
 <span class="r6">   356 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;not a JPEG file&quot;</span><span class="r9">                                                            </span>  
 <span class="r6">   357 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                             </span>  
 <span class="r6">   358 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\xFF</span><span class="r16">&quot;</span><span class="r9">                                                                            </span>  
 <span class="r6">   359 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   360 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Create attributes</span><span class="r9">                                                                    </span>  
 <span class="r6">   361 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">bits </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layers </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                            </span>  
 <span class="r6">   362 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   363 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># JPEG specifics (internal)</span><span class="r9">                                                            </span>  
 <span class="r6">   364 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">layer </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                        </span>  
 <span class="r6">   365 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">huffman_dc </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                   </span>  
 <span class="r6">   366 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">huffman_ac </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                   </span>  
 <span class="r6">   367 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">quantization </span><span class="r15">=</span><span class="r11"> {}</span><span class="r9">                                                                 </span>  
 <span class="r6">   368 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">app </span><span class="r15">=</span><span class="r11"> {}  </span><span class="r14"># compatibility</span><span class="r9">                                                         </span>  
 <span class="r6">   369 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">applist </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                      </span>  
 <span class="r6">   370 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">icclist </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                      </span>  
 <span class="r6">   371 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   372 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> </span><span class="r10">True</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   373 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   374 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            i </span><span class="r15">=</span><span class="r11"> s[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                                           </span>  
 <span class="r6">   375 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> i </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFF</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   376 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                s </span><span class="r15">=</span><span class="r11"> s </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                                        </span>  
 <span class="r6">   377 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                i </span><span class="r15">=</span><span class="r11"> i16(s)</span><span class="r9">                                                                     </span>  
 <span class="r6">   378 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   379 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># Skip non-0xFF junk</span><span class="r9">                                                           </span>  
 <span class="r6">   380 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                s </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">   381 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">continue</span><span class="r9">                                                                       </span>  
 <span class="r6">   382 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   383 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> i </span><span class="r19">in</span><span class="r11"> MARKER:</span><span class="r9">                                                                    </span>  
 <span class="r6">   384 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                name, description, handler </span><span class="r15">=</span><span class="r11"> MARKER[i]</span><span class="r9">                                         </span>  
 <span class="r6">   385 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> handler </span><span class="r19">is</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   386 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    handler(</span><span class="r20">self</span><span class="r11">, i)</span><span class="r9">                                                           </span>  
 <span class="r6">   387 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> i </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFDA</span><span class="r11">:  </span><span class="r14"># start of scan</span><span class="r9">                                               </span>  
 <span class="r6">   388 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    rawmode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                        </span>  
 <span class="r6">   389 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;CMYK&quot;</span><span class="r11">:</span><span class="r9">                                                    </span>  
 <span class="r6">   390 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        rawmode </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;CMYK;I&quot;</span><span class="r11">  </span><span class="r14"># assume adobe conventions</span><span class="r9">                         </span>  
 <span class="r6">   391 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> [(</span><span class="r16">&quot;jpeg&quot;</span><span class="r11">, (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size, </span><span class="r15">0</span><span class="r11">, (rawmode, </span><span class="r16">&quot;&quot;</span><span class="r11">))]</span><span class="r9">               </span>  
 <span class="r6">   392 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r14"># self.__offset = self.fp.tell()</span><span class="r9">                                           </span>  
 <span class="r6">   393 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">break</span><span class="r9">                                                                      </span>  
 <span class="r6">   394 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                s </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">   395 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> i </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> i </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFFFF</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   396 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r14"># padded marker or junk; move on</span><span class="r9">                                               </span>  
 <span class="r6">   397 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                s </span><span class="r15">=</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\xff</span><span class="r16">&quot;</span><span class="r9">                                                                    </span>  
 <span class="r6">   398 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> i </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0xFF00</span><span class="r11">:  </span><span class="r14"># Skip extraneous data (escaped 0xFF)</span><span class="r9">                           </span>  
 <span class="r6">   399 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                s </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                                            </span>  
 <span class="r6">   400 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   401 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;no marker found&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   402 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                         </span>  
 <span class="r6">   403 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load_read</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, read_bytes):</span><span class="r9">                                                           </span>  
 <span class="r6">   405 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   406 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        internal: read more image data</span><span class="r9">                                                         </span>  
 <span class="r6">   407 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        For premature EOF and LOAD_TRUNCATED_IMAGES adds EOI marker</span><span class="r9">                            </span>  
 <span class="r6">   408 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        so libjpeg can finish decoding</span><span class="r9">                                                         </span>  
 <span class="r6">   409 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   410 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">   2%  </span>│<span class="r11">        s </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">fp</span><span class="r15">.</span><span class="r11">read(read_bytes)</span><span class="r9">                                                           </span>  
 <span class="r6">   411 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   412 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> s </span><span class="r19">and</span><span class="r11"> ImageFile</span><span class="r15">.</span><span class="r11">LOAD_TRUNCATED_IMAGES </span><span class="r19">and</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, </span><span class="r16">&quot;_ended&quot;</span><span class="r11">):</span><span class="r9">          </span>  
 <span class="r6">   413 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Premature EOF.</span><span class="r9">                                                                   </span>  
 <span class="r6">   414 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Pretend file is finished adding EOI marker</span><span class="r9">                                       </span>  
 <span class="r6">   415 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_ended </span><span class="r15">=</span><span class="r11"> </span><span class="r10">True</span><span class="r9">                                                                 </span>  
 <span class="r6">   416 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\xFF\xD9</span><span class="r16">&quot;</span><span class="r9">                                                                 </span>  
 <span class="r6">   417 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   418 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> s</span><span class="r9">                                                                               </span>  
 <span class="r6">   419 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   420 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">draft</span><span class="r11">(</span><span class="r20">self</span><span class="r11">, mode, size):</span><span class="r9">                                                               </span>  
 <span class="r6">   421 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   422 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile) </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   423 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">   424 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   425 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Protect from second call</span><span class="r9">                                                             </span>  
 <span class="r6">   426 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoderconfig:</span><span class="r9">                                                                 </span>  
 <span class="r6">   427 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r9">                                                                             </span>  
 <span class="r6">   428 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   429 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        d, e, o, a </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile[</span><span class="r15">0</span><span class="r11">]</span><span class="r9">                                                              </span>  
 <span class="r6">   430 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        scale </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                              </span>  
 <span class="r6">   431 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        original_size </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                              </span>  
 <span class="r6">   432 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   433 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> a[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;RGB&quot;</span><span class="r11"> </span><span class="r19">and</span><span class="r11"> mode </span><span class="r19">in</span><span class="r11"> [</span><span class="r16">&quot;L&quot;</span><span class="r11">, </span><span class="r16">&quot;YCbCr&quot;</span><span class="r11">]:</span><span class="r9">                                           </span>  
 <span class="r6">   434 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> mode</span><span class="r9">                                                                   </span>  
 <span class="r6">   435 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            a </span><span class="r15">=</span><span class="r11"> mode, </span><span class="r16">&quot;&quot;</span><span class="r9">                                                                       </span>  
 <span class="r6">   436 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   437 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> size:</span><span class="r9">                                                                               </span>  
 <span class="r6">   438 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            scale </span><span class="r15">=</span><span class="r11"> </span><span class="r20">min</span><span class="r11">(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">//</span><span class="r11"> size[</span><span class="r15">0</span><span class="r11">], </span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">//</span><span class="r11"> size[</span><span class="r15">1</span><span class="r11">])</span><span class="r9">                      </span>  
 <span class="r6">   439 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> s </span><span class="r19">in</span><span class="r11"> [</span><span class="r15">8</span><span class="r11">, </span><span class="r15">4</span><span class="r11">, </span><span class="r15">2</span><span class="r11">, </span><span class="r15">1</span><span class="r11">]:</span><span class="r9">                                                             </span>  
 <span class="r6">   440 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> scale </span><span class="r15">&gt;=</span><span class="r11"> s:</span><span class="r9">                                                                 </span>  
 <span class="r6">   441 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">break</span><span class="r9">                                                                      </span>  
 <span class="r6">   442 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            e </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                              </span>  
 <span class="r6">   443 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                e[</span><span class="r15">0</span><span class="r11">],</span><span class="r9">                                                                          </span>  
 <span class="r6">   444 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                e[</span><span class="r15">1</span><span class="r11">],</span><span class="r9">                                                                          </span>  
 <span class="r6">   445 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (e[</span><span class="r15">2</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> e[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> s </span><span class="r15">-</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">//</span><span class="r11"> s </span><span class="r15">+</span><span class="r11"> e[</span><span class="r15">0</span><span class="r11">],</span><span class="r9">                                             </span>  
 <span class="r6">   446 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                (e[</span><span class="r15">3</span><span class="r11">] </span><span class="r15">-</span><span class="r11"> e[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> s </span><span class="r15">-</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">//</span><span class="r11"> s </span><span class="r15">+</span><span class="r11"> e[</span><span class="r15">1</span><span class="r11">],</span><span class="r9">                                             </span>  
 <span class="r6">   447 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">   448 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> ((</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> s </span><span class="r15">-</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">//</span><span class="r11"> s, (</span><span class="r20">self</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> s </span><span class="r15">-</span><span class="r11"> </span><span class="r15">1</span><span class="r11">) </span><span class="r15">//</span><span class="r11"> s)</span><span class="r9">            </span>  
 <span class="r6">   449 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            scale </span><span class="r15">=</span><span class="r11"> s</span><span class="r9">                                                                          </span>  
 <span class="r6">   450 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   451 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> [(d, e, o, a)]</span><span class="r9">                                                             </span>  
 <span class="r6">   452 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">decoderconfig </span><span class="r15">=</span><span class="r11"> (scale, </span><span class="r15">0</span><span class="r11">)</span><span class="r9">                                                        </span>  
 <span class="r6">   453 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   454 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        box </span><span class="r15">=</span><span class="r11"> (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">, original_size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">/</span><span class="r11"> scale, original_size[</span><span class="r15">1</span><span class="r11">] </span><span class="r15">/</span><span class="r11"> scale)</span><span class="r9">                       </span>  
 <span class="r6">   455 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode, box</span><span class="r9">                                                                  </span>  
 <span class="r6">   456 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   457 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">load_djpeg</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                      </span>  
 <span class="r6">   458 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   459 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># ALTERNATIVE: handle JPEGs via the IJG command line utilities</span><span class="r9">                         </span>  
 <span class="r6">   460 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   461 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        f, path </span><span class="r15">=</span><span class="r11"> tempfile</span><span class="r15">.</span><span class="r11">mkstemp()</span><span class="r9">                                                           </span>  
 <span class="r6">   462 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        os</span><span class="r15">.</span><span class="r11">close(f)</span><span class="r9">                                                                            </span>  
 <span class="r6">   463 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> os</span><span class="r15">.</span><span class="r11">path</span><span class="r15">.</span><span class="r11">exists(</span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename):</span><span class="r9">                                                      </span>  
 <span class="r6">   464 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            subprocess</span><span class="r15">.</span><span class="r11">check_call([</span><span class="r16">&quot;djpeg&quot;</span><span class="r11">, </span><span class="r16">&quot;-outfile&quot;</span><span class="r11">, path, </span><span class="r20">self</span><span class="r15">.</span><span class="r11">filename])</span><span class="r9">                  </span>  
 <span class="r6">   465 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   466 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid Filename&quot;</span><span class="r9">                                                           </span>  
 <span class="r6">   467 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   468 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   469 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                   </span>  
 <span class="r6">   470 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">with</span><span class="r11"> Image</span><span class="r15">.</span><span class="r11">open(path) </span><span class="r10">as</span><span class="r11"> _im:</span><span class="r9">                                                      </span>  
 <span class="r6">   471 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                _im</span><span class="r15">.</span><span class="r11">load()</span><span class="r9">                                                                     </span>  
 <span class="r6">   472 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im </span><span class="r15">=</span><span class="r11"> _im</span><span class="r15">.</span><span class="r11">im</span><span class="r9">                                                               </span>  
 <span class="r6">   473 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">finally</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   474 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   475 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                os</span><span class="r15">.</span><span class="r11">unlink(path)</span><span class="r9">                                                                </span>  
 <span class="r6">   476 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   477 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">pass</span><span class="r9">                                                                           </span>  
 <span class="r6">   478 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   479 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">mode</span><span class="r9">                                                               </span>  
 <span class="r6">   480 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_size </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">im</span><span class="r15">.</span><span class="r11">size</span><span class="r9">                                                              </span>  
 <span class="r6">   481 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   482 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r20">self</span><span class="r15">.</span><span class="r11">tile </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                         </span>  
 <span class="r6">   483 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   484 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_getexif</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                        </span>  
 <span class="r6">   485 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _getexif(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                  </span>  
 <span class="r6">   486 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">_getmp</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   488 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> _getmp(</span><span class="r20">self</span><span class="r11">)</span><span class="r9">                                                                    </span>  
 <span class="r6">   489 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   490 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">getxmp</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                          </span>  
 <span class="r6">   491 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r18">        </span><span class="r8">&quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   492 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Returns a dictionary containing the XMP tags.</span><span class="r9">                                          </span>  
 <span class="r6">   493 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        Requires defusedxml to be installed.</span><span class="r9">                                                   </span>  
 <span class="r6">   494 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   495 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        :returns: XMP tags in a dictionary.</span><span class="r9">                                                    </span>  
 <span class="r6">   496 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">        &quot;&quot;&quot;</span><span class="r9">                                                                                    </span>  
 <span class="r6">   497 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   498 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> segment, content </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">applist:</span><span class="r9">                                                  </span>  
 <span class="r6">   499 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> segment </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;APP1&quot;</span><span class="r11">:</span><span class="r9">                                                              </span>  
 <span class="r6">   500 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                marker, xmp_tags </span><span class="r15">=</span><span class="r11"> content</span><span class="r15">.</span><span class="r11">rsplit(</span><span class="r16">b&quot;</span><span class="r25">\x00</span><span class="r16">&quot;</span><span class="r11">, </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                                  </span>  
 <span class="r6">   501 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">if</span><span class="r11"> marker </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;http://ns.adobe.com/xap/1.0/&quot;</span><span class="r11">:</span><span class="r9">                                  </span>  
 <span class="r6">   502 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">_getxmp(xmp_tags)</span><span class="r9">                                              </span>  
 <span class="r6">   503 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> {}</span><span class="r9">                                                                              </span>  
 <span class="r6">   504 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   505 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   506 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_getexif</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                            </span>  
 <span class="r6">   507 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r16">&quot;exif&quot;</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r19">in</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info:</span><span class="r9">                                                                </span>  
 <span class="r6">   508 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                            </span>  
 <span class="r6">   509 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">getexif()</span><span class="r15">.</span><span class="r11">_get_merged_dict()</span><span class="r9">                                                   </span>  
 <span class="r6">   510 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   511 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   512 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_getmp</span><span class="r11">(</span><span class="r20">self</span><span class="r11">):</span><span class="r9">                                                                              </span>  
 <span class="r6">   513 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Extract MP information.  This method was inspired by the &quot;highly</span><span class="r9">                         </span>  
 <span class="r6">   514 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># experimental&quot; _getexif version that&#x27;s been in use for years now,</span><span class="r9">                         </span>  
 <span class="r6">   515 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># itself based on the ImageFileDirectory class in the TIFF plugin.</span><span class="r9">                         </span>  
 <span class="r6">   516 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   517 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># The MP record essentially consists of a TIFF file embedded in a JPEG</span><span class="r9">                     </span>  
 <span class="r6">   518 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># application marker.</span><span class="r9">                                                                      </span>  
 <span class="r6">   519 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   520 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        data </span><span class="r15">=</span><span class="r11"> </span><span class="r20">self</span><span class="r15">.</span><span class="r11">info[</span><span class="r16">&quot;mp&quot;</span><span class="r11">]</span><span class="r9">                                                                 </span>  
 <span class="r6">   521 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   522 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r10">None</span><span class="r9">                                                                            </span>  
 <span class="r6">   523 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    file_contents </span><span class="r15">=</span><span class="r11"> io</span><span class="r15">.</span><span class="r11">BytesIO(data)</span><span class="r9">                                                           </span>  
 <span class="r6">   524 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    head </span><span class="r15">=</span><span class="r11"> file_contents</span><span class="r15">.</span><span class="r11">read(</span><span class="r15">8</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">   525 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    endianness </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;&gt;&quot;</span><span class="r11"> </span><span class="r10">if</span><span class="r11"> head[:</span><span class="r15">4</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r16">b&quot;</span><span class="r25">\x4d\x4d\x00\x2a</span><span class="r16">&quot;</span><span class="r11"> </span><span class="r10">else</span><span class="r11"> </span><span class="r16">&quot;&lt;&quot;</span><span class="r9">                               </span>  
 <span class="r6">   526 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># process dictionary</span><span class="r9">                                                                       </span>  
 <span class="r6">   527 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   528 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        info </span><span class="r15">=</span><span class="r11"> TiffImagePlugin</span><span class="r15">.</span><span class="r11">ImageFileDirectory_v2(head)</span><span class="r9">                                     </span>  
 <span class="r6">   529 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        file_contents</span><span class="r15">.</span><span class="r11">seek(info</span><span class="r15">.</span><span class="r11">next)</span><span class="r9">                                                          </span>  
 <span class="r6">   530 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        info</span><span class="r15">.</span><span class="r11">load(file_contents)</span><span class="r9">                                                               </span>  
 <span class="r6">   531 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        mp </span><span class="r15">=</span><span class="r11"> </span><span class="r20">dict</span><span class="r11">(info)</span><span class="r9">                                                                        </span>  
 <span class="r6">   532 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">Exception</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                     </span>  
 <span class="r6">   533 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;malformed MP Index (unreadable directory)&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   534 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                          </span>  
 <span class="r6">   535 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># it&#x27;s an error not to have a number of images</span><span class="r9">                                             </span>  
 <span class="r6">   536 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   537 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        quant </span><span class="r15">=</span><span class="r11"> mp[</span><span class="r15">0xB001</span><span class="r11">]</span><span class="r9">                                                                     </span>  
 <span class="r6">   538 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                      </span>  
 <span class="r6">   539 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;malformed MP Index (no number of images)&quot;</span><span class="r9">                                       </span>  
 <span class="r6">   540 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                          </span>  
 <span class="r6">   541 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># get MP entries</span><span class="r9">                                                                           </span>  
 <span class="r6">   542 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    mpentries </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                             </span>  
 <span class="r6">   543 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   544 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rawmpentries </span><span class="r15">=</span><span class="r11"> mp[</span><span class="r15">0xB002</span><span class="r11">]</span><span class="r9">                                                              </span>  
 <span class="r6">   545 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> entrynum </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, quant):</span><span class="r9">                                                       </span>  
 <span class="r6">   546 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            unpackedentry </span><span class="r15">=</span><span class="r11"> struct</span><span class="r15">.</span><span class="r11">unpack_from(</span><span class="r9">                                                </span>  
 <span class="r6">   547 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">f&quot;</span><span class="r21">{</span><span class="r11">endianness</span><span class="r21">}</span><span class="r16">LLLHH&quot;</span><span class="r11">, rawmpentries, entrynum </span><span class="r15">*</span><span class="r11"> </span><span class="r15">16</span><span class="r9">                              </span>  
 <span class="r6">   548 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">   549 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            labels </span><span class="r15">=</span><span class="r11"> (</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">, </span><span class="r16">&quot;Size&quot;</span><span class="r11">, </span><span class="r16">&quot;DataOffset&quot;</span><span class="r11">, </span><span class="r16">&quot;EntryNo1&quot;</span><span class="r11">, </span><span class="r16">&quot;EntryNo2&quot;</span><span class="r11">)</span><span class="r9">               </span>  
 <span class="r6">   550 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mpentry </span><span class="r15">=</span><span class="r11"> </span><span class="r20">dict</span><span class="r11">(</span><span class="r20">zip</span><span class="r11">(labels, unpackedentry))</span><span class="r9">                                         </span>  
 <span class="r6">   551 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mpentryattr </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                    </span>  
 <span class="r6">   552 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;DependentParentImageFlag&quot;</span><span class="r11">: </span><span class="r20">bool</span><span class="r11">(mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> (</span><span class="r15">1</span><span class="r11"> </span><span class="r15">&lt;&lt;</span><span class="r11"> </span><span class="r15">31</span><span class="r11">)),</span><span class="r9">            </span>  
 <span class="r6">   553 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;DependentChildImageFlag&quot;</span><span class="r11">: </span><span class="r20">bool</span><span class="r11">(mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> (</span><span class="r15">1</span><span class="r11"> </span><span class="r15">&lt;&lt;</span><span class="r11"> </span><span class="r15">30</span><span class="r11">)),</span><span class="r9">             </span>  
 <span class="r6">   554 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;RepresentativeImageFlag&quot;</span><span class="r11">: </span><span class="r20">bool</span><span class="r11">(mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> (</span><span class="r15">1</span><span class="r11"> </span><span class="r15">&lt;&lt;</span><span class="r11"> </span><span class="r15">29</span><span class="r11">)),</span><span class="r9">             </span>  
 <span class="r6">   555 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;Reserved&quot;</span><span class="r11">: (mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> (</span><span class="r15">3</span><span class="r11"> </span><span class="r15">&lt;&lt;</span><span class="r11"> </span><span class="r15">27</span><span class="r11">)) </span><span class="r15">&gt;&gt;</span><span class="r11"> </span><span class="r15">27</span><span class="r11">,</span><span class="r9">                          </span>  
 <span class="r6">   556 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;ImageDataFormat&quot;</span><span class="r11">: (mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> (</span><span class="r15">7</span><span class="r11"> </span><span class="r15">&lt;&lt;</span><span class="r11"> </span><span class="r15">24</span><span class="r11">)) </span><span class="r15">&gt;&gt;</span><span class="r11"> </span><span class="r15">24</span><span class="r11">,</span><span class="r9">                   </span>  
 <span class="r6">   557 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">&quot;MPType&quot;</span><span class="r11">: mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">&amp;</span><span class="r11"> </span><span class="r15">0x00FFFFFF</span><span class="r11">,</span><span class="r9">                                   </span>  
 <span class="r6">   558 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            }</span><span class="r9">                                                                                  </span>  
 <span class="r6">   559 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> mpentryattr[</span><span class="r16">&quot;ImageDataFormat&quot;</span><span class="r11">] </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                            </span>  
 <span class="r6">   560 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                mpentryattr[</span><span class="r16">&quot;ImageDataFormat&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;JPEG&quot;</span><span class="r9">                                        </span>  
 <span class="r6">   561 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   562 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;unsupported picture format in MPO&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   563 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg)</span><span class="r9">                                                         </span>  
 <span class="r6">   564 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mptypemap </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                      </span>  
 <span class="r6">   565 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x000000</span><span class="r11">: </span><span class="r16">&quot;Undefined&quot;</span><span class="r11">,</span><span class="r9">                                                         </span>  
 <span class="r6">   566 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x010001</span><span class="r11">: </span><span class="r16">&quot;Large Thumbnail (VGA Equivalent)&quot;</span><span class="r11">,</span><span class="r9">                                  </span>  
 <span class="r6">   567 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x010002</span><span class="r11">: </span><span class="r16">&quot;Large Thumbnail (Full HD Equivalent)&quot;</span><span class="r11">,</span><span class="r9">                              </span>  
 <span class="r6">   568 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x020001</span><span class="r11">: </span><span class="r16">&quot;Multi-Frame Image (Panorama)&quot;</span><span class="r11">,</span><span class="r9">                                      </span>  
 <span class="r6">   569 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x020002</span><span class="r11">: </span><span class="r16">&quot;Multi-Frame Image: (Disparity)&quot;</span><span class="r11">,</span><span class="r9">                                    </span>  
 <span class="r6">   570 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x020003</span><span class="r11">: </span><span class="r16">&quot;Multi-Frame Image: (Multi-Angle)&quot;</span><span class="r11">,</span><span class="r9">                                  </span>  
 <span class="r6">   571 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">0x030000</span><span class="r11">: </span><span class="r16">&quot;Baseline MP Primary Image&quot;</span><span class="r11">,</span><span class="r9">                                         </span>  
 <span class="r6">   572 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            }</span><span class="r9">                                                                                  </span>  
 <span class="r6">   573 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mpentryattr[</span><span class="r16">&quot;MPType&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> mptypemap</span><span class="r15">.</span><span class="r11">get(mpentryattr[</span><span class="r16">&quot;MPType&quot;</span><span class="r11">], </span><span class="r16">&quot;Unknown&quot;</span><span class="r11">)</span><span class="r9">            </span>  
 <span class="r6">   574 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mpentry[</span><span class="r16">&quot;Attribute&quot;</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> mpentryattr</span><span class="r9">                                                 </span>  
 <span class="r6">   575 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            mpentries</span><span class="r15">.</span><span class="r11">append(mpentry)</span><span class="r9">                                                          </span>  
 <span class="r6">   576 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        mp[</span><span class="r15">0xB002</span><span class="r11">] </span><span class="r15">=</span><span class="r11"> mpentries</span><span class="r9">                                                                 </span>  
 <span class="r6">   577 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                      </span>  
 <span class="r6">   578 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;malformed MP Index (bad MP Entry)&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   579 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                          </span>  
 <span class="r6">   580 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Next we should try and parse the individual image unique ID list;</span><span class="r9">                        </span>  
 <span class="r6">   581 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># we don&#x27;t because I&#x27;ve never seen this actually used in a real MPO</span><span class="r9">                        </span>  
 <span class="r6">   582 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># file and so can&#x27;t test it.</span><span class="r9">                                                               </span>  
 <span class="r6">   583 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> mp</span><span class="r9">                                                                                  </span>  
 <span class="r6">   584 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   585 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   586 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># --------------------------------------------------------------------</span><span class="r9">                         </span>  
 <span class="r6">   587 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># stuff to save JPEG files</span><span class="r9">                                                                     </span>  
 <span class="r6">   588 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   589 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">RAWMODE </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                                    </span>  
 <span class="r6">   590 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;1&quot;</span><span class="r11">: </span><span class="r16">&quot;L&quot;</span><span class="r11">,</span><span class="r9">                                                                                  </span>  
 <span class="r6">   591 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;L&quot;</span><span class="r11">: </span><span class="r16">&quot;L&quot;</span><span class="r11">,</span><span class="r9">                                                                                  </span>  
 <span class="r6">   592 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;RGB&quot;</span><span class="r11">: </span><span class="r16">&quot;RGB&quot;</span><span class="r11">,</span><span class="r9">                                                                              </span>  
 <span class="r6">   593 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;RGBX&quot;</span><span class="r11">: </span><span class="r16">&quot;RGB&quot;</span><span class="r11">,</span><span class="r9">                                                                             </span>  
 <span class="r6">   594 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;CMYK&quot;</span><span class="r11">: </span><span class="r16">&quot;CMYK;I&quot;</span><span class="r11">,  </span><span class="r14"># assume adobe conventions</span><span class="r9">                                              </span>  
 <span class="r6">   595 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r16">&quot;YCbCr&quot;</span><span class="r11">: </span><span class="r16">&quot;YCbCr&quot;</span><span class="r11">,</span><span class="r9">                                                                          </span>  
 <span class="r6">   596 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">   597 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   598 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># fmt: off</span><span class="r9">                                                                                     </span>  
 <span class="r6">   599 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">zigzag_index </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                               </span>  
 <span class="r6">   600 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">0</span><span class="r11">,  </span><span class="r15">1</span><span class="r11">,  </span><span class="r15">5</span><span class="r11">,  </span><span class="r15">6</span><span class="r11">, </span><span class="r15">14</span><span class="r11">, </span><span class="r15">15</span><span class="r11">, </span><span class="r15">27</span><span class="r11">, </span><span class="r15">28</span><span class="r11">,</span><span class="r9">                                                             </span>  
 <span class="r6">   601 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">2</span><span class="r11">,  </span><span class="r15">4</span><span class="r11">,  </span><span class="r15">7</span><span class="r11">, </span><span class="r15">13</span><span class="r11">, </span><span class="r15">16</span><span class="r11">, </span><span class="r15">26</span><span class="r11">, </span><span class="r15">29</span><span class="r11">, </span><span class="r15">42</span><span class="r11">,</span><span class="r9">                                                             </span>  
 <span class="r6">   602 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">3</span><span class="r11">,  </span><span class="r15">8</span><span class="r11">, </span><span class="r15">12</span><span class="r11">, </span><span class="r15">17</span><span class="r11">, </span><span class="r15">25</span><span class="r11">, </span><span class="r15">30</span><span class="r11">, </span><span class="r15">41</span><span class="r11">, </span><span class="r15">43</span><span class="r11">,</span><span class="r9">                                                             </span>  
 <span class="r6">   603 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">9</span><span class="r11">, </span><span class="r15">11</span><span class="r11">, </span><span class="r15">18</span><span class="r11">, </span><span class="r15">24</span><span class="r11">, </span><span class="r15">31</span><span class="r11">, </span><span class="r15">40</span><span class="r11">, </span><span class="r15">44</span><span class="r11">, </span><span class="r15">53</span><span class="r11">,</span><span class="r9">                                                             </span>  
 <span class="r6">   604 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">10</span><span class="r11">, </span><span class="r15">19</span><span class="r11">, </span><span class="r15">23</span><span class="r11">, </span><span class="r15">32</span><span class="r11">, </span><span class="r15">39</span><span class="r11">, </span><span class="r15">45</span><span class="r11">, </span><span class="r15">52</span><span class="r11">, </span><span class="r15">54</span><span class="r11">,</span><span class="r9">                                                            </span>  
 <span class="r6">   605 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">20</span><span class="r11">, </span><span class="r15">22</span><span class="r11">, </span><span class="r15">33</span><span class="r11">, </span><span class="r15">38</span><span class="r11">, </span><span class="r15">46</span><span class="r11">, </span><span class="r15">51</span><span class="r11">, </span><span class="r15">55</span><span class="r11">, </span><span class="r15">60</span><span class="r11">,</span><span class="r9">                                                            </span>  
 <span class="r6">   606 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">21</span><span class="r11">, </span><span class="r15">34</span><span class="r11">, </span><span class="r15">37</span><span class="r11">, </span><span class="r15">47</span><span class="r11">, </span><span class="r15">50</span><span class="r11">, </span><span class="r15">56</span><span class="r11">, </span><span class="r15">59</span><span class="r11">, </span><span class="r15">61</span><span class="r11">,</span><span class="r9">                                                            </span>  
 <span class="r6">   607 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r15">35</span><span class="r11">, </span><span class="r15">36</span><span class="r11">, </span><span class="r15">48</span><span class="r11">, </span><span class="r15">49</span><span class="r11">, </span><span class="r15">57</span><span class="r11">, </span><span class="r15">58</span><span class="r11">, </span><span class="r15">62</span><span class="r11">, </span><span class="r15">63</span><span class="r11">,</span><span class="r9">                                                            </span>  
 <span class="r6">   608 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">)</span><span class="r9">                                                                                              </span>  
 <span class="r6">   609 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   610 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">samplings </span><span class="r15">=</span><span class="r11"> {</span><span class="r9">                                                                                  </span>  
 <span class="r6">   611 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">): </span><span class="r15">0</span><span class="r11">,</span><span class="r9">                                                                     </span>  
 <span class="r6">   612 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    (</span><span class="r15">2</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">): </span><span class="r15">1</span><span class="r11">,</span><span class="r9">                                                                     </span>  
 <span class="r6">   613 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    (</span><span class="r15">2</span><span class="r11">, </span><span class="r15">2</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">, </span><span class="r15">1</span><span class="r11">): </span><span class="r15">2</span><span class="r11">,</span><span class="r9">                                                                     </span>  
 <span class="r6">   614 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">   615 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># fmt: on</span><span class="r9">                                                                                      </span>  
 <span class="r6">   616 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   617 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   618 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">convert_dict_qtables</span><span class="r11">(qtables):</span><span class="r9">                                                             </span>  
 <span class="r6">   619 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    deprecate(</span><span class="r16">&quot;convert_dict_qtables&quot;</span><span class="r11">, </span><span class="r15">10</span><span class="r11">, action</span><span class="r15">=</span><span class="r16">&quot;Conversion is no longer needed&quot;</span><span class="r11">)</span><span class="r9">             </span>  
 <span class="r6">   620 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> qtables</span><span class="r9">                                                                             </span>  
 <span class="r6">   621 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   622 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   623 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">get_sampling</span><span class="r11">(im):</span><span class="r9">                                                                          </span>  
 <span class="r6">   624 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># There&#x27;s no subsampling when images have only 1 layer</span><span class="r9">                                     </span>  
 <span class="r6">   625 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># (grayscale images) or when they are CMYK (4 layers),</span><span class="r9">                                     </span>  
 <span class="r6">   626 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># so set subsampling to the default value.</span><span class="r9">                                                 </span>  
 <span class="r6">   627 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14">#</span><span class="r9">                                                                                          </span>  
 <span class="r6">   628 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># NOTE: currently Pillow can&#x27;t encode JPEG to YCCK format.</span><span class="r9">                                 </span>  
 <span class="r6">   629 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># If YCCK support is added in the future, subsampling code will have</span><span class="r9">                       </span>  
 <span class="r6">   630 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># to be updated (here and in JpegEncode.c) to deal with 4 layers.</span><span class="r9">                          </span>  
 <span class="r6">   631 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">hasattr</span><span class="r11">(im, </span><span class="r16">&quot;layers&quot;</span><span class="r11">) </span><span class="r19">or</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">layers </span><span class="r19">in</span><span class="r11"> (</span><span class="r15">1</span><span class="r11">, </span><span class="r15">4</span><span class="r11">):</span><span class="r9">                                       </span>  
 <span class="r6">   632 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">return</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                                              </span>  
 <span class="r6">   633 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    sampling </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">layer[</span><span class="r15">0</span><span class="r11">][</span><span class="r15">1</span><span class="r11">:</span><span class="r15">3</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">layer[</span><span class="r15">1</span><span class="r11">][</span><span class="r15">1</span><span class="r11">:</span><span class="r15">3</span><span class="r11">] </span><span class="r15">+</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">layer[</span><span class="r15">2</span><span class="r11">][</span><span class="r15">1</span><span class="r11">:</span><span class="r15">3</span><span class="r11">]</span><span class="r9">                          </span>  
 <span class="r6">   634 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> samplings</span><span class="r15">.</span><span class="r11">get(sampling, </span><span class="r15">-1</span><span class="r11">)</span><span class="r9">                                                         </span>  
 <span class="r6">   635 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   636 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   637 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_save</span><span class="r11">(im, fp, filename):</span><span class="r9">                                                                   </span>  
 <span class="r6">   638 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">width </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">height </span><span class="r15">==</span><span class="r11"> </span><span class="r15">0</span><span class="r11">:</span><span class="r9">                                                        </span>  
 <span class="r6">   639 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;cannot write empty image as JPEG&quot;</span><span class="r9">                                               </span>  
 <span class="r6">   640 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">   641 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   642 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   643 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        rawmode </span><span class="r15">=</span><span class="r11"> RAWMODE[im</span><span class="r15">.</span><span class="r11">mode]</span><span class="r9">                                                             </span>  
 <span class="r6">   644 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">KeyError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                                      </span>  
 <span class="r6">   645 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">f&quot;cannot write mode </span><span class="r21">{</span><span class="r11">im</span><span class="r15">.</span><span class="r11">mode</span><span class="r21">}</span><span class="r16"> as JPEG&quot;</span><span class="r9">                                           </span>  
 <span class="r6">   646 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                              </span>  
 <span class="r6">   647 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   648 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    info </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">encoderinfo</span><span class="r9">                                                                      </span>  
 <span class="r6">   649 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   650 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    dpi </span><span class="r15">=</span><span class="r11"> [</span><span class="r20">round</span><span class="r11">(x) </span><span class="r10">for</span><span class="r11"> x </span><span class="r19">in</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;dpi&quot;</span><span class="r11">, (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">))]</span><span class="r9">                                          </span>  
 <span class="r6">   651 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   652 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    quality </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;quality&quot;</span><span class="r11">, </span><span class="r15">-1</span><span class="r11">)</span><span class="r9">                                                          </span>  
 <span class="r6">   653 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    subsampling </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;subsampling&quot;</span><span class="r11">, </span><span class="r15">-1</span><span class="r11">)</span><span class="r9">                                                  </span>  
 <span class="r6">   654 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    qtables </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;qtables&quot;</span><span class="r11">)</span><span class="r9">                                                              </span>  
 <span class="r6">   655 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   656 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> quality </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;keep&quot;</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   657 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        quality </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                                           </span>  
 <span class="r6">   658 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;keep&quot;</span><span class="r9">                                                                   </span>  
 <span class="r6">   659 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        qtables </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;keep&quot;</span><span class="r9">                                                                       </span>  
 <span class="r6">   660 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> quality </span><span class="r19">in</span><span class="r11"> presets:</span><span class="r9">                                                                   </span>  
 <span class="r6">   661 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        preset </span><span class="r15">=</span><span class="r11"> presets[quality]</span><span class="r9">                                                              </span>  
 <span class="r6">   662 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        quality </span><span class="r15">=</span><span class="r11"> </span><span class="r15">-1</span><span class="r9">                                                                           </span>  
 <span class="r6">   663 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> preset</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;subsampling&quot;</span><span class="r11">, </span><span class="r15">-1</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">   664 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        qtables </span><span class="r15">=</span><span class="r11"> preset</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;quantization&quot;</span><span class="r11">)</span><span class="r9">                                                   </span>  
 <span class="r6">   665 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(quality, </span><span class="r20">int</span><span class="r11">):</span><span class="r9">                                                         </span>  
 <span class="r6">   666 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid quality setting&quot;</span><span class="r9">                                                        </span>  
 <span class="r6">   667 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                                  </span>  
 <span class="r6">   668 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                      </span>  
 <span class="r6">   669 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> subsampling </span><span class="r19">in</span><span class="r11"> presets:</span><span class="r9">                                                             </span>  
 <span class="r6">   670 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            subsampling </span><span class="r15">=</span><span class="r11"> presets[subsampling]</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;subsampling&quot;</span><span class="r11">, </span><span class="r15">-1</span><span class="r11">)</span><span class="r9">                          </span>  
 <span class="r6">   671 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(qtables, </span><span class="r20">str</span><span class="r11">) </span><span class="r19">and</span><span class="r11"> qtables </span><span class="r19">in</span><span class="r11"> presets:</span><span class="r9">                                    </span>  
 <span class="r6">   672 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            qtables </span><span class="r15">=</span><span class="r11"> presets[qtables]</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;quantization&quot;</span><span class="r11">)</span><span class="r9">                                     </span>  
 <span class="r6">   673 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   674 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> subsampling </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;4:4:4&quot;</span><span class="r11">:</span><span class="r9">                                                                 </span>  
 <span class="r6">   675 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                        </span>  
 <span class="r6">   676 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> subsampling </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;4:2:2&quot;</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   677 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                        </span>  
 <span class="r6">   678 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> subsampling </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;4:2:0&quot;</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   679 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                        </span>  
 <span class="r6">   680 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> subsampling </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;4:1:1&quot;</span><span class="r11">:</span><span class="r9">                                                               </span>  
 <span class="r6">   681 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># For compatibility. Before Pillow 4.3, 4:1:1 actually meant 4:2:0.</span><span class="r9">                    </span>  
 <span class="r6">   682 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># Set 4:2:0 if someone is still using that value.</span><span class="r9">                                      </span>  
 <span class="r6">   683 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r9">                                                                        </span>  
 <span class="r6">   684 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">elif</span><span class="r11"> subsampling </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;keep&quot;</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   685 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">format </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;JPEG&quot;</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   686 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot use &#x27;keep&#x27; when original image is not a JPEG&quot;</span><span class="r9">                        </span>  
 <span class="r6">   687 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   688 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling </span><span class="r15">=</span><span class="r11"> get_sampling(im)</span><span class="r9">                                                         </span>  
 <span class="r6">   689 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   690 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">def</span><span class="r11"> </span><span class="r17">validate_qtables</span><span class="r11">(qtables):</span><span class="r9">                                                             </span>  
 <span class="r6">   691 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> qtables </span><span class="r19">is</span><span class="r11"> </span><span class="r10">None</span><span class="r11">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   692 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> qtables</span><span class="r9">                                                                     </span>  
 <span class="r6">   693 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(qtables, </span><span class="r20">str</span><span class="r11">):</span><span class="r9">                                                           </span>  
 <span class="r6">   694 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                               </span>  
 <span class="r6">   695 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                lines </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                      </span>  
 <span class="r6">   696 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r20">int</span><span class="r11">(num)</span><span class="r9">                                                                   </span>  
 <span class="r6">   697 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">for</span><span class="r11"> line </span><span class="r19">in</span><span class="r11"> qtables</span><span class="r15">.</span><span class="r11">splitlines()</span><span class="r9">                                           </span>  
 <span class="r6">   698 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">for</span><span class="r11"> num </span><span class="r19">in</span><span class="r11"> line</span><span class="r15">.</span><span class="r11">split(</span><span class="r16">&quot;#&quot;</span><span class="r11">, </span><span class="r15">1</span><span class="r11">)[</span><span class="r15">0</span><span class="r11">]</span><span class="r15">.</span><span class="r11">split()</span><span class="r9">                                   </span>  
 <span class="r6">   699 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ]</span><span class="r9">                                                                              </span>  
 <span class="r6">   700 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">except</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                            </span>  
 <span class="r6">   701 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid quantization table&quot;</span><span class="r9">                                             </span>  
 <span class="r6">   702 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                                   </span>  
 <span class="r6">   703 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                              </span>  
 <span class="r6">   704 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                qtables </span><span class="r15">=</span><span class="r11"> [lines[s : s </span><span class="r15">+</span><span class="r11"> </span><span class="r15">64</span><span class="r11">] </span><span class="r10">for</span><span class="r11"> s </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r15">0</span><span class="r11">, </span><span class="r20">len</span><span class="r11">(lines), </span><span class="r15">64</span><span class="r11">)]</span><span class="r9">                </span>  
 <span class="r6">   705 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(qtables, (</span><span class="r20">tuple</span><span class="r11">, </span><span class="r20">list</span><span class="r11">, </span><span class="r20">dict</span><span class="r11">)):</span><span class="r9">                                           </span>  
 <span class="r6">   706 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(qtables, </span><span class="r20">dict</span><span class="r11">):</span><span class="r9">                                                      </span>  
 <span class="r6">   707 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                qtables </span><span class="r15">=</span><span class="r11"> [</span><span class="r9">                                                                    </span>  
 <span class="r6">   708 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    qtables[key] </span><span class="r10">for</span><span class="r11"> key </span><span class="r19">in</span><span class="r11"> </span><span class="r20">range</span><span class="r11">(</span><span class="r20">len</span><span class="r11">(qtables)) </span><span class="r10">if</span><span class="r11"> key </span><span class="r19">in</span><span class="r11"> qtables</span><span class="r9">              </span>  
 <span class="r6">   709 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                ]</span><span class="r9">                                                                              </span>  
 <span class="r6">   710 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">elif</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(qtables, </span><span class="r20">tuple</span><span class="r11">):</span><span class="r9">                                                   </span>  
 <span class="r6">   711 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                qtables </span><span class="r15">=</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(qtables)</span><span class="r9">                                                        </span>  
 <span class="r6">   712 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">if</span><span class="r11"> </span><span class="r19">not</span><span class="r11"> (</span><span class="r15">0</span><span class="r11"> </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(qtables) </span><span class="r15">&lt;</span><span class="r11"> </span><span class="r15">5</span><span class="r11">):</span><span class="r9">                                                     </span>  
 <span class="r6">   713 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;None or too many quantization tables&quot;</span><span class="r9">                                   </span>  
 <span class="r6">   714 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                          </span>  
 <span class="r6">   715 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">for</span><span class="r11"> idx, table </span><span class="r19">in</span><span class="r11"> </span><span class="r20">enumerate</span><span class="r11">(qtables):</span><span class="r9">                                              </span>  
 <span class="r6">   716 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                           </span>  
 <span class="r6">   717 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(table) </span><span class="r15">!=</span><span class="r11"> </span><span class="r15">64</span><span class="r11">:</span><span class="r9">                                                       </span>  
 <span class="r6">   718 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                        </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r9">                                                        </span>  
 <span class="r6">   719 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    table </span><span class="r15">=</span><span class="r11"> array</span><span class="r15">.</span><span class="r11">array(</span><span class="r16">&quot;H&quot;</span><span class="r11">, table)</span><span class="r9">                                            </span>  
 <span class="r6">   720 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">except</span><span class="r11"> </span><span class="r13">TypeError</span><span class="r11"> </span><span class="r10">as</span><span class="r11"> e:</span><span class="r9">                                                         </span>  
 <span class="r6">   721 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Invalid quantization table&quot;</span><span class="r9">                                         </span>  
 <span class="r6">   722 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg) </span><span class="r10">from</span><span class="r11"> </span><span class="r12">e</span><span class="r9">                                               </span>  
 <span class="r6">   723 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                          </span>  
 <span class="r6">   724 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                    qtables[idx] </span><span class="r15">=</span><span class="r11"> </span><span class="r20">list</span><span class="r11">(table)</span><span class="r9">                                                 </span>  
 <span class="r6">   725 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">return</span><span class="r11"> qtables</span><span class="r9">                                                                     </span>  
 <span class="r6">   726 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   727 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> qtables </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;keep&quot;</span><span class="r11">:</span><span class="r9">                                                                      </span>  
 <span class="r6">   728 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">format </span><span class="r15">!=</span><span class="r11"> </span><span class="r16">&quot;JPEG&quot;</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   729 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            msg </span><span class="r15">=</span><span class="r11"> </span><span class="r16">&quot;Cannot use &#x27;keep&#x27; when original image is not a JPEG&quot;</span><span class="r9">                        </span>  
 <span class="r6">   730 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">raise</span><span class="r11"> </span><span class="r13">ValueError</span><span class="r11">(msg)</span><span class="r9">                                                              </span>  
 <span class="r6">   731 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        qtables </span><span class="r15">=</span><span class="r11"> </span><span class="r20">getattr</span><span class="r11">(im, </span><span class="r16">&quot;quantization&quot;</span><span class="r11">, </span><span class="r10">None</span><span class="r11">)</span><span class="r9">                                            </span>  
 <span class="r6">   732 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    qtables </span><span class="r15">=</span><span class="r11"> validate_qtables(qtables)</span><span class="r9">                                                        </span>  
 <span class="r6">   733 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   734 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    extra </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;extra&quot;</span><span class="r11">, </span><span class="r16">b&quot;&quot;</span><span class="r11">)</span><span class="r9">                                                             </span>  
 <span class="r6">   735 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   736 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    icc_profile </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;icc_profile&quot;</span><span class="r11">)</span><span class="r9">                                                      </span>  
 <span class="r6">   737 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> icc_profile:</span><span class="r9">                                                                            </span>  
 <span class="r6">   738 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        ICC_OVERHEAD_LEN </span><span class="r15">=</span><span class="r11"> </span><span class="r15">14</span><span class="r9">                                                                  </span>  
 <span class="r6">   739 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        MAX_BYTES_IN_MARKER </span><span class="r15">=</span><span class="r11"> </span><span class="r15">65533</span><span class="r9">                                                            </span>  
 <span class="r6">   740 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        MAX_DATA_BYTES_IN_MARKER </span><span class="r15">=</span><span class="r11"> MAX_BYTES_IN_MARKER </span><span class="r15">-</span><span class="r11"> ICC_OVERHEAD_LEN</span><span class="r9">                      </span>  
 <span class="r6">   741 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        markers </span><span class="r15">=</span><span class="r11"> []</span><span class="r9">                                                                           </span>  
 <span class="r6">   742 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">while</span><span class="r11"> icc_profile:</span><span class="r9">                                                                     </span>  
 <span class="r6">   743 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            markers</span><span class="r15">.</span><span class="r11">append(icc_profile[:MAX_DATA_BYTES_IN_MARKER])</span><span class="r9">                             </span>  
 <span class="r6">   744 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            icc_profile </span><span class="r15">=</span><span class="r11"> icc_profile[MAX_DATA_BYTES_IN_MARKER:]</span><span class="r9">                               </span>  
 <span class="r6">   745 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        i </span><span class="r15">=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                                  </span>  
 <span class="r6">   746 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">for</span><span class="r11"> marker </span><span class="r19">in</span><span class="r11"> markers:</span><span class="r9">                                                                 </span>  
 <span class="r6">   747 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            size </span><span class="r15">=</span><span class="r11"> o16(</span><span class="r15">2</span><span class="r11"> </span><span class="r15">+</span><span class="r11"> ICC_OVERHEAD_LEN </span><span class="r15">+</span><span class="r11"> </span><span class="r20">len</span><span class="r11">(marker))</span><span class="r9">                                     </span>  
 <span class="r6">   748 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            extra </span><span class="r15">+=</span><span class="r11"> (</span><span class="r9">                                                                         </span>  
 <span class="r6">   749 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r16">b&quot;</span><span class="r25">\xFF\xE2</span><span class="r16">&quot;</span><span class="r9">                                                                    </span>  
 <span class="r6">   750 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">+</span><span class="r11"> size</span><span class="r9">                                                                         </span>  
 <span class="r6">   751 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">+</span><span class="r11"> </span><span class="r16">b&quot;ICC_PROFILE</span><span class="r25">\0</span><span class="r16">&quot;</span><span class="r9">                                                             </span>  
 <span class="r6">   752 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">+</span><span class="r11"> o8(i)</span><span class="r9">                                                                        </span>  
 <span class="r6">   753 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">+</span><span class="r11"> o8(</span><span class="r20">len</span><span class="r11">(markers))</span><span class="r9">                                                             </span>  
 <span class="r6">   754 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">                </span><span class="r15">+</span><span class="r11"> marker</span><span class="r9">                                                                       </span>  
 <span class="r6">   755 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            )</span><span class="r9">                                                                                  </span>  
 <span class="r6">   756 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            i </span><span class="r15">+=</span><span class="r11"> </span><span class="r15">1</span><span class="r9">                                                                             </span>  
 <span class="r6">   757 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   758 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    comment </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;comment&quot;</span><span class="r11">, im</span><span class="r15">.</span><span class="r11">info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;comment&quot;</span><span class="r11">))</span><span class="r9">                                      </span>  
 <span class="r6">   759 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   760 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># &quot;progressive&quot; is the official name, but older documentation</span><span class="r9">                              </span>  
 <span class="r6">   761 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># says &quot;progression&quot;</span><span class="r9">                                                                       </span>  
 <span class="r6">   762 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># FIXME: issue a warning if the wrong form is used (post-1.1.7)</span><span class="r9">                            </span>  
 <span class="r6">   763 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    progressive </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;progressive&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">) </span><span class="r19">or</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;progression&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">)</span><span class="r9">             </span>  
 <span class="r6">   764 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   765 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    optimize </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;optimize&quot;</span><span class="r11">, </span><span class="r10">False</span><span class="r11">)</span><span class="r9">                                                     </span>  
 <span class="r6">   766 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   767 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    exif </span><span class="r15">=</span><span class="r11"> info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;exif&quot;</span><span class="r11">, </span><span class="r16">b&quot;&quot;</span><span class="r11">)</span><span class="r9">                                                               </span>  
 <span class="r6">   768 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> </span><span class="r20">isinstance</span><span class="r11">(exif, Image</span><span class="r15">.</span><span class="r11">Exif):</span><span class="r9">                                                           </span>  
 <span class="r6">   769 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exif </span><span class="r15">=</span><span class="r11"> exif</span><span class="r15">.</span><span class="r11">tobytes()</span><span class="r9">                                                                  </span>  
 <span class="r6">   770 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   771 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># get keyword arguments</span><span class="r9">                                                                    </span>  
 <span class="r6">   772 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im</span><span class="r15">.</span><span class="r11">encoderconfig </span><span class="r15">=</span><span class="r11"> (</span><span class="r9">                                                                       </span>  
 <span class="r6">   773 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        quality,</span><span class="r9">                                                                               </span>  
 <span class="r6">   774 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        progressive,</span><span class="r9">                                                                           </span>  
 <span class="r6">   775 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;smooth&quot;</span><span class="r11">, </span><span class="r15">0</span><span class="r11">),</span><span class="r9">                                                                 </span>  
 <span class="r6">   776 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        optimize,</span><span class="r9">                                                                              </span>  
 <span class="r6">   777 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        info</span><span class="r15">.</span><span class="r11">get(</span><span class="r16">&quot;streamtype&quot;</span><span class="r11">, </span><span class="r15">0</span><span class="r11">),</span><span class="r9">                                                             </span>  
 <span class="r6">   778 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        dpi[</span><span class="r15">0</span><span class="r11">],</span><span class="r9">                                                                                </span>  
 <span class="r6">   779 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        dpi[</span><span class="r15">1</span><span class="r11">],</span><span class="r9">                                                                                </span>  
 <span class="r6">   780 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        subsampling,</span><span class="r9">                                                                           </span>  
 <span class="r6">   781 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        qtables,</span><span class="r9">                                                                               </span>  
 <span class="r6">   782 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        comment,</span><span class="r9">                                                                               </span>  
 <span class="r6">   783 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        extra,</span><span class="r9">                                                                                 </span>  
 <span class="r6">   784 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        exif,</span><span class="r9">                                                                                  </span>  
 <span class="r6">   785 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    )</span><span class="r9">                                                                                          </span>  
 <span class="r6">   786 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   787 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># if we optimize, libjpeg needs a buffer big enough to hold the whole image</span><span class="r9">                </span>  
 <span class="r6">   788 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># in a shot. Guessing on the size, at im.size bytes. (raw pixel size is</span><span class="r9">                    </span>  
 <span class="r6">   789 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># channels*size, this is a value that&#x27;s been used in a django patch.</span><span class="r9">                       </span>  
 <span class="r6">   790 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># https://github.com/matthewwithanm/django-imagekit/issues/50</span><span class="r9">                              </span>  
 <span class="r6">   791 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r15">0</span><span class="r9">                                                                                </span>  
 <span class="r6">   792 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">if</span><span class="r11"> optimize </span><span class="r19">or</span><span class="r11"> progressive:</span><span class="r9">                                                                </span>  
 <span class="r6">   793 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># CMYK can be bigger</span><span class="r9">                                                                   </span>  
 <span class="r6">   794 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">mode </span><span class="r15">==</span><span class="r11"> </span><span class="r16">&quot;CMYK&quot;</span><span class="r11">:</span><span class="r9">                                                                  </span>  
 <span class="r6">   795 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r15">4</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                              </span>  
 <span class="r6">   796 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># keep sets quality to -1, but the actual value may be high.</span><span class="r9">                           </span>  
 <span class="r6">   797 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">elif</span><span class="r11"> quality </span><span class="r15">&gt;=</span><span class="r11"> </span><span class="r15">95</span><span class="r11"> </span><span class="r19">or</span><span class="r11"> quality </span><span class="r15">==</span><span class="r11"> </span><span class="r15">-1</span><span class="r11">:</span><span class="r9">                                                   </span>  
 <span class="r6">   798 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r15">2</span><span class="r11"> </span><span class="r15">*</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                              </span>  
 <span class="r6">   799 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">else</span><span class="r11">:</span><span class="r9">                                                                                  </span>  
 <span class="r6">   800 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            bufsize </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">0</span><span class="r11">] </span><span class="r15">*</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size[</span><span class="r15">1</span><span class="r11">]</span><span class="r9">                                                  </span>  
 <span class="r6">   801 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   802 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># The EXIF info needs to be written as one block, + APP1, + one spare byte.</span><span class="r9">                </span>  
 <span class="r6">   803 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># Ensure that our buffer is big enough. Same with the icc_profile block.</span><span class="r9">                   </span>  
 <span class="r6">   804 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    bufsize </span><span class="r15">=</span><span class="r11"> </span><span class="r20">max</span><span class="r11">(ImageFile</span><span class="r15">.</span><span class="r11">MAXBLOCK, bufsize, </span><span class="r20">len</span><span class="r11">(exif) </span><span class="r15">+</span><span class="r11"> </span><span class="r15">5</span><span class="r11">, </span><span class="r20">len</span><span class="r11">(extra) </span><span class="r15">+</span><span class="r11"> </span><span class="r15">1</span><span class="r11">)</span><span class="r9">                  </span>  
 <span class="r6">   805 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   806 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    ImageFile</span><span class="r15">.</span><span class="r11">_save(im, fp, [(</span><span class="r16">&quot;jpeg&quot;</span><span class="r11">, (</span><span class="r15">0</span><span class="r11">, </span><span class="r15">0</span><span class="r11">) </span><span class="r15">+</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">size, </span><span class="r15">0</span><span class="r11">, rawmode)], bufsize)</span><span class="r9">                 </span>  
 <span class="r6">   807 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   808 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   809 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">_save_cjpeg</span><span class="r11">(im, fp, filename):</span><span class="r9">                                                             </span>  
 <span class="r6">   810 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r14"># ALTERNATIVE: handle JPEGs via the IJG command line utilities.</span><span class="r9">                            </span>  
 <span class="r6">   811 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    tempfile </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">_dump()</span><span class="r9">                                                                      </span>  
 <span class="r6">   812 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    subprocess</span><span class="r15">.</span><span class="r11">check_call([</span><span class="r16">&quot;cjpeg&quot;</span><span class="r11">, </span><span class="r16">&quot;-outfile&quot;</span><span class="r11">, filename, tempfile])</span><span class="r9">                           </span>  
 <span class="r6">   813 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   814 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        os</span><span class="r15">.</span><span class="r11">unlink(tempfile)</span><span class="r9">                                                                    </span>  
 <span class="r6">   815 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">OSError</span><span class="r11">:</span><span class="r9">                                                                            </span>  
 <span class="r6">   816 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   817 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   818 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   819 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">##</span><span class="r9">                                                                                             </span>  
 <span class="r6">   820 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Factory for making JPEG and MPO instances</span><span class="r9">                                                    </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">def</span><span class="r11"> </span><span class="r17">jpeg_factory</span><span class="r11">(fp</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, filename</span><span class="r15">=</span><span class="r10">None</span><span class="r11">, logging</span><span class="r15">=</span><span class="r10">False</span><span class="r11">):</span><span class="r9">                                       </span>  
 <span class="r6">   822 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    im </span><span class="r15">=</span><span class="r11"> JpegImageFile(fp, filename, logging</span><span class="r15">=</span><span class="r11">logging)</span><span class="r9">                                          </span>  
 <span class="r6">   823 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   824 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">try</span><span class="r11">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   825 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        mpheader </span><span class="r15">=</span><span class="r11"> im</span><span class="r15">.</span><span class="r11">_getmp()</span><span class="r9">                                                                 </span>  
 <span class="r6">   826 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">if</span><span class="r11"> mpheader[</span><span class="r15">45057</span><span class="r11">] </span><span class="r15">&gt;</span><span class="r11"> </span><span class="r15">1</span><span class="r11">:</span><span class="r9">                                                                </span>  
 <span class="r6">   827 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># It&#x27;s actually an MPO</span><span class="r9">                                                             </span>  
 <span class="r6">   828 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r10">from</span><span class="r11"> </span><span class="r12">.MpoImagePlugin</span><span class="r11"> </span><span class="r10">import</span><span class="r11"> MpoImageFile</span><span class="r9">                                           </span>  
 <span class="r6">   829 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   830 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r14"># Don&#x27;t reload everything, just convert it.</span><span class="r9">                                        </span>  
 <span class="r6">   831 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            im </span><span class="r15">=</span><span class="r11"> MpoImageFile</span><span class="r15">.</span><span class="r11">adopt(im, mpheader)</span><span class="r9">                                              </span>  
 <span class="r6">   832 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> (</span><span class="r13">TypeError</span><span class="r11">, </span><span class="r13">IndexError</span><span class="r11">):</span><span class="r9">                                                            </span>  
 <span class="r6">   833 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r14"># It is really a JPEG</span><span class="r9">                                                                  </span>  
 <span class="r6">   834 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        </span><span class="r10">pass</span><span class="r9">                                                                                   </span>  
 <span class="r6">   835 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">except</span><span class="r11"> </span><span class="r13">SyntaxError</span><span class="r11">:</span><span class="r9">                                                                        </span>  
 <span class="r6">   836 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        warnings</span><span class="r15">.</span><span class="r11">warn(</span><span class="r9">                                                                         </span>  
 <span class="r6">   837 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;Image appears to be a malformed MPO file, it will be &quot;</span><span class="r9">                            </span>  
 <span class="r6">   838 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">            </span><span class="r16">&quot;interpreted as a base JPEG file&quot;</span><span class="r9">                                                  </span>  
 <span class="r6">   839 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">        )</span><span class="r9">                                                                                      </span>  
 <span class="r6">   840 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">    </span><span class="r10">return</span><span class="r11"> im</span><span class="r9">                                                                                  </span>  
 <span class="r6">   841 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   842 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   843 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># ---------------------------------------------------------------------</span><span class="r9">                        </span>  
 <span class="r6">   844 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14"># Registry stuff</span><span class="r9">                                                                               </span>  
 <span class="r6">   845 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   846 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">register_open(JpegImageFile</span><span class="r15">.</span><span class="r11">format, jpeg_factory, _accept)</span><span class="r9">                               </span>  
 <span class="r6">   847 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">register_save(JpegImageFile</span><span class="r15">.</span><span class="r11">format, _save)</span><span class="r9">                                               </span>  
 <span class="r6">   848 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   849 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">register_extensions(JpegImageFile</span><span class="r15">.</span><span class="r11">format, [</span><span class="r16">&quot;.jfif&quot;</span><span class="r11">, </span><span class="r16">&quot;.jpe&quot;</span><span class="r11">, </span><span class="r16">&quot;.jpg&quot;</span><span class="r11">, </span><span class="r16">&quot;.jpeg&quot;</span><span class="r11">])</span><span class="r9">            </span>  
 <span class="r6">   850 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   851 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">Image</span><span class="r15">.</span><span class="r11">register_mime(JpegImageFile</span><span class="r15">.</span><span class="r11">format, </span><span class="r16">&quot;image/jpeg&quot;</span><span class="r11">)</span><span class="r9">                                        </span>  
 <span class="r6">   852 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r24">function summary for /proj/prismgt-PG0/anaconda3/envs/torch2/lib/python3.10/site-packages/PIL/…</span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">_accept</span><span class="r9">                                                                            </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">Skip</span><span class="r9">                                                                             </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">APP</span><span class="r9">                                                                              </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">COM</span><span class="r9">                                                                              </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">SOF</span><span class="r9">                                                                              </span>  
 <span class="r6">   243 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">DQT</span><span class="r9">                                                                              </span>  
 <span class="r6">   351 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_open</span><span class="r9">                                                                            </span>  
 <span class="r6">   404 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">   2%  </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">load_read</span><span class="r9">                                                                        </span>  
 <span class="r6">   487 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">JpegImageFile</span><span class="r15">.</span><span class="r11">_getmp</span><span class="r9">                                                                           </span>  
 <span class="r6">   821 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">ImageFolder</span><span class="r15">.</span><span class="r11">jpeg_factory</span><span class="r9">                                                                       </span>  
        ╵        ╵       ╵       ╵                                                                                                 
generated by the <a class="r26" href="https://github.com/plasma-umass/scalene">scalene</a> profiler                                                                                                   
</code></pre>
</body>
</html>
